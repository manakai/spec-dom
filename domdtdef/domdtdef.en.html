<!DOCTYPE html><html class="formal-specification anolis" lang=en><head>
<title>XML processing and DOM Document Type Definitions</title>
<link href=http://suika.suikawiki.org/www/style/html/spec rel=stylesheet>
<link href=http://suika.suikawiki.org/www/style/def/dom rel=stylesheet>
<link href=http://suika.suikawiki.org/c/gnu/fdl rel=license>
</head>
<body class=has-abstract>

<div class=header>
<h1 class="no-toc no-num">XML processing and DOM Document Type Definitions</h1>
<h2 class="no-toc no-num" id=manakai-project-specification-date>Manakai Project Specification 25 February 2014</h2>

<dl class=versions-uri>
<dt>Latest version</dt>
  <dd><code class=URI>&lt;<a href=http://suika.suikawiki.org/www/markup/xml/domdtdef/domdtdef>http://suika.suikawiki.org/www/markup/xml/domdtdef/domdtdef</a>&gt;</code></dd>
<dt>Version history</dt>
  <dd><a href=#history>History</a>
</dd><dt id=author>Author</dt>
  <dd><a href=http://suika.suikawiki.org/~wakaba/who? lang=ja rel=author>Wakaba</a>
  <code class=mail>&lt;<a href=mailto:wakaba@suikawiki.org rel=author>wakaba@suikawiki.org</a>&gt;</code></dd>
</dl>

<p class=copyright id=license lang=en><a href=http://creativecommons.org/publicdomain/zero/1.0/ rel=license><img alt=CC0 src=http://i.creativecommons.org/p/zero/1.0/80x15.png></a> To the
extent possible under law, the editor has waived all copyright and
related or neighboring rights to this work.  In addition, as of
25 February 2014, the editor has made this specification available under the
<cite>Open Web Foundation Agreement Version 1.0</cite>, which is
available at <a href=http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0>http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0</a>.

</p></div>

<div class=section id=abstract>
<h2 class="no-toc no-num" id=abstract-0>Abstract</h2>

<p>This specification defines how various implementations of XML by <a href=https://github.com/manakai/>the manakai project</a> process XML
documents, including: how to parse XML documents; how information in
XML DTDs are represented in DOM; how base URLs are determined in XML
documents; how namespace prefixes are serialized; and how conformance
of XML documents are checked.

</p></div>

<div class=section id=status>
<h2 class="no-toc no-num" id=status-of-this-document>Status of This Document</h2>

<p class=section-info>This section describes the status of this document at the
time of its publication.  Other documents might supersede this document.</p>

<p>This document is a specification produced as part of <a href=https://github.com/manakai/>the manakai project</a>.  It is not
intended to be implemented by any other DOM or XML implementation,
although nothing prevents it from being implemented by any other
party.  It might be updated, replaced, or obsoleted by other documents
at any time.

</p><p class=ed>This specification was originllay developed in DOM3 age.
Most part of this document need to be rewritten to align with modern
Web standard specifications.

</p><p>Comments on this document are welcome and
may be sent to the <a href=#author>author</a>.</p>

<p>Translations of this document might be available.
The English version of the document is the only
normative version.</p>
</div>

<div class=section>
<h2 class="no-toc no-num" id=table-of-contents>Table of contents</h2>

<!--begin-toc-->
<ol class=toc>
 <li><a href=#introduction-0><span class=secno>1 </span>Introduction</a>
  <ol>
   <li><a href=#history-0><span class=secno>1.1 </span>History</a></li></ol></li>
 <li><a href=#conformance-requirements><span class=secno>2 </span>Conformance requirements</a>
  <ol>
   <li><a href=#terminology-0><span class=secno>2.1 </span>Terminology</a></li>
   <li><a href=#xml-versions><span class=secno>2.2 </span>XML versions</a></li></ol></li>
 <li><a href=#parsing-xml-documents><span class=secno>3 </span>Parsing XML documents</a>
  <ol>
   <li><a href=#character-encodings><span class=secno>3.1 </span>Character encodings</a></li>
   <li><a href=#expansion-of-entities><span class=secno>3.2 </span>Expansion of entities</a>
    <ol>
     <li><a href=#the-external-subset-entity><span class=secno>3.2.1 </span>The external subset entity</a></li>
     <li><a href=#parameter-entities><span class=secno>3.2.2 </span>Parameter entities</a></li>
     <li><a href=#general-entities><span class=secno>3.2.3 </span>General entities</a></li>
     <li><a href=#fetching-and-parsing-external-entities><span class=secno>3.2.4 </span>Fetching and parsing external entities</a></li></ol></li></ol></li>
 <li><a href=#dom-document-type-definitions><span class=secno>4 </span>DOM Document Type Definitions</a>
  <ol>
   <li><a href=#Node><span class=secno>4.1 </span>Nodes</a></li>
   <li><a href=#Document><span class=secno>4.2 </span>Documents</a></li>
   <li><a href=#document-types><span class=secno>4.3 </span>Document types</a></li>
   <li><a href=#element-types><span class=secno>4.4 </span>Element types</a></li>
   <li><a href=#attribute-definitions><span class=secno>4.5 </span>Attribute definitions</a></li>
   <li><a href=#general-entities-0><span class=secno>4.6 </span>General entities</a></li>
   <li><a href=#notations><span class=secno>4.7 </span>Notations</a></li></ol></li>
 <li><a href=#base-urls><span class=secno>5 </span>Base URLs</a></li>
 <li><a href=#xml-namespaces><span class=secno>6 </span>XML namespaces</a>
  <ol>
   <li><a href=#namespace-mappings><span class=secno>6.1 </span>Namespace mappings</a></li>
   <li><a href=#namespace-fixup-of-an-xml-element-for-serialization><span class=secno>6.2 </span>Namespace fixup of an XML element for serialization</a></li>
   <li><a href=#tests><span class=secno>6.3 </span>Tests</a></li></ol></li>
 <li><a href=#conformance-checking-of-xml-documents><span class=secno>7 </span>Conformance checking of XML documents</a>
  <ol>
   <li><a href=#processing-model-0><span class=secno>7.1 </span>Processing Model</a>
    <ol>
     <li><a href=#error-classification><span class=secno>7.1.1 </span>Error Classification</a></li></ol></li>
   <li><a href=#checking-an-xml-dom-tree><span class=secno>7.2 </span>Checking an <abbr>XML</abbr> <abbr>DOM</abbr> Tree</a>
    <ol>
     <li><a href=#definitions-0><span class=secno>7.2.1 </span>Definitions</a></li>
     <li><a href=#conformance-checking-algorithms-for-components><span class=secno>7.2.2 </span>Conformance Checking Algorithms for Components</a></li>
     <li><a href=#checking-node-0><span class=secno>7.2.3 </span>Checking <code>Node</code></a></li></ol></li>
   <li><a href=#character-classes><span class=secno>7.3 </span>Character Classes</a></li></ol></li>
 <li><a href=#obsolete-features><span class=secno>8 </span>Obsolete features</a>
  <ol>
   <li><a href=#the-dom-feature-string-for-the-dom-document-type-definitions><span class=secno>8.1 </span>The DOM feature string for the DOM Document Type Definitions</a></li>
   <li><a href=#obsolete-attribute><span class=secno>8.2 </span>Obsolete attribute</a></li></ol></li>
 <li><a class=no-num href=#references-0>References</a>
  <ol>
   <li><a class=no-num href=#normative-references-0>Normative References</a></li>
   <li><a class=no-num href=#non-normative-references>Non-normative References</a></li></ol></li></ol>
<!--end-toc-->
</div>

<div class=section id=introduction>
<h2 id=introduction-0><span class=secno>1 </span>Introduction</h2>

<p class=section-info>This section is <em>non-normative</em>.</p>

<p>This specification defines how various implementations of XML by <a href=https://github.com/manakai/>the manakai project</a> process XML
documents, including: how to parse XML documents; how information in
XML DTDs are represented in DOM; how base URLs are determined in XML
documents; how namespace prefixes are serialized; and how conformance
of XML documents are checked.

</p><p>In general, this specification does not intend to override
requirements imposed by various XML specifications.  It is not
intended to be implemented by any other DOM or XML implementation,
although nothing prevents it from being implemented by any other party
than <a href=https://github.com/manakai/>the manakai project</a>.
Especially, it is not intended to be implemented by Web browsers.  In
fact some of features in this specification (e.g. handling of external
entities) are not compatible with Web contents.

</p><div class=section id=history>
<h3 id=history-0><span class=secno>1.1 </span>History</h3>

<p class=section-info>This section is <em>non-normative</em>.</p>

<p>Most part of this specification was originally published as
<cite>DOM Document Type Definition</cite>.  The First Edition of the
<cite>DOM Document Type Definition</cite> specification is available
at <code class=URI>&lt;<a href=http://suika.suikawiki.org/www/markup/xml/domdtdef/domdtdef-20071209>http://suika.suikawiki.org/www/markup/xml/domdtdef/domdtdef-20071209</a>&gt;</code>.
After publishing of the First Edition, the specification had moved to
the Living Standard model.  Version history of that and <em>this</em>
specifications are available at <code class=URI>&lt;<a href=http://suika.suikawiki.org/gate/git/wi/markup/xmlexts.git/history/HEAD:/domdtdef/source.en.html>http://suika.suikawiki.org/gate/git/wi/markup/xmlexts.git/history/HEAD:/domdtdef/source.en.html</a>&gt;</code>.

</p><p>Some part of this specification is derived from the <a href=http://suika.suikawiki.org/www/markup/xml/xmlcc/xmlcc-work><cite>manakai's
<abbr>XML</abbr> Conformance Checking</cite></a> specification.
Revision history of the specification is available at <code class=URI>&lt;<a href=http://suika.suikawiki.org/gate/cvs/markup/xml/xmlcc/xmlcc-work.en.html>http://suika.suikawiki.org/gate/cvs/markup/xml/xmlcc/xmlcc-work.en.html</a>&gt;</code>.

</p><p>Some part of this specification is derived from the <a href=http://suika.suikawiki.org/www/markup/xml/nsfixup><cite>Namespace
fixup</cite></a> note, whose revision history is available at <code class=URI>&lt;<a href=http://suika.suikawiki.org/gate/git/wi/markup/xmlexts.git/history/HEAD:/nsfixup-source.en.html>http://suika.suikawiki.org/gate/git/wi/markup/xmlexts.git/history/HEAD:/nsfixup-source.en.html</a>&gt;</code>.

</p></div>

</div>

<div class=section id=conformance>
<h2 id=conformance-requirements><span class=secno>2 </span>Conformance requirements</h2>

<div class=section id=terminology>
<h3 id=terminology-0><span class=secno>2.1 </span>Terminology</h3>

<p>All examples and notes in this specification are non-normative,
as are all sections explicitly marked non-normative.</p>

<p class=ed>Known issues are marked like this.  They are non-normative.  <!--
However, this paragraph itself is normative.  One may argue that this paragraph
is non-normative, because this paragraph is marked as an editor's note. 
Anyway, the other editor's notes are non-normative. --></p>

<p>Everything else in this document is normative.</p>

<p>The key words <q><em class=rfc2119>MUST</em></q>,
<q><em class=rfc2119>MUST NOT</em></q>, and <q><em class=rfc2119>MAY</em></q>
in this document are to be interpreted as described in 
<a href=urn:ietf:rfc:2119><abbr title="Request for Comments">RFC</abbr> 
2119</a>
<cite class="bibref normative">[<a href=#ref-KEYWORDS>KEYWORDS</a>]</cite>.</p>

<p>Conformance requirements phrased as algorithms or specific steps 
<em class=rfc2119>MAY</em> be implemented in any manner, so long as the end
result is equivalent.  Requirements phrased in the imperative as part of 
algorithms are to be interpreted with the meaning of the key word used in 
introducing the algorithm.</p>

<div class=ed>

<p>The following paragraph is no longer applied, but
strictErrorChecking has effect for certain methods (need to define
them...)

</p><p>Sometimes an exception is phrased as being required to be raised.  As
specified in the <abbr>DOM</abbr> Core specification
<cite class="bibref normative">[<a href=#ref-DOM3CORE>DOM3CORE</a>]</cite>,
when the value of the <code>strictErrorChecking</code> attribute of the
<a href=#Document><code>Document</code></a> node is <code>false</code>,
then the exception is not have to be raised.</p>
</div>

<p>Some conformance requirements are phrased as requirements on interfaces,
attributes, methods, or objects.  Such requirements are applied to
implementations.</p>

<p>The construction <q>a <code><var title="">Foo</var></code> object</q>,
where <code><var title="">Foo</var></code> is an interface, is used
instead of the more accurate <q>an object implementing the interface
<code><var title="">Foo</var></code></q>.</p>

<p class=ed>The construction <q>raise a
<code><var>Bar</var></code></q>, where <code><var>Bar</var></code> is
an exception code, is used instead of the more accurate <q>raise an
exception implementing the interface <a href=#domexception><code>DOMException</code></a> <cite class="bibref normative">[<a href=#ref-DOM3CORE>DOM3CORE</a>]</cite>
with its <code>code</code> attribute set to
<code><var>Bar</var></code></q>.</p>

<p>The <em id=idl-fragment>WebIDL fragments</em> in this document are
to be interpreted as described in the WebIDL specification <cite class="bibref normative">[<a href=#ref-DOMBIND>DOMBIND</a>]</cite>.</p>

<p>The term <dfn id=null>null</dfn> is definedby the WebIDL specification
<cite class="bibref normative">[<a href=#ref-DOMBIND>DOMBIND</a>]</cite>.

</p><p>The terms, interfaces, attributes, and exceptions <dfn id=context-object>context
object</dfn>, <dfn id=concept-tree-child title=concept-tree-child>child</dfn>, <dfn id=concept-tree-parent title=concept-tree-parent>parent</dfn>, <dfn id=node>node</dfn> or
<dfn id=node-0><code>Node</code></dfn> (which has <dfn id=dom-node-nodename title=dom-Node-nodeName><code>nodeName</code></dfn>, <dfn id=concept-node-adopt title=concept-node-adopt>adopt</dfn>, <dfn id=concept-node-document title=concept-node-document>node document</dfn>, <dfn id=concept-node-clone title=concept-node-clone>clone</dfn>, <dfn id=concept-node-base-url title=concept-node-base-url>base URL</dfn>), <dfn id=document>document</dfn> or
<dfn id=document-0><code>Document</code></dfn> (which has <dfn id=dom-document-doctype title=dom-Document-doctype><code>doctype</code></dfn>), <dfn id=xml-document>XML
document</dfn>, <dfn id=html-document>HTML document</dfn>, <dfn id=concept-element title=concept-element>element</dfn> or <dfn id=element><code>Element</code></dfn>
(which has <dfn id=concept-element-namespace title=concept-element-namespace>namespace</dfn>, <dfn id=concept-element-namespace-prefix title=concept-element-namespace-prefix>namespace prefix</dfn>, <dfn id=concept-element-local-name title=concept-element-local-name>local name</dfn>, and <dfn id=concept-element-attribute title=concept-element-attribute>attribute list</dfn>), <dfn id=concept-attribute title=concept-attribute>attribute</dfn> or
<dfn id=attr><code>Attr</code></dfn> (which has <dfn id=concept-attribute-namespace title=concept-attribute-namespace>namespace</dfn>, <dfn id=concept-attribute-namespace-prefix title=concept-attribute-namespace-prefix>namespace prefix</dfn>, <dfn id=concept-attribute-local-name title=concept-attribute-local-name>local name</dfn>, and <dfn id=concept-attribute-value title=concept-attribute-value>value</dfn>), <dfn id=concept-doctype title=concept-doctype>doctype</dfn> or
<dfn id=documenttype><code>DocumentType</code></dfn> (which has <dfn id=concept-doctype-name title=concept-doctype-name>doctype name</dfn> and <dfn id=dom-documenttype-systemid title=dom-DocumentType-systemId><code>systemId</code></dfn>), <dfn id=xml-namespace>XML
namespace</dfn>, <dfn id=xmlns-namespace>XMLNS namespace</dfn>, <dfn id=in-a-document>in a document</dfn>,
<dfn id=concept-collection title=concept-collection>collection</dfn>, <dfn id=throw>throw</dfn>,
<dfn id=domexception><code>DOMException</code></dfn>,
<dfn id=hierarchyrequesterror><code>HierarchyRequestError</code></dfn>,
<dfn id=invalidcharactererror><code>InvalidCharacterError</code></dfn>, and
<dfn id=notfounderror><code>NotFoundError</code></dfn> are defined by the DOM Standard
<cite class="bibref normative">[<a href=#ref-DOM>DOM</a>]</cite>.

</p><p>The terms and steps <em id=live><a href=http://www.whatwg.org/specs/web-apps/current-work/#live>live</a></em>,
<dfn id=xml-mime-type>XML MIME type</dfn>, <dfn id=document-base-url>document base URL</dfn>, <dfn id="the-document's-address">the
document's address</dfn>, <dfn id=resolve-a-url title="resolve a URL">resolve a
URL</dfn>, <dfn id=content-type-metadata>Content-Type metadata</dfn>, <dfn id=willful-violation>willful
violation</dfn>, <dfn id=xml-parser>XML parser</dfn>, <em id=setting>setting</em>
and <em id=getting>getting</em> of an attribute, <dfn id=concept-task title=concept-task>task</dfn>, <dfn id=queue-a-task>queue a task</dfn>, <dfn id=parser-pause-flag>parser
pause flag</dfn>, <dfn id=input-byte-stream>input byte stream</dfn>, <dfn id=character-token>character
token</dfn>, <!-- <dfn>acknowledge self-closing flag</dfn>, -->
<dfn id=character-reference-in-attribute-value-state>character reference in attribute value state</dfn>, <dfn id=consume-a-character-reference>consume
a character reference</dfn>, <dfn id=additional-allowed-character>additional allowed character</dfn>,
<dfn id=named-character-references>named character references</dfn>, and <dfn id=stops-parsing>stops parsing</dfn>
are defined in the HTML Standard <cite class="bibref normative">[<a href=#ref-HTML>HTML</a>]</cite>.</p>

<p>The interfaces and attributes
<dfn id=namednodemap><code>NamedNodeMap</code></dfn><!-- XXX or AttrExodus? -->, <a href=http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/DOM3-Core.html#core-ID-1788794630><dfn id=dom-documenttype-entities title=dom-DocumentType-entities><code>entities</code></dfn></a>, <a href=http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/DOM3-Core.html#core-ID-D46829EF><dfn id=dom-documenttype-notations title=dom-DocumentType-notations><code>notations</code></dfn></a>,
<dfn id=entity><code>Entity</code></dfn>, and <dfn id=notation><code>Notation</code></dfn>
are defined in the DOM3 Core specification <cite class="bibref
normative">[<a href=#ref-DOM3CORE>DOM3CORE</a>]</cite>.

</p><p>The term <dfn id=concept-attribute-owner-element title=concept-attribute-owner-element>owner
element</dfn> is defined in the <cite>Manakai DOM Extensions</cite>
specification <cite class="bibref normative">[<a href=#ref-MANAKAI>MANAKAI</a>]</cite>.

</p><p>The terms <a href=http://www.w3.org/TR/xml/#NT-Name><dfn id=name><code>Name</code></dfn></a>,
<dfn id=internal-entity>internal entity</dfn>, <dfn id=external-entity>external entity</dfn>, <dfn id=unparsed-entity>unparsed
entity</dfn>, <dfn id=general-entity>general entity</dfn>, <dfn id=parameter-entity>parameter entity</dfn>,
<dfn id=internal-subset>internal subset</dfn>, <dfn id=external-subset>external subset</dfn>, <dfn id=xml-declaration>XML
declaration</dfn>, <dfn id=text-declaration>text declaration</dfn>, <dfn id=attr-xml-version title=attr-xml-version><code>version</code></dfn> pseudo-attribute,
<dfn id=attr-xml-encoding title=attr-xml-encoding><code>encoding</code></dfn>
pseudo-attribute, <dfn id=attr-xml-standalone title=attr-xml-standalone><code>standalone</code></dfn>
pseudo-attribute, and <dfn id=replacement-text>replacement text</dfn> are defined in the
XML 1.0 specification <cite class="bibref normative">[<a href=#ref-XML>XML</a>]</cite>.

</p><p>The terms <dfn id=parse-error>parse error</dfn>, <dfn id=input-stream>input stream</dfn>,
<dfn id=tokenization>tokenization</dfn>, <dfn id=character-token-0>character token</dfn>, <dfn id=end-tag-token>end tag
token</dfn>, <dfn id=tree-construction>tree construction</dfn>, <dfn id=phase>phase</dfn>,
<dfn id=start-phase>start phase</dfn>, <dfn id=main-phase>main phase</dfn>, <dfn id=end-phase>end phase</dfn>,
<dfn id=stack-of-open-elements>stack of open elements</dfn>, <dfn id=current-element>current element</dfn>,
<dfn id=list-of-entities>list of entities</dfn>, <dfn id=list-of-parameter-entities>list of parameter entities</dfn>,
<dfn id=append-an-entity>append an entity</dfn>, and <dfn id=entity-flag>entity flag</dfn> are defined in
the XML5 specification <cite class="bibref normative">[<a href=#ref-XML5>XML5</a>]</cite>.

</p><p>The <dfn id=predefined-entity-names>predefined entity names</dfn> are <code>apos</code>,
<code>amp</code>, <code>lt</code>, <code>gt</code>, and
<code>quot</code>.

</p><p>The terms <dfn id=concept-fetch title=concept-fetch>fetch</dfn>, <dfn id=concept-request title=concept-request>request</dfn>, <dfn id=concept-response title=concept-response>response</dfn>, <dfn id=concept-response-type title=concept-response-type>type</dfn>, <dfn id=concept-response-body title=concept-response-body>body</dfn>, <dfn id=process-response>process response</dfn>,
<dfn id=process-response-body>process response body</dfn>, and <dfn id=process-response-end-of-file>process response
end-of-file</dfn> are defined in the Fetch Standard <cite class="bibref normative">[<a href=#ref-FETCH>FETCH</a>]</cite>.

</p><div class=ed>
<p>Following paragraph need to be updated:

</p><p>Some <abbr>IDL</abbr> fragments are presented as <i>patch</i> to an
<abbr>IDL</abbr> fragment defined in another document.  They are to be
interpreted as an instance of
<a href=http://www.w3.org/TR/2007/WD-DOM-Bindings-20071017/#proddef-InterfaceMembers><code>InterfaceMembers</code></a>
<cite class="bibref normative">[<a href=#ref-DOMBIND>DOMBIND</a>]</cite>.
If the <abbr>IDL</abbr> fragment to which the <i>patch</i> is applied has any 
instance of
<a href=http://www.w3.org/TR/2007/WD-DOM-Bindings-20071017/#proddef-InterfaceMember><code>InterfaceMember</code></a>
with same 
<a href=http://www.w3.org/TR/2007/WD-DOM-Bindings-20071017/#prod-identifier><code>identifier</code></a>
part as that of an instance of 
<a href=http://www.w3.org/TR/2007/WD-DOM-Bindings-20071017/#proddef-InterfaceMember><code>InterfaceMember</code></a>
in the <i>patch</i>, then the former instance of
<a href=http://www.w3.org/TR/2007/WD-DOM-Bindings-20071017/#proddef-InterfaceMember><code>InterfaceMember</code></a>
<em class=rfc2119>MUST</em> be ignored.</p>

</div>

</div><!-- section -->

<div class=section>
<h3 id=xml-versions><span class=secno>2.2 </span>XML versions</h3>

<p>Implementations of this specification <em class=rfc2119>MUST</em>
support features defined in <cite>XML 1.0</cite> <cite class="bibref
normative">[<a href=#ref-XML>XML</a>]</cite> and <cite>Namespaces in
XML 1.0</cite> <cite class="bibref normative">[<a href=#ref-XMLNS>XMLNS</a>]</cite> specifications.

</p><p>Unless explicitly specified, featurs in this specification does not
support XML 1.1.

</p><p>This document sometimes cites parts of XML 1.0 and Namespaces in
XML 1.0 specifications by hyperlinks.  If such a requirement is
applied to XML 1.1, however, they should be read as references to
<cite>XML 1.1</cite> <cite class="bibref normative">[<a href=#ref-XML11>XML11</a>]</cite> and <cite>Namespaces in XML
1.1</cite> <cite class="bibref normative">[<a href=#ref-XMLNS11>XMLNS11</a>]</cite> specifications.

</p><p class=ed>XXX Should we drop XML 1.1 support entirely?

</p><p>This specification does not specify which edition of relevant
specifications has to be supported.

</p></div>

</div><!-- section -->


<div class=section id=parsing-xml>
<h2 id=parsing-xml-documents><span class=secno>3 </span>Parsing XML documents</h2>

<p>This section defines additional requirements for an <a href=#xml-parser>XML
parser</a>.

</p><p>An <a href=#xml-parser>XML parser</a> <em class=rfc2119>MUST</em> parse an XML
document as specified in the XML5 <cite class="bibref normative">[<a href=#ref-XML5>XML5</a>]</cite> specification.

</p><p class=ed>XXX If steps for an <a href=#xml-parser>XML parser</a> is not yet
defined, similar steps for an <span>HTML parser</span> has to be used
instead.  Changes to HTML tokenizer made after XML5 has been specced
must also be applied to XML tokenizer, where possible.  Even for such
cases, if the input is not well-formed, it is a <a href=#parse-error>parse
error</a>.  There are <dfn id=before-xml-declaration-phase>before XML declaration phase</dfn>,
<dfn id=before-document-type-phase>before document type phase</dfn>, and <dfn id=document-type-phase>document type
phase</dfn> in the <a href=#tree-construction>tree construction</a> stage.  XML
namespaces must also be supported.  The <a href=#xml-parser>XML parser</a> has
the <dfn id=entity-body-phase>entity body phase</dfn>, which is initially set to the
<a href=#before-document-type-phase>before document type phase</a>.  It is used as the next
<a href=#phase>phase</a> of the <a href=#before-xml-declaration-phase>before XML declaration phase</a>.

</p><p>An <dfn id=xml-tokenizer>XML tokenizer</dfn> is a component of the <a href=#xml-parser>XML
parser</a> performing <a href=#tokenization>tokenization</a>.  An <a href=#input-stream>input
stream</a> is associated with the <a href=#xml-tokenizer title="XML
tokenizer">tokenizer</a>.  Initially, an <a href=#xml-parser>XML parser</a>
has an associated <a href=#xml-tokenizer title="XML tokenizer">tokenizer</a> and
<a href=#input-stream>input stream</a>.  An <a href=#xml-parser>XML parser</a> has a
<dfn id=stack-of-tokenizers>stack of tokenizers</dfn>, which is initially empty.

</p><p>The <a href=#xml-parser>XML parser</a> has <dfn id=expose-dtd-content>expose DTD content</dfn> and
<dfn id=expand-external-entities>expand external entities</dfn> flags.  Unless explicitly stated,
these flags are unset.

  </p><div class="note memo">

  <p>DOM APIs such as <code title=dom-Element-innerHTML>innerHTML</code> and
  <code>DOMParser</code> do not set these flags.

  </p></div>

<p>Each entry in the <a href=#list-of-entities>list of entities</a> of an <a href=#xml-parser>XML
parser</a> have the <dfn id=concept-entity-open title=concept-entity-open>open</dfn> flag,
which is initiall unset.

</p><p>When the <a href=#xml-parser>XML parser</a> has to <a href=#append-an-entity>append an
entity</a>, it <em class=rfc2119>MUST</em> do nothing in following
cases:

  </p><ul>

  <li>If the <a href=#entity-flag>entity flag</a> is "normal" and the entity name
  is one of <a href=#predefined-entity-names>predefined entity names</a>,

  </li><li>If the <a href=#entity-flag>entity flag</a> is "normal" and the <a href=#list-of-entities>list
  of entities</a> contains an entity with same name, or

  </li><li>If the <a href=#entity-flag>entity flag</a> is "parameter" and the
  <a href=#list-of-parameter-entities>list of parameter entities</a> contains an entity with same
  name.

  </li><li class=ed>XXX stop processing flag is set

  </li></ul>

<!-- When a start tag token is emitted with its <i>self-closing
flag</i> set, the flag <em class=rfc2119>MUST</em> be <span
title="acknowledge self-closing flag">acknowledged</span>. -->

<p>If the <a href=#expose-dtd-content>expose DTD content</a> flag is set, the <span title="element definition">element</span>, <span title="attribute
definition">attribute list</span>, <span title="unparsed entity
definition">unparsed entity</span>, and <span title="notation
definition">notation</span> declarations, as well as <span title="processing instruction">processing instructions</span> in DTD,
<em class=rfc2119>MUST</em> be exposed to the DOM through the
<a href=#documenttype><code>DocumentType</code></a> object.<!-- XXX Need stricter definition -->

</p><div class=section>
<h3 id=character-encodings><span class=secno>3.1 </span>Character encodings</h3>

<p class=ed>The value of the <code title=attr-xml-encodingmake>encoding</code> pseudo-attribute or the
<code>charset</code> parameter <em class=rfc2119>MUST</em> be
interpreted as an <span>encoding label</span> defined by the
<span>Encoding Standard</span>.

</p></div>

<div class=section>
<h3 id=expansion-of-entities><span class=secno>3.2 </span>Expansion of entities</h3>

<div class=section>
<h4 id=the-external-subset-entity><span class=secno>3.2.1 </span>The external subset entity</h4>

<p>Just before the <a href=#phase>phase</a> is switched from the
<a href=#before-document-type-phase>before document type phase</a> to the <a href=#start-phase>start
phase</a>, the <a href=#xml-parser>XML parser</a> <em class=rfc2119>MUST</em>
run the following steps:

  </p><ol>

  <li>Let <var title="">doctype</var> be the <a href=#dom-document-doctype><code title=dom-Document-doctype>doctype</code></a> of the
  <a href=#document-0><code>Document</code></a>.

  </li><li>If <var title="">doctype</var> is null, abort these steps.

  </li><li>Let <var title="">system ID</var> be the <a href=#dom-documenttype-systemid><code title=dom-DocumentType-systemId>systemId</code></a> of <var title="">doctype</var>.

  </li><li>If <var title="">system ID</var> is the empty string, abort these
  steps.

  </li><li class=ed>XXX public ID

  </li><li>Invoke the <a href=#parse-an-entity>parse an entity</a> steps with following
  parameters:

    <dl>

    <dt><var title="">entity</var>
    </dt><dd>The <a href=#external-subset>external subset</a>.

    </dd><dt><var title="">url</var>
    </dt><dd>The result of <a href=#resolve-a-url title="resolve a URL">resolving</a>
    <var title="">system ID</var> against the <a href=#concept-node-base-url title=concept-node-base-url>base URL</a> of <var title="">doctype</var>.

    </dd><dt><var title="">original phase</var>
    </dt><dd>The <a href=#phase>phase</a> of the <a href=#xml-parser>XML parser</a>.

    </dd><dt><var title="">entity body phase</var>
    </dt><dd>The <a href=#document-type-phase>document type phase</a>.

    </dd></dl>

  </li></ol>

  <div class="note memo">

  <p>The <a href=#external-subset>external subset</a> is parsed and processed after
  the <a href=#internal-subset>internal subset</a>, if any.

  </p></div>

</div>

<div class=section>
<h4 id=parameter-entities><span class=secno>3.2.2 </span>Parameter entities</h4>

<p>To <dfn id=consume-a-parameter-entity>consume a parameter entity</dfn>, the <a href=#xml-parser>XML
parser</a> <em class=rfc2119>MUST</em> run these steps:

  </p><ol>

  <li class=ed>XXX

  </li></ol>

</div>

<div class=section>
<h4 id=general-entities><span class=secno>3.2.3 </span>General entities</h4>

<p>When the steps to <a href=#consume-a-character-reference>consume a character reference</a> is
applied to an <a href=#xml-parser>XML parser</a>, the following requirements in
this section is applied.</p>

  <div class="note memo">

  <p>The steps to <a href=#consume-a-character-reference>consume a character reference</a> is
  defined in the <span>HTML Standard</span> for the <span>HTML
  parser</span>.  This section monkeypatches the steps to implement
  XML-specific rules.<!-- XXX character reference (not entity)
  handling need also to be patched for 0x80-0x9F range... -->

  </p></div>

<p>If the <a href=#stack-of-open-elements>stack of open elements</a> is empty and the state
is not the <a href=#character-reference-in-attribute-value-state>character reference in attribute value state</a>
when the steps to <a href=#consume-a-character-reference>consume a character reference</a> is
invoked, this is a <a href=#parse-error>parse error</a>.

</p><p>Each entity in the <a href=#list-of-entities>list of entities</a> <em class=rfc2119>MUST</em> be appendded to the table of the <a href=#named-character-references>named
character references</a> as a row, where the first column is the
name of the entity followed by a <code>U+003B</code> <code class=charname>SEMICOLON</code> character (<code>;</code>).  If the
table already has a row whose first column is equal to the first
column of the new row, the existing row <em class=rfc2119>MUST</em> be
replaced by the new row.

</p><p>If a row from the original <a href=#named-character-references>named character references</a>
table is used, the first column of the row ends with a
<code>U+003B</code> <code class=charname>SEMICOLON</code> character
(<code>;</code>), and the first column of the row is none of
<a href=#predefined-entity-names>predefined entity names</a>, this is a <a href=#parse-error>parse
error</a>.

</p><p>When <a href=#character-token-0 title="character token">character tokens</a> are
returned using the second column of the table, an <a href=#xml-parser>XML
parser</a> <em class=rfc2119>MUST</em> run these steps:

</p><ol>

<li>Let <var title="">entity</var> be the entity of the selected row.

</li><li>If <var title="">entity</var> is an <a href=#unparsed-entity>unparsed entity</a>,
this is a <a href=#parse-error>parse error</a>.  Return nothing and abort the
<a href=#consume-a-character-reference>consume a character reference</a> steps.

</li><li>If the <a href=#concept-entity-open title=concept-entity-open>open</a> flag of the
entry for <var title="">entity</var> in the <a href=#list-of-entities>list of entities</a>
of the <a href=#xml-parser>XML parser</a> is set, this is a <a href=#parse-error>parse
error</a>.  Return nothing and abort the <a href=#consume-a-character-reference>consume a character
reference</a> steps.

</li><li>If these steps are invoked in the <a href=#character-reference-in-attribute-value-state>character reference in
attribute value state</a>:

  <ol>

  <li>If <var title="">entity</var> is an <a href=#external-entity>external entity</a>,
  this is a <a href=#parse-error>parse error</a>.  Return nothing and abort the
  <a href=#consume-a-character-reference>consume a character reference</a> steps.

  </li><li>Let <var title="">replacement text</var> be the <a href=#replacement-text>replacement
  text</a> of <var title="">entity</var>.

  </li><li>If <var title="">replacement text</var> contains a
  <code>U+003C</code> <code class=charname>LESS THAN SIGN</code>
  character (<code>&lt;</code>), this is a <a href=#parse-error>parse error</a>.
  Return nothing and abort the <a href=#consume-a-character-reference>consume a character
  reference</a> steps.

  </li><li>Set the <a href=#concept-entity-open title=concept-entity-open>open</a> flag of the
  entry for <var title="">entity</var> in the <a href=#list-of-entities>list of
  entities</a> of the <a href=#xml-parser>XML parser</a>.

  </li><li>Let <var title="">s</var> be the empty string.

  </li><li><i>Loop</i>: If <var title="">replacement text</var> is the empty
  string, go to the step labeled <i>end</i>.

  </li><li>If the first character in <var title="">replacement text</var> is
  not a <code>U+0026</code> <code class=charname>AMPERSAND</code>
  character (<code>&amp;</code>), append the character to <var title="">s</var> and remove the character from <var title="">replacement
  text</var>.

  </li><li>If the first character in <var title="">replacement text</var> is a
  <code>U+0026</code> <code class=charname>AMPERSAND</code> character
  (<code>&amp;</code>):

  <ol>

  <li>Attempt to <a href=#consume-a-character-reference>consume a character reference</a> steps
  recursively, with no <a href=#additional-allowed-character>additional allowed character</a>.
  Those steps <em class=rfc2119>MUST</em> behave as if the <a href=#input-stream>input
  stream</a> were <var title="">replacement text</var> and remove the
  characters consumed from <var title="">replacement text</var>.

  </li><li>If nothing is returned, append a <code>U+0026</code> <code class=charname>AMPERSAND</code> character (<code>&amp;</code>) to <var title="">s</var> and remove the first character from <var title="">replacement text</var>.

  </li><li>Otherwise, append the characters represented by the returned
  <a href=#character-token-0 title="character token">character tokens</a> to <var title="">s</var>.

  </li></ol>

  </li><li>Go to the step labeled <i>loop</i>.

  </li><li><i>End</i>: Unset the <a href=#concept-entity-open title=concept-entity-open>open</a> flag of the entry for <var title="">entity</var> in the <a href=#list-of-entities>list of entities</a> of the
  <a href=#xml-parser>XML parser</a>.

  </li><li>Return <a href=#character-token-0 title="character token">character tokens</a>
  equivalent to characters in <var title="">s</var> and abort the
  <a href=#consume-a-character-reference>consume a character reference</a> steps.

  </li></ol>

</li><li>Otherwise:

  <ol>

  <li>If the <a href=#phase>phase</a> of the <a href=#tree-construction>tree construction</a>
  stage is not the <a href=#main-phase>main phase</a>, return nothing and abort
  the <a href=#consume-a-character-reference>consume a character reference</a> steps.

  </li><li>Invoke the <a href=#parse-an-entity>parse an entity</a> steps with following
  parameters:

    <dl>

    <dt><var title="">entity</var>
    </dt><dd><var title="">entity</var>

    </dd><dt><var title="">url</var>
    </dt><dd>The result of <a href=#resolve-a-url title="resolve a URL">resolving</a> the
    <a href=#concept-entity-systemid title=concept-entity-systemID>system ID</a> of <var title="">entity</var> against the <a href=#concept-effective-declaration-base-url title=concept-effective-declaration-base-url>effective declaration
    base URL</a> of <var title="">entity</var>, if <var title="">entity</var> is an <a href=#external-entity>external entity</a>, or null.

    </dd><dt><var title="">original phase</var>
    </dt><dd>The <a href=#main-phase>main phase</a>.

    </dd><dt><var title="">entity body phase</var>
    </dt><dd>The <a href=#main-phase>main phase</a>.

    </dd></dl>

  </li><li>Return zero <a href=#character-token-0 title="character token">character
  tokens</a> and abort the <a href=#consume-a-character-reference>consume a character
  reference</a> steps.

  </li></ol>

</li></ol>

  <div class="note memo">

  <p>The number of <a href=#character-token-0 title="character token">character
  tokens</a> returned by these steps can be zero, which is
  different from returning nothing.

  </p></div>

</div>

<div class=section>
<h4 id=fetching-and-parsing-external-entities><span class=secno>3.2.4 </span>Fetching and parsing external entities</h4>

<p>To <dfn id=parse-an-entity>parse an entity</dfn> <var title="">entity</var> with <var title="">url</var>, <var title="">original phase</var>, and <var title="">entity body phase</var>, the <a href=#xml-parser>XML parser</a> <em class=rfc2119>MUST</em> run these steps:

  </p><ol>

  <li>Set the <a href=#concept-entity-open title=concept-entity-open>open</a> flag of the
  entry for <var title="">entity</var> in the <a href=#list-of-entities>list of
  entities</a> of the <a href=#xml-parser>XML parser</a> if <var title="">entity</var> is a <a href=#general-entity>general entity</a>.

  </li><li>Push a <dfn id=entity-boundary-marker title="entity boundary marker">marker</dfn> to the
  <a href=#stack-of-open-elements>stack of open elements</a>.  This marker is referenced
  later in this section, but is ignored for any other purposes.
  (Especially, the <a href=#current-element>current element</a> can never be a <a href=#entity-boundary-marker title="entity boundary marker">marker</a>.)

  </li><li>Set the <a href=#parser-pause-flag>parser pause flag</a> of the <a href=#xml-tokenizer title="XML
  tokenizer">tokenizer</a> of the <a href=#xml-parser>XML parser</a> to true.

  </li><li>Block the <a href=#xml-tokenizer title="XML tokenizer">tokenizer</a> of the
  <a href=#xml-parser>XML parser</a>, such that the <span>event loop</span> will
  not run <a href=#concept-task title=concept-task>tasks</a> that invoke the <a href=#xml-tokenizer title="XML tokenizer">tokenizer</a>.

  </li><li>Push the current <a href=#xml-tokenizer title="XML tokenizer">tokenizer</a> of
  the <a href=#xml-parser>XML parser</a> to the <a href=#stack-of-tokenizers>stack of tokenizers</a>.

  </li><li>If <var title="">entity</var> is an <a href=#internal-entity>internal entity</a>,
  the <a href=#expand-external-entities>expand external entities</a> flag is unset, or <var title="">url</var> is in error:

    <ol>

    <li>Set the <a href=#xml-tokenizer title="XML tokenizer">tokenizer</a> of the
    <a href=#xml-parser>XML parser</a> to a new <a href=#xml-tokenizer title="XML
    tokenizer">tokenizer</a> whose <a href=#input-stream>input stream</a> is
    <a href=#replacement-text>replacement text</a> of <var title="">entity</var>, if it is
    an <a href=#internal-entity>internal entity</a>, or the empty string.

    </li></ol>

    <div class="note memo">

    <p>If the <a href=#expand-external-entities>expand external entities</a> flag is unset, a
    reference to the <a href=#external-entity>external entity</a> is expanded to the
    empty string.

    </p></div>

  </li><li>Otherwise:

    <ol>

    <li>Let <var title="">referrer</var> be <span class=ed>XXX
    <span>document's address</span> of the <a href=#document-0><code>Document</code></a> of
    the <a href=#xml-parser>XML parser</a>, if referrer is enabled, or
    null</span>.

    </li><li>Let <var title="">req</var> be a <a href=#concept-request title=concept-request>request</a> with <span title=concept-request-url>url</span> <var title="">url</var> and
    <span title=concept-request-referrer>referrer</span> <var title="">referrer</var>.

    </li><li>Invoke the <a href=#concept-fetch title=concept-fetch>fetch</a> steps using
    <var title="">req</var>.  The <a href=#concept-task title=concept-task>tasks</a>
    <a href=#queue-a-task title="queue a task">queued</a> by the <a href=#concept-fetch title=concept-fetch>fetch</a> algorithm <em class=rfc2119>MUST</em> run these steps:

      <dl class=switch>

      <dt>If it is a <a href=#concept-task title=concept-task>task</a> to
      <a href=#process-response>process response</a>

      </dt><dd>If the <a href=#concept-response-type title=concept-response-type>type</a> of the
      <a href=#concept-response title=concept-response>response</a> of the <a href=#concept-fetch title=concept-fetch>fetch</a> is <em>not</em> <i title="">default</i>, append the "EOF" character to the <a href=#input-byte-stream>input
      byte stream</a> of the current <a href=#xml-tokenizer title="XML
      tokenizer">tokenizer</a> of the <a href=#xml-parser>XML parser</a>.

      </dd><dt>If it is a <a href=#concept-task title=concept-task>task</a> to
      <a href=#process-response-body>process response body</a>

      </dt><dd>If the <a href=#concept-response-type title=concept-response-type>type</a> of the
      <a href=#concept-response title=concept-response>response</a> of the <a href=#concept-fetch title=concept-fetch>fetch</a> is <i title="">default</i>, append
      newly-arrived bytes in <a href=#concept-response-body title=concept-response-body>body</a> of the <a href=#concept-response title=concept-response>response</a> to the <a href=#input-byte-stream>input byte
      stream</a> of the current <a href=#xml-tokenizer title="XML
      tokenizer">tokenizer</a> of the <a href=#xml-parser>XML parser</a>.

      </dd><dt>If it is a <a href=#concept-task title=concept-task>task</a> to
      <a href=#process-response-end-of-file>process response end-of-file</a>

      </dt><dd>Append the "EOF" character to the <a href=#input-byte-stream>input byte
      stream</a> of the current <a href=#xml-tokenizer title="XML
      tokenizer">tokenizer</a> of the <a href=#xml-parser>XML parser</a>.

      </dd></dl>

    </li><li>Set the <a href=#xml-tokenizer title="XML tokenizer">tokenizer</a> of the
    <a href=#xml-parser>XML parser</a> to a new <a href=#xml-tokenizer title="XML
    tokenizer">tokenizer</a>.

    </li><li>Set the <a href=#phase>phase</a> of the <a href=#tree-construction>tree
    construction</a> stage of the <a href=#xml-parser>XML parser</a> to
    <a href=#before-xml-declaration-phase>before XML declaration phase</a> and <a href=#entity-body-phase>entity body
    phase</a> to <var title="">entity body phase</var>.

      <div class="note memo">

      <p>The <a href=#before-xml-declaration-phase>before XML declaration phase</a> is used to
      parse the <a href=#text-declaration>text declaration</a> in the <a href=#external-entity>external
      entity</a>, if any.

      </p></div>

    </li></ol>

    <p>When decoding the <a href=#input-byte-stream>input byte stream</a>, the character
    encoding given in the <a href=#content-type-metadata>Content-Type metadata</a> (e.g. the
    <code>charset</code> parameter) <em class=rfc2119>MUST</em> be
    taken into account.  However, the <span>MIME type</span> itself is
    ignored.

      </p><div class="note memo">

      <p>An <a href=#external-entity title="external entity">external</a>
      <a href=#general-entity>general entity</a> can be served with various <span title="MIME type">MIME types</span>, including but not limited
      to: <code>application/xml-dtd</code>,
      <code>text/xml-parsed-entity</code>,
      <code>application/xml-parsed-entity</code>, various <a href=#xml-mime-type title="XML MIME type">XML MIME types</a>,
      <code>text/sgml</code>, <code>application/sgml</code>,
      <code>text/plain</code>, and
      <code>application/octet-stream</code>.

      </p></div>

    <p class=ed>XXX set some error flag if external entity is not
    expanded

    </p><p class=ed>XXX interaction of <code>standalone=yes</code> and
    external entity reference??

  </p></li></ol>

<p>While the <a href=#stack-of-tokenizers>stack of tokenizers</a> is <em>not</em> empty,
for the purpose of the processing of an <a href=#end-tag-token>end tag token</a>
only, the <a href=#xml-parser>XML parser</a> <em class=rfc2119>MUST</em> act as
if the <a href=#stack-of-open-elements>stack of open elements</a> does not contain the <a href=#entity-boundary-marker title="entity boundary marker">marker</a> and any other element
added to the <a href=#stack-of-open-elements title="stack of open elements">stack</a> before
the <a href=#entity-boundary-marker title="entity boundary marker">marker</a>.<!-- For other
purposes, e.g. entity reference expansion and <video>/<object>
processing, the stack of open elements is not empty, however. -->

</p><p>While the <a href=#stack-of-tokenizers>stack of tokenizers</a> is <em>not</em> empty,
instead of the <a href=#stops-parsing>stops parsing</a> steps, the <a href=#xml-parser>XML
parser</a> <em class=rfc2119>MUST</em> run these steps:

  </p><ol>

  <li>Pop the most recently added <a href=#entity-boundary-marker title="entity boundary
  marker">marker</a>, as well as any element added after the <a href=#entity-boundary-marker title="entity boundary marker">marker</a>, from the <a href=#stack-of-open-elements>stack
  of open elements</a>.

  </li><li>Set the <a href=#phase>phase</a> of the <a href=#tree-construction>tree construction</a>
  stage of the <a href=#xml-parser>XML parser</a> to <var title="">original
  phase</var>.

  </li><li>Pop a <a href=#xml-tokenizer title="XML tokenizer">tokenizer</a> from the
  <a href=#stack-of-tokenizers>stack of tokenizers</a> and set it the <a href=#xml-tokenizer title="XML
  tokenizer">tokenizer</a> of the <a href=#xml-parser>XML parser</a>.

  </li><li>Unblock the <a href=#xml-tokenizer title="XML tokenizer">tokenizer</a> of the
  <a href=#xml-parser>XML parser</a>, such that <a href=#concept-task title=concept-task>tasks</a> that invoke the <a href=#xml-tokenizer title="XML
  tokenizer">tokenizer</a> can again be run.

  </li><li>Set the <a href=#parser-pause-flag>parser pause flag</a> of the <a href=#xml-tokenizer title="XML
  tokenizer">tokenizer</a> of the <a href=#xml-parser>XML parser</a> to false.

  </li><li>Unset the <a href=#concept-entity-open title=concept-entity-open>open</a> flag of
  the entry for <var title="">entity</var> in the <a href=#list-of-entities>list of
  entities</a> of the <a href=#xml-parser>XML parser</a> if <var title="">entity</var> is a <a href=#general-entity>general entity</a>.

  </li></ol>

</div>

</div>

<div class=ed>

<dl class=switch>
<dt>For each external entity (including the document entity and the external
subset entity, if any)
  </dt><dd>If there is a byte sequence that are not legal in the encoding in use,
  then the parser <em class=rfc2119>MUST</em> raise an
  <a href=#xml-misc-error id=xme-illegal-bytes><code>xml-misc-error</code></a>.
  <!--
     <q>It is a fatal error when an XML processor encounters an entity with an
     encoding that it is unable to process. It is a fatal error if an XML
     entity is determined (via default, encoding declaration, or higher-level
     protocol) to be in a certain encoding but contains byte sequences that are
     not legal in that encoding.</q>
  -->

  </dd><dd>If it is the document entity or a general entity, then:
    <ul>
    <li>If the input byte sequence for the entity begins with the
    <abbr class=charname title="BYTE ORDER MARK">BOM</abbr>, then the parser
    <em class=rfc2119>MUST</em> set the <span class=ed>BOM flag</span> of
    the node corresponding to the entity (the <a href=#document-0><code>Document</code></a> node
    for the document entity or an <a href=#entity><code>Entity</code></a> node for a general
    entity) to <code>true</code>.
    <!--
      <q>Entities encoded in UTF-16 MUST and entities encoded in UTF-8 MAY
      begin with the Byte Order Mark</q>
    -->
    <span class=ed>@@ flag must be checked later</span>
    <!-- <?xml encoding=""?> must be reflected to xmlEncoding; this should be
    enforced by DOM Core spec. -->
    </li></ul>
  </dd><dd>If it is a parameter entity or the external subset entity, then:
    <ul>
    <li>If the character encoding of the entity is <code>UTF-16</code> but
    the input byte stream for the entity does not begin with the
    <abbr class=charname title="BYTE ORDER MARK">BOM</abbr>, then the parser
    <em class=rfc2119>MUST</em> raise an
    <a href=#xml-misc-error id=xme-pe-bom><code>xml-misc-error</code></a>.
    </li><li class=ed>@@ encoding="" preferred name?
<!--
"In an encoding declaration, the values "UTF-8", "UTF-16", "ISO-10646-UCS-2", and "ISO-10646-UCS-4" SHOULD be used for the various encodings and transformations of Unicode / ISO/IEC 10646, the values "ISO-8859-1", "ISO-8859-2", ... "ISO-8859-n" (where n is the part number) SHOULD be used for the parts of ISO 8859, and the values "ISO-2022-JP", "Shift_JIS", and "EUC-JP" SHOULD be used for the various encoded forms of JIS X-0208-1997. It is RECOMMENDED that character encodings registered (as charsets) with the Internet Assigned Numbers Authority [IANA-CHARSETS], other than those just listed, be referred to using their registered names; other encodings SHOULD use names starting with an "x-" prefix."

In addition, this should be checked later for Document and Entity nodes.
-->
    </li></ul>

</dd><dt>For the document
  </dt><dd>If the <abbr>XML</abbr> document does not begin with an
  <abbr>XML</abbr> declaration, then the parser <em class=rfc2119>MUST</em>
  raise an
  <a href=#xml-misc-recommentation id=xmr-xml-decl><code>xml-misc-recommendation</code></a>.
  </dd><dd>If the document does not contain the document type declaration, or
  if it does but the document type definition does not contain entity 
  declaration for any of <code>amp</code>, <code>lt</code>, <code>gt</code>,
  <code>apos</code>, or <code>quot</code>, then the parser
  <em class=rfc2119>MUST</em> raise
  <a href=#xml-misc-recommentation id=xmr-predefined-decl><code>xml-misc-recommendation</code></a>(s).
  <!--
    <q>For interoperability, valid documents SHOULD declare the entities
    amp, lt, gt, apos, quot, in the form specified in 4.6 Predefined
    Entities.</q>
  -->
</dd><dt>For the document type declaration
  </dt><dd class=ed>@@ read external entity
  </dd><dd>The <code>entities</code> attribute of the <a href=#documenttype><code>DocumentType</code></a>
  node <em class=rfc2119>MUST</em> contain a <a href=#namednodemap><code>NamedNodeMap</code></a> object
  whose first five items are as follows:
    <ol start=0>
    <li>An <a href=#entity><code>Entity</code></a> node whose <code>nodeName</code> attribute
    is <code>amp</code>.  It contains a <code>Text</code> node whose
    <code>data</code> attribute is set to <code>&amp;</code>.
    </li><li>An <a href=#entity><code>Entity</code></a> node whose <code>nodeName</code> attribute
    is <code>lt</code>.  It contains a <code>Text</code> node whose
    <code>data</code> attribute is set to <code>&lt;</code>.
    </li><li>An <a href=#entity><code>Entity</code></a> node whose <code>nodeName</code> attribute
    is <code>gt</code>.  It contains a <code>Text</code> node whose
    <code>data</code> attribute is set to <code>&gt;</code>.
    </li><li>An <a href=#entity><code>Entity</code></a> node whose <code>nodeName</code> attribute
    is <code>quot</code>.  It contains a <code>Text</code> node whose
    <code>data</code> attribute is set to <code>"</code>.
    </li><li>An <a href=#entity><code>Entity</code></a> node whose <code>nodeName</code> attribute
    is <code>apos</code>.  It contains a <code>Text</code> node whose
    <code>data</code> attribute is set to <code>'</code>.
    </li></ol>
</dd><dt>For each internal general entity declaration being processed by the parser
  </dt><dd>If the 
  <a href=http://www.w3.org/TR/2006/REC-xml-20060816/#NT-EntityValue><code>EntityValue</code></a>
  part of the general entity declaration contains a bare <code>U+003C</code>
  <code>LESS-THAN SIGN</code> (<code>&lt;</code>) character, then the parser
  <em class=rfc2119>MUST</em> raise an
  <a href=#xml-misc-warning id=xmw-entity-value-lt><code>xml-misc-warning</code></a>.<!--
"strongly advised to avoid" in a Note in Section 2.3 of [XML], [XML11].
-->
</dd><dt>For each element type declaration being processed by the parser
  </dt><dd>If there is another processed element type declaration whose
  <a href=#getAttributeDefinitionNode-name><code>Name</code></a> is equal to the <a href=#getAttributeDefinitionNode-name><code>Name</code></a> of the element type
  declaration, then the parser <em class=rfc2119>MUST</em> raise an 
  <a href=#xml-validity-error id=vc-edunique><code>xml-validity-error</code></a>.
</dd><dt>For each attribute definition list declaration being processed by the
parser
  </dt><dd>If there is another processed attribute defintion list declaration whose
  <a href=#getAttributeDefinitionNode-name><code>Name</code></a> is equal to the <a href=#getAttributeDefinitionNode-name><code>Name</code></a> of the attribute
  definition list declaration, then the parser <em class=rfc2119>MUST</em>
  raise an 
  <a href=#xml-misc-warning id=xme-attlist-unique><code>xml-misc-warning</code></a>.
  </dd><dd>For each attribute definition in the attribute definition list 
  declaration, if there is another processed attribute definition whose
  <a href=#getAttributeDefinitionNode-name><code>Name</code></a> is equal to the <a href=#getAttributeDefinitionNode-name><code>Name</code></a> of the attribute
  definition (whether or not in the same attribute definition list
  declaration), then the parser <em class=rfc2119>MUST</em> raise an
  <a href=#xml-misc-warning id=xme-attrdef-unique><code>xml-misc-warning</code></a>.
  <!--
    <q>For interoperability, an XML processor <em class=rfc2119>MAY</em> at
    user option issue a warning when more than one attribute-list declaration
    is provided for a given element type, or more than one attribute definition
    is provided for a given attribute, but this is not an error.</q>
  -->
<!--
  NOTE: <!ATTLIST a xml:space (default) #IMPLIED xml:space CDATA #IMPLIED>
  will not be warned.
-->

</dd><dt>For each entity declaration being processed by the parser
  </dt><dd>Handle as follows:
    <ol>
    <li><p>If the entity declaration declares a general entity, the following
    is applied:
      </p><dl>
      <dt>If the <a href=#getAttributeDefinitionNode-name><code>Name</code></a> is <code>lt</code> or <code>amp</code>
        </dt><dd><p>If the entity declaration does not declare an internal entity,
        or if the replacement text of the entity is not the escaped form of
        <code>&lt;</code> (if <code>lt</code>) or <code>&amp;</code> (if
        <code>amp</code>), then the parser <em class=rfc2119>MUST</em> raise an
        <a href=#xml-misc-error id=xme-double-escape><code>xml-misc-error</code></a>.

          </p><div class="note memo informative">
          <p>In other word, the character in the <code>EntityValue</code>
          has to be double-escaped.
          </p></div>
      </dd><dt>If the <a href=#getAttributeDefinitionNode-name><code>Name</code></a> is <code>gt</code>, <code>quot</code>, or
      <code>apos</code>
        </dt><dd><p>If the entity declaration does not declare an internal entity,
        or if the replacement text of the entity is not equal to or not the
        escaped form of <code>&gt;</code> (if <code>gt</code>), <code>"</code> (if
        <code>quot</code>), or <code>'</code> (if <code>apos</code>), then the
        parser <em class=rfc2119>MUST</em> raise an
        <a href=#xml-misc-error id=xme-single-escape><code>xml-misc-error</code></a>.

          </p><div class="note memo informative">
          <p>In other word, the character in the <code>EntityValue</code>
          has to be single- or double-escaped.
          </p></div>
      </dd></dl>
      <!--
        <q>If the entities lt or amp are declared, they MUST be declared as internal entities whose replacement text is a character reference to the respective character (less-than sign or ampersand) being escaped; the double escaping is REQUIRED for these entities so that references to them produce a well-formed result. If the entities gt, apos, or quot are declared, they MUST be declared as internal entities whose replacement text is the single character being escaped (or a character reference to that character; the double escaping here is OPTIONAL but harmless).</q>
      -->

    </li><li><p>If the entity declaration has to be ignored since there has already
    been declared an entity with the same <a href=#getAttributeDefinitionNode-name><code>Name</code></a> as the declaration,
    then the parser <em class=rfc2119>MUST</em> raise a
    <a href=#misc-info id=mi-ent-unique><code>misc-info</code></a>
    and abort these steps.

    </p><div class="informative note memo">
    <p>Five predefined entities, i.e. <code>amp</code>, <code>lt</code>,
    <code>gt</code>, <code>quot</code>, and <code>apos</code>, are always
    declared implicitly and therefore any declaration for such an entity 
    always raises an
    <a href=#misc-info id=mi-ent-unique><code>misc-info</code></a>.
    </p></div>  

    </li><li><p>If the entity declaration declares a parameter entity and the
    <a href=#getAttributeDefinitionNode-name><code>Name</code></a> of the entity begins with the string <code>xml</code>
    (in any combination of upper- and lowercase letters), then the parser
    <em class=rfc2119>MUST</em> raise an
    <a href=#xml-misc-warning id=xmw-reserved-pe-name><code>xml-misc-warning</code></a>.

    </p></li><li><p>If the entity declaration contains the <code>EntityValue</code>,
    then for each occurence of any references to unparsed entities in the
    <code>EntityValue</code>, the parser <em class=rfc2119>MUST</em> raise an
    <a href=#xml-misc-error id=xme-unparsed-in-ev><code>xml-misc-error</code></a>.
    <!--
      <q>It is an error for a reference to an unparsed entity to appear in the
      EntityValue in an entity declaration.</q>
    -->
    </p></li><li><p>If the entity declaration declares a general entity, then an
    <a href=#entity><code>Entity</code></a> node <em class=rfc2119>MUST</em> be created and
    appended to the <a href=#namednodemap><code>NamedNodeMap</code></a> object in the
    <code>entities</code> attribute of the <a href=#documenttype><code>DocumentType</code></a> node.
    
    </p><p class=ed>Read the external entity

    </p><p>If the replacement text of the entity is read, then parse the 
    replacement text as if it were referenced from the content of an
    element (with no namespace bindings).  If no <span class=ed>@@ parse error</span>
    is raised by the parsing process, then the nodes generated by the
    parsing <em class=rfc2119>MUST</em> be appended to the <a href=#entity><code>Entity</code></a>
    node.  The parse error <em class=rfc2119>MUST NOT</em> be propagated to
    the entire parsing process.  Other kinds of errors
    <em class=rfc2119>MUST</em> be propagated.  The first parse error
    <em class=rfc2119>MUST</em> abort the internal parsing process.
    <span class=ed>@@ better wording</span>

    </p><p class=ed>@@ prop
     
    </p><p>Then, the <a href=#entity><code>Entity</code></a> node and its descendant 
    <em class=rfc2119>MUST</em> be marked as read-only.
  </p></li></ol>

</dd><dt>For each notation declaration being processed by the parser
  </dt><dd>If there is another processed notation declaration whose
  <a href=#getAttributeDefinitionNode-name><code>Name</code></a> is equal to the <a href=#getAttributeDefinitionNode-name><code>Name</code></a> of the notation
  declaration, then the parser <em class=rfc2119>MUST</em> raise an 
  <a href=#xml-validity-error id=vc-uniquenotationname><code>xml-validity-error</code></a>.
  <!-- <a href="http://www.w3.org/TR/2006/REC-xml-20060816/#UniqueNotationName">Validity constraint: Unique Notation Name</a> -->

</dd><dt>For each empty-element tag
  </dt><dd>If the <a href=#getAttributeDefinitionNode-name><code>Name</code></a> of the tag is not declared by a processed
  element type declaration as <code>EMPTY</code> content, then the parser
  <em class=rfc2119>MUST</em> raise an
  <a href=#xml-misc-recommentation id=xmr-emptyelemtag-not-empty><code>xml-misc-recommendation</code></a>.
</dd><dt>For each start-tag
  </dt><dd>If the <a href=#getAttributeDefinitionNode-name><code>Name</code></a> of the tag is declared by a processed element
  type declaration as <code>EMPTY</code> content, then the parser
  <em class=rfc2119>MUST</em> raise an
  <a href=#xml-misc-recommentation id=xmr-empty-not-emptyelemtag><code>xml-misc-recommendation</code></a>.
</dd><dt>For each attribute
  </dt><dd><p>The parser <em class=rfc2119>MUST</em> set the normalized value of 
  the attribute to the <code>value</code> attribute of the <a href=#attr><code>Attr</code></a>
  node created for the attribute.

    </p><div class="note memo informative">
    <p>That is, any entity reference has to be expanded.  Unexpanded entity
    references in attribute values are discarded.
    </p></div>
</dd><dt>For each <code>xml:space</code> attribute
  </dt><dd>The parser <em class=rfc2119>MUST</em> set the normalized value of
  the <code>xml:space</code> attribute to the <code>value</code> attribute
  of the <a href=#attr><code>Attr</code></a> node created for the attribute even if the
  normalized value is different from <code>default</code> or
  <code>preserve</code>.
  <!-- In XML 1.0/1.1 specification, the attribute specification MAY be
  ignored. -->

</dd><dt>For each parameter entity reference
  </dt><dd><p>Process as follows:
    </p><ol>
    <li>If the declaration for the entity is <em>not</em> processed,
    then:
      <dl class=switch>
      <dt>If the document contains no external entity or if the document
      contains the <code>standalone</code> pseudo-attribute set to
      <code>yes</code><!-- or the document contains no DTD -->
        </dt><dd>The parser <em class=rfc2119>MUST</em> raise an
        <a href=#xml-well-formedness-error id=wf-entdeclared-pe><code>xml-well-formedness-error</code></a>.
      </dd><dt>Otherwise
        </dt><dd>The parser <em class=rfc2119>MUST</em> raise an
        <a href=#xml-validity-error id=vc-entdeclared-pe><code>xml-validity-error</code></a>.
      </dd></dl>
    </li><li>If the declaration for the entity <em>is</em> processed but the
    referenced entity cannot be retrieved, then the parser
    <em class=rfc2119>MUST</em> raise an
    <span class=ed>@@ ??-error</span>.
    </li></ol>

    <p>In any of two cases above, process as follows:
    </p><ul>
    <li>If the parameter entity reference is contained in a declaration, then
    the declaration <em class=rfc2119>MUST</em> be ignored <em>except</em> that
    any error before the parameter entity <em class=rfc2119>MUST</em> be
    raised as usual.
    </li><li>If the parameter entity reference is contained in the status portion of
    a conditional section, then the conditional section
    <em class=rfc2119>MUST</em> be processed as if it were an
    <code>IGNORE</code>d section.
    </li><li>The parser <em class=rfc2119>MUST NOT</em> process any entity or
    attribute-list declaration after the parameter entity reference in the DTD
    <em>except</em> when the <code>standalone</code> pseudo-attribute of the
    XML declaration (if any) is set to <code>yes</code>.
    <!-- This requirement is enforced for internal DTD subset case in
    XML 1.0/1.1 specification (section 5.1) but not for any other cases. -->
    <!-- According to this definition, element type declarations, notation
    declarations, and PIs ARE processed. -->
    </li><li>If the parameter entity reference is the first reference to an entity
    that is not read, then the parser <em class=rfc2119>MUST</em> raise an
    <a href=#entity-error id=ee-unread-pe><code>entity-error</code></a>.
    </li><li>The <code>allDeclarationsProcessed</code> <span class=ed>@@ ref</span>
    attribute of the <a href=#document-0><code>Document</code></a> node <em class=rfc2119>MUST</em> be
    set to <code>false</code>.
    </li></ul>
</dd><dt>For each general entity reference in an attribute value or in the content
of an element
  </dt><dd><p>Process as follows:
    </p><ol>
    <li>If the <a href=#getAttributeDefinitionNode-name><code>Name</code></a> of the entity reference is either
    <code>amp</code>, <code>lt</code>, <code>gt</code>, <code>quot</code>,
    or <code>apos</code>, then abort these steps.
    </li><li>If the declaration for the entity is <em>not</em> processed,
    then:
      <dl class=switch>
      <dt>If the document contains no external entity or if the document
      contains the <code>standalone</code> pseudo-attribute set to
      <code>yes</code><!-- or the document contains no DTD -->
        </dt><dd>The parser <em class=rfc2119>MUST</em> raise an
        <a href=#xml-well-formedness-error id=wf-entdeclared-ge><code>xml-well-formedness-error</code></a>.
      </dd><dt>Otherwise
        </dt><dd>The parser <em class=rfc2119>MUST</em> raise an
        <a href=#xml-validity-error id=vc-entdeclared-ge><code>xml-validity-error</code></a>.
      </dd></dl>
    </li><li>If the declaration for the entity <em>is</em> processed but the
    referenced entity cannot be retrieved, then the parser
    <em class=rfc2119>MUST</em> raise an
    <span class=ed>@@ ??-error</span>.
    </li></ol>

    <p>In any of two cases above, process as follows:
    </p><ul>
    <li>If the general entity reference is the first reference to an entity
    that is not read, then the parser <em class=rfc2119>MUST</em> raise an
    <a href=#entity-error id=ee-unread-ge><code>entity-error</code></a>.
    <span class=ed>@@ entity declared WFC?</span>
    </li><li class=ed>An unexpended entity reference node <em class=rfc2119>MUST</em> be inserted to the current node.
    </li></ul>

</dd><dt>For each comment <em>outside</em> of document type declaration
  </dt><dd>A <code>Comment</code> node <em class=rfc2119>MUST</em> be created
  and inserted appropriately.
  <!-- In XML 1.0/1.1 spec, this is optional. -->
</dd></dl>

<p>The parser <em class=rfc2119>MUST</em> try to read any entity
referenced by general or parameter entity references<!--,--> and the
external subset entity, if any<!--, and any general entity declared-->
in the document type definition.

</p><p><strong>Well-formedness constraints</strong>.  When the parser
detects a voilation to one of certain well-formedness constraints, it
<em class=rfc2119>MUST</em> raise an <a href=#xml-well-formedness-error><code>xml-well-formedness-error</code></a>.
The list of such well-formed constraints is as follows:

</p><ul>
<li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#wfc-PEinInternalSubset>Well-formedness constraint: PEs in Internal Subset</a>
</li><li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#GIMatch>Well-formedness constraint: Element Type Match</a>
</li><li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#uniqattspec>Well-formedness constraint: Unique Att Spec</a>
</li><li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#NoExternalRefs>Well-formedness constraint: No External Entity References</a>
</li><li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#CleanAttrVals>Well-formedness constraint: No &lt; in Attribute Values</a>
</li><li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#wf-Legalchar>Well-formedness constraint: Legal Character</a>
</li><li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#textent>Well-formedness constraint: Parsed Entity</a>
</li><li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#norecursion>Well-formedness constraint: No Recursion</a>
</li><li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#indtd>Well-formedness constraint: In DTD</a>
</li></ul>

<p><strong>Validity constraints</strong>.  When the parser detects a
violation to one of certain validity contraints, it <em class=rfc2119>MUST</em> raise an <a href=#xml-validity-error><code>xml-validity-error</code></a>.  The
list of such validity constraints is as follows:

</p><ul>
<li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#vc-PEinMarkupDecl>Validity constraint: Proper Declaration/PE Nesting</a>
</li><li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#vc-PEinGroup>Validity constraint: Proper Group/PE Nesting</a>
</li><li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#condsec-nesting>Validity constraint: Proper Conditional Section/PE Nesting</a>
</li><li><a href=http://www.w3.org/TR/2006/REC-xml-20060816/#vc-check-rmd>Validity constraint: Standalone Document Declaration</a>
</li></ul>

<p><strong>Other creteria</strong>.  If the parser detects a violation
to one of certain additional constraints, it <em class=rfc2119>MUST</em> raise an <a href=#xml-misc-recommendation><code>xml-misc-recommendation</code></a>.
The list of such constraints is as follows:

</p><ul>
<li><q>For interoperability, if a parameter-entity reference appears in a 
<code>choice</code>, <code>seq</code>, or <code>Mixed</code> construct, its 
replacement text <em class=rfc2119>SHOULD</em> contain at least one non-blank 
character, and neither the first nor last non-blank character of the 
replacement text <em class=rfc2119>SHOULD</em> be a connector (<code>|</code> 
or <code>,</code>).</q>
</li><li><q>External parsed entities <em class=rfc2119>SHOULD</em> each begin with a
text declaration.</q>
</li></ul>

<p>The parser <em class=rfc2119>MUST</em> act as if it is a <a href=http://www.w3.org/TR/2006/REC-xml-20060816/#dt-validating>validating
XML processor</a> for the purpose of informing of white space
characters appearing in <a href=http://www.w3.org/TR/2006/REC-xml-20060816/#dt-elemcontent>element
content</a> (See <a href=http://www.w3.org/TR/2006/REC-xml-20060816/#sec-white-space>Section
2.10</a> of the XML specification).

  </p><div class="note memo informative">
  <p>In other word, the <code>isElementContentWhitespace</code> attribute
  of <code>Text</code> nodes has to be set appropriately.  Note that the
  value of the attribute will be set to <code>false</code> for any 
  <code>Text</code> node in the content of an element whose declaration
  is not processed.
  </p></div>

<p>The parser <em class=rfc2119>MUST</em> raise at least one <a href=#xml-well-formedness-error id=wfe-syntax><code>xml-well-formedness-error</code></a> if the entity
it parses does not match to the appropriate production rule in the XML
specification.  As an exception to this requirement, it <em class=rfc2119>MAY</em> choose not to raise such an error if the error
will be raised by the conformance checker when the conformance checker
<a href=#algorithm-to-check-a-node title="check a node">checks</a>
the <a href=#document-0><code>Document</code></a> object produced by the parser.

<!--
  <li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#ExtSubset">Well-formedness constraint: External Subset</a>
  <li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#PE-between-Decls">Well-formedness constraint: PE Between Declarations</a>
-->

<!--
  Inpossible to test:
    "In the absence of external character encoding information (such as MIME
    headers), parsed entities which are stored in an encoding other than UTF-8
    or UTF-16 MUST begin with a text declaration"
-->
</p></div><!-- ed -->

</div><!-- section -->


<div class=section>
<h2 id=dom-document-type-definitions><span class=secno>4 </span>DOM Document Type Definitions</h2>

<p>This section defines various extensions to DOM to represent
definitions that can be contained in XML DTDs.  They are referred to
as <dfn id=term-dom-dtdef><abbr>DOM</abbr> Document Type
Definitions</dfn>, which is a set of <abbr>DOM</abbr> interfaces,
including both new interfaces and modifications to existing standard
<abbr>DOM</abbr> interfaces.

</p><p>The primary goal of those features is to make it possible to built
an XML DTD validator on the top of the extended DOM API.

</p><div class="note memo">

<p>Although these features are defined as extensions to the standard
DOM interfaces, they are not expected to be implemented by Web
browsers.

</p></div>

<div class="note memo">

<p>Interfaces defined in this section are partially modeled and
inspired by early Working Drafts of <cite><abbr>DOM</abbr> Level
1</cite> <cite class="bibref informative">[<a href=#ref-DOM1WD>DOM1WD</a>]</cite>, <cite><abbr>DOM</abbr> Level 3
Abstract Schemas</cite> draft <cite class="bibref informative">[<a href=#ref-DOM3AS>DOM3AS</a>]</cite>, and <cite><abbr>XML</abbr>
Schema <abbr>API</abbr></cite> specification <cite class="bibref
informative">[<a href=#ref-XSAPI>XSAPI</a>]</cite>, but they are not
compatible with any of them as a whole.</p>

</div>

<div class="note memo">

<p>Features in this section are applied to both <a href=#xml-document title="XML
document">XML documents</a> and <a href=#html-document title="HTML document">HTML
documents</a>.

</p></div>

<div class=section id=section-node>
<h3 id=Node><span class=secno>4.1 </span>Nodes</h3>

<p>This specification introduces two kinds of <span class=concept-node>nodes</span>: <a href=#concept-element-type title=concept-element-type>element types</a> and <a href=#concept-attribute-definition title=concept-attribute-definition>attribute definitions</a>.
Also, this specification reuses two kinds of nodes defined by DOM3
Core specification <cite class="bibref normative">[<a href=#ref-DOM3CORE>DOM3CORE</a>]</cite> (but obsoleted by current
DOM Standard <cite class="bibref normative">[<a href=#ref-DOM>DOM</a>]</cite>): <a href=#concept-entity title=concept-entity>entities</a> and <a href=#concept-notation title=concept-notation>notations</a>.  Requirements on <span class=concept-node>nodes</span> are applied by the following rules:

</p><dl class=switch>

<dt>Node types introduced by this specification
(<a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a> and
<a href=#AttributeDefinition><code>AttributeDefinition</code></a>)

</dt><dd>If this specification explicitly states requirements for them,
they have to be followed.  Otherwise, requirements mentioned in the
DOM Standard have to be followed.

</dd><dt><a href=#documenttype><code>DocumentType</code></a>

</dt><dd>If this specification explicitly states requirements for it, they
have to be followed.  Otherwise, requirements mentioned in the DOM
Standard have to be followed.

<div class="note memo">

<p>This specification defines how nodes attached to the
<a href=#documenttype><code>DocumentType</code></a> (e.g. <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a> and
<a href=#entity><code>Entity</code></a>) affect to attributes and methods of the <span title=concept-node>nodes</span>.  When the <a href=#documenttype><code>DocumentType</code></a>
has no such attached node, they are expected to behave as specified by
the DOM Standard.

</p></div>

</dd><dt>Node types defined in DOM3 Core specification but obsoleted by DOM
Standard (<a href=#entity><code>Entity</code></a> and <a href=#notation><code>Notation</code></a>)

</dt><dd>If this specification explicitly states requirements for them,
they have to be followed.  Otherwise, requirements mentioned in the
DOM3 Core specification have to be followed.

</dd><dt>Other node types

</dt><dd>Requirements in the DOM Standard have to be followed.

</dd></dl>

<p>Nodes of types <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a>,
<a href=#AttributeDefinition><code>AttributeDefinition</code></a>, <a href=#entity><code>Entity</code></a>, and
<a href=#notation><code>Notation</code></a> cannot contain, or cannot be contained by, any
kind of node as <a href=#concept-tree-child title=concept-tree-child>child</a>.

</p><div class="note memo">

  <p>Historically, DOM3 Core specification and earlier versions of
  this specification have allowed <a href=#AttributeDefinition><code>AttributeDefinition</code></a> and
  <a href=#entity><code>Entity</code></a> nodes containing <a href=#concept-tree-child title=concept-tree-child>children</a>.

</p></div>

<hr>

<pre class=idl><code>partial interface <a href=#node-0>Node</a> {
  const unsigned short <a href=#dom-node-element_type_definition_node title=dom-Node-ELEMENT_TYPE_DEFINITION_NODE>ELEMENT_TYPE_DEFINITION_NODE</a> = 81001;
  const unsigned short <a href=#dom-node-attribute_definition_node title=dom-Node-ATTRIBUTE_DEFINITION_NODE>ATTRIBUTE_DEFINITION_NODE</a> = 81002;
};</code></pre>

<p>The <code title=dom-Node-nodeType>nodeType</code> attribute <em class=rfc2119>MUST</em> return the following, depending on the
<a href=#context-object>context object</a>:

</p><dl class=switch>

<dt><a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a>
</dt><dd><dfn id=dom-node-element_type_definition_node title=dom-Node-ELEMENT_TYPE_DEFINITION_NODE><code id=ELEMENT_TYPE_DEFINITION_NODE>ELEMENT_TYPE_DEFINITION_NODE</code></dfn>
(<code>81001</code>)

</dd><dt><a href=#AttributeDefinition><code>AttributeDefinition</code></a>
</dt><dd><dfn id=dom-node-attribute_definition_node title=dom-Node-ATTRIBUTE_DEFINITION_NODE><code id=ATTRIBUTE_DEFINITION_NODE>ATTRIBUTE_DEFINITION_NODE</code></dfn>
(<code>81002</code>)

<!-- For Entity and Notation, defined by DOM3CORE -->
</dd></dl>

<p>The <a href=#dom-node-nodename><code title=dom-Node-nodeName>nodeName</code></a> attribute <em class=rfc2119>MUST</em> return the name (<a href=#concept-element-type-name title=concept-element-type-name>element type name</a> or <a href=#concept-attribute-definition-name title=concept-attribute-definition-name>attribute definition
name</a>) of the node.

</p><p>If the <span title=concept-node>node</span> has attributes <code title=dom-Node-attributes>attributes</code>, <code title=dom-Node-localName>localName</code>, <code title=dom-Node-namespaceURI>namespaceURI</code>, and <code title=dom-Node-prefix>prefix</code>, they <em class=rfc2119>MUST</em>
return <a href=#null><code>null</code></a>.<!-- NodeExodus / AttrExodus -->

</p><p>The <code title=dom-Node-nodeValue>nodeValue</code> attribute and
the <code title=dom-Node-textContent>textContent</code> attribute <em class=rfc2119>MUST</em> return the following, depending on the
<a href=#context-object>context object</a>:

</p><dl class=switch>

<!--
<dt><code>ElementTypeDefinition</code>
<dd><span>Null</span>.
-->

<dt><a href=#AttributeDefinition><code>AttributeDefinition</code></a> </dt><dd>The <a href=#concept-attribute-definition-default-value title=concept-attribute-definition-default-value>default value</a>
of the <a href=#context-object>context object</a>.

</dd><dt><a href=#entity><code>Entity</code></a>
</dt><dd>The <a href=#concept-entity-replacement-text title=concept-entity-replacement-text>replacement
text</a> of the <a href=#context-object>context object</a>.

<!-- For Notation, defined by DOM3CORE -->
</dd></dl>

<p>Setting the <code title=dom-Node-nodeValue>nodeValue</code>
attribute or the <code title=dom-Node-textContent>textContent</code>
attribute <em class=rfc2119>MUST</em> do the following, depending on
the <a href=#context-object>context object</a>:

</p><dl class=switch>

<!--
<dt><code>ElementTypeDefinition</code>
<dd>Do nothing.
-->

<dt><a href=#AttributeDefinition><code>AttributeDefinition</code></a> </dt><dd>Set the <a href=#concept-attribute-definition-default-value title=concept-attribute-definition-default-value>default value</a>
of the <a href=#context-object>context object</a> to the new value.

</dd><dt><a href=#entity><code>Entity</code></a>
</dt><dd>Set the <a href=#concept-entity-replacement-text title=concept-entity-replacement-text>replacement
text</a> of the <a href=#context-object>context object</a> to the new value.

<!-- For Notation, defined by DOM3CORE -->
</dd></dl>

<p>On setting, the <code title=dom-Node-textContent>textContent</code>
attribute <em class=rfc2119>MUST</em> act as if it was the empty
string instead if the new value is <a href=#null>null</a>.

</p><p>When a node is <a href=#concept-node-clone title=concept-node-clone>cloned</a>, the
following values <em class=rfc2119>MUST</em> be copied:

<!-- This list should be equal to isEqualNode's list -->
</p><dl class=switch>

<dt><a href=#documenttype><code>DocumentType</code></a>
<!-- Modify DOM definition -->
</dt><dd>Its <a href=#concept-documenttype-elementtypes title=concept-DocumentType-elementTypes>element
types</a>, <a href=#concept-documenttype-generalentities title=concept-DocumentType-generalEntities>general
entities</a>, and <a href=#concept-documenttype-notations title=concept-DocumentType-notations>notations</a>.

  <div class="note memo">
  
  <p>The DOM Standard defines more values to copy.

  </p></div>

</dd><dt><a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a> </dt><dd>Its <a href=#concept-element-type-name title=concept-element-type-name>name</a> and <a href=#concept-elementtypedefinition-attributedefinitions title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</a>.<!-- XXX content model -->

</dd><dt><a href=#AttributeDefinition><code>AttributeDefinition</code></a> </dt><dd>Its <a href=#concept-attribute-definition-name title=concept-attribute-definition-name>name</a>, <a href=#concept-attribute-definition-declared-type title=concept-attribute-definition-declared-type>declared type</a>,
<a href=#concept-attribute-definition-allowed-tokens title=concept-attribute-definition-allowed-tokens>allowed
tokens</a>, <a href=#concept-attribute-definition-default-type title=concept-attribute-definition-default-type>default type</a>,
and <a href=#concept-attribute-definition-default-value title=concept-attribute-definition-default-value>default
value</a>.

</dd><dt><a href=#entity><code>Entity</code></a>
<!-- Implementation dependent in DOM3CORE -->
</dt><dd>Its <span title=concept-entity-name>name</span>, <a href=#concept-entity-publicid title=concept-entity-publicid>public ID</a>, <a href=#concept-entity-systemid title=concept-entity-systemid>system ID</a>, <a href=#concept-entity-notation-name title=concept-entity-notation-name>notation name</a>, and <a href=#concept-entity-replacement-text title=concept-entity-replacement-text>replacement text</a>.

  <div class="note memo">

  <p>The <span title=concept-entity-encoding>encoding</span><!--
  [MANAKAI] --> is not copied.

  </p></div>

</dd><dt><a href=#notation><code>Notation</code></a>
<!-- Implementation dependent in DOM3CORE -->
</dt><dd>Its <span title=concept-notation-name>name</span>, <a href=#concept-notation-publicid title=concept-notation-publicid>public ID</a>, and <a href=#concept-notation-systemid title=concept-notation-systemid>system ID</a>.

</dd></dl>

<p>When two nodes are compared for the <code title=dom-Node-isEqualNode>isEqualNode</code> method, equality of the
following values <em class=rfc2119>MUST</em> also be taken into
account:

<!-- This list should be equal to cloneNode's list -->
</p><dl class=switch>

<dt><a href=#documenttype><code>DocumentType</code></a>
<!-- Modify DOM definition -->
</dt><dd>Its <a href=#concept-documenttype-elementtypes title=concept-DocumentType-elementTypes>element
types</a>, <a href=#concept-documenttype-generalentities title=concept-DocumentType-generalEntities>general
entities</a>, and <a href=#concept-documenttype-notations title=concept-DocumentType-notations>notations</a>.

</dd><dt><a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a>
</dt><dd>Its <a href=#concept-element-type-name title=concept-element-type-name>name</a> and <a href=#concept-elementtypedefinition-attributedefinitions title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</a>.<!-- XXX and content model -->

</dd><dt><a href=#AttributeDefinition><code>AttributeDefinition</code></a> </dt><dd>Its <a href=#concept-attribute-definition-name title=concept-attribute-definition-name>name</a>, <a href=#concept-attribute-definition-declared-type title=concept-attribute-definition-declared-type>declared type</a>,
<a href=#concept-attribute-definition-allowed-tokens title=concept-attribute-definition-allowed-tokens>allowed
tokens</a>, <a href=#concept-attribute-definition-default-type title=concept-attribute-definition-default-type>default type</a>,
and <a href=#concept-attribute-definition-default-value title=concept-attribute-definition-default-value>default
value</a>.

</dd><dt><a href=#entity><code>Entity</code></a>
<!-- Modify DOM3CORE definition -->
</dt><dd>Its <span title=concept-entity-name>name</span>, <a href=#concept-entity-publicid title=concept-entity-publicid>public ID</a>, <a href=#concept-entity-systemid title=concept-entity-systemid>system ID</a>, <a href=#concept-entity-notation-name title=concept-entity-notation-name>notation name</a>, and <a href=#concept-entity-replacement-text title=concept-entity-replacement-text>replacement text</a>.

</dd><dt><a href=#notation><code>Notation</code></a>
<!-- Modify DOM3CORE definition -->
</dt><dd>Its <span title=concept-notation-name>name</span>, <a href=#concept-notation-publicid title=concept-notation-publicid>public ID</a>, and <a href=#concept-notation-systemid title=concept-notation-systemid>system ID</a>.

</dd></dl>

<p>For the comparison of node sets, only the length and equality of
nodes with same <a href=#dom-node-nodename><code title=dom-Node-nodeName>nodeName</code></a> in the
set are significant.  The order of the nodes are not ignored for the
purpose of the comparison.  For the comparison of <a href=#concept-attribute-definition-allowed-tokens title=concept-attribute-definition-allowed-tokens>allowed
tokens</a>, the length of items and existence of the values in both
are taken into account.

</p><p>If at least one of two nodes compared by the <code title=dom-Node-compareDocumentPosition>compareDocumentPosition</code>
method (i.e. <var title="">reference</var> and <var title="">other</var>)
are <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a>,
<a href=#AttributeDefinition><code>AttributeDefinition</code></a>, <a href=#entity><code>Entity</code></a>, or
<a href=#notation><code>Notation</code></a> and they are different nodes, the following
rules are applied:

</p><ul>

<li>If both nodes are of these four node types and their <a href=#concept-owner title=concept-owner>owners</a> are the same node,

  <ul>

  <li>If <var title="">other</var>'s node type is less than <var title="">reference</var>'s node type, the method <em class=rfc2119>MUST</em> return the result of adding <code title=dom-Node-DOCUMENT_POSITION_PRECEDING>DOCUMENT_POSITION_PRECEDING</code>
  to <code title=dom-Node-DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC>DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC</code>.

  </li><li>Otherwise, if <var title="">other</var>'s node type is greater than
  <var title="">reference</var>'s node type, the method <em class=rfc2119>MUST</em> return the result of adding <code title=dom-Node-DOCUMENT_POSITION_FOLLOWING>DOCUMENT_POSITION_FOLLOWING</code>
  to <code title=dom-Node-DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC>DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC</code>.

  </li><li>Otherwise, if <var title="">other</var>'s <a href=#dom-node-nodename><code title=dom-Node-nodeName>nodeName</code></a> is less than <var title="">reference</var>'s <a href=#dom-node-nodename><code title=dom-Node-nodeName>nodeName</code></a> in code point order, the
  method <em class=rfc2119>MUST</em> return the resulf of adding <code title=dom-Node-DOCUMENT_POSITION_PRECEDING>DOCUMENT_POSITION_PRECEDING</code>
  to <code title=dom-Node-DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC>DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC</code>.

  </li><li>Otherwise, the method <em class=rfc2119>MUST</em> return the
  result of adding <code title=dom-Node-DOCUMENT_POSITION_FOLLOWING>DOCUMENT_POSITION_FOLLOWING</code>
  to <code title=dom-Node-DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC>DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC</code>.

  </li></ul>

</li><li>Otherwise, the <a href=#concept-owner title=concept-owner>owner</a> <em class=rfc2119>MUST</em> be considered as the <a href=#concept-tree-parent title=concept-tree-parent>parent</a> of the node for the purpose of
comparison.  The nodes of these four types <em class=rfc2119>MUST</em>
be considered as preceding any <a href=#concept-tree-child title=concept-tree-child>child</a> node of the <a href=#concept-owner title=concept-owner>owner</a>.

</li></ul>

<hr>

<p>A node of type <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a>,
<a href=#entity><code>Entity</code></a>, or <a href=#notation><code>Notation</code></a> has an associated <dfn id=concept-owner-document-type-definition title=concept-owner-document-type-definition>owner document type
definition</dfn>.  The <a href=#AttributeDefinition><code>AttributeDefinition</code></a> node has an
associated <dfn id=concept-owner-element-type-definition title=concept-owner-element-type-definition>owner
element type definition</dfn>.  Their values are <a href=#null>null</a>
unless otherwise specified.  When not ambiguous, they are simply
referred to as <dfn id=concept-owner title=concept-owner>owner</dfn> of the node.

</p><p>The <dfn id=dom-ownerdocumenttypedefinition title=dom-ownerDocumentTypeDefinition><code id=ownerDocumentTypeDefinition>ownerDocumentTypeDefinition</code></dfn>
attribute of the <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a>,
<a href=#entity><code>Entity</code></a>, and <a href=#notation><code>Notation</code></a> interfaces <em class=rfc2119>MUST</em> return the <a href=#concept-owner-document-type-definition title=concept-owner-document-type-definition>owner document type
definition</a> of the <a href=#context-object>context object</a>.  The <dfn id=dom-ownerelementtypedefinition title=dom-ownerElementTypeDefinition><code id=ownerElementTypeDefinition>ownerElementTypeDefinition</code></dfn>
attribute of the <a href=#AttributeDefinition><code>AttributeDefinition</code></a> interface <em class=rfc2119>MUST</em> return the <a href=#concept-owner-element-type-definition title=concept-owner-element-type-definition>owner element type
definition</a> of the <a href=#context-object>context object</a>.

</p><p>The <dfn id=dom-publicid title=dom-publicId><code id=publicId>publicId</code></dfn>
attribute and the <dfn id=dom-systemid title=dom-systemId><code id=systemId>systemId</code></dfn> attribute of the <a href=#entity><code>Entity</code></a>
and <a href=#notation><code>Notation</code></a> interfaces <em class=rfc2119>MUST</em>
return the <span title=concept-publicid>public ID</span> and <span title=concept-systemid>system ID</span> of the <a href=#context-object>context
object</a>, respectively.<!-- For DocumentType, defined in DOM -->.

</p><p>On setting, the <a href=#dom-publicid><code title=dom-publicId>publicId</code></a> attribute
and the <a href=#dom-systemid><code title=dom-systemId>systemId</code></a> attribute of the
<a href=#documenttype><code>DocumentType</code></a>, <a href=#entity><code>Entity</code></a>, and
<a href=#notation><code>Notation</code></a> interfaces <em class=rfc2119>MUST</em> set the
<span title=concept-publicid>public ID</span> and <span title=concept-systemid>system ID</span> of the <a href=#context-object>context
object</a>, respectively, to the new value.

</p><div class="note memo">
<p>In DOM Standard and DOM3 Core specifications, these attributes are
read-only.
</p></div>

<div class="note memo">
<p>Setting an invalid identifier to these attribute might make the
node unserializable in the XML syntax.
</p></div>

<hr>

<p>When a <a href=#namednodemap><code>NamedNodeMap</code></a> <a href=#concept-collection title=concept-collection>collection</a> represents <a href=#concept-documenttype-elementtypes title=concept-DocumentType-elementTypes>element types</a>, <a href=#concept-documenttype-generalentities title=concept-DocumentType-generalEntities>general entities</a>,
<a href=#concept-documenttype-notations title=concept-DocumentType-notations>notations</a>, or <a href=#concept-elementtypedefinition-attributedefinitions title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</a>, methods <code title=dom-NamedNodeMap-getNamedItemNS>getNamedItemNS</code>, <code title=dom-NamedNodeMap-setNamedItemNS>setNamedItemNS</code>, and <code title=dom-NamedNodeMap-removeNamedItemNS>removeNamedItemNS</code> of
the <a href=#namednodemap><code>NamedNodeMap</code></a> interface <cite class="bibref
normative">[<a href=#ref-DOM3CORE>DOM3CORE</a>]</cite> <em class=rfc2119>MUST</em> <a href=#throw>throw</a> a
"<code>NotSupportedError</code>" exception.

</p></div>

<div class=section id=section-document>
<h3 id=Document><span class=secno>4.2 </span>Documents</h3>

<p>Several factory methods are added to the <a href=#document-0><code>Document</code></a>
interface.

</p><pre class=idl id=section-documentxdoctype><code>partial interface <a href=#document-0>Document</a> {
  <a href=#documenttype>DocumentType</a> <a href=#dom-document-createdocumenttypedefinition title=dom-Document-createDocumentTypeDefinition>createDocumentTypeDefinition</a>(<span>DOMString</span> name);
  <a href=#ElementTypeDefinition>ElementTypeDefinition</a> <a href=#dom-document-createelementtypedefinition title=dom-Document-createElementTypeDefinition>createElementTypeDefinition</a>(<span>DOMString</span> name);
  <a href=#AttributeDefinition>AttributeDefinition</a> <a href=#dom-document-createattributedefinition title=dom-Document-createAttributeDefinition>createAttributeDefinition</a>(<span>DOMString</span> name);
  <a href=#entity>Entity</a> <a href=#dom-document-creategeneralentity title=dom-Document-createGeneralEntity>createGeneralEntity</a>(<span>DOMString</span> name);
  <a href=#notation>Notation</a> <a href=#dom-document-createnotation title=dom-Document-createNotation>createNotation</a>(<span>DOMString</span> name);
};</code></pre>

<div class="note memo">
  <p>Earlier versions of this specification called this WebIDL
  fragment as the <dfn id=DocumentXDoctype><code>DocumentXDoctype</code></dfn> interface.
</p></div>

<p>The <dfn id=dom-document-createdocumenttypedefinition title=dom-Document-createDocumentTypeDefinition><code id=createDocumentTypeDefinition>createDocumentTypeDefinition(<var>name</var>)</code></dfn>
method <em class=rfc2119>MUST</em> run these steps:

</p><ol>

  <li>If <var title="">name</var> does not match the <a href=#getAttributeDefinitionNode-name><code>Name</code></a>
  production, <a href=#throw>throw</a> an
  "<a href=#invalidcharactererror><code>InvalidCharacterError</code></a>" exception and terminate these
  steps.

  </li><li>Return a new <a href=#concept-doctype title=concept-doctype>doctype</a>, with
  <var title="">name</var> as its <a href=#concept-doctype-name title=concept-doctype-name>name</a> and with its <a href=#concept-node-document title=concept-node-document>node document</a> set to the
  <a href=#context-object>context object</a>.

</li></ol>

<p>The <dfn id=dom-document-createelementtypedefinition title=dom-Document-createElementTypeDefinition><code id=createDocumentTypeDefinition>createElementTypeDefinition(<var>name</var>)</code></dfn>
method <em class=rfc2119>MUST</em> run these steps:

</p><ol>

  <li>If <var title="">name</var> does not match the <a href=#getAttributeDefinitionNode-name><code>Name</code></a>
  production, <a href=#throw>throw</a> an
  "<a href=#invalidcharactererror><code>InvalidCharacterError</code></a>" exception and terminate these
  steps.

  </li><li>Return a new <a href=#concept-element-type title=concept-element-type>element
  type</a>, with <var title="">name</var> as its <a href=#concept-element-type-name title=concept-element-type-name>name</a> and with its <a href=#concept-node-document title=concept-node-document>node document</a> set to the
  <a href=#context-object>context object</a>.

</li></ol>

<p>The <dfn id=dom-document-createattributedefinition title=dom-Document-createAttributeDefinition><code id=createDocumentTypeDefinition>createAttributeDefinition(<var>name</var>)</code></dfn>
method <em class=rfc2119>MUST</em> run these steps:

</p><ol>

  <li>If <var title="">name</var> does not match the <a href=#getAttributeDefinitionNode-name><code>Name</code></a>
  production, <a href=#throw>throw</a> an
  "<a href=#invalidcharactererror><code>InvalidCharacterError</code></a>" exception and terminate these
  steps.

  </li><li>Return a new <a href=#concept-attribute-definition title=concept-attribute-definition>attribute
  definition</a>, with <var title="">name</var> as its <a href=#concept-attribute-definition-name title=concept-attribute-definition-name>name</a> and with its
  <a href=#concept-node-document title=concept-node-document>node document</a> set to the
  <a href=#context-object>context object</a>.

</li></ol>

<p>The <dfn id=dom-document-creategeneralentity title=dom-Document-createGeneralEntity><code id=createDocumentTypeDefinition>createGeneralEntity(<var>name</var>)</code></dfn>
method <em class=rfc2119>MUST</em> run these steps:

</p><ol>

  <li>If <var title="">name</var> does not match the <a href=#getAttributeDefinitionNode-name><code>Name</code></a>
  production, <a href=#throw>throw</a> an
  "<a href=#invalidcharactererror><code>InvalidCharacterError</code></a>" exception and terminate these
  steps.

  </li><li>Return a new <a href=#concept-general-entity title=concept-general-entity>general
  entity</a>, with <var title="">name</var> as its <span title=concept-entity-name>name</span> and with its <a href=#concept-node-document title=concept-node-document>node document</a> set to the
  <a href=#context-object>context object</a>.

</li></ol>

<p>The <dfn id=dom-document-createnotation title=dom-Document-createNotation><code id=createDocumentTypeDefinition>createNotation(<var>name</var>)</code></dfn>
method <em class=rfc2119>MUST</em> run these steps:

</p><ol>

  <li>If <var title="">name</var> does not match the <a href=#getAttributeDefinitionNode-name><code>Name</code></a>
  production, <a href=#throw>throw</a> an
  "<a href=#invalidcharactererror><code>InvalidCharacterError</code></a>" exception and terminate these
  steps.

  </li><li>Return a new <a href=#concept-notation title=concept-notation>notation</a>, with
  <var title="">name</var> as its <span title=concept-notation-name>name</span> and with its <a href=#concept-node-document title=concept-node-document>node document</a> set to the
  <a href=#context-object>context object</a>.

</li></ol>

<div class="note memo">
<p><a href=#getAttributeDefinitionNode-name><var>name</var></a> does not have to be a namespace qualified name.</p>
</div>

</div>


<div class=section id=section-documenttype>
<h3 id=document-types><span class=secno>4.3 </span>Document types</h3>

<p>Each <a href=#concept-doctype title=concept-doctype>doctype</a> has associated
unordered sets of nodes <dfn id=concept-documenttype-elementtypes title=concept-DocumentType-elementTypes>element types</dfn>, <dfn id=concept-documenttype-generalentities title=concept-DocumentType-generalEntities>general entities</dfn>, and
<dfn id=concept-documenttype-notations title=concept-DocumentType-notations>notations</dfn>.  Unless
otherwise specified, they <em class=rfc2119>MUST</em> be empty when
the <a href=#concept-doctype title=concept-doctype>doctype</a> is created.

</p><p>The set <a href=#concept-documenttype-elementtypes title=concept-DocumentType-elementTypes>element
types</a> can only contains <a href=#concept-element-type title=concept-element-type>element types</a>.

</p><p>The <dfn id=dom-documenttype-elementtypes title=dom-DocumentType-elementTypes><code id=elementTypes>elementTypes</code></dfn> attribute of the
<a href=#documenttype><code>DocumentType</code></a> interface <em class=rfc2119>MUST</em> return
an <a href=#namednodemap><code>NamedNodeMap</code></a> <a href=#concept-collection title=concept-collection>collection</a> containing the nodes in the
<a href=#concept-documenttype-elementtypes title=concept-DocumentType-elementTypes>element types</a> set
of the <a href=#context-object>context object</a>, sorted by their <a href=#dom-node-nodename><code title=dom-Node-nodeName>nodeName</code></a>'s code point.

</p><p>The <a href=#concept-documenttype-generalentities title=concept-DocumentType-generalEntities>general
entities</a> of the <a href=#concept-doctype title=concept-doctype>doctype</a> is
exposed by the <a href=#dom-documenttype-entities><code title=dom-DocumentType-entities>entities</code></a>
attribute of the <a href=#documenttype><code>DocumentType</code></a> interface <cite class="bibref normative">[<a href=#ref-DOM3CORE>DOM3CORE</a>]</cite>.  The <dfn id=dom-documenttype-generalentities title=dom-DocumentType-generalEntities><code id=generalEntities>generalEntities</code></dfn> attribute of the
<a href=#documenttype><code>DocumentType</code></a> interface <em class=rfc2119>MUST</em> return
the same object as the <a href=#dom-documenttype-entities><code title=dom-DocumentType-entities>entities</code></a> attribute.  The nodes
in the <a href=#dom-documenttype-entities><code title=dom-DocumentType-entities>entities</code></a> <a href=#concept-collection title=concept-collection>collection</a> <em class=rfc2119>MUST</em>
be sorted by their <a href=#dom-node-nodename><code title=dom-Node-nodeName>nodeName</code></a>'s
code point.

</p><p>The <a href=#concept-documenttype-notations title=concept-DocumentType-notations>notations</a> of
the <a href=#concept-doctype title=concept-doctype>doctype</a> is exposed by the <a href=#dom-documenttype-notations><code title=dom-DocumentType-notations>notations</code></a> attribute of the
<a href=#documenttype><code>DocumentType</code></a> interface <cite class="bibref normative">[<a href=#ref-DOM3CORE>DOM3CORE</a>]</cite>.  The nodes in the <a href=#dom-documenttype-notations><code title=dom-DocumentType-notations>notations</code></a> <a href=#concept-collection title=concept-collection>collection</a> <em class=rfc2119>MUST</em>
be sorted by their <a href=#dom-node-nodename><code title=dom-Node-nodeName>nodeName</code></a>'s
code point.

</p><div class=ed>
<p>Need to merge with <code>manakai-allow-doctype-children</code>
configuration parameter spec...

</p><p>A <a href=#DocumentType><code>DocumentType</code></a> interface 
<em class=rfc2119>MAY</em> contain zero or more
<code>ProcessingInstruction</code> nodes in the <code>NodeList</code> object 
contained in the <code>childNodes</code> attribute of the 
<a href=#DocumentType><code>DocumentType</code></a> node.</p>

<p>If the <a href=#DocumentType><code>DocumentType</code></a> node is created
during the process to create a <abbr>DOM</abbr> from an <abbr>XML</abbr>
document, the <code>NodeList</code> object in the <code>childNodes</code> 
object <em class=rfc2119>MUST</em> contains the 
<code>ProcessingInstruction</code> nodes representing the processing 
instructions in the document type definition of the document processed
<cite class="bibref normative">[<a href=#ref-XML>XML</a>,
<a href=#ref-XML11>XML11</a>]</cite> by the <abbr>XML</abbr> processor.

</p><p>If a <a href=#DocumentType><code>DocumentType</code></a> node is created
from a
<a href=http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#infoitem.doctype>document
type declaration information item</a>
<cite class="bibref normative">[<a href=#ref-INFOSET>INFOSET</a>]</cite>,
the <code>NodeList</code> object in the <code>childNodes</code> attribute
of the node <em class=rfc2119>MUST</em> contain the
<code>ProcessingInstruction</code> nodes created from any
<a href=http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#infoitem.pi>processing
instruction information items</a> in the list in the [children] property of the
<a href=http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#infoitem.doctype>document
type declaration item</a> in the same order.</p>

<p>If a <a href=#DocumentType><code>DocumentType</code></a> node is mapped to
a document type declaration information item, the list in the [children] 
property <em class=rfc2119>MUST</em> contain the processng instruction
information items created from the <code>ProcessingInstruction</code> nodes
in the <code>NodeList</code> object in the <code>childNodes</code> attribute
of the <a href=#DocumentType><code>DocumentType</code></a> node.</p>
</div>

<pre class=idl id=section-documenttypedefinition><code>partial interface <a href=#documenttype>DocumentType</a> {
  [TreatNullAs=EmptyString] attribute <span>DOMString</span> <a href=#dom-publicid title=dom-publicId>publicId</a>;
  [TreatNullAs=EmptyString] attribute <span>DOMString</span> <a href=#dom-systemid title=dom-systemId>systemId</a>;
  attribute <span>DOMString</span>? <a href=#dom-documenttype-declarationbaseuri title=dom-DocumentType-declarationBaseURI>declarationBaseURI</a>;
  attribute <span>DOMString</span>? <a href=#dom-documenttype-manakaideclarationbaseuri title=dom-DocumentType-manakaiDeclarationBaseURI>manakaiDeclarationBaseURI</a>;

  readonly attribute <a href=#namednodemap>NamedNodeMap</a> <a href=#dom-documenttype-elementtypes title=dom-DocumentType-elementTypes>elementTypes</a>;
  readonly attribute <a href=#namednodemap>NamedNodeMap</a> <a href=#dom-documenttype-generalentities title=dom-DocumentType-generalEntities>generalEntities</a>;

  <a href=#ElementTypeDefinition>ElementTypeDefinition</a> <a href=#getElementTypeDefinitionNode>getElementTypeDefinitionNode</a>
    (in DOMString <a href=#getElementTypeDefinitionNode-name><var>name</var></a>);
  <a href=#Entity>Entity</a> <a href=#getGeneralEntityNode>getGeneralEntityNode</a>
    (in DOMString <a href=#getGeneralEntityNode-name><var>name</var></a>);
  <a href=#Notation>Notation</a> <a href=#getNotationNode>getNotationNode</a>
    (in DOMString <a href=#getNotationNode-name><var>name</var></a>);

  <a href=#ElementTypeDefinition>ElementTypeDefinition</a>? <a href=#dom-documenttype-setelementtypedefinitionnode title=dom-DocumentType-setElementTypeDefinitionNode>setElementTypeDefinitionNode</a>(<a href=#ElementTypeDefinition>ElementTypeDefinition</a> node);
  <a href=#entity>Entity</a>? <a href=#dom-documenttype-setgeneralentitynode title=dom-DocumentType-setGeneralEntityNode>setGeneralEntityNode</a>(<a href=#entity>Entity</a> node);
  <a href=#notation>Notation</a>? <a href=#dom-documenttype-setnotationnode title=dom-DocumentType-setNotationNode>setNotationNode</a>(<a href=#notation>Notation</a> node);
  <a href=#ElementTypeDefinition>ElementTypeDefinition</a> <a href=#dom-documenttype-removeelementtypedefinitionnode title=dom-DocumentType-removeElementTypeDefinitionNode>removeElementTypeDefinitionNode</a>(<a href=#ElementTypeDefinition>ElementTypeDefinition</a> node);
  <a href=#entity>Entity</a> <a href=#dom-documenttype-removegeneralentitynode title=dom-DocumentType-removeGeneralEntityNode>removeGeneralEntityNode</a>(<a href=#entity>Entity</a> node);
  <a href=#notation>Notation</a> <a href=#dom-documenttype-removenotationnode title=dom-DocumentType-removeNotationNode>removeNotationNode</a>(<a href=#notation>Notation</a> node);
};</code></pre>

<div class="note memo">

  <p>Earlier versions of this specification named this WebIDL fragment
  as the <dfn id=DocumentTypeDefinition><code>DocumentTypeDefinition</code></dfn>
  interface.

</p></div>

<div class=ed>
  <p>If the <a href=#documenttype><code>DocumentType</code></a> node is created during the process
  to create a <abbr>DOM</abbr> from an <abbr>XML</abbr> document, the following
  requirements are applied:  The <a href=#namednodemap><code>NamedNodeMap</code></a> object in the
  <a href=#elementTypes><code>elementType</code></a> attribute 
  <em class=rfc2119>MUST</em> be so transformed that the object contains
  the <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a> nodes for the element types
  whose name is presented as the <a href=#getAttributeDefinitionNode-name><code>Name</code></a> of the element type or
  attribute definition list declarations processed
  <cite class="bibref normative">[<a href=#ref-XML>XML</a>,
  <a href=#ref-XML11>XML11</a>]</cite> by the <abbr>XML</abbr>
  processor.  If there are more than one element type declarations for an
  element type, then the declarations other than the first one 
  <em class=rfc2119>MUST</em> be ignored for the purpose of constructing the
  <a href=#namednodemap><code>NamedNodeMap</code></a> object.</p>

<p>All entities declared in the document type definition
contained in or referenced from the document entity
might not be exposed through this collection, depending
on the information provided by the XML processor for
the DOM implementation.  In particular, it might not
contain any entity if entity references are expanded
at the parse time.  An implementation [['''MUST NOT''']]
expose an [CODE(DOMi)@en[[[Entity]]]] node whose [CODE(DOMa)@en[[[nodeName]]]]
is equal to the name of one of five predefined general entities in
XML through the collection as the result of parsing of an XML
document that has no error.  Duplicate entity declarations are also discarded.

</p><p>The attribute [['''MUST''']] return the [CODE(DOMi)@en[[[NamedNodeMap]]]]
object that contains all the [CODE(DOMi)@en[[[Entity]]]] nodes
representing general entities belong to the node.

</p><p>If the [CODE(DOMi)@en[[[DocumentTypeDefinition]]]] node is
created from an XML document, duplicate notation declarations, if any, in DTD 
[['''MUST NOT''']] result in a node in the [CODE(DOMi)@en[[[NamedNodeMap]]]]
object and only the first declaration [['''MUST''']] be
made available as a [CODE(DOMi)@en[[[Notation]]]] node.

</p><p>;; This definition is based on one for the 
[CODE(DOMa)@en[[[notations]]]] attribute of the
[CODE(DOMi)@en[[[DocumentType]]]] interface in DOM XML module.
Since duplication is violation to the Validity Constraint,
XML parsers might vary on how notations are notified to
the application.  In particular, [CODE(InfoProp)@en[[[notations]]]]
property of the document information item in XML Information Set
is so defined that in case ''any'' notation is declared for 
multiple times then the property has no value.

</p><p>The attribute [['''MUST''']] return the [CODE(DOMi)@en[[[NamedNodeMap]]]]
object that contains all the [CODE(DOMi)@en[[[Notation]]]] nodes
representing notations belong to the node.
</p></div>

<dl>
<dt><dfn class=dom-method id=getElementTypeDefinitionNode><code>getElementTypeDefinitionNode</code></dfn>,
method</dt>
  <dd><p>Returns the
  <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a> node
  with the specified name.</p>

  <p>The
  <dfn class=dom-param id=getElementTypeDefinitionNode-name><var>name</var></dfn>
  parameter is the name of the element type.</p>

  <p>When invoked, the method <em class=rfc2119>MUST</em> return the 
  <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a> node,
  whose <a href=#nodeName><code>nodeName</code></a> is equal to
  <a href=#getElementTypeDefinitionNode-name><var>name</var></a>, in the
  <a href=#namednodemap><code>NamedNodeMap</code></a> object in the
  <a href=#elementTypes><code>elementTypes</code></a> attribute of the
  node.  If there is no such node, it <em class=rfc2119>MUST</em> return
  <a href=#null><code>null</code></a>.</p></dd>
<dt><dfn class=dom-method id=getGeneralEntityNode><code>getGeneralEntityNode</code></dfn>,
method</dt>
  <dd><p>Returns the <a href=#Entity><code>Entity</code></a> node
  with the specified name.</p>

  <p>The
  <dfn class=dom-param id=getGeneralEntityNode-name><var>name</var></dfn>
  parameter is the name of the general entity.</p>

  <p>When invoked, the method <em class=rfc2119>MUST</em> return the 
  <a href=#Entity><code>Entity</code></a> node,
  whose <a href=#nodeName><code>nodeName</code></a> is equal to
  <a href=#getGeneralEntityNode-name><var>name</var></a>, in the
  <a href=#namednodemap><code>NamedNodeMap</code></a> object in the
  <a href=#entities><code>entities</code></a> attribute of the
  node.  If there is no such node, it <em class=rfc2119>MUST</em> return
  <a href=#null><code>null</code></a>.</p></dd>
<dt><dfn class=dom-method id=getNotationNode><code>getNotationNode</code></dfn>,
method</dt>
  <dd><p>Returns the <a href=#Notation><code>Notation</code></a> node
  with the specified name.</p>

  <p>The
  <dfn class=dom-param id=getNotationNode-name><var>name</var></dfn>
  parameter is the name of the notation.</p>

  <p>When invoked, the method <em class=rfc2119>MUST</em> return the 
  <a href=#Notation><code>Notation</code></a> node,
  whose <a href=#nodeName><code>nodeName</code></a> is equal to
  <a href=#getNotationNode-name><var>name</var></a>, in the
  <a href=#namednodemap><code>NamedNodeMap</code></a> object in the
  <a href=#notations><code>notations</code></a> attribute of the
  node.  If there is no such node, it <em class=rfc2119>MUST</em> return
  <a href=#null><code>null</code></a>.</p></dd>

<dt><dfn class=dom-method id=dom-documenttype-setelementtypedefinitionnode title=dom-DocumentType-setElementTypeDefinitionNode><code id=setElementTypeDefinitionNode>setElementTypeDefinitionNode</code></dfn>,
method</dt>

<dd>The <a href=#dom-documenttype-setelementtypedefinitionnode><code title=dom-DocumentType-setElementTypeDefinitionNode>setElementTypeDefinitionNode(<var title="">node</var>)</code></a> method <em class=rfc2119>MUST</em> return the
result of <a href=#concept-set-node title=concept-set-node>setting</a> <var title="">node</var> to the <a href=#context-object>context object</a>'s <a href=#concept-documenttype-elementtypes title=concept-DocumentType-elementTypes>element types</a>.

</dd><dt><dfn class=dom-method id=dom-documenttype-setgeneralentitynode title=dom-DocumentType-setGeneralEntityNode><code id=setGeneralEntityNode>setGeneralEntityNode</code></dfn>, method</dt>

<dd>The <a href=#dom-documenttype-setgeneralentitynode><code title=dom-DocumentType-setGeneralEntityNode>setGeneralEntityNode(<var title="">node</var>)</code></a> method <em class=rfc2119>MUST</em> return the
result of <a href=#concept-set-node title=concept-set-node>setting</a> <var title="">node</var> to the <a href=#context-object>context object</a>'s <a href=#concept-documenttype-generalentities title=concept-DocumentType-generalEntities>general entities</a>.

</dd><dt><dfn class=dom-method id=dom-documenttype-setnotationnode title=dom-DocumentType-setNotationNode><code id=setNotationNode>setNotationNode</code></dfn>, method

</dt><dd>The <a href=#dom-documenttype-setnotationnode><code title=dom-DocumentType-setNotationNode>setNotationNode(<var title="">node</var>)</code></a> method <em class=rfc2119>MUST</em> return the
result of <a href=#concept-set-node title=concept-set-node>setting</a> <var title="">node</var> to the <a href=#context-object>context object</a>'s <a href=#concept-documenttype-notations title=concept-DocumentType-notations>notations</a>.

</dd><dt><dfn class=dom-method id=dom-documenttype-removeelementtypedefinitionnode title=dom-DocumentType-removeElementTypeDefinitionNode><code>removeElementTypeDefinitionNode</code></dfn>, method

</dt><dd>The <a href=#dom-documenttype-removeelementtypedefinitionnode><code title=dom-DocumentType-removeElementTypeDefinitionNode>removeElementTypeDefinitionNode(<var title="">node</var>)</code></a> method <em class=rfc2119>MUST</em> return the
result of <a href=#concept-remove-node title=concept-remove-node>removing</a> <var title="">node</var> from the <a href=#context-object>context object</a>'s <a href=#concept-documenttype-elementtypes title=concept-DocumentType-elementTypes>element types</a>.

</dd><dt><dfn class=dom-method id=dom-documenttype-removegeneralentitynode title=dom-DocumentType-removeGeneralEntityNode><code>removeGeneralEntityNode</code></dfn>, method

</dt><dd>The <a href=#dom-documenttype-removegeneralentitynode><code title=dom-DocumentType-removeGeneralEntityNode>removeGeneralEntityNode(<var title="">node</var>)</code></a> method <em class=rfc2119>MUST</em> return the
result of <a href=#concept-remove-node title=concept-remove-node>removing</a> <var title="">node</var> from the <a href=#context-object>context object</a>'s <a href=#concept-documenttype-generalentities title=concept-DocumentType-generalEntities>general entities</a>.

</dd><dt><dfn class=dom-method id=dom-documenttype-removenotationnode title=dom-DocumentType-removeNotationNode><code>removeNotationNode</code></dfn>, method

</dt><dd>The <a href=#dom-documenttype-removenotationnode><code title=dom-DocumentType-removeNotationNode>removeNotationNode(<var title="">node</var>)</code></a> method <em class=rfc2119>MUST</em> return the
result of <a href=#concept-remove-node title=concept-remove-node>removing</a> <var title="">node</var> from the <a href=#context-object>context object</a>'s <a href=#concept-documenttype-notations title=concept-DocumentType-notations>notations</a>.

</dd></dl>

<p>To <dfn id=concept-remove-node title=concept-remove-node>remove</dfn> a node <var title="">node</var> from the set of nodes <var title="">set</var><!--
associated to the node <var title>owner</var>-->, run these steps:

</p><ol>

  <li>If <var title="">set</var> does not contain <var title="">node</var>,
  <a href=#throw>throw</a> an "<a href=#notfounderror><code>NotFoundError</code></a>" exception and
  abort these steps.

  </li><li>Remove <var title="">node</var> from <var title="">set</var>.

  </li><li>Set the <a href=#concept-owner title=concept-owner>owner</a> of
  <var title="">node</var> to <a href=#null>null</a>.

  </li><li>Return <var title="">node</var>.
</li></ol>

<p>To <dfn id=concept-set-node title=concept-set-node>set</dfn> a node <var title="">node</var> to the set of nodes <var title="">set</var> associated
to the node <var title="">owner</var>, run these steps:

</p><ol>

<li>If the <a href=#concept-owner title=concept-owner>owner</a> of <var title="">node</var> is not <a href=#null>null</a> and is not equal to <var title="">owner</var>, <a href=#throw>throw</a> a
"<a href=#hierarchyrequesterror><code>HierarchyRequestError</code></a>" and abort these steps.

</li><li><a href=#concept-node-adopt title=concept-node-adopt>Adopt</a> <var title="">node</var>
into the <a href=#concept-node-document title=concept-node-document>node document</a> of
<var title="">owner</var>.

</li><li>Let <var title="">oldNode</var> be <a href=#null>null</a>.

</li><li>If there is a node whose <a href=#dom-node-nodename><code title=dom-Node-nodeName>nodeName</code></a> is equal to <var title="">node</var>'s <a href=#dom-node-nodename><code title=dom-Node-nodeName>nodeName</code></a> in
<var title="">set</var>, let <var title="">oldNode</var> be the node and
<a href=#concept-remove-node title=concept-remove-node>remove</a> <var title="">oldNode</var>
from <var title="">set</var>.

</li><li>Add <var title="">node</var> to <var title="">set</var>.

</li><li>Set the <a href=#concept-owner title=concept-owner>owner</a> of <var title="">node</var> to <var title="">owner</var>.

</li><li>Return <var title="">oldNode</var>.

</li></ol>

</div><!-- section -->

<div class=section id=section-elementtypedefinition>
<h3 id=element-types><span class=secno>4.4 </span>Element types</h3>

<p>The <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a> objects are simply known as
<dfn id=concept-element-type title=concept-element-type>element types</dfn>.  It represents
the definition of the element, identified by the <dfn id=concept-element-type-name title=concept-element-type-name>name.

</dfn></p><div class="note memo">
<p>Although the <a href=#concept-element-type title=concept-element-type>element type</a>
is corresponding to the <a href=#element><code>ELEMENT</code></a> declaration in the XML
DTD, the <a href=#concept-element-type title=concept-element-type>element type</a> does not
directly represent the <a href=#element><code>ELEMENT</code></a> declaration.
</p></div>

<pre class=idl><code>interface <dfn id=ElementTypeDefinition>ElementTypeDefinition</dfn> : <a href=#node-0>Node</a> {
  readonly attribute <a href=#documenttype>DocumentType</a>? <a href=#dom-ownerdocumenttypedefinition title=dom-ownerDocumentTypeDefinition>ownerDocumentTypeDefinition</a>;

  readonly attribute <a href=#namednodemap>NamedNodeMap</a> <a href=#dom-elementtypedefinition-attributedefinitions title=dom-ElementTypeDefinition-attributeDefinitions>attributeDefinitions</a>;
  <a href=#AttributeDefinition>AttributeDefinition</a>? <span title=dom-ElementTypeDefinition-getAttributeDefinitionNode>getAttributeDefinitionNode</span>(<span>DOMString</span> name);
  <a href=#AttributeDefinition>AttributeDefinition</a>? <a href=#dom-elementtypedefinition-setattributedefinitionnode title=dom-ElementTypeDefinition-setAttributeDefinitionNode>setAttributeDefinitionNode</a>(<a href=#AttributeDefinition>AttributeDefinition</a> node);
  <a href=#AttributeDefinition>AttributeDefinition</a> <a href=#dom-elementtypedefinition-removeattributedefinitionnode title=dom-ElementTypeDefinition-removeAttributeDefinitionNode>removeAttributeDefinitionNode</a>(<a href=#AttributeDefinition>AttributeDefinition</a> node);
};</code></pre>

<p>Each <a href=#concept-element-type title=concept-element-type>element type</a> has an
associated unordered set of nodes <dfn id=concept-elementtypedefinition-attributedefinitions title=concept-elementTypeDefinition-attributeDefinitions>attribute
definitions</dfn>.  Unless otherwise specified, it <em class=rfc2119>MUST</em> be empty when the <a href=#concept-element-type title=concept-element-type>element type</a> is created.  The set
<a href=#concept-elementtypedefinition-attributedefinitions title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</a> can only contains <a href=#concept-attribute-definition title=concept-attribute-definition>attribute definition</a>.

</p><p>The <dfn id=dom-elementtypedefinition-attributedefinitions title=dom-ElementTypeDefinition-attributeDefinitions><code id=attributeDefinitions>attributeDefinitions</code></dfn> attribute of
the <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a> interface <em class=rfc2119>MUST</em> return an <a href=#namednodemap><code>NamedNodeMap</code></a> <a href=#concept-collection title=concept-collection>collection</a> containing the nodes in the
<a href=#concept-elementtypedefinition-attributedefinitions title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</a> set of the <a href=#context-object>context object</a>, sorted by
their <a href=#dom-node-nodename><code title=dom-Node-nodeName>nodeName</code></a>'s code point.

</p><div class=ed>

<p>Even if there are more than one element type declarations for an
element type in <abbr>DTD</abbr>, the result <abbr>DOM</abbr> will
contain only an <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a>
node for that element type.  In addition, if there are attribute
definition declarations for an element type, even when there is no
element type declaration for that element type, the <abbr>DOM</abbr>
will contain an <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a>
node for that element type.</p>

  <p>If the
  <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a> node
  is created during the process to create a <abbr>DOM</abbr> from an
  <abbr>XML</abbr> document, the following requirements are applied:  The
  <a href=#namednodemap><code>NamedNodeMap</code></a> object in the 
  <a href=#attributeDefinitions><code>attributeDefinitions</code></a>
  attribute <em class=rfc2119>MUST</em> be so transformed that the object
  contains the
  <a href=#AttributeDefinition><code>AttributeDefinition</code></a> node
  corresponding to the attribute definitions in the attribute definition
  list declarations processed
  <cite class="bibref normative">[<a href=#ref-XML>XML</a>,
  <a href=#ref-XML11>XML11</a>]</cite> by the <abbr>XML</abbr> processor and
  associated to the element type represented by the node.  If there are more
  than one attribute definitions for an attribute, then the definitions other
  than the first one <em class=rfc2119>MUST</em> be ignored for the purpose
  of constructing the <a href=#namednodemap><code>NamedNodeMap</code></a> object.</p>
</div>

<dl>
<dt><dfn class=dom-method id=getAttributeDefinitionNode><code>getAttributeDefinitionNode</code></dfn>,
method</dt>
  <dd><p>Return the
  <a href=#AttributeDefinition><code>AttributeDefinition</code></a> node
  with the specified name.</p>

  <p>The
  <dfn class=dom-param id=getAttributeDefinitionNode-name><var>name</var></dfn>
  parameter is the name of the attribute.</p>

  <p>When invoked, the method <em class=rfc2119>MUST</em> return the
  <a href=#AttributeDefinition><code>AttributeDefinition</code></a> node,
  whose <a href=#nodeName><code>nodeName</code></a> attribute value is
  equal to <a href=#getAttributeDefinitionNode-name><var>name</var></a>,
  in the <a href=#namednodemap><code>NamedNodeMap</code></a> in the 
  <a href=#attributeDefinitions><code>attributeDefinitions</code></a>
  attribute of the node.  If there is no such node, it 
  <em class=rfc2119>MUST</em> return <a href=#null><code>null</code></a>.</p></dd>
</dl>

<p>The <dfn id=dom-elementtypedefinition-setattributedefinitionnode title=dom-ElementTypeDefinition-setAttributeDefinitionNode><code id=setAttributeDefinitionNode>setAttributeDefinitionNode(<var title="">node</var>)</code></dfn> method of the
<a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a> object <em class=rfc2119>MUST</em>
return the result of <a href=#concept-set-node title=concept-set-node>setting</a> <var title="">node</var> to the <a href=#context-object>context object</a>'s <a href=#concept-elementtypedefinition-attributedefinitions title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</a>.

</p><p>The <dfn id=dom-elementtypedefinition-removeattributedefinitionnode title=dom-ElementTypeDefinition-removeAttributeDefinitionNode><code>removeAttributeDefinitionNode(<var title="">node</var>)</code></dfn> method of the
<a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a> object <em class=rfc2119>MUST</em>
return the result of <a href=#concept-remove-node title=concept-remove-node>removing</a>
<var title="">node</var> from the <a href=#context-object>context object</a>'s <a href=#concept-elementtypedefinition-attributedefinitions title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</a>.

</p><div class=ed>
<p>A future version of the specification might define a set of attributes
and methods for representing and accessing to the content model of the 
element type.</p>

<pre class=idl><code>partial interface ElementTypeDefinition {
  attribute DOMString? contentModelText;
};</code></pre>
</div>

</div><!-- section -->

<div class=section id=section-attributedefinition>
<h3 id=attribute-definitions><span class=secno>4.5 </span>Attribute definitions</h3>

<p>The nodes of type <a href=#ATTRIBUTE_DEFINITION_NODE><code>ATTRIBUTE_DEFINITION_NODE</code></a>
represents an <dfn id=concept-attribute-definition title=concept-attribute-definition>attribute
definition</dfn>.  Such a node <em class=rfc2119>MUST</em> implement
the <a href=#AttributeDefinition><code>AttributeDefinition</code></a>
interface, which extends the <a href=#Node><code>Node</code></a>
interface.</p>

<p>Each <a href=#concept-attribute-definition title=concept-attribute-definition>attribute
definition</a> has an associated <dfn id=concept-attribute-definition-name title=concept-attribute-definition-name>name</dfn>.

</p><p>Each <a href=#concept-attribute-definition title=concept-attribute-definition>attribute
definition</a> has associated <dfn id=concept-attribute-definition-declared-type title=concept-attribute-definition-declared-type>declared type</dfn>,
<dfn id=concept-attribute-definition-allowed-tokens title=concept-attribute-definition-allowed-tokens>allowed
tokens</dfn>, <dfn id=concept-attribute-definition-default-type title=concept-attribute-definition-default-type>default type</dfn>,
and <dfn id=concept-attribute-definition-default-value title=concept-attribute-definition-default-value>default
value</dfn>.  Unless otherwise specified, they are initialized to
their default values when the <a href=#concept-attribute-definition title=concept-attribute-definition>attribute definition</a> is
created.  Their default values are <code title=dom-AttributeDefinition-NO_TYPE_ATTR>NO_TYPE_ATTR</code>, the
empty list, <code title=dom-AttributeDefinition-UNKNOWN_DEFAULT>UNKNOWN_DEFAULT</code>,
and the empty string, respectively.

</p><p>An attribute definition represents a definition of the attribute 
associated to an element type.  It is corresponding to the attribute definition
in the attribute list declaration in <abbr>DTD</abbr>.  However, an
<a href=#AttributeDefinition><code>AttributeDefinition</code></a> node does 
not represent the attribute definition in <abbr>DTD</abbr> itself.  Even if 
there are more than one attribute definitions for an attribute of an element 
type in <abbr>DTD</abbr>, the result <abbr>DOM</abbr> will contain only an
<a href=#AttributeDefinition><code>AttributeDefinition</code></a> node for 
that attribute.</p>

<pre class=idl><code>interface <dfn id=AttributeDefinition>AttributeDefinition</dfn> : <a href=#Node>Node</a> {
  <span class=comment>// <dfn id=DefaultValueType>DefaultValueType</dfn>
  const unsigned short <a href=#UNKNOWN_DEFAULT>UNKNOWN_DEFAULT</a> = 0;
  const unsigned short <a href=#FIXED_DEFAULT>FIXED_DEFAULT</a> = 1;
  const unsigned short <a href=#REQUIRED_DEFAULT>REQUIRED_DEFAULT</a> = 2;
  const unsigned short <a href=#IMPLIED_DEFAULT>IMPLIED_DEFAULT</a> = 3;
  const unsigned short <a href=#EXPLICIT_DEFAULT>EXPLICIT_DEFAULT</a> = 4;

  readonly attribute <a href=#ElementTypeDefinition>ElementTypeDefinition</a>? <a href=#dom-ownerelementtypedefinition title=dom-ownerElementTypeDefinition>ownerElementTypeDefinition</a>;
  attribute unsigned short <a href=#declaredType>declaredType</a>;
  attribute <span>DOMString</span>[] <a href=#allowedTokens>allowedTokens</a>;
  attribute unsigned short <a href=#defaultType>defaultType</a>;
};

[NoInterfaceObject]
interface <dfn id=attrdeclaredvaluetype>AttrDeclaredValueType</dfn> {
  <span class=comment>// <dfn id=DeclaredValueType>DeclaredValueType</dfn>
  const unsigned short <a href=#NO_TYPE_ATTR>NO_TYPE_ATTR</a> = 0;
  const unsigned short <a href=#CDATA_ATTR>CDATA_ATTR</a> = 1;
  const unsigned short <a href=#ID_ATTR>ID_ATTR</a> = 2;
  const unsigned short <a href=#IDREF_ATTR>IDREF_ATTR</a> = 3;
  const unsigned short <a href=#IDREFS_ATTR>IDREFS_ATTR</a> = 4;
  const unsigned short <a href=#ENTITY_ATTR>ENTITY_ATTR</a> = 5;
  const unsigned short <a href=#ENTITIES_ATTR>ENTITIES_ATTR</a> = 6;
  const unsigned short <a href=#NMTOKEN_ATTR>NMTOKEN_ATTR</a> = 7;
  const unsigned short <a href=#NMTOKENS_ATTR>NMTOKENS_ATTR</a> = 8;
  const unsigned short <a href=#NOTATION_ATTR>NOTATION_ATTR</a> = 9;
  const unsigned short <a href=#ENUMERATION_ATTR>ENUMERATION_ATTR</a> = 10;
  const unsigned short <a href=#UNKNOWN_ATTR>UNKNOWN_ATTR</a> = 11;
};
<a href=#AttributeDefinition>AttributeDefinition</a> implements <a href=#attrdeclaredvaluetype>AttrDeclaredValueType</a>;
<a href=#attr>Attr</a> implements <a href=#attrdeclaredvaluetype>AttrDeclaredValueType</a>;
</span></span></code></pre>

<dl>
<dt><dfn class=dom-attr id=declaredType><code>declaredType</code></dfn> of type
<code>unsigned short</code></dt>
  <dd><p>The declared type
  <cite class="bibref normative">[<a href=#ref-XML>XML</a>,
  <a href=#ref-XML11>XML11</a>]</cite> of the attribute.  It is expected that
  this attribute contains a value from the definition group
  <a href=#DeclaredValueType><code>DeclaredValueType</code></a>.</p>

  <p>On getting, the attribute <em class=rfc2119>MUST</em> return the
  value associated to this attribute.</p>

  <p>On setting, it <em class=rfc2119>MUST</em> set the specified
  value as the value associated to this attribute.</p>

  <p>If the <a href=#AttributeDefinition><code>AttributeDefinition</code></a> node is created during the process
  to create a <abbr>DOM</abbr> from an <abbr>XML</abbr> document, an
  appropriate value from the
  <a href=#DeclaredValueType><code>DeclaredValueType</code></a> constant
  group <em class=rfc2119>MUST</em> be set to the attribute.</p>

  <!-- DeclaredValueType -->
<p>The definition group 
<dfn id=DeclaredValueType><code>DeclaredValueType</code></dfn> contains
integers indicating the declared type of attributes.  The definition
group contains the following constants:</p>

<table>
<thead>
<tr><th scope=col>Name</th><th scope=col>Value</th><th scope=col>Description</th></tr>
</thead>
<tbody>
<tr>
<th scope=row><dfn class=dom-const id=NO_TYPE_ATTR><code>NO_TYPE_ATTR</code>
</dfn></th><td><code>0</code></td><td><a href=http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#intro.null>No
value</a>
<cite class="bibref normative">[<a href=#ref-INFOSET>INFOSET</a>]</cite>.</td></tr>
<tr>
<th scope=row><dfn class=dom-const id=CDATA_ATTR><code>CDATA_ATTR</code>
</dfn></th><td><code>1</code></td><td><code>CDATA</code>
<cite class="bibref normative">[<a href=#ref-XML>XML</a>,
<a href=#ref-XML11>XML11</a>]</cite>.</td></tr>
<tr>
<th scope=row><dfn class=dom-const id=ID_ATTR><code>ID_ATTR</code>
</dfn></th><td><code>2</code></td><td><code>ID</code>
<cite class="bibref normative">[<a href=#ref-XML>XML</a>,
<a href=#ref-XML11>XML11</a>]</cite>.</td></tr>
<tr>
<th scope=row><dfn class=dom-const id=IDREF_ATTR><code>IDREF_ATTR</code>
</dfn></th><td><code>3</code></td><td><code>IDREF</code>
<cite class="bibref normative">[<a href=#ref-XML>XML</a>,
<a href=#ref-XML11>XML11</a>]</cite>.</td></tr>
<tr>
<th scope=row><dfn class=dom-const id=IDREFS_ATTR><code>IDREFS_ATTR</code>
</dfn></th><td><code>4</code></td><td><code>IDREFS</code>
<cite class="bibref normative">[<a href=#ref-XML>XML</a>,
<a href=#ref-XML11>XML11</a>]</cite>.</td></tr>
<tr>
<th scope=row><dfn class=dom-const id=ENTITY_ATTR><code>ENTITY_ATTR</code>
</dfn></th><td><code>5</code></td><td><a href=#entity><code>ENTITY</code></a>
<cite class="bibref normative">[<a href=#ref-XML>XML</a>,
<a href=#ref-XML11>XML11</a>]</cite>.</td></tr>
<tr>
<th scope=row><dfn class=dom-const id=ENTITIES_ATTR><code>ENTITIES_ATTR</code>
</dfn></th><td><code>6</code></td><td><code>ENTITIES</code>
<cite class="bibref normative">[<a href=#ref-XML>XML</a>,
<a href=#ref-XML11>XML11</a>]</cite>.</td></tr>
<tr>
<th scope=row><dfn class=dom-const id=NMTOKEN_ATTR><code>NMTOKEN_ATTR</code>
</dfn></th><td><code>7</code></td><td><code>NMTOKEN</code>
<cite class="bibref normative">[<a href=#ref-XML>XML</a>,
<a href=#ref-XML11>XML11</a>]</cite>.</td></tr>
<tr>
<th scope=row><dfn class=dom-const id=NMTOKENS_ATTR><code>NMTOKENS_ATTR</code>
</dfn></th><td><code>8</code></td><td><code>NMTOKENS</code>
<cite class="bibref normative">[<a href=#ref-XML>XML</a>,
<a href=#ref-XML11>XML11</a>]</cite>.</td></tr>
<tr>
<th scope=row><dfn class=dom-const id=NOTATION_ATTR><code>NOTATION_ATTR</code>
</dfn></th><td><code>9</code></td><td><a href=#notation><code>NOTATION</code></a>
<cite class="bibref normative">[<a href=#ref-XML>XML</a>,
<a href=#ref-XML11>XML11</a>]</cite>.</td></tr>
<tr>
<th scope=row><dfn class=dom-const id=ENUMERATION_ATTR><code>ENUMERATION_ATTR</code>
</dfn></th><td><code>10</code></td><td>Enumeration
<cite class="bibref normative">[<a href=#ref-XML>XML</a>,
<a href=#ref-XML11>XML11</a>]</cite>.</td></tr>
<tr>
<th scope=row><dfn class=dom-const id=UNKNOWN_ATTR><code>UNKNOWN_ATTR</code>
</dfn></th><td><code>11</code></td><td><a href=http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#intro.null>Unknown</a>,
because no declaration for the attribute has been read but the 
<a href=http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#infoitem.document>[all declarations processed]</a>
property
<cite class="bibref normative">[<a href=#ref-INFOSET>INFOSET</a>]</cite>
would be false.</td></tr>
</tbody>
</table>

<p>If no attribute type information is available, or if the source
of the information does not distinguish 
<a href=http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#intro.null>no
value</a> and
<a href=http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#intro.null>unknown</a>
<cite class="bibref normative">[<a href=#ref-INFOSET>INFOSET</a>]</cite>, 
then the value
<a href=#NO_TYPE_ATTR><code>NO_TYPE_ATTR</code></a> 
<em class=rfc2119>MUST</em> be used.</p>

<div class="note memo">
<p>An <a href=#AttributeDefinition><code>AttributeDefinition</code></a> node
created by the 
<a href=#createAttributeDefinition><code>createAttributeDefinition</code></a>
method has its <a href=#declaredType><code>declaredType</code></a> attribute
set to <a href=#NO_TYPE_ATTR><code>NO_TYPE_ATTR</code></a>.</p>
</div>

<p>If the source of the information does not distinguish
<a href=http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#intro.null>no
value</a> and/or
<a href=http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#intro.null>unknown</a>
<cite class="bibref normative">[<a href=#ref-INFOSET>INFOSET</a>]</cite> and
<code>CDATA</code>
<cite class="bibref normative">[<a href=#ref-XML>XML</a>,
<a href=#ref-XML11>XML11</a>]</cite>, then the value
<a href=#CDATA_ATTR><code>CDATA_ATTR</code></a> <em class=rfc2119>MUST</em>
be used.</p>

<p>In Perl binding
<cite class="bibref normative">[<a href=#ref-DOMPERL>DOMPERL</a>]</cite>, the
<a href=#attr><code>Attr</code></a> nodes <em class=rfc2119>MUST</em> implement the
<a href=#DeclaredValueType><code>DeclaredValueType</code></a>
definition group.</p>

  </dd>
<dt><dfn class=dom-attr id=allowedTokens><code>allowedTokens</code></dfn> of
type <code>DOMString</code>[]</dt>
  <dd><p>The list of allowed attribute values.</p>

  <p>On getting, the attribute <em class=rfc2119>MUST</em> return the
  <code>DOMStringList</code> object associated to this attribute.  The object
  <em class=rfc2119>MAY</em> contain zero or more ordered strings, consist of
  zero or more characters respectively, possibly with duplications.

  </p><p>If the <a href=#AttributeDefinition><code>AttributeDefinition</code></a>
  node is created during the process to create a <abbr>DOM</abbr> from an 
  <abbr>XML</abbr> document, the object <em class=rfc2119>MUST</em> contain
  the names or name tokens allowed for the attribute defined by the node.
  If the document is well-formed, the object will be empty unless 
  the <a href=#declaredType><code>declaredType</code></a> is 
  <a href=#ENUMERATION_ATTR><code>ENUMERATION_ATTR</code></a> or
  <a href=#NOTATION_ATTR><code>NOTATION_ATTR</code></a>.</p>

  <p>If the <a href=#declaredType><code>declaredType</code></a> is different
  from <a href=#ENUMERATION_ATTR><code>ENUMERATION_ATTR</code></a> or
  <a href=#NOTATION_ATTR><code>NOTATION_ATTR</code></a>, this attribute
  <em class=rfc2119>MUST</em> be ignored for the purpose of serializing
  into (part of) <abbr>XML</abbr> document.</p>

  <div class="note memo">
    <p>When serializing the node it should be noted that the object might
    be empty, might contain duplications, and might contain strings that are
    not names or name tokens.</p>
  </div></dd>
<dt><dfn class=dom-attr id=defaultType><code>defaultType</code></dfn> of
type <code>unsigned short</code></dt>
  <dd><p>The type of the default for the attribute.  It is expected that this 
  attribute contains a value from the definition group
  <a href=#DefaultValueType><code>DefaultValueType</code></a>.</p>

  <p>On getting, the attribute <em class=rfc2119>MUST</em> return
  the value associated to this attribute.</p>

  <p>On setting, it <em class=rfc2119>MUST</em> set the specified
  value as the value associated to this attribute.</p>

  <p>If the 
  <a href=#AttributeDefinition><code>AttributeDefinition</code></a> node is
  created during the process to create a <abbr>DOM</abbr> from an
  <abbr>XML</abbr> document, an appropriate value from the
  <a href=#DefaultValueType><code>DefaultValueType</code></a> definition
  group <em class=rfc2119>MUST</em> be set to the attribute.</p>

  <!-- DefaultValueType -->
  <p>The definition group
  <dfn id=DefaultValueType><code>DefaultValueType</code></dfn>
  contains integers indicating the type of the default for the attribute.
  The definition group contains the following constants:</p>

  <table>
  <thead>
  <tr><th scope=col>Name</th><th scope=col>Value</th><th scope=col>Description</th></tr>
  </thead>
  <tbody>
  <tr>
  <th scope=row><dfn class=dom-const id=UNKNOWN_DEFAULT><code>UNKNOWN_DEFAULT</code></dfn>
  </th><td><code>0</code></td><td>Unknown.</td></tr>
  <tr>
  <th scope=row><dfn class=dom-const id=FIXED_DEFAULT><code>FIXED_DEFAULT</code></dfn>
  </th><td><code>1</code></td><td>Provided explicitly and only the value is allowed.
  <cite class="bibref normative">[<a href=#ref-XML>XML</a>,
  <a href=#ref-XML11>XML11</a>]</cite>.</td></tr>
  <tr>
  <th scope=row><dfn class=dom-const id=REQUIRED_DEFAULT><code>REQUIRED_DEFAULT</code></dfn>
  </th><td><code>2</code></td><td>No default value and the attribute have to be
  explicitly specified.</td></tr>
  <tr>
  <th scope=row><dfn class=dom-const id=IMPLIED_DEFAULT><code>IMPLIED_DEFAULT</code></dfn>
  </th><td><code>3</code></td><td>Implied
  <cite class="bibref normative">[<a href=#ref-XML>XML</a>,
  <a href=#ref-XML11>XML11</a>]</cite>.</td></tr>
  <tr>
  <th scope=row><dfn class=dom-const id=EXPLICIT_DEFAULT><code>EXPLICIT_DEFAULT</code></dfn>
  </th><td><code>4</code></td><td>Provided explicitly.</td></tr>
  </tbody>
  </table>

  <p>If the source of the default type does not distinguish
  implied and unknown default types, then the value
  <a href=#IMPLIED_DEFAULT><code>IMPLIED_DEFAULT</code></a>
  <em class=rfc2119>MUST</em> be used.</p>

  <div class="note memo">
  <p>An <a href=#AttributeDefinition><code>AttributeDefinition</code></a>
  node created by the
  <a href=#createAttributeDefinition><code>createAttributeDefinition</code></a>
  method has its <a href=#defaultType><code>defaultType</code></a>
  attribute set to
  <a href=#UNKNOWN_DEFAULT><code>UNKNOWN_DEFAULT</code></a>.</p>
  </div></dd>
</dl>

</div>

<div class=section id=section-entity>
<h3 id=general-entities-0><span class=secno>4.6 </span>General entities</h3>

<p>The <a href=#entity><code>Entity</code></a> node is known as <dfn id=concept-general-entity title=concept-general-entity>general entity</dfn>, or when not
ambiguous, simply <dfn id=concept-entity title=concept-entity>entity</dfn>.

</p><p>Each <a href=#concept-entity title=concept-entity>entity</a> has an associated
<dfn id=concept-entity-publicid title=concept-entity-publicid>public ID</dfn> and <dfn id=concept-entity-systemid title=concept-entity-systemid>system ID</dfn>.  Unless otherwise
specified, their values are the empty string when the <a href=#concept-entity title=concept-entity>entity</a> is created.

</p><pre class=idl><code>partial interface <a href=#entity>Entity</a> {
  readonly attribute <a href=#documenttype>DocumentType</a>? <a href=#dom-ownerdocumenttypedefinition title=dom-ownerDocumentTypeDefinition>ownerDocumentTypeDefinition</a>;

  [TreatNullAs=EmptyString] attribute DOMString <a href=#dom-publicid title=dom-publicId>publicId</a>;
  [TreatNullAs=EmptyString] attribute DOMString <a href=#dom-systemid title=dom-systemId>systemId</a>;
  attribute <span>DOMString</span>? <a href=#dom-declarationbaseuri title=dom-declarationBaseURI>declarationBaseURI</a>;
  attribute <span>DOMString</span>? <a href=#dom-manakaideclarationbaseuri title=dom-manakaiDeclarationBaseURI>manakaiDeclarationBaseURI</a>;
  attribute <span>DOMString</span>? <span title=dom-Entity-notationName>notationName</span>;
  readonly attribute <span>DOMString</span> <a href=#dom-entity-hasreplacementtree title=dom-Entity-hasReplacementTree>hasReplacementTree</a>;
  attribute <span>DOMString</span>? <a href=#dom-entity-manakaientityuri title=dom-Entity-manakaiEntityURI>manakaiEntityURI</a>;
  attribute <span>DOMString</span>? <a href=#dom-manakaientitybaseuri title=dom-manakaiEntityBaseURI>manakaiEntityBaseURI</a>;
  attribute boolean <a href=#isExternallyDeclared>isExternallyDeclared</a>;
};</code></pre>

<p>Each <a href=#concept-entity title=concept-entity>entity</a> has an associated
<dfn id=concept-entity-notation-name title=concept-entity-notation-name>notation name</dfn>.  Unless
otherwise specified, it is <a href=#null>null</a> when the <a href=#concept-entity title=concept-entity>entity</a> is created.

</p><p>The <code title=dom-Entity-notationName>notationName</code>
attribute returns the <a href=#concept-entity-notation-name title=concept-entity-notation-name>notation name</a> of the
<a href=#context-object>context object</a>.<!-- Normatively defined in DOM3CORE -->

</p><p>On setting, the <code title=dom-Entity-notationName>notationName</code> attribute of the
<a href=#entity><code>Entity</code></a> interface <em class=rfc2119>MUST</em> set the
<a href=#concept-entity-notation-name title=concept-entity-notation-name>notation name</a> of the
<a href=#context-object>context object</a> to the new value.

</p><div class="note memo">
<p>In DOM3 Core specification, this attribute was read-only.
</p></div>

<div class="note memo">
<p>Setting an invalid name to this attribute would make the node
unserializable in the XML syntax.
</p></div>

<p>Each <a href=#concept-entity title=concept-entity>entity</a> has an associated
<dfn id=concept-entity-replacement-text title=concept-entity-replacement-text>replacement text</dfn>.
Unless otherwise specified, the <a href=#concept-entity-replacement-text title=concept-entity-replacement-text>replacement text</a> is the
empty string when an <a href=#concept-entity title=concept-entity>entity</a> is
created.

</p><dl>
<dt><dfn class=dom-attr id=isExternallyDeclared><code>isExternallyDeclared</code></dfn>
of type <code>boolean</code></dt>
  <dd><p>Whether the entity is declared by an external entity declaration or 
  not.  If the value is <code>true</code>, the entity is declared in an entity
  declaration in the external subset entity or in an external parameter entity.
  If the value is <code>false</code>, the entity is declared in an entity
  declaration in the internal subset, or the node is created in memory.</p>

  <p>On getting, the attribute <em class=rfc2119>MUST</em> return
  the value associated to this attribute.</p>

  <p>On setting, it <em class=rfc2119>MUST</em> set the specified
  value as the value associated to this attribute.</p>

  <p>If the <a href=#Entity><code>Entity</code></a> node is created during
  the process to create a <abbr>DOM</abbr> from an <abbr>XML</abbr> document,
  the following requirements are applied:  If the entity is an unparsed
  entity, then the attribute <em class=rfc2119>MUST</em> be set to 
  <code>false</code>.  Otherwise, i.e. the entity is a parsed entity, then the
  attribute <em class=rfc2119>MUST</em> be set to the value of whether the
  entity is declared by an external markup declaration or not.</p></dd>
</dl>

<hr>

<p>A <a href=#concept-entity title=concept-entity>entity</a> has associated <dfn id=concept-entity-url title=concept-entity-url>entity URL</dfn> and <dfn id=concept-entity-base-url title=concept-entity-base-url>entity base URL</dfn>.  Unless otherwise
specified, their values are <a href=#null>null</a>.

</p><p>On getting, the <dfn id=dom-entity-manakaientityuri title=dom-Entity-manakaiEntityURI><code>manakaiEntityURI</code></dfn>
attribute of the <a href=#entity><code>Entity</code></a> interface <em class=rfc2119>MUST</em> run these steps:

</p><ol>

<li>If the <a href=#concept-entity-url title=concept-entity-url>entity URL</a> of the
<a href=#context-object>context object</a> is not <a href=#null>null</a>, return it and
abort these steps.

</li><li>Otherwise, if the <a href=#concept-entity-systemid title=concept-entity-systemid>system
ID</a> of the <a href=#context-object>context object</a> is not the empty string,
<a href=#resolve-a-url title="resolve a URL">resolve</a> it relative to the <a href=#concept-effective-declaration-base-url title=concept-effective-declaration-base-url>effective declaration
base URL</a> of the <a href=#context-object>context object</a>.  If it succeeded,
return the result and abort these steps.

</li><li>Return <a href=#null>null</a>.

</li></ol>

<p>On setting, the attribute <em class=rfc2119>MUST</em> run these
steps:

</p><ol>

<li>If the new value is <a href=#null>null</a>, set the <a href=#concept-entity-url title=concept-entity-url>entity URL</a> of the <a href=#context-object>context
object</a> to <a href=#null>null</a> and abort these steps.

</li><li><a href=#resolve-a-url title="resolve a URL">Resolve</a> the new value relative
to the <a href=#concept-effective-declaration-base-url title=concept-effective-declaration-base-url>effective
declaration base URL</a> of the <a href=#context-object>context object</a>.  Set
the <a href=#concept-entity-url title=concept-entity-url>entity URL</a> of the
<a href=#context-object>context object</a> to the result if succeeded, or
<a href=#null>null</a> otherwise.

</li></ol>

<div class="note memo">

<p>It is expected that an <a href=#xml-parser>XML Parser</a> supporting this
specification set the <a href=#concept-entity-url title=concept-entity-url>entity URL</a>
when an external entity is read.

</p></div>

</div><!-- section -->

<div class=section id=section-notation>
<h3 id=notations><span class=secno>4.7 </span>Notations</h3>

<p>The <a href=#notation><code>Notation</code></a> node is simply known as <dfn id=concept-notation title=concept-notation>notation.

</dfn></p><p>Each <a href=#concept-notation title=concept-notation>notation</a> has an associated
<dfn id=concept-notation-publicid title=concept-notation-publicid>public ID</dfn> and <dfn id=concept-notation-systemid title=concept-notation-systemid>system ID</dfn>.  Unless otherwise
specified, their values are the empty string when the <a href=#concept-notation title=concept-notation>notation</a> is created.

</p><pre class=idl><code>partial interface <a href=#notation>Notation</a> {
  readonly attribute <a href=#documenttype>DocumentType</a>? <a href=#dom-ownerdocumenttypedefinition title=dom-ownerDocumentTypeDefinition>ownerDocumentTypeDefinition</a>;
  [TreatNullAs=EmptyString] attribute DOMString <a href=#dom-publicid title=dom-publicId>publicId</a>;
  [TreatNullAs=EmptyString] attribute DOMString <a href=#dom-systemid title=dom-systemId>systemId</a>;
  attribute <span>DOMString</span>? <a href=#dom-declarationbaseuri title=dom-declarationBaseURI>declarationBaseURI</a>;
  attribute <span>DOMString</span>? <a href=#dom-manakaideclarationbaseuri title=dom-manakaiDeclarationBaseURI>manakaiDeclarationBaseURI</a>;
};</code></pre>

</div><!-- section -->

</div><!-- section -->

<div class=section>
<h2 id=base-urls><span class=secno>5 </span>Base URLs</h2>

<p>To determine the <a href=#concept-node-base-url title=concept-node-base-url>base URL</a>
of a <span title=concept-node>node</span> <var title="">node</var>, these
steps <em class=rfc2119>MUST</em> be followed:

</p><ol>

<li>If <var title="">node</var> is a <a href=#document-0><code>Document</code></a>, return
<a href=#document-base-url>document base URL</a> of <var title="">node</var> and abort
these steps.

</li><li>If <var title="">node</var> is the <code>base</code> attribute in the
<a href=#xml-namespace>XML namespace</a>:

  <dl class=switch>

  <dt>If the <a href=#concept-attribute-owner-element title=concept-attribute-owner-element>owner
  element</a> of <var title="">node</var> is <a href=#null>null</a> </dt><dt>If
  the <a href=#concept-tree-parent title=concept-tree-parent>parent</a> of the <a href=#concept-attribute-owner-element title=concept-attribute-owner-element>owner element</a> of <var title="">node</var> is <a href=#null>null</a>

  </dt><dd>Return the <a href=#concept-node-base-url title=concept-node-base-url>base URL</a> of
  the <a href=#concept-node-document title=concept-node-document>node document</a> of <var title="">node</var> and abort these steps.

  </dd><dt>Otherwise

  </dt><dd>Return the <a href=#concept-node-base-url title=concept-node-base-url>base URL</a> of
  the <a href=#concept-tree-parent title=concept-tree-parent>parent</a> of the <a href=#concept-attribute-owner-element title=concept-attribute-owner-element>owner element</a> of <var title="">node</var> and abort these steps.
  
  </dd></dl>

</li><li>Otherwise, if <var title="">node</var> is an <a href=#concept-attribute title=concept-attribute>attribute</a>:

  <dl class=switch>

  <dt>If the <a href=#concept-attribute-owner-element title=concept-attribute-owner-element>owner
  element</a> of <var title="">node</var> is <a href=#null>null</a>

  </dt><dd>Return the <a href=#concept-node-base-url title=concept-node-base-url>base URL</a> of
  the <a href=#concept-node-document title=concept-node-document>node document</a> of <var title="">node</var> and abort these steps.

  </dd><dt>Otherwise

  </dt><dd>Return the <a href=#concept-node-base-url title=concept-node-base-url>base URL</a> of
  the <a href=#concept-attribute-owner-element title=concept-attribute-owner-element>owner element</a>
  of <var title="">node</var> and abort these steps.
  
  </dd></dl>

</li><li>If <var title="">node</var> is an <a href=#concept-element title=concept-element>element</a> and it has the <code>base</code>
attribute in the <span title="">XML namespace</span>, <a href=#resolve-a-url title="resolve a URL">resolve</a> the <a href=#concept-attribute-value title=concept-attribute-value>value</a> of the <a href=#concept-attribute title=concept-attribute>attribute</a> relative to the <a href=#concept-node-base-url title=concept-node-base-url>base URL</a> of the <a href=#concept-attribute title=concept-attribute>attribute</a>.  If it succeeded, return the
result and abort these steps.

</li><li>If the <a href=#concept-tree-parent title=concept-tree-parent>parent</a> of <var title="">node</var> is not <a href=#null>null</a>, return the <a href=#concept-node-base-url title=concept-node-base-url>base URL</a> of the <a href=#concept-tree-parent title=concept-tree-parent>parent</a> and abort these steps.

</li><li><!-- If <var title>node</var> is not <span>in a document</span>,
r-->Return the <a href=#concept-node-base-url title=concept-node-base-url>base URL</a> of
the <a href=#concept-node-document title=concept-node-document>node document</a> of <var title="">node</var> and abort these steps.

</li></ol>

<div class="note memo">

<p>These steps ignore external entity boundary, which is a
<a href=#willful-violation>willful violation</a> to the <cite>XML Base</cite>
specification <cite class="bibref informative">[<a href=#ref-XMLBASE>XMLBASE</a>]</cite>.

</p></div>

<hr>

<p>On getting, the <dfn id=dom-documenttype-declarationbaseuri title=dom-DocumentType-declarationBaseURI><code>declarationBaseURI</code></dfn>
and <dfn id=dom-documenttype-manakaideclarationbaseuri title=dom-DocumentType-manakaiDeclarationBaseURI><code>manakaiDeclarationBaseURI</code></dfn>
attributes of the <a href=#documenttype><code>DocumentType</code></a> interface <em class=rfc2119>MUST</em> return the <a href=#concept-node-base-url title=concept-node-base-url>base URL</a> of the <a href=#context-object>context
object</a>.  On setting, they <em class=rfc2119>MUST</em> do
nothing.

</p><p>Each <a href=#concept-entity title=concept-entity>entity</a> or <a href=#concept-notation title=concept-notation>notation</a> has an associated <dfn id=concept-declaration-base-url title=concept-declaration-base-url>declaration base URL</dfn>.  Its
default value is <a href=#null>null</a>.

</p><p>On getting, the <dfn id=dom-declarationbaseuri title=dom-declarationBaseURI><code>declarationBaseURI</code></dfn> and
<dfn id=dom-manakaideclarationbaseuri title=dom-manakaiDeclarationBaseURI><code>manakaiDeclarationBaseURI</code></dfn>
attributes of the <a href=#entity><code>Entity</code></a> or <a href=#notation><code>Notation</code></a>
interface <em class=rfc2119>MUST</em> return <dfn id=concept-effective-declaration-base-url title=concept-effective-declaration-base-url>effective declaration
base URL</dfn>, i.e. the <a href=#concept-declaration-base-url title=concept-declaration-base-url>declaration base URL</a> of the
<a href=#context-object>context object</a> if it is not <a href=#null>null</a>, or the
<a href=#concept-node-base-url title=concept-node-base-url>base URL</a> of the <a href=#context-object>context
object</a> otherwise.

</p><p>On setting, they <em class=rfc2119>MUST</em> run these steps:

</p><ol>

<li>If the new value is <a href=#null>null</a>, set the <a href=#concept-declaration-base-url title=concept-declaration-base-url>declaration base URL</a> of the
<a href=#context-object>context object</a> to <a href=#null>null</a> and abort these
steps.

</li><li>Otherwise, <a href=#resolve-a-url title="resolve a URL">resolve</a> the new
value relative to the <a href=#concept-node-base-url title=concept-node-base-url>base
URL</a> of the <a href=#context-object>context object</a>.  Set the <a href=#concept-declaration-base-url title=concept-declaration-base-url>declaration base URL</a> of the
<a href=#context-object>context object</a> to the result, if it succeeded, or
<a href=#null>null</a>, otherwise.

</li></ol>

<hr>

<pre class=idl><code>partial interface <a href=#document-0>Document</a> {
  attribute <span>DOMString</span>? <a href=#dom-manakaientitybaseuri title=dom-manakaiEntityBaseURI>manakaiEntityBaseURI</a>;
};</code></pre>

<p>The <span title=concept-document>document</span>, like <a href=#concept-entity title=concept-entity>entities</a>, has the <a href=#concept-entity-base-url title=concept-entity-base-url>entity base URL</a>, initially
<a href=#null>null</a>.

</p><p>On getting, the <dfn id=dom-manakaientitybaseuri title=dom-manakaiEntityBaseURI><code>manakaiEntityBaseURI</code></dfn>
attribute of the <a href=#document-0><code>Document</code></a> or <a href=#entity><code>Entity</code></a>
interface <em class=rfc2119>MUST</em> run these steps:

</p><ol>

<li>If the <a href=#concept-entity-base-url title=concept-entity-base-url>entity base URL</a>
of the <a href=#context-object>context object</a> is not <a href=#null>null</a>, return it
and abort these steps.

</li><li>Otherwise, if the <a href=#context-object>context object</a> is
<a href=#entity><code>Entity</code></a>, return the <a href=#dom-entity-manakaientityuri><code title=dom-Entity-manakaiEntityURI>manakaiEntityURI</code></a> attribute
value of the <a href=#context-object>context object</a> if it is not
<a href=#null>null</a>.

</li><li>Otherwise, return the <a href=#concept-node-base-url title=concept-node-base-url>base
URL</a> of the <a href=#context-object>context object</a>.

</li></ol>

<p>On setting, the attribute <em class=rfc2119>MUST</em> run these
steps:

</p><ol>

<li>If the new value is <a href=#null>null</a>, set the <a href=#concept-entity-base-url title=concept-entity-base-url>entity base URL</a> of the
<a href=#context-object>context object</a> to <a href=#null>null</a> and abort these
steps.

</li><li><a href=#resolve-a-url title="resolve a URL">Resolve</a> the new value relative
to the <a href=#dom-entity-manakaientityuri><code title=dom-Entity-manakaiEntityURI>manakaiEntityURI</code></a>
attribute value, if the <a href=#context-object>context object</a> is an
<a href=#entity><code>Entity</code></a> and it it not <a href=#null>null</a>, or the <a href=#concept-node-base-url title=concept-node-base-url>base URL</a> otherwise, of the
<a href=#context-object>context object</a>.  Set the <a href=#concept-entity-base-url title=concept-entity-base-url>entity base URL</a> of the
<a href=#context-object>context object</a> to the result if succeeded, or
<a href=#null>null</a> otherwise.

</li></ol>

<div class="note memo">

<p>It is expected that an <a href=#xml-parser>XML Parser</a> supporting this
specification set the <a href=#concept-entity-base-url title=concept-entity-base-url>entity base
URL</a> when a document or external entity is read.  If the entity
is retrieved using HTTP, the <code>Content-Base:</code> and
<code>Content-Location:</code> header fields might affect the value.
Note also that they does not affect the value of the <a href=#document-base-url>document
base URL</a> of the <span title=concept-document>document</span>.

</p></div>


</div><!-- section -->


<div class=section>
<h2 id=xml-namespaces><span class=secno>6 </span>XML namespaces</h2>

<p class=section-info>This section is <em>non-normative</em>.

</p><p>This section describes how to implement namespace fixup.</p>

<div class=section>
<h3 id=namespace-mappings><span class=secno>6.1 </span>Namespace mappings</h3>

<p class=section-info>This section is <em>non-normative</em>.

</p><p>A <dfn id=concept-nsmap title=concept-nsmap>namespace mapping</dfn> is a data
structure with the following fields:

</p><dl>

<dt><dfn id=concept-nsmap-default title=concept-nsmap-default>Default namespace</dfn>

</dt><dd>Either a namespace URL, <a href=#null><i>null</i></a>, or <i>missing</i>.  By
default, its value is <i>missing</i>.

</dd><dt><dfn id=concept-nsmap-prefix-to-url title=concept-nsmap-prefix-to-url>Prefix to URL</dfn>

</dt><dd>An ordered list of key/value pairs, where keys are namespace
prefixes and values are namespace URLs or <i>none</i>.  By default,
the set contains two pairs: (<code>xml</code>, the <a href=#xml-namespace>XML
namespace</a>) and (<code>xmlns</code>, the <a href=#xmlns-namespace>XMLNS
namespace</a>).

</dd></dl>

<div class="note memo">

<p>There will be at most one pair with same key in the <a href=#concept-nsmap-prefix-to-url title=concept-nsmap-prefix-to-url>prefix to URL</a> list.  However,
there might be more than one pairs with same value in the list.

</p></div>

<p>A <dfn id=concept-default-namespace-declaration title=concept-default-namespace-declaration>default
namespace declaration</dfn> with namespace URL <var title="">url</var> is
an <a href=#concept-attribute title=concept-attribute>attribute</a> whose <a href=#concept-attribute-namespace title=concept-attribute-namespace>namespace</a> is the <a href=#xmlns-namespace>XMLNS
namespace</a>, <a href=#concept-attribute-local-name title=concept-attribute-local-name>local
name</a> is <code>xmlns</code>, and <a href=#concept-attribute-value title=concept-attribute-value>value</a> is <var title="">url</var>.

</p><p>A <dfn id=concept-namespace-prefix-declaration title=concept-namespace-prefix-declaration>namespace prefix
declaration</dfn> with prefix <var title="">prefix</var> and namespace
URL <var title="">url</var> is an <a href=#concept-attribute title=concept-attribute>attribute</a> whose <a href=#concept-attribute-namespace title=concept-attribute-namespace>namespace</a> is the <a href=#xmlns-namespace>XMLNS
namespace</a>, <a href=#concept-attribute-namespace-prefix title=concept-attribute-namespace-prefix>namespace prefix</a> is
<code>xmlns</code>, <a href=#concept-attribute-local-name title=concept-attribute-local-name>local
name</a> is <var title="">prefix</var>, and <a href=#concept-attribute-value title=concept-attribute-value>value</a> is <var title="">url</var>.

</p></div>

<div class=section>
<h3 id=namespace-fixup-of-an-xml-element-for-serialization><span class=secno>6.2 </span>Namespace fixup of an XML element for serialization</h3>

<p class=section-info>This section is <em>non-normative</em>.

</p><p>The <dfn id=steps-for-namespace-fixup-of-an-xml-element-for-serialization>steps for namespace fixup of an XML element for
serialization</dfn>, with an <a href=#concept-element title=concept-element>element</a> <var title="">element</var> and
optional <a href=#concept-nsmap title=concept-nsmap>namespace mapping</a> <var title="">nsmap</var>, are as follows:

</p><ol>

<li>If <var title="">nsmap</var> is not specified, let <var title="">nsmap</var> be a new <a href=#concept-nsmap title=concept-nsmap>namespace
mapping</a>.

</li><li>Otherwise, let <var title="">nsmap</var> be a deep clone of <var title="">nsmap</var>.

</li><li>Let <var title="">attributes</var> be the list containing the <a href=#concept-attribute title=concept-attribute>attributes</a> in the <a href=#concept-element-attribute title=concept-element-attribute>attribute list</a> of <var title="">element</var> in same order.

</li><li>For each <a href=#concept-attribute title=concept-attribute>attribute</a> <var title="">attr</var> in <var title="">attributes</var>, in order:

  <ol>

  <li>If the <a href=#concept-attribute-namespace title=concept-attribute-namespace>namespace</a>
  of <var title="">attr</var> is not the <a href=#xmlns-namespace>XMLNS namespace</a>,
  skip the rest of these substeps and continue with any next <a href=#concept-attribute title=concept-attribute>attribute</a>.

  </li><li>Let <var title="">local name</var> be the <a href=#concept-attribute-local-name title=concept-attribute-local-name>local name</a> of <var title="">attr</var>.

  </li><li>Let <var title="">value</var> be the <a href=#concept-attribute-value title=concept-attribute-value>value</a> of <var title="">attr</var>.

  </li><li>If <var title="">local name</var> is <code>xml</code>, or if <var title="">value</var> is the <a href=#xml-namespace>XML namespace</a> or the
  <a href=#xmlns-namespace>XMLNS namespace</a>, do nothing.

  </li><li>Otherwise, if <var title="">local name</var> is <code>xmlns</code>:

    <ol>

    <li>If <var title="">value</var> is the empty string, set the <a href=#concept-nsmap-default title=concept-nsmap-default>default namespace</a> of <var title="">nsmap</var> to <a href=#null><i>null</i></a>.

    </li><li>Otherwise, set the <a href=#concept-nsmap-default title=concept-nsmap-default>default
    namespace</a> of <var title="">nsmap</var> to <var title="">value</var>.

    </li></ol>

  </li><li>Otherwise:

    <ol>

    <li>Delete the key/value pair whose key is equal to <var title="">local name</var>, if any, from the <a href=#concept-nsmap-prefix-to-url title=concept-nsmap-prefix-to-url>prefix to URL</a> list of
    <var title="">nsmap</var>.

    </li><li>If <var title="">value</var> is the empty string, append
    key/value pair (<var title="">local name</var>,
    <i>none</i>) to the <a href=#concept-nsmap-prefix-to-url title=concept-nsmap-prefix-to-url>prefix
    to URL</a> list of <var title="">nsmap</var>.

    </li><li>Otherwise, append key/value pair (<var title="">local name</var>,
    <var title="">value</var>) to the <a href=#concept-nsmap-prefix-to-url title=concept-nsmap-prefix-to-url>prefix to URL</a> list of
    <var title="">nsmap</var>.

    </li></ol>

  </li></ol>

</li><li>Let <var title="">tag name</var> and <var title="">new attr</var> be the
values returned by the <a href=#steps-to-obtain-a-qname>steps to obtain a QName</a> with the
<a href=#concept-element-namespace title=concept-element-namespace>namespace</a>, <a href=#concept-element-namespace-prefix title=concept-element-namespace-prefix>namespace prefix</a>, and
<a href=#concept-element-local-name title=concept-element-local-name>local name</a> of <var title="">element</var>, <var title="">attributes</var>, and <var title="">nsmap</var> and with the <var title="">is element</var> flag.

</li><li>If <var title="">new attr</var> is not null, prepend it to <var title="">attributes</var>.

</li><li>Let <var title="">attribute specifications</var> be the empty list.

</li><li>For each <a href=#concept-attribute title=concept-attribute>attribute</a> <var title="">attr</var> in <var title="">attributes</var>, in order:

  <ol>

  <li>Let <var title="">attr name</var> and <var title="">new attr</var> be
  the values returned by the <a href=#steps-to-obtain-a-qname>steps to obtain a QName</a> with
  the <a href=#concept-attribute-namespace title=concept-attribute-namespace>namespace</a>, <a href=#concept-attribute-namespace-prefix title=concept-attribute-namespace-prefix>namespace prefix</a>,
  and <a href=#concept-attribute-local-name title=concept-attribute-local-name>local name</a> of
  <var title="">attr</var>, <var title="">attributes</var>, and <var title="">nsmap</var> (without the <var title="">is element</var> flag).

  </li><li>If <var title="">new attr</var> is not null, insert it into <var title="">attributes</var> just after <var title="">attr</var>.

  </li><li>Append attribute name/value pair (<var title="">attr name</var>,
  the <a href=#concept-attribute-value title=concept-attribute-value>value</a> of <var title="">attr</var>) to <var title="">attribute specifications</var>.

  </li></ol>

  </li><li>Return <var title="">tag name</var>, <var title="">attribute
  specifications</var>, and <var title="">nsmap</var>.

</li></ol>

<p>These steps return three values.  The first value, <var title="">tag
name</var>, is used as the tag name in the start and end tag of the
serialization of <var title="">element</var>.  The second value, <var title="">attribute specifications</var>, contains zero or more pairs of
attribute names and values, which are used in the start tag of the
serialization of <var title="">element</var>.  The third value, <var title="">nsmap</var>, is used as the input to the steps for serialization
of the child elements of <var title="">element</var>.

</p><p>The <dfn id=steps-to-obtain-a-qname>steps to obtain a QName</dfn>, with parameters <var title="">namespace URL</var>, <var title="">prefix</var>, <var title="">local
name</var>, <var title="">attributes</var>, and <var title="">nsmap</var>,
where <var title="">attributes</var> and <var title="">nsmap</var> are
shared with the callee such that any modification to them is also
reflected to those variables in the steps which invoked these steps,
and the <var title="">is element</var> flag, are as follows:

</p><ol>

<li>Let <var title="">qname</var> be <var title="">local name</var>.

</li><li>Let <var title="">new attr</var> be null.

</li><li>If <var title="">namespace URL</var> is null:

  <ol>

  <li>If the <var title="">is element</var> flag is not set, do nothing.

  </li><li>Otherwise, if the <a href=#concept-nsmap-default title=concept-nsmap-default>default
  namespace</a> of <var title="">nsmap</var> is not <a href=#null><i>null</i></a>:

    <ol>

    <li>Set the <a href=#concept-nsmap-default title=concept-nsmap-default>default
    namespace</a> of <var title="">nsmap</var> to <a href=#null><i>null</i></a>.

    </li><li>If <var title="">attributes</var> contains an <a href=#concept-attribute title=concept-attribute>attribute</a> <var title="">attr</var>
    whose <a href=#concept-attribute-namespace title=concept-attribute-namespace>namespace</a> is
    the <a href=#xmlns-namespace>XMLNS namespace</a> and <a href=#concept-attribute-local-name title=concept-attribute-local-name>local name</a> is
    <code>xmlns</code>:

      <ol>

      <li>If the <a href=#concept-attribute-value title=concept-attribute-value>value</a> of
      <var title="">attr</var> is not the empty string, replace <var title="">attr</var> in <var title="">attributes</var> by a new <a href=#concept-default-namespace-declaration title=concept-default-namespace-declaration>defualt namespace
      declaration</a> with namespace URL <i>the empty string</i>,
      preserving the order.

      </li></ol>

    </li><li>Otherwise, let <var title="">new attr</var> be a new <a href=#concept-default-namespace-declaration title=concept-default-namespace-declaration>defualt namespace
    declaration</a> with namespace URL <i>the empty string</i>.

    </li></ol>

  </li></ol>

</li><li>Otherwise, if <var title="">namespace URL</var> is not null:

  <ol>

  <li>If <var title="">namespace URL</var> is the <a href=#xml-namespace>XML
  namespace</a>, let <var title="">prefix</var> be <code>xml</code>.

  </li><li>Otherwise, if <var title="">namespace URL</var> is the <a href=#xmlns-namespace>XMLNS
  namespace</a>, let <var title="">prefix</var> be <code>xmlns</code>.

  </li><li>If <var title="">namespace URL</var> is the <a href=#xmlns-namespace>XMLNS
  namespace</a> and <var title="">qname</var> is <code>xmlns</code>,
  do nothing.

  </li><li>Otherwise, if the <var title="">is element</var> flag is set, <var title="">prefix</var> is null, and the <a href=#concept-nsmap-default title=concept-nsmap-default>default namespace</a> of <var title="">nsmap</var> is <i>missing</i>:

    <ol>

    <li>Set the <a href=#concept-nsmap-default title=concept-nsmap-default>default
    namespace</a> of <var title="">nsmap</var> to <var title="">namespace
    URL</var>.

    </li><li>Let <var title="">new attr</var> be a new <a href=#concept-default-namespace-declaration title=concept-default-namespace-declaration>default namespace
    declaration</a> with namespace URL <var title="">namespace
    URL</var>.

    </li></ol>

  </li><li>Otherwise, if the <var title="">is element</var> flag is set, <var title="">prefix</var> is null, and the <a href=#concept-nsmap-default title=concept-nsmap-default>default namespace</a> of <var title="">nsmap</var> is equal to <var title="">namespace URL</var>, do
  nothing.

  </li><li>Otherwise, if <var title="">prefix</var> is not null and there is
  the key/value pair whose key is <var title="">prefix</var> and value is
  <var title="">namespace URL</var> in the <a href=#concept-nsmap-prefix-to-url title=concept-nsmap-prefix-to-url>prefix to URL</a> list of <var title="">nsmap</var>, prepend <var title="">prefix</var> followed by a
  <code>U+003A</code> <code class=charname>COLON</code> character
  (<code>:</code>) to <var title="">qname</var>.

  </li><li>Otherwise, if <var title="">prefix</var> is not null and there is
  no key/value pair whose key is <var title="">prefix</var> in the <a href=#concept-nsmap-prefix-to-url title=concept-nsmap-prefix-to-url>prefix to URL</a> list of <var title="">nsmap</var>:

    <ol>

    <li>Append key/value pair (<var title="">prefix</var>, <var title="">namespace URL</var>) to the <a href=#concept-nsmap-prefix-to-url title=concept-nsmap-prefix-to-url>prefix to URL</a> list of
    <var title="">nsmap</var>.

    </li><li>Let <var title="">new attr</var> be a new <a href=#concept-namespace-prefix-declaration title=concept-namespace-prefix-declaration>namespace prefix
    declaration</a> with prefix <var title="">prefix</var> and
    namespace URL <var title="">namespace URL</var>.

    </li><li>Prepend <var title="">prefix</var> followed by a
    <code>U+003A</code> <code class=charname>COLON</code> character
    (<code>:</code>) to <var title="">qname</var>.

    </li></ol>

  </li><li>Otherwise, if there is the key/value pair whose value is equal
  to <var title="">namespace URL</var> in the <a href=#concept-nsmap-prefix-to-url title=concept-nsmap-prefix-to-url>prefix to URL</a> list of <var title="">nsmap</var>:

    <ol>

    <li>Let <var title="">prefix</var> be the key of the last key/value
    pair whose value is equal to <var title="">namespace URL</var> in the
    <a href=#concept-nsmap-prefix-to-url title=concept-nsmap-prefix-to-url>prefix to URL</a> list
    of <var title="">nsmap</var>.

    </li><li>Prepend <var title="">prefix</var> followed by a
    <code>U+003A</code> <code class=charname>COLON</code> character
    (<code>:</code>) to <var title="">qname</var>.

    </li></ol>

  </li><li>Otherwise, if the <var title="">is element</var> flag is set and
  the <a href=#concept-nsmap-default title=concept-nsmap-default>default namespace</a> of
  <var title="">nsmap</var> is equal to <var title="">namespace URL</var>,
  do nothing.

  </li><li>Otherwise, if the <var title="">is element</var> flag is set, <var title="">prefix</var> is null, and <var title="">attribute</var> does not
  contain an <a href=#concept-attribute title=concept-attribute>attribute</a> whose
  <a href=#concept-attribute-namespace title=concept-attribute-namespace>namespace</a> is the
  <a href=#xmlns-namespace>XMLNS namespace</a> and <a href=#concept-attribute-local-name title=concept-attribute-local-name>local name</a> is
  <code>xmlns</code>:

    <ol>

    <li>Set the <a href=#concept-nsmap-default title=concept-nsmap-default>default
    namespace</a> of <var title="">nsmap</var> to <var title="">namespace
    URL</var>.

    </li><li>Let <var title="">new attr</var> be a new <a href=#concept-default-namespace-declaration title=concept-default-namespace-declaration>default namespace
    declaration</a> with namespace URL <var title="">namespace
    URL</var>.

    </li></ol>

  </li><li>Otherwise:

    <ol>

    <li>Let <var title="">prefix</var> be <code title="">a<var title="">n</var></code> where <var title="">n</var> is chosen such that
    <var title="">n</var> is the minimum non-negative integer <code title="">a<var title="">n</var></code> is not found as a key of the
    <a href=#concept-nsmap-prefix-to-url title=concept-nsmap-prefix-to-url>prefix to URL</a> list
    of <var title="">nsmap</var>.

    </li><li>Append key/value pair (<var title="">prefix</var>, <var title="">namespace URL</var>) to the <a href=#concept-nsmap-prefix-to-url title=concept-nsmap-prefix-to-url>prefix to URL</a> list of
    <var title="">nsmap</var>.

    </li><li>Let <var title="">new attr</var> be a new <a href=#concept-namespace-prefix-declaration title=concept-namespace-prefix-declaration>namespace prefix
    declaration</a> with prefix <var title="">prefix</var> and
    namespace URL <var title="">namespace URL</var>.

    </li><li>Prepend <var title="">prefix</var> followed by a
    <code>U+003A</code> <code class=charname>COLON</code> character
    (<code>:</code>) to <var title="">qname</var>.

    </li></ol>

  </li></ol>

  </li><li>Return <var title="">qname</var> and <var title="">new attr</var>.

</li></ol>

<div class="note memo">

<p>These steps are based on, but not equivalent to, <a href=http://suika.fam.cx/~wakaba/wiki/sw/n/XML%E3%81%AE%E7%9B%B4%E5%88%97%E5%8C%96#anchor-8>Gecko's
implementation at the time of writing</a>.

</p></div>

<div class="note memo">

<p>These steps do not prevent an unserializable set of <var title="">tag
name</var> and <var title="">attributes</var> from being returned when,
for example, there is an <code>xmlns</code> <a href=#concept-attribute title=concept-attribute>attribute</a> in null namespace, there is
an <code>xml</code> <a href=#concept-attribute title=concept-attribute>attribute</a> in
the <a href=#xmlns-namespace>XMLNS namespace</a> whose <a href=#concept-attribute-value title=concept-attribute-value>value</a> is not equal to the
<a href=#xml-namespace>XML namespace</a>, or the given <var title="">nsmap</var>
contains a key which is not a valid XML <code>NCName</code>.

</p></div>

</div>

<div class=section>
<h3 id=tests><span class=secno>6.3 </span>Tests</h3>

<p class=section-info>This section is <em>non-normative</em>.

</p><p>There is no comprehensive test suite of namespace fixup at the time
of writing.

</p><p>There are some tests at: <code class=URI>&lt;<a href=http://suika.suikawiki.org/~wakaba/test/web/dom/element/inner-html/>http://suika.suikawiki.org/~wakaba/test/web/dom/element/inner-html/</a>&gt;</code>
and <code class=URI>&lt;<a href=https://github.com/manakai/perl-web-markup/blob/master/t/modules/Web-XML-Serializer.t>https://github.com/manakai/perl-web-markup/blob/master/t/modules/Web-XML-Serializer.t</a>&gt;</code>.

</p></div>

</div><!-- section -->


<div class=makesection>
<h2 id=conformance-checking-of-xml-documents><span class=secno>7 </span>Conformance checking of XML documents</h2>

<p>If there is a <a href=#parse-error>parse error</a>, the document is not
well-formed.

</p><div class=ed>

<div class="issue ed">...

<p>Much of invalid (well-formed or not) XML document parsing and XML document
/ XML DOM conformance is left undefined so that this document provides a
guideline for conformance checkers.

</p></div>

<div class=section id=processing-model>
<h3 id=processing-model-0><span class=secno>7.1 </span>Processing Model</h3>

<p>Conceptually, validation of an XML document is split into two
stages for the purpose of this specification: the <dfn id=xml-document-parsing>XML document parsing</dfn> stage and the <dfn id=dom-xml-conformance-checking>DOM XML conformance checking</dfn>
stage.

</p><p>The input to the XML document parsing stage is a byte sequence
representing the parsed XML document (and any additional metadata),
and the output are a DOM tree representing the XML document and zero
or more <a href=#error>errors</a>.  The processor that implements
this stage is called <dfn id=parser>parser</dfn>.  Requirements for a
parser are defined in the section of <a href=#parsing-xml>Parsing an
XML Document</a>.

</p><p>The input to the DOM XML conformance chcking stage is a DOM tree,
and the output are zero or more <a href=#error>errors</a>.  The
processor that implements this stage is called <dfn id=conformance-checker>conformance checker</dfn>.  Requirements for a
conformance checker are defined in the section of <a href=#checking-dom>Checking an XML DOM Tree</a>.


</p><div class=section id=error-categories>
<h4 id=error-classification><span class=secno>7.1.1 </span>Error Classification</h4>

<p class=ed>An <dfn id=error>error</dfn> is ...

</p><p class=ed>If a <a href=#document-0><code>Document</code></a> node has no 
xml-well-formedness-error, entity-error, and unknown-error,
then it is well-formed.  If a well-formed <a href=#document-0><code>Document</code></a>
node has no xml-validity-error, it is valid.</p>

<div class="note memo">
<p>A wellformed <a href=#document-0><code>Document</code></a> can be safely serialized
into a wellformed XML document.  A valid <a href=#document-0><code>Document</code></a>
can be easily serialized into a valid XML document.</p>
</div>

<p class=ed>To be a conforming <a href=http://www.w3.org/TR/2006/REC-xml-20060816/#dt-validating>validating XML processor</a>,
...</p>

<p>Errors are classified into these 
<dfn id=error-category title="error category">error categories</dfn>:</p>

<dl id=errors>
<dt><dfn id=entity-error><code>entity-error</code></dfn></dt>
  <dd>
    <p class=ed>@@</p>
    <div class="note memo">
      <p>This <span class=ed>algorithm</span> does not support
      <abbr>DOM</abbr> tree with one or more <code>EntityReference</code>
      nodes.  It is expected that any entity references are expanded
      at the parse time and any unexpandable entity references
      make parse time errors raised so that never result in
      <abbr>DOM</abbr> tree with <code>EntityReference</code> nodes.</p>
    </div>
  </dd>
<dt><dfn id=round-trip-error><code>round-trip-error</code></dfn></dt>
  <dd class=ed>@@</dd>
<dt><dfn id=round-trip-warning><code>round-trip-warning</code></dfn></dt>
  <dd>
    <p>A <a href=#round-trip-warning><code>round-trip-warning</code></a>
    will be raised when a construct, which might not be restored to the same
    construct when it is serialized and then re-parsed by a conforming
    processor, is encountered.</p>
    <div class="example memo">
      <p>For a <code>Comment</code> node a
      <a href=#round-trip-warning><code>round-trip-warning</code></a> will
      be raised, since <abbr>XML</abbr> processors are not required to
      report texts of comments for applications.</p>
    </div>
  </dd>
<dt class=ed><dfn id=unknown-error><code>unknown-error</code></dfn>?</dt>
  <dd class=ed>@@</dd>
<dt><dfn id=xml-misc-error><code>xml-misc-error</code></dfn></dt>
  <dd>An <abbr>XML</abbr> <a href=#error><i>error</i></a> (<abbr>XML</abbr> 1.0
  <cite class="bibref normative">[<a href=#ref-XML>XML</a>]</cite> 
  <a href=http://www.w3.org/TR/2006/REC-xml-20060816/#dt-error>error</a> /
  <abbr>XML</abbr> 1.1
  <cite class="bibref normative">[<a href=#ref-XML11>XML11</a>]</cite>
  <a href=@@/#dt-error>error</a>)
  that is not classified to any other <a href=#error-category>error
  category</a>.</dd>
<dt><dfn id=xml-misc-fatal-error><code>xml-misc-fatal-error</code></dfn></dt>
  <dd>An <abbr>XML</abbr> <i>fatal error</i> (<abbr>XML</abbr> 1.0
  <cite class="bibref normative">[<a href=#ref-XML>XML</a>]</cite> 
  <a href=http://www.w3.org/TR/2006/REC-xml-20060816/#dt-fatal>fatal
  error</a> / <abbr>XML</abbr> 1.1
  <cite class="bibref normative">[<a href=#ref-XML11>XML11</a>]</cite>
  <a href=@@/#dt-fatal>fatal error</a>)
  that is not classified to any other <a href=#error-category>error
  category</a>. <span class=ed>@@ What errors fall into this category?</span></dd>
<dt><dfn id=xml-misc-recommendation><code>xml-misc-recommendation</code></dfn></dt>
  <dd>
    <p>An
    <a href=#xml-misc-recommendation><code>xml-misc-recommendation</code></a>
    will be raised if a <em class=rfc2119>SHOULD</em>level requirement
    in <abbr>XML</abbr> specification is not met.</p>
  </dd>
<dt><dfn id=xml-validity-error><code>xml-validity-error</code></dfn></dt>
  <dd>A violation of validity constraint in XML document.</dd>
<dt><dfn id=xml-well-formedness-error><code>xml-well-formedness-error</code></dfn></dt>
  <dd><p>If an <a href=#xml-well-formedness-error><code>xml-well-formedness-error</code></a> is raised,
  it would not be possible to generate an XML serialization that
  would match to the appropriate production rule and that would not 
  violate to any wellformedness constraint in XML
  specification <cite class="bibref normative">[<a href=#ref-XML>XML</a>,
  <a href=#ref-XML11>XML11</a>]</cite>.</p></dd>
<dt><dfn id=misc-info><code>misc-info</code></dfn>
  </dt><dd><p>A <a href=#misc-info><code>misc-info</code></a> is raised when some status information
  on parsing or checking process that are considered useful for debugging
  and so on is available.  It by no means implies the non-conformance of
  the document.
</p></dd></dl>

<div class=ed><p>@@ TODO: #dt-atuseroption at user option
(MAY or MUST), #dt-compat for compatibility,
#dt-interop for interoperability</p>

<p>TODO: XML 1.1, XML Namespace 1.0/1.1, xml:base, xml:id

</p><p>TODO: XML "error"/"fatal error" is not always non-conforming (only
when MUST or SHOULD).
</p></div>

</div>

</div>

<div class=section id=checking-dom>
<h3 id=checking-an-xml-dom-tree><span class=secno>7.2 </span>Checking an <abbr>XML</abbr> <abbr>DOM</abbr> Tree</h3>

<p>The following algorithms and definitions are applied to
<abbr>XML</abbr> documents; especially, they are not applied
to <abbr>HTML</abbr> documents.<!-- TODO: ref to HTML5 --></p>

<div class=section id=definitions>
<h4 id=definitions-0><span class=secno>7.2.1 </span>Definitions</h4>

<p>The <dfn id=xml-version><abbr>XML</abbr> version</dfn> of a node is 
the <abbr>XML</abbr> version of the document to which the node belongs.
For a <code>Documemt</code> node, the <abbr>XML</abbr> version
of the document is the value of the <code>xmlVersion</code>
attribute of the node.  For a <a href=#documenttype><code>DocumentType</code></a> node whose 
<code>ownerDocument</code> attribute is set to <a href=#null><code>null</code></a>,
the <abbr>XML</abbr> version of the document is <code>1.0</code><!--
since createDocumentType [DOM3CORE] assumes XML 1.0 [XML10TE] -->.
For any other node, the <abbr>XML</abbr> version of the document
is that of the <a href=#document-0><code>Document</code></a> node contained in the
<code>ownerDocument</code> attribute of the node.</p>

</div>


<div class=section id=checking-components>
<h4 id=conformance-checking-algorithms-for-components><span class=secno>7.2.2 </span>Conformance Checking Algorithms for Components</h4>

<p>To
<dfn id=algorithm-to-validate-an-xml-character-data title="validate an XML string">to
validate an <abbr>XML</abbr> string (<dfn id=var-s><var>s</var></dfn>)</dfn>,
the following algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
<li>If <a href=#var-ncname-s><var>s</var></a> contains a character that is <em>not</em> in
the character class <a href=#class-Char10><code>Char10</code></a>, 
then raise an
<a href=#xml-well-formedness-error id=wfe-illegal-char><code>xml-well-formedness-error</code></a>.</li>
<li>If <a href=#var-ncname-s><var>s</var></a> contains a character that is in the character
class <a href=#class-CompatChar10><code>CompatChar10</code></a>,
then raise an
<a href=#xml-misc-warning id=xmw-compat-char><code>xml-misc-warning</code></a>.</li>
<li>If <a href=#var-ncname-s><var>s</var></a> contains a character that is in the character
class <a href=#class-ControlChar10><code>ControlChar10</code></a>,
then raise an
<a href=#xml-misc-warning id=xmw-control-char><code>xml-misc-warning</code></a>.</li>
<li class=ed>@@ XML 1.1 support</li>
<li>If <a href=#var-ncname-s><var>s</var></a> contains a <code class=char>U+000D</code>
<code class=charname>CARRIAGE RETURN</code> character, then
raise a 
<a href=#round-trip-error id=rte-cr><code>round-trip-error</code></a>.
<span class=ed>@@ We should not raise duplicate errors for U+000D
in attribute values.  In addition, we should support a mode where
U+000D will be serialized as 
 (so that no round-trip-error
will be raised).</span></li>
</ol>

<p>To
<dfn id=algorithm-to-validate-a-name title="validate a Name">validate a
<code>Name</code> (<dfn id=var-name-s><var>s</var></dfn>)</dfn>, the following
algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
<li>If <a href=#var-ncname-s><var>s</var></a> is an empty string, then raise an
<a href=#xml-well-formedness-error id=wfe-name-empty><code>xml-well-formedness-error</code></a>.
Abort these steps.</li>
<li><a href=#algorithm-to-validate-an-xml-character-data title="validate an XML string">Validate
<var>s</var> as an <abbr>XML</abbr> string</a>.</li>
<li>If the first character in <a href=#var-ncname-s><var>s</var></a> is a character that is 
<em>not</em> in the character class 
<a href=#class-NameStartChar10><code>NameStartChar10</code></a>, then raise
an
<a href=#xml-well-formedness-error id=wfe-name-startchar><code>xml-well-formedness-error</code></a>.</li>
<li>If a character other than the first character in <a href=#var-ncname-s><var>s</var></a> is a 
character that is <em>not</em> in the character class 
<a href=#class-NameChar10><code>NameChar10</code></a>, then raise an
<a href=#xml-well-formedness-error id=wfe-name-char><code>xml-well-formedness-error</code></a>.</li>
<li>If <a href=#var-ncname-s><var>s</var></a> begins with the string <code>xml</code> (in any
case combination), then raise an
<a href=#xml-misc-warning id=xmw-reserved-name><code>xml-misc-warning</code></a>.
<span class=ed>@@ except for attribute names <code>xml:lang</code>,
<code>xml:space</code><!--, <code>xml:base</code>, <code>xml:id</code>,
<code>xmlns</code>, <code>xmlns:<var>*</var></code>,
pi name <code>xml-stylesheet</code>-->.</span><!--
"names beginning with a match to (('X'|'x')('M'|'m')('L'|'l')) are reserved for standardization in this or future versions of this specification.":
xmlns, xml-stylesheet, xml:base and xml:id specifications violate to this sentense!
--></li>
<!-- COLON in Name is a lowercase "should not" in a Note of [XML],
[XML11]. -->
<li class=ed>@@ XML 1.1 support</li>
</ol>

<p>To
<dfn id=algorithm-to-validate-an-ncname title="validate an NCName">validate
an <code>NCName</code> (<dfn id=var-ncname-s><var>s</var></dfn>)</dfn>, the
following algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
<li><a href=#algorithm-to-validate-a-name title="validate a Name">Validate
<var>s</var> as a <code>Name</code></a>.</li>
<li class=ed>@@</li>
</ol>

<p>To 
<dfn id=algorithm-to-validate-a-public-identifier title="validate a public identifier">validate
a public identifier (<dfn id=var-pid><var>pid</var></dfn>)</dfn>, the
following algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
<li>If <a href=#var-pid><var>pid</var></a> is <a href=#null><code>null</code></a>, abort these steps.</li>
<li>If <a href=#var-pid><var>pid</var></a> contains a character that is <em>not</em> in the
character class <a href=#class-PubidChar><code>PubidChar</code></a>, then
raise an
<a href=#xml-well-formedness-error id=wfe-pubid-char><code>xml-well-formedness-error</code></a>.</li>
  <li>If <a href=#var-pid><var>pid</var></a> contains one of <code class=char>U+0009</code>
  <code class=charname>CHARACTER TABULATION</code>, 
  <code class=char>U+000A</code> <code class=charname>CARRIAGE RETURN</code>,
  and <code class=char>U+000D</code> <code class=charname>LINE FEED</code>
  characters, if the first character of <a href=#var-pid><var>pid</var></a> is
  <code class=char>U+0020</code> <code class=charname>SPACE</code> character,
  if the last character of <a href=#var-pid><var>pid</var></a> is <code class=char>U+0020</code>
  <code class=charname>SPACE</code> character, or if there is a
  <code class=char>U+0020</code> <code class=charname>SPACE</code> character
  immediately followed by another <code class=char>U+0020</code>
  <code class=charname>SPACE</code> character in <a href=#var-pid><var>pid</var></a>, then it is a
  <a href=#round-trip-error id=rte-pubid-space><code>round-trip-error</code></a>.
  <span class=ed>Is this really a roundtripness problem?  XML spec
  does only define the way to match public identifiers in fact, no
  canonical form.</span></li>
</ol>

<p>To 
<dfn id=algorithm-to-validate-a-system-identifier title="validate a system identifier">validate
a system identifier (<dfn id=var-sid><var>sid</var></dfn>)</dfn>, the
following algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
  <li>If <a href=#var-sid><var>sid</var></a> is <a href=#null><code>null</code></a>, abort these steps.</li>
<li><a href=#algorithm-to-validate-an-xml-character-data title="validate an XML string">Validate
<var>sid</var> as an <abbr>XML</abbr> string</a>.</li>
  <li>If <a href=#var-sid><var>sid</var></a> contains both <code class=char>U+0022</code>
  <code class=charname>QUOTATION MARK</code> (<code class=char>"</code>) and
  <code class=char>U+0027</code> <code class=charname>APOSTROPHE</code>
  (<code class=char>'</code>) characters, raise an
  <a href=#xml-well-formedness-error id=wfe-sid-lit><code>xml-well-formedness-error</code></a>.</li>
  <li>If <a href=#var-sid><var>sid</var></a> contains at least one <code class=char>U+0023</code>
  <code class=charname>NUMBER SIGN</code> (<code class=char>#</code>)
  character, then raise an
  <a href=#xml-misc-error id=xme-sid-fragment><code>xml-misc-error</code></a>.</li>
  <li class=ed>@@ If <a href=#var-sid><var>sid</var></a> cannot be converted to a URI
  reference, then raise a fact-level error (xml-misc-warning?).<!--
  XML 1.0 has no conformance language for system identifier being
  a URI reference. --></li>
</ol>

</div>

<div class=section id=checking-node>
<h4 id=checking-node-0><span class=secno>7.2.3 </span>Checking <a href=#node-0><code>Node</code></a></h4>

<p>The algorithm <dfn id=algorithm-to-check-a-node title="to check a node">to 
check a node (<dfn id=var-n><var>n</var></dfn>)</dfn> is defined as 
following:</p>
<dl class=switch>
<dt>If <a href=#var-n><var>n</var></a> is an <a href=#attr><code>Attr</code></a> node</dt>
  <dd>
    <ol>
    <li><a href=#algorithm-to-validate-an-ncname>Validate the
    <code>localName</code> attribute value as an <code>NCName</code></a>.</li>
    <li>If the <code>prefix</code> attribute value is different from
    <a href=#null><code>null</code></a>, then <a href=#algorithm-to-validate-an-ncname>validate
    the <code>prefix</code> attribute value as an <code>NCName</code></a>.</li>
    <li>For each node <dfn id=var-attr-nc><var>n<sub><var>c</var></sub></var></dfn> in the
    <code>childNodes</code> list of <a href=#var-n><var>n</var></a>,
      <ol>
      <li>If <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is <em>not</em> a
      <code>Text</code> or <code>EntityReference</code> node, then it is an
      <a href=#xml-well-formedness-error id=wfe-attr-child><code>xml-well-formedness-error</code></a>.</li>
      <li>Otherwise, if <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is an
      <code>EntityReference</code> node, then it is an 
      <a href=#entity-error id=ee-attr-er><code>entity-error</code></a>.</li>
      <li>Otherwise,
      <a href=#algorithm-to-check-a-node title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recusrively.</li>
      </ol></li>
    <li>If <code>nodeName</code> attribute of <a href=#var-n><var>n</var></a> is
    <code>xml:space</code> <span class=ed>@@ or {xml namespace}:space ?</span>
    and <code>value</code> attribute of <a href=#var-n><var>n</var></a> is neither 
    <code>default</code> nor <code>preserve</code>, then it is an
    <a href=#xml-misc-error id=xme-attr-xml-space><code>xml-misc-error</code></a>.<!--
    Note that <!ATTLIST e xml:space (default|preserve) "a">...
    <e xml:space="default"/> is conforming and valid. --></li>
    <li class=ed>@@ xml:lang value is not a language tag [RFC 3066 or its
    successor] or an empty string, then xml-misc-warning
    (a "fact"-level error; not an XML error).</li>
    <li class=ed>@@ <code>specified</code>,
    <code>manakaiAttributeType</code> (#ValueType Validity constraint: Attribute Value Type)</li>
    <!-- xml:space MUST be declared to be valid. -->
    <li>Let <dfn id=var-v><var>v</var></dfn> be the value of the
    attribute <code>value</code> of <a href=#var-n><var>n</var></a>.</li>
    <li>Validate the <a href=#var-n><var>n</var></a> against the <span class=ed>declared 
    type</span> as following:
      <dl class=switch>
      <dt class=ed><a href=#ID_ATTR><code>ID_ATTR</code></a></dt>
        <dd>
          <ol>
          <li><span class=ed>Validate <a href=#var-v><var>v</var></a> as an
          <a href=#getAttributeDefinitionNode-name><code>Name</code></a>.</span>  If it fails, then raise an
          <a href=#xml-validity-error id=vc-id-name><code>xml-validity-error</code></a>.</li>
          <li><span class=ed>If <code>ID</code> <a href=#var-v><var>v</var></a> is defined,</span>
          then raise an  
          <a href=#xml-validity-error id=vc-id-duplication><code>xml-validity-error</code></a>.</li>
          </ol>
        </dd>
      <dt class=ed>IDREF_ATTR</dt>
        <dd>
          <ol>
          <li><span class=ed>Validate <a href=#var-v><var>v</var></a> as an
          <a href=#getAttributeDefinitionNode-name><code>Name</code></a>.</span>  If it fails, then raise an
          <a href=#xml-validity-error id=vc-idref-name><code>xml-validity-error</code></a>.</li>
          <li><span class=ed>If <code>ID</code> <a href=#var-v><var>v</var></a> is NOT
          defined,</span> then raise an  
          <a href=#xml-validity-error id=vc-idref-match><code>xml-validity-error</code></a>.</li>
          </ol>
        </dd>
      <dt class=ed>IDREFS_ATTR</dt>
        <dd class=ed>@@</dd>
      <dt class=ed>ENTITY_ATTR</dt>
        <dd>
          <ol>
          <li><span class=ed>Validate <a href=#var-v><var>v</var></a> as an
          <a href=#getAttributeDefinitionNode-name><code>Name</code></a>.</span>  If it fails, then raise an
          <a href=#xml-validity-error id=vc-entname-name><code>xml-validity-error</code></a>.</li>
          <li><span class=ed>If <a href=#entity><code>Entity</code></a> <a href=#var-v><var>v</var></a> is NOT
          defined,</span> then raise an  
          <a href=#xml-validity-error id=vc-entname-match><code>xml-validity-error</code></a>.</li>
          </ol>
        </dd>
      <dt class=ed>ENTITIES_ATTR</dt>
        <dd class=ed>@@</dd>
      <dt class=ed>NMTOKEN_ATTR</dt>
        <dd>
          <ol>
          <li><span class=ed>Validate <a href=#var-v><var>v</var></a> as an
          <code>Nmtoken</code>.</span>  If it fails, then raise an
          <a href=#xml-validity-error id=vc-nmtok-name><code>xml-validity-error</code></a>.</li>
          </ol>
        </dd>
      <dt class=ed>NMTOKENS_ATTR</dt>
        <dd class=ed>@@</dd>
      <dt class=ed>NOTATION_ATTR</dt>
        <dd class=ed><a href=#var-v><var>v</var></a> must be one of enumerated values.
        If not, then raise an
        <a href=#xml-validity-error id=vc-notatn-match><code>xml-validity-error</code></a>.</dd>
      <dt class=ed>ENUMERATED_ATTR</dt>
        <dd class=ed><a href=#var-v><var>v</var></a> must be one of enumerated values.
        If not, then raise an
        <a href=#xml-validity-error id=vc-enum><code>xml-validity-error</code></a>.</dd>
      <dt class=ed>@@</dt>
      </dl>
    </li>
    <li>If <span class=ed>type ID and default is NOT #IMPLIED or #REQUIRED</span>, then
    raise an
    <a href=#xml-validity-error id=vc-id-default><code>xml-validity-error</code></a>.</li>
    <li class=ed>@@ #FixedAttr Validity constraint: Fixed Attribute Default</li>
    <li class=ed>@@ strict serialization error for U+000D, U+000A, and
    U+0009 characters, leading/trailing U+0020, and U+0020{2,} string?</li>
    </ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is an <a href=#AttributeDefinition><code>AttributeDefinition</code></a> node</dt>
  <dd>
    <ol>
    <li class=ed></li>
    <li>If <code>nodeName</code> attribute of <a href=#var-n><var>n</var></a> is
    <code>xml:space</code> <span class=ed>@@ or {xml namespace}:space ?</span>
    and <span class=ed>its declared type is different from (default|preserve),
    (preserve|default), (default), or (preserve)</span>, then raise an
    <a href=#xml-misc-error id=xme-at-xml-space><code>xml-misc-error</code></a>.</li>
    <li>For each node <dfn id=var-ad-nc><var>n<sub><var>c</var></sub></var></dfn> in the
    <code>childNodes</code> list of <a href=#var-n><var>n</var></a>,
      <ol>
      <li>If <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is <em>not</em> a
      <code>Text</code> or <code>EntityReference</code> node, then it is an
      <a href=#xml-well-formedness-error id=wfe-at-child><code>xml-well-formedness-error</code></a>.</li>
      <li>Otherwise, if <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is an
      <code>EntityReference</code> node, then it is an 
      <a href=#entity-error id=ee-at-er><code>entity-error</code></a>.</li>
      <li>Otherwise,
      <a href=#algorithm-to-check-a-node title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recusrively.</li>
      </ol></li>
    <li class=ed>If <a href=#NOTATION_ATTR><code>NOTATION_ATTR</code></a>, enumerated values MUST
    be declared.  If not, then raise an
    <a href=#xml-validity-error id=vc-notatn-declared><code>xml-validity-error</code></a>.</li>
    <li class=ed>If <a href=#NOTATION_ATTR><code>NOTATION_ATTR</code></a> or <code>ENUMERATED_ATTR</code>,
    values MUST all be distinct.  If not, then raise an
    <a href=#xml-validity-error id=vc-no-duplicate-tokens><code>xml-validity-error</code></a>.</li>
    <li class=ed>If <a href=#NOTATION_ATTR><code>NOTATION_ATTR</code></a> on an <code>EMPTY</code> 
    element, then raise an
    <a href=#xml-validity-error id=vc-no-notation-empty><code>xml-validity-error</code></a>.</li>
    <li class=ed>@@ #defattrvalid Validity constraint: Attribute Default Value Syntactically Correct</li>
    </ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is a <code>CDATASection</code> node</dt>
  <dd>
    <ol>
    <li><a href=#algorithm-to-validate-an-xml-character-data title="validate an XML string">Validate the 
    <code>data</code> attribute value as an <abbr>XML</abbr> character
    data</a>.</li>
    <li>If the <code>data</code> attribute value contains
    a string <code>]]&gt;</code>, then raise an
    <a href=#xml-well-formedness-error id=wfe-cs-mse><code>xml-well-formedness-error</code></a>.<!-- "for compatibility" --></li>
    <li>If the <code>childNodes</code> list of <a href=#var-n><var>n</var></a> contains
    any nodes, they are in
    <a href=#xml-well-formedness-error id=wfe-cs-child><code>xml-well-formedness-error</code></a>.</li>
    </ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is a <code>Comment</code> node</dt>
  <dd>
    <ol>
    <li>Raise an
    <a href=#round-trip-warning id=rtw-comment><code>round-trip-warning</code></a>.</li>
    <li><a href=#algorithm-to-validate-an-xml-character-data title="validate an XML string">Validate the 
    <code>data</code> attribute value as an <abbr>XML</abbr> character
    data</a>.</li>
    <li>If the <code>data</code> attribute value contains
    a string <code>--</code>, or if it ends with a character
    <code>-</code>, then raise an
    <a href=#xml-well-formedness-error id=wfe-comment-com><code>xml-well-formedness-error</code></a>.<!--
    "for compatibility" --></li>
    <li>If the <code>childNodes</code> list of <a href=#var-n><var>n</var></a> contains
    any nodes, they are in
    <a href=#xml-well-formedness-error id=wfe-comment-child><code>xml-well-formedness-error</code></a>.</li>
    </ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is a <a href=#document-0><code>Document</code></a> node</dt>
  <dd>
    <ol>
    <li>If <a href=#xml-version><abbr>XML</abbr> version</a> of <a href=#var-n><var>n</var></a>
    is different from <code>1.0</code> or <code>1.1</code>,
    then it is an <code class=ed>unknown-error?</code>.</li>
    <li>If the <code>xmlEncoding</code> attribute value does <em>not</em>
    match to <code>[A-Za-z] ([A-Za-z0-9._] | '-')*</code>
    <span class=ed>@@ formal def</span>, then it is an
    <a href=#xml-well-formedness-error id=wfe-encoding><code>xml-well-formedness-error</code></a>.</li>
    <li>The <code>childNodes</code> list of <a href=#var-n><var>n</var></a> have to
    consist of zero or more <code>Comment</code> and/or
    <code>ProcessingInstruction</code> nodes, followed by
    an optional <a href=#documenttype><code>DocumentType</code></a> node, followed
    by zero or more <code>Comment</code> and/or
    <code>ProcessingInstruction</code> nodes, followed by
    an <a href=#element><code>Element</code></a> node, followed
    by zero or more <code>Comment</code> and/or
    <code>ProcessingInstruction</code> nodes.  Any violation to this is an
    <a href=#xml-well-formedness-error id=wfe-document-child><code>xml-well-formedness-error</code></a>.</li>
    <li>For each node <dfn id=var-document-nc><var>n<sub><var>c</var></sub></var></dfn>
    in the <code>childNodes</code> list of <a href=#var-n><var>n</var></a>,
      <ol>
      <li>If <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is <em>not</em> an
      <code>EntityReference</code> node, then
      <a href=#algorithm-to-check-a-node title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recursively.</li>
      </ol></li>
    <li class=ed>@@ <code>allDeclarationsProcessed</code></li>
    </ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is a <code>DocumentFragment</code> node</dt>
  <dd>
    <ol>
    <li>For each node <dfn id=var-df-nc><var>n<sub><var>c</var></sub></var></dfn>
    in the <code>childNodes</code> list of <a href=#var-n><var>n</var></a>,
      <ol>
      <li>If <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is <em>not</em> an
      <a href=#element><code>Element</code></a>, <code>Text</code>, <code>CDATASection</code>,
      <code>Comment</code>, <code>ProcessingInstruction</code>, or
      <code>EntityReference</code> node, then it is an
      <a href=#xml-well-formedness-error id=wfe-df-child><code>xml-well-formedness-error</code></a>.</li>
      <li>Otherwise, if <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is an
      <code>EntityReference</code> node, then it is an
      <a href=#entity-error id=ee-df-er><code>entity-error</code></a>.</li>
      <li>Otherwise,
      <a href=#algorithm-to-check-a-node title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recursively.</li>
      </ol></li>
    </ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is a <a href=#documenttype><code>DocumentType</code></a> node</dt>
  <dd>
    <ol>
    <li><a href=#algorithm-to-validate-an-ncname>Validate the
    <code>nodeName</code> attribute value as an <code>NCName</code></a>.</li>
    <li>Follow the following substeps:
      <ol>
      <li>If <code>ownerDocument</code> attribute of <a href=#var-n><var>n</var></a> is
      <a href=#null><code>null</code></a>, then abort these substeps.</li>
      <li>If <code>documentElement</code> attribute of the node
      set to <code>ownerDocument</code> attribute of <a href=#var-n><var>n</var></a> is
      <a href=#null><code>null</code></a>, then abort these substeps.</li>
      <li>If <code>nodeName</code> attribute of the node set to
      <code>documentElement</code> attribute of the node set to
      <code>ownerDocument</code> attribute of <a href=#var-n><var>n</var></a> is
      different from <code>nodeName</code> of <a href=#var-n><var>n</var></a>,
      then raise an
      <a href=#xml-validity-error id=vc-roottype><code>xml-validity-error</code></a>.</li>
      </ol>
    </li>
    <li><a href=#algorithm-to-validate-a-public-identifier title="validate a public identifier">Validate
    the <code>publicId</code> attribute value as a public identifier</a>.</li>
    <li><a href=#algorithm-to-validate-a-system-identifier title="validate a system identifier">Validate
    the <code>systemId</code> attribute value as a system identifier</a>.</li>
    <li>If the <code>publicId</code> attribute value of <a href=#var-n><var>n</var></a> is
    <em>not</em> <a href=#null><code>null</code></a> and the <code>systemId</code> attribute
    value of <a href=#var-n><var>n</var></a> is <a href=#null><code>null</code></a>, then raise an
    <a href=#xml-well-formedness-error id=wfe-dt-sid><code>xml-well-formedness-error</code></a>.
    <span class=ed>@@ publicId == null?  Or, publicId == ""</span></li>
    <li>For each node <dfn id=var-dt-nc><var>n<sub><var>c</var></sub></var></dfn>
    in the <code>childNodes</code> list of <a href=#var-n><var>n</var></a>,
      <ol>
      <li>If <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is <em>not</em> a
      <code>ProcessingInstruction</code> node, then it is an
      <a href=#xml-well-formedness-error id=wfe-dt-child><code>xml-well-formedness-error</code></a>.
      <span class=ed>@@ ref to manakai's extensions</span></li>
      <li>Otherwise, <!-- if n_c is not an EntityReference node, -->
      <a href=#algorithm-to-check-a-node title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recusrively.</li>
      </ol></li>
    <li>For each node in the <code>entities</code>, <code>notations</code>,
    and <code>elementTypes</code> lists of <a href=#var-n><var>n</var></a>,
    <a href=#algorithm-to-check-a-node title="check a node">check the
    node</a> recursively.</li>
    <li class=ed>@@ externally declared?</li>
    <li>If the <a href=#namednodemap><code>NamedNodeMap</code></a> object in the <code>entities</code>
    attribute of <a href=#var-n><var>n</var></a> does not contain <a href=#entity><code>Entity</code></a> nodes
    whose <code>nodeName</code> attribute are <code>amp</code>,
    <code>lt</code>, <code>gt</code>, <code>apos</code>, and <code>quot</code>
    then raise
    <a href=#xml-misc-recommentation id=xmr-predefined><code>xml-misc-recommendation</code></a>(s).
    </li></ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is an <a href=#element><code>Element</code></a> node</dt>
  <dd>
    <ol>
    <li><a href=#algorithm-to-validate-an-ncname>Validate the
    <code>localName</code> attribute value as an <code>NCName</code></a>.</li>
    <li>If the <code>prefix</code> attribute value is different from
    <a href=#null><code>null</code></a>, then <a href=#algorithm-to-validate-an-ncname>validate
    the <code>prefix</code> attribute value as an <code>NCName</code></a>.</li>
    <li>For each node <dfn id=var-element-nc><var>n<sub><var>c</var></sub></var></dfn>
    in the <code>childNodes</code> list of <a href=#var-n><var>n</var></a>,
      <ol>
      <li>If <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is <em>not</em> an 
      <a href=#element><code>Element</code></a>,
      <code>Text</code>, <code>CDATASection</code>, <code>Comment</code>,
      <code>ProcessingInstruction</code>, or
      <code>EntityReference</code> node, then it is an
      <a href=#xml-well-formedness-error id=wfe-element-child><code>xml-well-formedness-error</code></a>.</li>
      <li>Otherwise, if <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is an
      <code>EntityReference</code> node, then it is an
      <a href=#entity-error id=ee-element-er><code>entity-error</code></a>.</li>
      <li>Otherwise,
      <a href=#algorithm-to-check-a-node title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recursively.</li>
      </ol></li>
    <li class=ed>@@ #elementvalid Validity constraint: Element Valid</li>
    <li>Let <var>attrs</var> be the value of the <code>attribute</code>
    attribute of <a href=#var-n><var>n</var></a>.  Check conformance of <var>attrs</var>
    as following:
      <ol>
      <li>If <var>attrs</var> contains an <a href=#attr><code>Attr</code></a> node whose
      <code>nodeName</code> attribute value is equal to that of another
      <a href=#attr><code>Attr</code></a> node in <var>attrs</var>, then raise an
      <a href=#xml-well-formedness-error id=wfe-uniqattspec><code>xml-well-formedness-error</code></a>.<!--
      #uniqattspec Well-formedness constraint: Unique Att Spec --></li>
      <li class=ed>@@ #RequiredAttr Validity constraint: Required Attribute</li>
      </ol>
    </li>
    </ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is an <a href=#ElementTypeDefinition><code>ElementTypeDefinition</code></a> node</dt>
  <dd>
    <ol>
    <li class=ed></li>
    <li>If the <code>childNodes</code> list of <a href=#var-n><var>n</var></a> contains
    any nodes, they are in
    <a href=#xml-well-formedness-error id=wfe-et-child><code>xml-well-formedness-error</code></a>.</li>
    <li class=ed>@@ <q cite=http://www.w3.org/TR/2006/REC-xml-20060816/#elemdecls>At user option, an XML processor MAY issue a warning when a declaration mentions an element type for which no declaration is provided, but this is not an error.</q></li>
    <li class=ed>@@ <q cite=http://www.w3.org/TR/2006/REC-xml-20060816/#sec-element-content>For compatibility, it is an error if the content model allows an element to match more than one occurrence of an element type in the content model. </q></li>
    <li class=ed>@@ #vc-MixedChildrenUnique
    Validity constraint: No Duplicate Types</li>
    <li class=ed>@@ <q cite=http://www.w3.org/TR/2006/REC-xml-20060816/#attdecls>At user option, an XML processor MAY issue a warning if attributes are declared for an element type not itself declared, but this is not an error.</q></li>
    <li>If there is more than one <a href=#AttributeDefinition><code>AttributeDefinition</code></a> node
    with <span class=ed>attribute type <code>ID</code></span> in the 
    <a href=#namednodemap><code>NamedNodeMap</code></a> list contained in the 
    <code>attributeDefinitions</code> attribute of <a href=#var-n><var>n</var></a>, then raise an
    <a href=#xml-validity-error id=vc-one-id-per-el><code>xml-validity-error</code></a>.</li>
    <li>If there is more than one <a href=#AttributeDefinition><code>AttributeDefinition</code></a> node
    with <span class=ed>attribute type <a href=#notation><code>NOTATION</code></a></span> in the 
    <a href=#namednodemap><code>NamedNodeMap</code></a> list contained in the 
    <code>attributeDefinitions</code> attribute of <a href=#var-n><var>n</var></a>, then raise an
    <a href=#xml-validity-error id=vc-one-notation-per><code>xml-validity-error</code></a>.</li>
    <li class=ed>"For interoperability, the same Nmtoken  SHOULD NOT occur more than once in the enumerated attribute types of a single element type."</li>
    </ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is an <a href=#entity><code>Entity</code></a> node whose
<code>notationName</code> attribute value is <a href=#null><code>null</code></a> (i.e. a
parsed entity)</dt>
  <dd>
    <ol>
    <li>Raise an
    <a href=#entity-error id=ee-entity-node><code>entity-error</code></a>.</li>
    <li><a href=#algorithm-to-validate-an-ncname>Validate the
    <code>nodeName</code> attribute value as an <code>NCName</code></a>.</li>
    <li><a href=#algorithm-to-validate-a-public-identifier title="validate a public identifier">Validate
    the <code>publicId</code> attribute value as a public identifier</a>.</li>
    <li><a href=#algorithm-to-validate-a-system-identifier title="validate a system identifier">Validate
    the <code>systemId</code> attribute value as a system identifier</a>.</li>
    <li>If the <code>publicId</code> attribute value of <a href=#var-n><var>n</var></a> is
    <em>not</em> <a href=#null><code>null</code></a> and the <code>systemId</code> attribute
    value of <a href=#var-n><var>n</var></a> is <a href=#null><code>null</code></a>, then raise an
    <a href=#xml-well-formedness-error id=wfe-entity-sid><code>xml-well-formedness-error</code></a>.</li>
    <li>For each node <dfn id=var-entity-nc><var>n<sub><var>c</var></sub></var></dfn>
    in the <code>childNodes</code> list of <a href=#var-n><var>n</var></a>,
      <ol>
      <li>If <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is <em>not</em> an
      <a href=#element><code>Element</code></a>,
      <code>Text</code>, <code>CDATASection</code>, <code>Comment</code>,
      <code>ProcessingInstruction</code>, or <code>EntityReference</code>
      node, then it is an
      <a href=#xml-well-formedness-error id=wfe-entity-child><code>xml-well-formedness-error</code></a>.</li>
      <li>Otherwise, if <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is an
      <code>EntityReference</code> node, then it is an
      <a href=#entity-error id=ee-er-er><code>entity-error</code></a>.</li>
      <li>Otherwise,
      <a href=#algorithm-to-check-a-node title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recursively.</li>
      </ol></li>
    </ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is an <a href=#entity><code>Entity</code></a> node whose
<code>notationName</code> attribute value is <em>not</em> <a href=#null><code>null</code></a>
(i.e. an unparsed entity)</dt>
  <dd>
    <ol>
    <li><a href=#algorithm-to-validate-an-ncname>Validate the
    <code>nodeName</code> attribute value as an <code>NCName</code></a>.</li>
    <li><a href=#algorithm-to-validate-a-public-identifier title="validate a public identifier">Validate
    the <code>publicId</code> attribute value as a public identifier</a>.</li>
    <li><a href=#algorithm-to-validate-a-system-identifier title="validate a system identifier">Validate
    the <code>systemId</code> attribute value as a system identifier</a>.</li>
    <li>If the <code>systemId</code> attribute value of <a href=#var-n><var>n</var></a> is
    <a href=#null><code>null</code></a>, then raise an
    <a href=#xml-well-formedness-error id=wfe-uentity-sid><code>xml-well-formedness-error</code></a>.</li>
    <li><a href=#algorithm-to-validate-an-ncname>Validate the
    <code>notationName</code> attribute value of <var>n</var> as an
    <code>NCName</code></a>.</li>
    <li class=ed>@@ #not-declared Validity constraint: Notation Declared</li>
    <li>If the <code>childNodes</code> list of <a href=#var-n><var>n</var></a> contains
    any nodes, they are in
    <a href=#xml-well-formedness-error id=wfe-uentity-child><code>xml-well-formedness-error</code></a>.</li>
    </ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is an <code>EntityReference</code> node</dt>
  <dd>
    <ol>
    <li>An <a href=#entity-error id=ee-er-node><code>entity-error</code></a>.</li>
    <li><a href=#algorithm-to-validate-an-ncname>Validate the
    <code>nodeName</code> attribute value as an <code>NCName</code></a>.</li>
    <li>For each node <dfn id=var-er-nc><var>n<sub><var>c</var></sub></var></dfn>
    in the <code>childNodes</code> list of <a href=#var-n><var>n</var></a>,
      <ol>
      <li>If <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is <em>not</em> an
      <a href=#element><code>Element</code></a>,
      <code>Text</code>, <code>CDATASection</code>, <code>Comment</code>,
      <code>ProcessingInstruction</code>, or <code>EntityReference</code>
      node, then it is an
      <a href=#xml-well-formedness-error id=wfe-er-child><code>xml-well-formedness-error</code></a>.</li>
      <li>Otherwise, if <a href=#var-er-nc><var>n<sub><var>c</var></sub></var></a> is <em>not</em> an
      <code>EntityReference</code> node, then it is an 
      <a href=#entity-error id=ee-entity-er><code>entity-error</code></a>.</li>
      <li>Otherwise,
      <a href=#algorithm-to-check-a-node title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recursively.</li>
      </ol></li>
    </ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is a <a href=#notation><code>Notation</code></a> node</dt>
  <dd>
    <ol>
    <li><a href=#algorithm-to-validate-an-ncname>Validate the
    <code>nodeName</code> attribute value as an <code>NCName</code></a>.</li>
    <li><a href=#algorithm-to-validate-a-public-identifier title="validate a public identifier">Validate
    the <code>publicId</code> attribute value as a public identifier</a>.</li>
    <li><a href=#algorithm-to-validate-a-system-identifier title="validate a system identifier">Validate
    the <code>systemId</code> attribute value as a system identifier</a>.</li>
    <li>If the <code>childNodes</code> list of <a href=#var-n><var>n</var></a> contains
    any nodes, they are in
    <a href=#xml-well-formedness-error id=wfe-notation-child><code>xml-well-formedness-error</code></a>.</li>
    </ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is a <code>ProcessingInstruction</code> node</dt>
  <dd>
    <ol>
    <li>If the <code>target</code> attribute value matches to the string
    <code>xml</code> in any case combination, then raise a 
    <a href=#xml-well-formedness-error id=wfe-pi-xml><code>xml-well-formedness-error</code></a>.</li>
    <li>Otherwise, <a href=#algorithm-to-validate-an-ncname>validate the
    <code>target</code> attribute value as an <code>NCName</code></a>.</li>
    <li>Then,
    <a href=#algorithm-to-validate-an-xml-character-data title="validate an XML string">validate
    the <code>data</code> attribute value as an <abbr>XML</abbr> character
    data</a>.</li>
    <li>If the <code>data</code> attribute value contains a string
    <code>?&gt;</code>, then raise a 
    <a href=#xml-well-formedness-error id=wfe-pi-pic><code>xml-well-formedness-error</code></a>.</li>
    <li>If the <code>data</code> attribute value starts with either
    <code class=char>U+0009</code> <code class=charname>CHARACTER
    TABULATION</code>, <code class=char>U+000A</code> <code class=charname>LINE
    FEED</code>, <code class=char>U+000D</code> <code class=charname>CARRIAGE
    RETURN</code>, or <code class=char>U+0020</code>
    <code class=charname>SPACE</code> character, then raise a
    <a href=#round-trip-error id=rte-pi-s><code>round-trip-error</code></a>.</li>
    <li>If the <code>childNodes</code> list of <a href=#var-n><var>n</var></a> contains
    any nodes, then raise an
    <a href=#xml-well-formedness-error id=wfe-pi-child><code>xml-well-formedness-error</code></a>.</li>
    <li class=ed>@@ Warn if not declared
    </li></ol>
  </dd>
<dt>If <a href=#var-n><var>n</var></a> is a <code>Text</code> node</dt>
  <dd>
    <ol>
    <li><a href=#algorithm-to-validate-an-xml-character-data title="validate an XML string">Validate the 
    <code>data</code> attribute value as an <abbr>XML</abbr> character
    data</a>.</li>
    <li>If the <code>childNodes</code> list of <a href=#var-n><var>n</var></a> contains
    any nodes, they are in
    <a href=#xml-well-formedness-error id=wfe-text-child><code>xml-well-formedness-error</code></a>.</li>
    </ol>
  </dd>
<dt>Otherwise</dt>
  <dd><span class=ed>xml-well-formedness-error?  unknown-error?</span></dd>
</dl>

</div>

</div>

<div class=section id=classes>
<h3 id=character-classes><span class=secno>7.3 </span>Character Classes</h3>

<p>This section defines a couple of character classes.
These classes are referred to by algorithms specified above.</p>

<p>Character class <dfn id=class-Char10><code>Char10</code></dfn> 
contains the following characters:</p>
<ul>
<li><code class=char>U+0009</code> <code class=charname>CHARACTER
TABULATION</code></li>
<li><code class=char>U+000A</code> <code class=charname>LINE FEED</code></li>
<li><code class=char>U+000D</code> <code class=charname>CARRIAGE
RETURN</code></li>
<li><code class=char>U+0020</code> <code class=charname>SPACE</code>
.. <code class=char>U+D7FF</code></li>
<li><code class=char>U+E000</code> .. <code class=char>U+FFFD</code>
<code class=charname>REPLACEMENT CHARACTER</code></li>
<li><code class=char>U+10000</code> .. <code class=char>U+10FFFF</code></li>
</ul>
<div class="note memo">
<p>This character class contains all characters allowed in the production rule
<a href=http://www.w3.org/TR/2006/REC-xml-20060816/#NT-Char><code>Char</code></a>
of <abbr>XML</abbr> 1.0
<cite class="bibref normative">[<a href=#ref-XML>XML</a>]</cite>.</p>
</div>

<p>Character class <dfn id=class-CompatChar10><code>CompatChar10</code></dfn> 
contains the following characters:</p>
<ul>
<li class=ed>@@ <q>Document authors are encouraged to avoid "compatibility characters", as defined in section 6.8 of [Unicode @@ Unicode 2.0 @@] (see also D21 in section 3.6 of [Unicode3]).</q></li>
</ul>

<p>Character class <dfn id=class-ControlChar10><code>ControlChar10</code></dfn> 
contains the following characters:</p>
<ul>
<li><code class=char>U+007F</code> <code class=charname>DELETE</code> ..
<code class=char>U+0084</code> <code class=charname>INDEX</code></li>
<li><code class=char>U+0086</code> <code class=charname>START OF SELECTED
AREA</code> .. <code class=char>U+009F</code> <code class=charname>APPLICATION
PROGRAM COMMAND</code></li>
<li><code class=char>U+FDD0</code> .. <code class=char>U+FDEF</code></li>
<li><code class=char>U+1FFFE</code> .. <code class=char>U+1FFFF</code></li>
<li><code class=char>U+2FFFE</code> .. <code class=char>U+2FFFF</code></li>
<li><code class=char>U+3FFFE</code> .. <code class=char>U+3FFFF</code></li>
<li><code class=char>U+4FFFE</code> .. <code class=char>U+4FFFF</code></li>
<li><code class=char>U+5FFFE</code> .. <code class=char>U+5FFFF</code></li>
<li><code class=char>U+6FFFE</code> .. <code class=char>U+6FFFF</code></li>
<li><code class=char>U+7FFFE</code> .. <code class=char>U+7FFFF</code></li>
<li><code class=char>U+8FFFE</code> .. <code class=char>U+8FFFF</code></li>
<li><code class=char>U+9FFFE</code> .. <code class=char>U+9FFFF</code></li>
<li><code class=char>U+AFFFE</code> .. <code class=char>U+AFFFF</code></li>
<li><code class=char>U+BFFFE</code> .. <code class=char>U+BFFFF</code></li>
<li><code class=char>U+CFFFE</code> .. <code class=char>U+CFFFF</code></li>
<li><code class=char>U+DFFFE</code> .. <code class=char>U+DFFFF</code></li>
<li><code class=char>U+EFFFE</code> .. <code class=char>U+EFFFF</code></li>
<li><code class=char>U+FFFFE</code> .. <code class=char>U+FFFFF</code></li>
<li><code class=char>U+10FFFE</code> .. <code class=char>U+10FFFF</code></li>
</ul>
<div class="note memo">
<p>This character class contains the characters listed in the Note in
<a href=http://www.w3.org/TR/2006/REC-xml-20060816/#charsets>Section 2.2</a>
of <abbr>XML</abbr> 1.0
<cite class="bibref normative">[<a href=#ref-XML>XML</a>]</cite>,
as amended by
<a href=http://www.w3.org/XML/xml-V10-4e-errata#E02>errata</a>.</p>
</div>

<p>The character class <dfn id=class-NameStartChar10><code>NameStartChar10</code></dfn> 
contains the following characters:</p>
<ul class=ed>
</ul>
<div class="note memo">
<p>This character class contains all characters allowed as the first character
of a string matching to the production rule
<a href=http://www.w3.org/TR/2006/REC-xml-20060816/#NT-Name><code>Name</code></a>
of <abbr>XML</abbr> 1.0
<cite class="bibref normative">[<a href=#ref-XML>XML</a>]</cite>.</p>
</div>

<p>The character class <dfn id=class-NameChar10><code>NameChar10</code></dfn> 
contains the following characters:</p>
<ul>
<li>The characters in the character class
<a href=#class-NameStartChar10>NameStartChar10</a>.</li>
<li class=ed></li>
</ul>
<div class="note memo">
<p>This character class contains all characters allowed as the second
character of a string matching to the production rule
<a href=http://www.w3.org/TR/2006/REC-xml-20060816/#NT-Name><code>Name</code></a>
of <abbr>XML</abbr> 1.0
<cite class="bibref normative">[<a href=#ref-XML>XML</a>]</cite>.</p>
</div>

<p>The character class <dfn id=class-PubidChar><code>PubidChar</code></dfn>
contains the following characters:</p>
<ul>
<li><code class=char>U+0009</code> <code class=charname>CHARACTER 
TABULATION</code></li>
<li><code class=char>U+000A</code> <code class=charname>LINE FEED</code></li>
<li><code class=char>U+000D</code> <code class=charname>CARRIAGE
RETURN</code></li>
<li><code class=char>U+0020</code> <code class=charname>SPACE</code></li>
<li><code class=char>U+0021</code> <code class=charname>EXCLAMATION MARK</code>
(<code class=char>!</code>)</li>
<li><code class=char>U+0023</code> <code class=charname>DOLLAR SIGN</code>
(<code class=char>$</code>)</li>
<li><code class=char>U+0024</code> <code class=charname>NUMBER SIGN</code>
(<code class=char>#</code>)</li>
<li><code class=char>U+0025</code> <code class=charname>PERCENT SIGN</code>
(<code class=char>%</code>)</li>
<li><code class=char>U+0027</code> <code class=charname>APOSTROPHE</code>
(<code class=char>'</code>)</li>
<li><code class=char>U+0028</code> <code class=charname>LEFT PARENTHESIS</code>
(<code class=char>(</code>)</li>
<li><code class=char>U+0029</code> <code class=charname>RIGHT
PARENTHESIS</code> (<code class=char>)</code>)</li>
<li><code class=char>U+002A</code> <code class=charname>ASTERISK</code>
(<code class=char>*</code>)</li>
<li><code class=char>U+002B</code> <code class=charname>PLUS SIGN</code>
(<code class=char>+</code>)</li>
<li><code class=char>U+002C</code> <code class=charname>COMMA</code>
(<code class=char>,</code>)</li>
<li><code class=char>U+002D</code> <code class=charname>HYPHEN-MINUS</code>
(<code class=char>-</code>)</li>
<li><code class=char>U+002E</code> <code class=charname>FULL STOP</code>
(<code class=char>.</code>)</li>
<li><code class=char>U+002F</code> <code class=charname>SOLIDUS</code>
(<code class=char>/</code>)</li>
<li><code class=char>U+0030</code> <code class=charname>DIGIT ZERO</code>
(<code class=char>0</code>) .. <code class=char>U+0039</code>
<code class=charname>DIGIT NINE</code> (<code class=char>9</code>)</li>
<li><code class=char>U+003A</code> <code class=charname>COLON</code>
(<code class=char>:</code>)</li>
<li><code class=char>U+003B</code> <code class=charname>SEMICOLON</code>
(<code class=char>;</code>)</li>
<li><code class=char>U+003D</code> <code class=charname>EQUAL SIGN</code>
(<code class=char>=</code>)</li>
<li><code class=char>U+003F</code> <code class=charname>QUESTION MARK</code>
(<code class=char>?</code>)</li>
<li><code class=char>U+0040</code> <code class=charname>COMMERCIAL AT</code>
(<code class=char>@</code>)</li>
<li><code class=char>U+0041</code> <code class=charname>LATIN CAPITAL LETTER
A</code> (<code class=char>A</code>) .. <code class=char>U+005A</code>
<code class=charname>LATIN CAPITAL LETTER Z</code> 
(<code class=char>Z</code>)</li>
<li><code class=char>U+005F</code> <code class=charname>LOW LINE</code>
(<code class=char>_</code>)</li>
<li><code class=char>U+0061</code> <code class=charname>LATIN CAPITAL LETTER
A</code> (<code class=char>A</code>) .. <code class=char>U+007A</code>
<code class=charname>LATIN CAPITAL LETTER Z</code> 
(<code class=char>Z</code>)</li>
</ul>
<div class="note memo">
<p>This character class contains all characters allowed in the production rule
<a href=http://www.w3.org/TR/2006/REC-xml-20060816/#NT-PubidChar><code>PubidChar</code></a>
of <abbr>XML</abbr> 1.0
<cite class="bibref normative">[<a href=#ref-XML>XML</a>]</cite>.</p>
</div>

</div>

</div><!-- ed -->

</div><!-- section -->


<div class=section>
<h2 id=obsolete-features><span class=secno>8 </span>Obsolete features</h2>

<div class=section id=features>
<h3 id=the-dom-feature-string-for-the-dom-document-type-definitions><span class=secno>8.1 </span>The DOM feature string for the DOM Document Type Definitions</h3>

<p>Ealier versions of this specification defined the DOM feature <cite class="bibref normative">[<a href=#ref-DOM3CORE>DOM3CORE</a>]</cite>
<dfn id=feature-XDoctype><code>http://suika.suikawiki.org/www/2006/feature/XDoctype</code></dfn>
version <dfn id=feature-XDoctype-3.0><code>3.0</code></dfn>.
</p></div><!-- section -->

<div class=section>
<h3 id=obsolete-attribute><span class=secno>8.2 </span>Obsolete attribute</h3>

<p>The <code id=internalSubset>internalSubset</code> attribute of the
<a href=#DocumentTypeDefinition><code>DocumentTypeDefinition</code></a>
interface has been removed.

</p><p>The <dfn id=dom-entity-hasreplacementtree title=dom-Entity-hasReplacementTree><code id=hasReplacementTree>hasReplacementTree</code></dfn> attribute of the
<a href=#entity><code>Entity</code></a> interface <em class=rfc2119>MUST</em> return
<span>false</span>.

</p><div class="note memo">

<p>The attribute was used to get or set whether the <a href=#concept-entity title=concept-entity>entity</a> has the replacement subtree (as its
<code title=dom-Node-childNodes>childNodes</code>) or not.

</p></div>

<pre class=idl><code>partial interface <a href=#element>Element</a> {
  readonly attribute DOMString? <a href=#dom-manakaibaseuri title=dom-manakaiBaseURI>manakaiBaseURI</a>;
};

partial interface <span>ProcessingInstruction</span> {
  readonly attribute DOMString? <a href=#dom-manakaibaseuri title=dom-manakaiBaseURI>manakaiBaseURI</a>;
};</code></pre>

<p>The <dfn id=dom-manakaibaseuri title=dom-manakaiBaseURI><code>manakaiBaseURI</code></dfn>
attribute of the <a href=#element><code>Element</code></a> and
<code>ProcessingInstruction</code> interfaces <em class=rfc2119>MUST</em> return <a href=#null>null</a>.

</p></div><!-- section -->

</div><!-- section -->

<div class="section reference" id=references>
<h2 class=no-num id=references-0>References</h2>

<div class=ed>
<p>Need to update references
</p></div>

<div class="section normative reference" id=normative-references>
<h3 class=no-num id=normative-references-0>Normative References</h3>

<dl>

<dt id=ref-DOM>DOM
</dt><dd><cite><a href=http://dom.spec.whatwg.org/>DOM
Standard</a></cite>, WHATWG.

</dd><dt id=ref-DOM3CORE>DOM3CORE</dt>
  <dd><cite><a href=http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407>Document
  Object Model (<abbr>DOM</abbr>) Level 3 Core Specification, Version 
  1.0</a></cite>, <abbr>W3C</abbr> Recommendation, <time datetime=2004-04-07>7
  April 2004</time>.  <em>This</em> version of the specification is referenced.
  The latest version of the specification is available at
  <code class=uri>&lt;<a href=http://www.w3.org/TR/DOM-Level-3-Core>http://www.w3.org/TR/DOM-Level-3-Core</a>&gt;</code>.</dd>
<dt id=ref-DOMBIND>DOMBIND</dt>
  <dd><cite><a href=http://www.w3.org/TR/2007/WD-DOM-Bindings-20071017/>Language
  Bindings for <abbr>DOM</abbr> Specifications</a></cite>, <abbr>W3C</abbr>
  Working Draft, <time datetime=2007-10-17>17 October 2007</time>.  
  <em>This</em> version of the specification is referenced.  The latest version
  of the specification is available at
  <code class=uri>&lt;<a href=http://www.w3.org/TR/DOM-Bindings/>http://www.w3.org/TR/DOM-Bindings/</a>&gt;</code>.</dd>
<dt id=ref-DOMPERL>DOMPERL</dt>
  <dd><cite><a href=http://suika.suikawiki.org/gate/2005/sw/manakai/DOM%20Perl%20Binding>manakai's
  <abbr>DOM</abbr> Perl Binding</a></cite>, editor's draft.  Work in 
  progress.</dd>

<dt id=ref-FETCH>FETCH </dt><dd><cite><a href=http://fetch.spec.whatwg.org/>Fetch Standard</a></cite>,
WHATWG.

</dd><dt id=ref-HTML>HTML

</dt><dd><a href=http://www.whatwg.org/specs/web-apps/current-work/><cite>HTML</cite></a>,
<abbr title="Web Hypertext Application Technology Working
Group">WHATWG</abbr>.

</dd><dt id=ref-INFOSET>INFOSET</dt>
  <dd><cite><a href=http://www.w3.org/TR/2004/REC-xml-infoset-20040204><abbr>XML</abbr>
  Information Set (Second Edition)</a></cite>, <abbr>W3C</abbr> Recommendation,
  <time datetime=2004-02-04>4 February 2004</time>.  <em>This</em> version of
  the specification is referenced.  The latest version of the specification is
  available at
  <code class=uri>&lt;<a href=http://www.w3.org/TR/xml-infoset>http://www.w3.org/TR/xml-infoset</a>&gt;</code>.</dd>
<dt id=ref-KEYWORDS>KEYWORDS</dt>
  <dd><cite><a href=urn:ietf:rfc:2119>Key words for use in 
  <abbr>RFCs</abbr> to Indicate Requirement Levels</a></cite>,
  <abbr title="Internet Engineering Task Force">IETF</abbr> 
  <a href=urn:ietf:bcp:14><abbr title="Best Current Practice">BCP</abbr> 
  14</a>, <abbr title="Request for Comments">RFC</abbr> 2119, 
  <time datetime=1997-03>March 1997</time>.
  <em>This</em> version of the specification is referenced.</dd>
<dt id=ref-MANAKAI>MANAKAI</dt>
  <dd><cite><a href=http://suika.suikawiki.org/gate/2005/sw/manakai/DOM%20Extensions>
  manakai's <abbr>DOM</abbr> Extensions</a></cite>, editor's draft.  Work in 
  progress.</dd>

<dt id=ref-XML>XML

</dt><dd><a href=http://www.w3.org/TR/xml/><cite>Extensible Markup
Language (<abbr>XML</abbr>) 1.0</cite></a>, W3C.

</dd><dt id=ref-XML11>XML11

</dt><dd><a href=http://www.w3.org/TR/xml11/><cite>Extensible Markup
Language (<abbr>XML</abbr>) 1.1</cite></a>, W3C.

</dd><dt id=ref-XMLNS>XMLNS

</dt><dd><a href=http://www.w3.org/TR/xml-names/><cite>Namespaces in XML
1.0</cite></a>, W3C.

</dd><dt id=ref-XMLNS11>XMLNS11

</dt><dd><a href=http://www.w3.org/TR/xml-names11/><cite>Namespaces in
XML 1.1</cite></a>, W3C.

</dd><dt id=ref-XML5>XML5

</dt><dd><a href=https://dvcs.w3.org/hg/xml-er/raw-file/tip/Overview.html><cite>XML-ER</cite></a>,
Anne van Kesteren.

</dd></dl>
</div>

<div class="section informative reference" id=informative-references>
<h3 class=no-num id=non-normative-references>Non-normative References</h3>

<dl>
<dt id=ref-DOM1WD>DOM1WD</dt>
  <dd><cite><a href=http://www.w3.org/TR/WD-DOM-971209/>Document Object
  Model Specification</a></cite>, <abbr>W3C</abbr> Working Draft,
  <time datetime=1997-12-09>9 December 1997</time>.</dd>
  <dd><cite><a href=http://www.w3.org/TR/WD-DOM-19980318/>Document Object
  Model Specification</a></cite>, <abbr>W3C</abbr> Working Draft,
  <time datetime=1998-03-18>18 March 1998</time>.</dd>
  <dd><cite><a href=http://www.w3.org/TR/1998/WD-DOM-19980416/>Document 
  Object Model Specification, Version 1.0</a></cite>, <abbr>W3C</abbr> Working
  Draft, <time datetime=1998-04-16>16 April 1998</time>.</dd>
<dt id=ref-DOM3AS>DOM3AS</dt>
  <dd><cite><a href=http://www.w3.org/TR/2002/NOTE-DOM-Level-3-AS-20020725/>Document
  Object Model (<abbr>DOM</abbr>) Level 3 Abstract Schemas Specification,
  Version 1.0</a></cite>, <abbr>W3C</abbr> Note, <time datetime=2002-07-25>25
  July 2002</time>.  The latest version of the specification is available at
  <code class=uri>&lt;<a href=http://www.w3.org/TR/DOM-Level-3-AS>http://www.w3.org/TR/DOM-Level-3-AS</a>&gt;</code>.</dd>

<dt id=ref-XMLBASE>XMLBASE

</dt><dd><cite><a href=http://www.w3.org/TR/xmlbase/>XML Base</a></cite>,
W3C.

</dd><dt id=ref-XSAPI>XSAPI</dt>
  <dd><cite><a href=http://www.w3.org/Submission/2004/SUBM-xmlschema-api-20040309/><abbr>XML</abbr>
  Schema <abbr>API</abbr></a></cite>, <abbr>W3C</abbr> Member Submission,
  <time datetime=2004-03-09>9 March 2004</time>.  The latest version of the
  specification is available at
  <code class=uri>&lt;<a href=http://www.w3.org/Submission/xmlschema-api/>http://www.w3.org/Submission/xmlschema-api/</a>&gt;</code>.</dd>
</dl>
</div>

</div>



</body></html>