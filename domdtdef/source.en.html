<!DOCTYPE html>
<html lang="en" class="formal-specification anolis">
<head>
<title>XML processing and DOM Document Type Definitions</title>
<link rel="stylesheet" href="http://suika.suikawiki.org/www/style/html/spec">
<link rel="stylesheet" href="http://suika.suikawiki.org/www/style/def/dom">
<link rel="license" href="http://suika.suikawiki.org/c/gnu/fdl">
</head>
<body class="has-abstract">

<div class="header">
<h1 class="no-toc no-num">XML processing and DOM Document Type Definitions</h1>
<h2 class="no-toc no-num">Manakai Project Specification [DATE]</h2>

<dl class="versions-uri">
<dt>Latest version</dt>
  <dd><code class="URI">&lt;<a href="http://suika.suikawiki.org/www/markup/xml/domdtdef/domdtdef"
      >http://suika.suikawiki.org/www/markup/xml/domdtdef/domdtdef</a>&gt;</code></dd>
<dt>Version history</dt>
  <dd><a href="#history">History</a>
<dt id=author>Author</dt>
  <dd><a href="http://suika.suikawiki.org/~wakaba/who?" rel="author"
      lang=ja>Wakaba</a>
  <code class="mail">&lt;<a href="mailto:wakaba@suikawiki.org" rel="author"
      >wakaba@suikawiki.org</a>&gt;</code></dd>
</dl>

<p class="copyright" lang="en" id=license><a
href=http://creativecommons.org/publicdomain/zero/1.0/
rel=license><img alt=CC0
src=http://i.creativecommons.org/p/zero/1.0/80x15.png></a> To the
extent possible under law, the editor has waived all copyright and
related or neighboring rights to this work.  In addition, as of
[DATE], the editor has made this specification available under the
<cite>Open Web Foundation Agreement Version 1.0</cite>, which is
available at <a
href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0">http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0</a>.

</div>

<div id="abstract" class="section">
<h2 class="no-toc no-num">Abstract</h2>

<p>This specification defines how various implementations of XML by <a
href="https://github.com/manakai/">the manakai project</a> process XML
documents, including: how to parse XML documents; how information in
XML DTDs are represented in DOM; how base URLs are determined in XML
documents; how namespace prefixes are serialized; and how conformance
of XML documents are checked.

</div>

<div id="status" class="section">
<h2 class="no-toc no-num">Status of This Document</h2>

<p class=section-info>This section describes the status of this document at the
time of its publication.  Other documents might supersede this document.</p>

<p>This document is a specification produced as part of <a
href="https://github.com/manakai/">the manakai project</a>.  It is not
intended to be implemented by any other DOM or XML implementation,
although nothing prevents it from being implemented by any other
party.  It might be updated, replaced, or obsoleted by other documents
at any time.

<p class=ed>This specification was originllay developed in DOM3 age.
Most part of this document need to be rewritten to align with modern
Web standard specifications.

<p>Comments on this document are welcome and
may be sent to the <a href="#author">author</a>.</p>

<p>Translations of this document might be available.
The English version of the document is the only
normative version.</p>
</div>

<div class=section>
<h2 class="no-toc no-num">Table of contents</h2>
<!-- toc -->
</div>

<div id="introduction" class="section">
<h2>Introduction</h2>

<p class=section-info>This section is <em>non-normative</em>.</p>

<p>This specification defines how various implementations of XML by <a
href="https://github.com/manakai/">the manakai project</a> process XML
documents, including: how to parse XML documents; how information in
XML DTDs are represented in DOM; how base URLs are determined in XML
documents; how namespace prefixes are serialized; and how conformance
of XML documents are checked.

<p>In general, this specification does not intend to override
requirements imposed by various XML specifications.  It is not
intended to be implemented by any other DOM or XML implementation,
although nothing prevents it from being implemented by any other party
than <a href="https://github.com/manakai/">the manakai project</a>.
Especially, it is not intended to be implemented by Web browsers.  In
fact some of features in this specification (e.g. handling of external
entities) are not compatible with Web contents.

<div class=section id=history>
<h3>History</h3>

<p class=section-info>This section is <em>non-normative</em>.</p>

<p>Most part of this specification was originally published as
<cite>DOM Document Type Definition</cite>.  The First Edition of the
<cite>DOM Document Type Definition</cite> specification is available
at <code class="URI">&lt;<a
href="http://suika.suikawiki.org/www/markup/xml/domdtdef/domdtdef-20071209"
>http://suika.suikawiki.org/www/markup/xml/domdtdef/domdtdef-20071209</a>&gt;</code>.
After publishing of the First Edition, the specification had moved to
the Living Standard model.  Version history of that and <em>this</em>
specifications are available at <code class=URI>&lt;<a
href="http://suika.suikawiki.org/gate/git/wi/markup/xmlexts.git/history/HEAD:/domdtdef/source.en.html">http://suika.suikawiki.org/gate/git/wi/markup/xmlexts.git/history/HEAD:/domdtdef/source.en.html</a>&gt;</code>.

<p>Some part of this specification is derived from the <a
href="http://suika.suikawiki.org/www/markup/xml/xmlcc/xmlcc-work"><cite>manakai's
<abbr>XML</abbr> Conformance Checking</cite></a> specification.
Revision history of the specification is available at <code
class=URI>&lt;<a
href="http://suika.suikawiki.org/gate/cvs/markup/xml/xmlcc/xmlcc-work.en.html">http://suika.suikawiki.org/gate/cvs/markup/xml/xmlcc/xmlcc-work.en.html</a>&gt;</code>.

<p>Some part of this specification is derived from the <a
href="http://suika.suikawiki.org/www/markup/xml/nsfixup"><cite>Namespace
fixup</cite></a> note, whose revision history is available at <code
class=URI>&lt;<a
href="http://suika.suikawiki.org/gate/git/wi/markup/xmlexts.git/history/HEAD:/nsfixup-source.en.html">http://suika.suikawiki.org/gate/git/wi/markup/xmlexts.git/history/HEAD:/nsfixup-source.en.html</a>&gt;</code>.

</div>

</div>

<div class="section" id=conformance>
<h2>Conformance requirements</h2>

<div class=section id=terminology>
<h3>Terminology</h3>

<p>All examples and notes in this specification are non-normative,
as are all sections explicitly marked non-normative.</p>

<p class=ed>Known issues are marked like this.  They are non-normative.  <!--
However, this paragraph itself is normative.  One may argue that this paragraph
is non-normative, because this paragraph is marked as an editor's note. 
Anyway, the other editor's notes are non-normative. --></p>

<p>Everything else in this document is normative.</p>

<p>The key words <q><em class="rfc2119">MUST</em></q>,
<q><em class="rfc2119">MUST NOT</em></q>, and <q><em class=rfc2119>MAY</em></q>
in this document are to be interpreted as described in 
<a href="urn:ietf:rfc:2119"><abbr title="Request for Comments">RFC</abbr> 
2119</a>
<cite class="bibref normative">[<a href="#ref-KEYWORDS">KEYWORDS</a>]</cite>.</p>

<p>Conformance requirements phrased as algorithms or specific steps 
<em class=rfc2119>MAY</em> be implemented in any manner, so long as the end
result is equivalent.  Requirements phrased in the imperative as part of 
algorithms are to be interpreted with the meaning of the key word used in 
introducing the algorithm.</p>

<div class=ed>

<p>The following paragraph is no longer applied, but
strictErrorChecking has effect for certain methods (need to define
them...)

<p>Sometimes an exception is phrased as being required to be raised.  As
specified in the <abbr>DOM</abbr> Core specification
<cite class="bibref normative">[<a href="#ref-DOM3CORE">DOM3CORE</a>]</cite>,
when the value of the <code>strictErrorChecking</code> attribute of the
<a href="#Document"><code>Document</code></a> node is <code>false</code>,
then the exception is not have to be raised.</p>
</div>

<p>Some conformance requirements are phrased as requirements on interfaces,
attributes, methods, or objects.  Such requirements are applied to
implementations.</p>

<p>The construction <q>a <code><var title>Foo</var></code> object</q>,
where <code><var title>Foo</var></code> is an interface, is used
instead of the more accurate <q>an object implementing the interface
<code><var title>Foo</var></code></q>.</p>

<p class=ed>The construction <q>raise a
<code><var>Bar</var></code></q>, where <code><var>Bar</var></code> is
an exception code, is used instead of the more accurate <q>raise an
exception implementing the interface <code>DOMException</code> <cite
class="bibref normative">[<a href="#ref-DOM3CORE">DOM3CORE</a>]</cite>
with its <code>code</code> attribute set to
<code><var>Bar</var></code></q>.</p>

<p>The <em id=idl-fragment>WebIDL fragments</em> in this document are
to be interpreted as described in the WebIDL specification <cite
class="bibref normative">[<a
href="#ref-DOMBIND">DOMBIND</a>]</cite>.</p>

<p>The term <dfn>null</dfn> is definedby the WebIDL specification
<cite class="bibref normative">[<a
href="#ref-DOMBIND">DOMBIND</a>]</cite>.

<p>The terms, interfaces, attributes, and exceptions <dfn>context
object</dfn>, <dfn title=concept-tree-child>child</dfn>, <dfn
title=concept-tree-parent>parent</dfn>, <dfn>node</dfn> or
<dfn><code>Node</code></dfn> (which has <dfn
title=dom-Node-nodeName><code>nodeName</code></dfn>, <dfn
title=concept-node-adopt>adopt</dfn>, <dfn
title=concept-node-document>node document</dfn>, <dfn
title=concept-node-clone>clone</dfn>, <dfn
title=concept-node-equals>equals</dfn>, <dfn
title=concept-node-base-url>base URL</dfn>), <dfn>document</dfn> or
<dfn><code>Document</code></dfn> (which has <dfn
title=dom-Document-doctype><code>doctype</code></dfn>), <dfn>XML
document</dfn>, <dfn>HTML document</dfn>, <dfn
title=concept-element>element</dfn> or <dfn><code>Element</code></dfn>
(which has <dfn title=concept-element-namespace>namespace</dfn>, <dfn
title=concept-element-namespace-prefix>namespace prefix</dfn>, <dfn
title=concept-element-local-name>local name</dfn>, and <dfn
title=concept-element-attribute>attribute list</dfn>), <dfn
title=concept-attribute>attribute</dfn> or
<dfn><code>Attr</code></dfn> (which has <dfn
title=concept-attribute-namespace>namespace</dfn>, <dfn
title=concept-attribute-namespace-prefix>namespace prefix</dfn>, <dfn
title=concept-attribute-local-name>local name</dfn>, and <dfn
title=concept-attribute-value>value</dfn>), <dfn
title=concept-doctype>doctype</dfn> or
<dfn><code>DocumentType</code></dfn> (which has <dfn
title=concept-doctype-name>doctype name</dfn> and <dfn
title=dom-DocumentType-systemId><code>systemId</code></dfn>), <dfn>XML
namespace</dfn>, <dfn>XMLNS namespace</dfn>, <dfn>in a document</dfn>,
<dfn title=concept-collection>collection</dfn>, <dfn>throw</dfn>,
<dfn><code>DOMException</code></dfn>,
<dfn><code>HierarchyRequestError</code></dfn>,
<dfn><code>InvalidCharacterError</code></dfn>, and
<dfn><code>NotFoundError</code></dfn> are defined by the DOM Standard
<cite class="bibref normative">[<a href="#ref-DOM">DOM</a>]</cite>.

<p>The terms and steps <em id=live><a
href="http://www.whatwg.org/specs/web-apps/current-work/#live">live</a></em>,
<dfn>space character</dfn>, <dfn>XML MIME type</dfn>, <dfn>document
base URL</dfn>, <dfn>the document's address</dfn>, <dfn title="resolve
a URL">resolve a URL</dfn>, <dfn>Content-Type metadata</dfn>,
<dfn>willful violation</dfn>, <dfn>XML parser</dfn>, <em
id=setting>setting</em> and <em id=getting>getting</em> of an
attribute, <dfn>event loop</dfn>, <dfn title=concept-task>task</dfn>,
<dfn>queue a task</dfn>, <dfn>parser pause flag</dfn>, <dfn>input byte
stream</dfn>, <dfn>character token</dfn>, <!-- <dfn>acknowledge
self-closing flag</dfn>, --> <dfn>character reference in attribute
value state</dfn>, <dfn>consume a character reference</dfn>,
<dfn>additional allowed character</dfn>, <dfn>named character
references</dfn>, and <dfn>stops parsing</dfn> are defined in the HTML
Standard <cite class="bibref normative">[<a
href="#ref-HTML">HTML</a>]</cite>.</p>

<p>The interfaces and attributes
<dfn><code>NamedNodeMap</code></dfn><!-- XXX or AttrExodus? -->, <a
href="http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/DOM3-Core.html#core-ID-1788794630"><dfn
title=dom-DocumentType-entities><code>entities</code></dfn></a>, <a
href="http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/DOM3-Core.html#core-ID-D46829EF"><dfn
title=dom-DocumentType-notations><code>notations</code></dfn></a>,
<dfn><code>Entity</code></dfn>, and <dfn><code>Notation</code></dfn>
are defined in the DOM3 Core specification <cite class="bibref
normative">[<a href="#ref-DOM3CORE">DOM3CORE</a>]</cite>.

<p>The term <dfn title=concept-attribute-owner-element>owner
element</dfn> is defined in the <cite>Manakai DOM Extensions</cite>
specification <cite class="bibref normative">[<a
href="#ref-MANAKAI">MANAKAI</a>]</cite>.

<p>The terms <a
href="http://www.w3.org/TR/xml/#NT-Name"><dfn><code>Name</code></dfn></a>,
<dfn>internal entity</dfn>, <dfn>external entity</dfn>, <dfn>unparsed
entity</dfn>, <dfn>general entity</dfn>, <dfn>parameter entity</dfn>,
<dfn>internal subset</dfn>, <dfn>external subset</dfn>, <dfn>entity
reference</dfn>, <dfn>XML declaration</dfn>, <dfn>text
declaration</dfn>, <dfn
title=attr-xml-version><code>version</code></dfn> pseudo-attribute,
<dfn title=attr-xml-encoding><code>encoding</code></dfn>
pseudo-attribute, <dfn
title=attr-xml-standalone><code>standalone</code></dfn>
pseudo-attribute, <dfn>replacement text</dfn>, and <dfn>process</dfn>
are defined in the XML 1.0 specification <cite class="bibref
normative">[<a href="#ref-XML">XML</a>]</cite>.

<p>The terms <dfn>parse error</dfn>, <dfn>input stream</dfn>,
<dfn>tokenization</dfn>, <dfn>character token</dfn>, <dfn>end tag
token</dfn>, <dfn>tree construction</dfn>, <dfn>phase</dfn>,
<dfn>start phase</dfn>, <dfn>main phase</dfn>, <dfn>end phase</dfn>,
<dfn>stack of open elements</dfn>, <dfn>current element</dfn>,
<dfn>list of entities</dfn>, <dfn>list of parameter entities</dfn>,
<dfn>append an entity</dfn>, and <dfn>entity flag</dfn> are defined in
the XML5 specification <cite class="bibref normative">[<a
href="#ref-XML5">XML5</a>]</cite>.

<p>The <dfn>predefined entity names</dfn> are <code>apos</code>,
<code>amp</code>, <code>lt</code>, <code>gt</code>, and
<code>quot</code>.

<p>The <dfn>predefined public IDs</dfn> are <a
href="http://www.whatwg.org/specs/web-apps/current-work/#parsing-xhtml-documents">the
public identifiers associated with the DTD containing declarations for
the named character references</a>, as specified in the <span>HTML
Standard</span>.

<p>The terms <dfn title=concept-fetch>fetch</dfn>, <dfn
title=concept-request>request</dfn>, <dfn
title=concept-response>response</dfn>, <dfn
title=concept-response-type>type</dfn>, <dfn
title=concept-response-body>body</dfn>, <dfn>process response</dfn>,
<dfn>process response body</dfn>, and <dfn>process response
end-of-file</dfn> are defined in the Fetch Standard <cite
class="bibref normative">[<a href="#ref-FETCH">FETCH</a>]</cite>.

<div class=ed>
<p>Following paragraph need to be updated:

<p>Some <abbr>IDL</abbr> fragments are presented as <i>patch</i> to an
<abbr>IDL</abbr> fragment defined in another document.  They are to be
interpreted as an instance of
<a href="http://www.w3.org/TR/2007/WD-DOM-Bindings-20071017/#proddef-InterfaceMembers"><code>InterfaceMembers</code></a>
<cite class="bibref normative">[<a href="#ref-DOMBIND">DOMBIND</a>]</cite>.
If the <abbr>IDL</abbr> fragment to which the <i>patch</i> is applied has any 
instance of
<a href="http://www.w3.org/TR/2007/WD-DOM-Bindings-20071017/#proddef-InterfaceMember"><code>InterfaceMember</code></a>
with same 
<a href="http://www.w3.org/TR/2007/WD-DOM-Bindings-20071017/#prod-identifier"><code>identifier</code></a>
part as that of an instance of 
<a href="http://www.w3.org/TR/2007/WD-DOM-Bindings-20071017/#proddef-InterfaceMember"><code>InterfaceMember</code></a>
in the <i>patch</i>, then the former instance of
<a href="http://www.w3.org/TR/2007/WD-DOM-Bindings-20071017/#proddef-InterfaceMember"><code>InterfaceMember</code></a>
<em class=rfc2119>MUST</em> be ignored.</p>

</div>

</div><!-- section -->

<div class=section>
<h3>XML versions</h3>

<p>Implementations of this specification <em class=rfc2119>MUST</em>
support features defined in <cite>XML 1.0</cite> <cite class="bibref
normative">[<a href="#ref-XML">XML</a>]</cite> and <cite>Namespaces in
XML 1.0</cite> <cite class="bibref normative">[<a
href="#ref-XMLNS">XMLNS</a>]</cite> specifications.

<p>Unless explicitly specified, featurs in this specification does not
support XML 1.1.

<p>This document sometimes cites parts of XML 1.0 and Namespaces in
XML 1.0 specifications by hyperlinks.  If such a requirement is
applied to XML 1.1, however, they should be read as references to
<cite>XML 1.1</cite> <cite class="bibref normative">[<a
href="#ref-XML11">XML11</a>]</cite> and <cite>Namespaces in XML
1.1</cite> <cite class="bibref normative">[<a
href="#ref-XMLNS11">XMLNS11</a>]</cite> specifications.

<p class=ed>XXX Should we drop XML 1.1 support entirely?

<p>This specification does not specify which edition of relevant
specifications has to be supported.

</div>

</div><!-- section -->


<div class=section id=parsing-xml>
<h2>Parsing XML documents</h2>

<p>This section defines additional requirements for an <span>XML
parser</span>.

<p>An <span>XML parser</span> <em class=rfc2119>MUST</em> parse an XML
document as specified in the XML5 <cite class="bibref normative">[<a
href="#ref-XML5">XML5</a>]</cite> specification.

<p class=ed>XXX If steps for an <span>XML parser</span> is not yet
defined, similar steps for an <span>HTML parser</span> has to be used
instead.  Changes to HTML tokenizer made after XML5 has been specced
must also be applied to XML tokenizer, where possible.  Even for such
cases, if the input is not well-formed, it is a <span>parse
error</span>.  There are <dfn>before XML declaration phase</dfn>,
<dfn>before document type phase</dfn>, and <dfn>document type
phase</dfn> in the <span>tree construction</span> stage.  XML
namespaces must also be supported.  The <span>XML parser</span> has
the <dfn>entity body phase</dfn>, which is initially set to the
<span>before document type phase</span>.  It is used as the next
<span>phase</span> of the <span>before XML declaration phase</span>.

<p>An <dfn>XML tokenizer</dfn> is a component of the <span>XML
parser</span> performing <span>tokenization</span>.  An <span>input
stream</span> is associated with the <span title="XML
tokenizer">tokenizer</span>.  Initially, an <span>XML parser</span>
has an associated <span title="XML tokenizer">tokenizer</span> and
<span>input stream</span>.  An <span>XML parser</span> has a
<dfn>stack of tokenizers</dfn>, which is initially empty.

  <div class="note memo">

  <p>Unless explicitly specified, various states of the <span>XML
  parser</span> are shared among <span title="XML
  tokenizer">tokenizers</span> associated with it.

  </div>

<p>The <span>XML parser</span> has <dfn>standalone document</dfn>,
<dfn>expose DTD content</dfn>, <dfn>don't process</dfn>, and
<dfn>expand external entities</dfn> flags.  Unless explicitly stated,
these flags are unset.

  <div class="note memo">

  <p>DOM APIs such as <code
  title=dom-Element-innerHTML>innerHTML</code> and
  <code>DOMParser</code> do not set these flags.

  </div>

<p>Each entry in the <span>list of entities</span> of an <span>XML
parser</span> have the <dfn title=concept-entity-open>open</dfn> flag,
which is initiall unset.

<p>When the <span>XML parser</span> has to <span>append an
entity</span>, it <em class=rfc2119>MUST</em> do nothing in following
cases:

  <ul>

  <li>If the <span>entity flag</span> is "normal" and the entity name
  is one of <span>predefined entity names</span>,

  <li>If the <span>entity flag</span> is "normal" and the <span>list
  of entities</span> contains an entity with same name, or

  <li>If the <span>entity flag</span> is "parameter" and the
  <span>list of parameter entities</span> contains an entity with same
  name.

  <li>If the <span>don't process</span> flag is set.

  </ul>

<!-- When a start tag token is emitted with its <i>self-closing
flag</i> set, the flag <em class=rfc2119>MUST</em> be <span
title="acknowledge self-closing flag">acknowledged</span>. -->

<p class=ed>If the <span>expose DTD content</span> flag is set, the
<span title="element definition">element</span>, <span
title="attribute definition">attribute list</span>, <span
title="unparsed entity definition">unparsed entity</span>, and <span
title="notation definition">notation</span> declarations, as well as
<span title="processing instruction">processing instructions</span> in
DTD, <em class=rfc2119>MUST</em> be exposed to the DOM through the
<code>DocumentType</code> object.<!-- XXX Need stricter definition -->

<p class=ed>Unless when the previous <span>phase</span> is the
<span>start phase</span> or when the currently processing <span>input
stream</span> is an <span>entity</span> referenced by the
<span>document type declaration</span> or an <span>entity
reference</span> (rather than the <span>document entity</span>),
everything must be ignored in the <span>document type phase</span>.

<p>An <span>XML parser</span> has <dfn>need predefined entity
declarations</dfn> and <dfn>has character entity declarations</dfn>
flags.  They are initially unset.

<p>In the <span>document type phase</span>, the <span>need predefined
entity declarations</span> flag <em class=rfc2119>MUST</em> be set.
It <em class=rfc2119>MUST</em> be restored to the original value when
the <span>phase</span> is set to another value.

<div class=section>
<h3>Character encodings</h3>

<p class=ed>The value of the <code
title=attr-xml-encoding>encoding</code> pseudo-attribute or the
<code>charset</code> parameter <em class=rfc2119>MUST</em> be
interpreted as an <span>encoding label</span> defined by the
<span>Encoding Standard</span>.

</div>

<div class=section>
<h3>Expansion of entities</h3>

<div class=section>
<h4>The external subset entity</h4>

<p>Just before the <span>phase</span> is switched from the
<span>before document type phase</span> to the <span>start
phase</span>, the <span>XML parser</span> <em class=rfc2119>MUST</em>
run the following steps:

  <ol>

  <li>Let <var title>doctype</var> be the <code
  title=dom-Document-doctype>doctype</code> of the
  <code>Document</code>.

  <li>If <var title>doctype</var> is null, abort these steps.

  <li>Let <var title>public ID</var> be the <code
  title=dom-DocumentType-publicId>publicId</code> of <var
  title>doctype</var>.

  <li>If <var title>public ID</var> is one of <span>predefined public
  IDs</span>, set the <span>has character entity declarations</span>
  flag and abort these steps.

  <li>Set the <span>need predefined entity declarations</span> flag.

  <li>Let <var title>system ID</var> be the <code
  title=dom-DocumentType-systemId>systemId</code> of <var
  title>doctype</var>.

  <li>If <var title>system ID</var> is the empty string, abort these
  steps.

  <li>Invoke the <span>parse an entity</span> steps with following
  parameters:

    <dl>

    <dt><var title>entity</var>
    <dd>The <span>external subset</span>.

    <dt><var title>url</var>
    <dd>The result of <span title="resolve a URL">resolving</span>
    <var title>system ID</var> against the <span
    title=concept-node-base-url>base URL</span> of <var
    title>doctype</var>.

    <dt><var title>original phase</var>
    <dd>The <span>phase</span> of the <span>XML parser</span>.

    <dt><var title>entity body phase</var>
    <dd>The <span>document type phase</span>.

    </dl>

  </ol>

  <div class="note memo">

  <p>The <span>external subset</span> is parsed and processed after
  the <span>internal subset</span>, if any.

  </div>

</div>

<div class=section>
<h4>Parameter entities</h4>

<p>To <dfn>consume a parameter entity</dfn>, the <span>XML
parser</span> <em class=rfc2119>MUST</em> run these steps:

  <ol>

  <li>Consume the <span>next input character</span> while it is
  <em>not</em> one of following characters:

    <ul>

    <li>A <span>space character</span>

    <li>A <code>U+0022</code> <code class=charname>QUOTATION
    MARK</code> character (<code>&quot;</code>)

    <li>A <code>U+0025</code> <code class=charname>PERCENT SIGN</code>
    character (<code>%</code>)

    <li>A <code>U+0026</code> <code class=charname>AMPERSAND</code>
    character (<code>&amp;</code>)

    <li>A <code>U+0027</code> <code class=charname>APOSTROPHE</code>
    character (<code>'</code>)

    <li>A <code>U+003B</code> <code class=charname>SEMICOLON</code>
    character (<code>;</code>)

    <li>A <code>U+003C</code> <code class=charname>LESS-THAN
    SIGN</code> character (<code>&lt;</code>)

    <li>A <code>U+003D</code> <code class=charname>EQUAL SIGN</code>
    character (<code>=</code>)

    <li>A <code>U+003E</code> <code class=charname>GREATER-THAN
    SIGN</code> character (<code>&gt;</code>)

    <li>A <code>U+0060</code> <code class=charname>GRAVE ACCENT</code>
    character (<code>`</code>)

    <li>An implied EOF character

    </ul>

  <li>Let <var title>name</var> be the characters consumed by the
  previous step.

  <li>If the <span>next input character</span> is a
  <code>U+003B</code> <code class=charname>SEMICOLON</code> character
  (<code>;</code>), consume the character and append the character to
  <var title>name</var>.

  <li>Otherwise, this is a <span>parse error</span>.

  <li>Let <var title>entity</var> be the <span>parameter entity</span>
  whose name is <var title>name</var> in the <span>list of parameter
  entities</span>.  If there is no such a <span>parameter
  entity</span>:

    <ul>

    <li><span>Parse error</span>.

    <li>If the <span>standalone document</span> flag is <em>not</em>
    set, set the <span>don't process</span> flag.

    <li>Abort these steps.

    </ul>

    <div class="note memo">

    <p>Names of <span title="parameter entity">parameter
    entities</span> in the <span>list of parameter entities</span>
    always contain the <code>;</code> character.

    </div>

  <li>If the <span>don't process</span> flag is set and the
  <span>standalone document</span> flag is <em>not</em> set, return
  nothing and abort these steps.

  <li>If the <span title=concept-entity-open>open</span> flag of the
  entry for <var title>entity</var> in the <span>list of parameter
  entities</span> of the <span>XML parser</span> is set, this is a
  <span>parse error</span>.  Return nothing and abort these steps.

  <li>Let <var title>public ID</var> be the <span>public ID</span> of
  <var title>entity</var>.

  <li>If <var title>public ID</var> is one of <span>predefined public
  IDs</span>:

     <dl class=switch>

     <dt>If the <span>state</span> is the <span>document type internal
     subset state</span>

     <dd>Set the <span>has character entity declarations</span> flag
     and abort these steps.

     <dt>Otherwise

     <dd><span>Parse error</span>.  Abort these steps.

     </dl>

  <li>Invoke the <span>parse an entity</span> steps with following
  parameters:

    <dl>

    <dt><var title>entity</var>
    <dd><var title>entity</var>

    <dt><var title>url</var>
    <dd>The result of <span title="resolve a URL">resolving</span> the
    <span title=concept-entity-systemID>system ID</span> of <var
    title>entity</var> against the <span
    title=concept-effective-declaration-base-url>effective declaration
    base URL</span> of <var title>entity</var>, if <var
    title>entity</var> is an <span>external entity</span>, or null.

    <dt><var title>original phase</var>
    <dd>The current <span>phase</span> of the <span>tree
    construction</span> stage.

    <dt><var title>entity body phase</var>
    <dd>The current <span>phase</span> of the <span>tree
    construction</span> stage.

    <dt><var title>state</var>
    <dd>If the state is one of <span>document type entity value double
    quoted state</span>, <span>document type entity value single
    quoted state</span>, or <span>entity value state</span>, the
    <span>entity value state</span>.

    <dt><var title>in markup declaration</var> flag

    <dd><i>Set</i> if the state of the <span>XML parser</span> is
    <em>not</em> one of <span>document type internal subset
    state</span>, <span>document type entity value double quoted
    state</span>, <span>document type entity value single quoted
    state</span>, or <span>entity value state</span>, or <i>unset</i>
    otherwise.

    </dl>
  
  </ol>

</div>

<div class=section>
<h4>General entities</h4>

<p>When the steps to <span>consume a character reference</span> is
applied to an <span>XML parser</span>, the following requirements in
this section is applied.</p>

  <div class="note memo">

  <p>The steps to <span>consume a character reference</span> is
  defined in the <span>HTML Standard</span> for the <span>HTML
  parser</span>.  This section monkeypatches the steps to implement
  XML-specific rules.<!-- XXX character reference (not entity)
  handling need also to be patched for 0x80-0x9F range... -->

  </div>

<p>If the <span>stack of open elements</span> is empty and the state
is not the <span>character reference in attribute value state</span>
when the steps to <span>consume a character reference</span> is
invoked, this is a <span>parse error</span>.

<p>Each entity in the <span>list of entities</span> <em
class=rfc2119>MUST</em> be appendded to the table of the <span>named
character references</span> as a row, where the first column is the
name of the entity followed by a <code>U+003B</code> <code
class=charname>SEMICOLON</code> character (<code>;</code>).  If the
table already has a row whose first column is equal to the first
column of the new row, the existing row <em class=rfc2119>MUST</em> be
replaced by the new row.

<p>If all of following conditions are met, this is a <span>parse
error</span>:

  <ul>

  <li>A row from the original <span>named character references</span>
  table is used

  <li>The first column of the row ends with a <code>U+003B</code>
  <code class=charname>SEMICOLON</code> character (<code>;</code>)

  <li>The <span>has character entity declarations</span> flag is unset

  <li>The first column of the row is none of <span>predefined entity
  names</span>

  </ul>

<p>If only the last condition is not met and the <span>need predefined
entity declarations</span> flag is set, the <span>XML parser</span>
<em class=rfc2119>MAY</em> report a warning.

<p>When <span title="character token">character tokens</span> are
returned using the second column of the table, an <span>XML
parser</span> <em class=rfc2119>MUST</em> run these steps:

<ol>

<li>Let <var title>entity</var> be the entity of the selected row.

<li>If <var title>entity</var> is an <span>unparsed entity</span>,
this is a <span>parse error</span>.  Return nothing and abort the
<span>consume a character reference</span> steps.

<li>If the <span title=concept-entity-open>open</span> flag of the
entry for <var title>entity</var> in the <span>list of entities</span>
of the <span>XML parser</span> is set, this is a <span>parse
error</span>.  Return nothing and abort the <span>consume a character
reference</span> steps.

<li>If these steps are invoked in the <span>character reference in
attribute value state</span>:

  <ol>

  <li>If <var title>entity</var> is an <span>external entity</span>,
  this is a <span>parse error</span>.  Return nothing and abort the
  <span>consume a character reference</span> steps.

  <li>Let <var title>replacement text</var> be the <span>replacement
  text</span> of <var title>entity</var>.

  <li>If <var title>replacement text</var> contains a
  <code>U+003C</code> <code class=charname>LESS-THAN SIGN</code>
  character (<code>&lt;</code>), this is a <span>parse error</span>.
  Return nothing and abort the <span>consume a character
  reference</span> steps.

  <li>Set the <span title=concept-entity-open>open</span> flag of the
  entry for <var title>entity</var> in the <span>list of
  entities</span> of the <span>XML parser</span>.

  <li>Let <var title>s</var> be the empty string.

  <li><i>Loop</i>: If <var title>replacement text</var> is the empty
  string, go to the step labeled <i>end</i>.

  <li>If the first character in <var title>replacement text</var> is
  not a <code>U+0026</code> <code class=charname>AMPERSAND</code>
  character (<code>&</code>), append the character to <var
  title>s</var> and remove the character from <var title>replacement
  text</var>.

  <li>If the first character in <var title>replacement text</var> is a
  <code>U+0026</code> <code class=charname>AMPERSAND</code> character
  (<code>&amp;</code>):

  <ol>

  <li>Attempt to <span>consume a character reference</span> steps
  recursively, with no <span>additional allowed character</span>.
  Those steps <em class=rfc2119>MUST</em> behave as if the <span>input
  stream</span> were <var title>replacement text</var> and remove the
  characters consumed from <var title>replacement text</var>.

  <li>If nothing is returned, append a <code>U+0026</code> <code
  class=charname>AMPERSAND</code> character (<code>&</code>) to <var
  title>s</var> and remove the first character from <var
  title>replacement text</var>.

  <li>Otherwise, append the characters represented by the returned
  <span title="character token">character tokens</span> to <var
  title>s</var>.

  </ol>

  <li>Go to the step labeled <i>loop</i>.

  <li><i>End</i>: Unset the <span
  title=concept-entity-open>open</span> flag of the entry for <var
  title>entity</var> in the <span>list of entities</span> of the
  <span>XML parser</span>.

  <li>Return <span title="character token">character tokens</span>
  equivalent to characters in <var title>s</var> and abort the
  <span>consume a character reference</span> steps.

  </ol>

<li>Otherwise:

  <ol>

  <li>If the <span>phase</span> of the <span>tree construction</span>
  stage is not the <span>main phase</span>, return nothing and abort
  the <span>consume a character reference</span> steps.

  <li>Invoke the <span>parse an entity</span> steps with following
  parameters:

    <dl>

    <dt><var title>entity</var>
    <dd><var title>entity</var>

    <dt><var title>url</var>
    <dd>The result of <span title="resolve a URL">resolving</span> the
    <span title=concept-entity-systemID>system ID</span> of <var
    title>entity</var> against the <span
    title=concept-effective-declaration-base-url>effective declaration
    base URL</span> of <var title>entity</var>, if <var
    title>entity</var> is an <span>external entity</span>, or null.

    <dt><var title>original phase</var>
    <dd>The <span>main phase</span>.

    <dt><var title>entity body phase</var>
    <dd>The <span>main phase</span>.

    </dl>

  <li>Return zero <span title="character token">character
  tokens</span> and abort the <span>consume a character
  reference</span> steps.

  </ol>

</ol>

  <div class="note memo">

  <p>The number of <span title="character token">character
  tokens</span> returned by these steps can be zero, which is
  different from returning nothing.

  </div>

</div>

<div class=section>
<h4>Fetching and parsing external entities</h4>

<p>To <dfn>parse an entity</dfn> <var title>entity</var> with <var
title>url</var>, <var title>original phase</var>, <var title>entity
body phase</var>, <var title>state</var> whose default is <i>null</i>,
and <var title>in markup declaration</var> flag whose default is
<i>unset</i>, the <span>XML parser</span> <em class=rfc2119>MUST</em>
run these steps:

  <ol>

  <li>If <var title>in markup declaration</var> flag is set, act as if
  a <code>U+0020</code> <code class=charname>SPACE</code> character
  were processed by the <span title="XML tokenizer">tokenizer</span>.

  <li>Set the <span title=concept-entity-open>open</span> flag of the
  entry for <var title>entity</var> in the <span>list of
  entities</span> of the <span>XML parser</span> if <var
  title>entity</var> is a <span>general entity</span>.

  <li>Push a <dfn title="entity boundary marker">marker</dfn> to the
  <span>stack of open elements</span>.  This marker is referenced
  later in this section, but is ignored for any other purposes.
  (Especially, the <span>current element</span> can never be a <span
  title="entity boundary marker">marker</span>.)

  <li>Set the <span>parser pause flag</span> of the <span title="XML
  tokenizer">tokenizer</span> of the <span>XML parser</span> to true.

  <li>Block the <span title="XML tokenizer">tokenizer</span> of the
  <span>XML parser</span>, such that the <span>event loop</span> will
  not run <span title=concept-task>tasks</span> that invoke the <span
  title="XML tokenizer">tokenizer</span>.

  <li>Push the current <span title="XML tokenizer">tokenizer</span> of
  the <span>XML parser</span> to the <span>stack of tokenizers</span>.

  <li>If <var title>entity</var> is an <span>internal entity</span>,
  if the <span>expand external entities</span> flag is unset, if <var
  title>url</var> is null, if <var title>url</var> is in error, or if
  there are more than <span title="entity reference">entity
  references</span> than an implementation-specific limit such that
  the <span>entity reference</span> that caused these steps invoked
  ought to be ignored:

    <ol>

    <li>Let <var title>replacement</var> be the <span>replacement
    text</span> of <var title>entity</var>, if it is an <span>internal
    entity</span>, or the empty string.

    <li>Set the <span title="XML tokenizer">tokenizer</span> of the
    <span>XML parser</span> to a new <span title="XML
    tokenizer">tokenizer</span> whose <span>input stream</span> is
    <var title>replacement</var>.

    </ol>

    <div class="note memo">

    <p>If the <span>expand external entities</span> flag is unset, a
    reference to the <span>external entity</span> is expanded to the
    empty string.

    </div>

    <div class="note memo">

    <p>There should be an implementation-specific limit on how many
    <span title="entity reference">entity references</span> are
    expanded to defend against <a
    href="http://en.wikipedia.org/wiki/Billion_laughs">billion laughs
    attack</a>.

    </div>

  <li>Otherwise:

    <ol>

    <li>Let <var title>referrer</var> be <span class=ed>XXX
    <span>document's address</span> of the <code>Document</code> of
    the <span>XML parser</span>, if referrer is enabled, or
    null</span>.

    <li>Let <var title>req</var> be a <span
    title=concept-request>request</span> with <span
    title=concept-request-url>url</span> <var title>url</var> and
    <span title=concept-request-referrer>referrer</span> <var
    title>referrer</var>.

    <li>Invoke the <span title=concept-fetch>fetch</span> steps using
    <var title>req</var>.  The <span title=concept-task>tasks</span>
    <span title="queue a task">queued</span> by the <span
    title=concept-fetch>fetch</span> algorithm <em
    class=rfc2119>MUST</em> run these steps:

      <dl class=switch>

      <dt>If it is a <span title=concept-task>task</span> to
      <span>process response</span>

      <dd>If the <span title=concept-response-type>type</span> of the
      <span title=concept-response>response</span> of the <span
      title=concept-fetch>fetch</span> is <em>not</em> <i
      title>default</i>, append the "EOF" character to the <span>input
      byte stream</span> of the current <span title="XML
      tokenizer">tokenizer</span> of the <span>XML parser</span>.

      <dt>If it is a <span title=concept-task>task</span> to
      <span>process response body</span>

      <dd>If the <span title=concept-response-type>type</span> of the
      <span title=concept-response>response</span> of the <span
      title=concept-fetch>fetch</span> is <i title>default</i>, append
      newly-arrived bytes in <span
      title=concept-response-body>body</span> of the <span
      title=concept-response>response</span> to the <span>input byte
      stream</span> of the current <span title="XML
      tokenizer">tokenizer</span> of the <span>XML parser</span>.

      <dt>If it is a <span title=concept-task>task</span> to
      <span>process response end-of-file</span>

      <dd>Append the "EOF" character to the <span>input byte
      stream</span> of the current <span title="XML
      tokenizer">tokenizer</span> of the <span>XML parser</span>.

      </dl>

    <li>Set the <span title="XML tokenizer">tokenizer</span> of the
    <span>XML parser</span> to a new <span title="XML
    tokenizer">tokenizer</span>.

    <li>Set the <span>phase</span> of the <span>tree
    construction</span> stage of the <span>XML parser</span> to
    <span>before XML declaration phase</span> and <span>entity body
    phase</span> to <var title>entity body phase</var>.

      <div class="note memo">

      <p>The <span>before XML declaration phase</span> is used to
      parse the <span>text declaration</span> in the <span>external
      entity</span>, if any.

      </div>

    <li>If <var title>state</var> is <em>not</em> <i>null</i>, let
    <var title>original state</var> be the state of the <span>XML
    parser</span> and set the state of the <span>XML parser</span> to
    <var title>state</var>.

    </ol>

    <p>When decoding the <span>input byte stream</span>, the character
    encoding given in the <span>Content-Type metadata</span> (e.g. the
    <code>charset</code> parameter) <em class=rfc2119>MUST</em> be
    taken into account.  However, the <span>MIME type</span> itself is
    ignored.

      <div class="note memo">

      <p>An <span title="external entity">external</span>
      <span>general entity</span> can be served with various <span
      title="MIME type">MIME types</span>, including but not limited
      to: <code>application/xml-dtd</code>,
      <code>text/xml-parsed-entity</code>,
      <code>application/xml-parsed-entity</code>, various <span
      title="XML MIME type">XML MIME types</span>,
      <code>text/sgml</code>, <code>application/sgml</code>,
      <code>text/plain</code>, and
      <code>application/octet-stream</code>.

      <p class=ed>XXX Should the <code>charset</code> parameter be
      taken into account even when the <code>charset</code> parameter
      is not defined for the MIME type?

      </div>

    <p class=ed>XXX set some error flag if external entity is not
    expanded

    <p class=ed>XXX interaction of <code>standalone=yes</code> and
    external entity reference??

  </ol>

<p>While the <span>stack of tokenizers</span> is <em>not</em> empty,
for the purpose of the processing of an <span>end tag token</span>
only, the <span>XML parser</span> <em class=rfc2119>MUST</em> act as
if the <span>stack of open elements</span> does not contain the <span
title="entity boundary marker">marker</span> and any other element
added to the <span title="stack of open elements">stack</span> before
the <span title="entity boundary marker">marker</span>.<!-- For other
purposes, e.g. entity reference expansion and <video>/<object>
processing, the stack of open elements is not empty, however. -->

<p>While the <span>stack of tokenizer</span> is <em>not</em> empty and
<var title>in markup declaration</var> flag is set upon the last
invocation of the <span>parse an entity</span> steps:

  <ul>

  <li>If the <span title="XML tokenizer">tokenizer</span> consumes a
  <code>U+003E</code> <code class=charname>GREATER-THAN SIGN</code>
  character (<code>&gt;</code>) and the state is changed to the
  <span>document type internal subset state</span>, it <em
  class=rfc2119>MUST</em> be a <span>parse error</span> and the state
  <em class=rfc2119>MUST</em> be changed to the <span>bogus markup
  declaration state</span> instead.

  <li>If the <span title="XML tokenizer">tokenizer</span> consumes an
  implied EOF character, the <span title="stops parsing">steps to stop
  parsing</span> <em class=rfc2119>MUST</em> be run instead.  <span
  class=ed>If this is within an entity value, public literal, system
  literal, or content model group opened by current <var
  title>entity</var></span>, this is a <span>parse error</span> and
  the state <em class=rfc2119>MUST</em> be changed to the <span>bogus
  markup declaration state</span>.

  </ul>

<p>While the <span>stack of tokenizers</span> is <em>not</em> empty,
instead of the <span>stops parsing</span> steps, the <span>XML
parser</span> <em class=rfc2119>MUST</em> run these steps:

  <ol>

  <li>Pop the most recently added <span title="entity boundary
  marker">marker</span>, as well as any element added after the <span
  title="entity boundary marker">marker</span>, from the <span>stack
  of open elements</span>.

  <li>If the last invocation of the <span>parse an entity</span> steps
  sets <var title>original state</var>, set the state of the <span>XML
  parser</span> to <var title>original state</var>.

  <li>Set the <span>phase</span> of the <span>tree construction</span>
  stage of the <span>XML parser</span> to <var title>original
  phase</var> for the last invocation of the <span>parse an
  entity</span> steps.

  <li>Pop a <span title="XML tokenizer">tokenizer</span> from the
  <span>stack of tokenizers</span> and set it the <span title="XML
  tokenizer">tokenizer</span> of the <span>XML parser</span>.

  <li>Unblock the <span title="XML tokenizer">tokenizer</span> of the
  <span>XML parser</span>, such that <span
  title=concept-task>tasks</span> that invoke the <span title="XML
  tokenizer">tokenizer</span> can again be run.

  <li>Set the <span>parser pause flag</span> of the <span title="XML
  tokenizer">tokenizer</span> of the <span>XML parser</span> to false.

  <li>Unset the <span title=concept-entity-open>open</span> flag of
  the entry for <var title>entity</var> in the <span>list of
  entities</span> of the <span>XML parser</span> if <var
  title>entity</var> is a <span>general entity</span>.

  <li>If <var title>in markup declaration</var> flag is set upon the
  last invocation of the <span>parse an entity</span> steps, act as if
  a <code>U+0020</code> <code class=charname>SPACE</code> character
  were processed by the <span title="XML tokenizer">tokenizer</span>.

  </ol>

</div>

</div>

<div class=ed>

<dl class=switch>
<dt>For each external entity (including the document entity and the external
subset entity, if any)
  <dd>If there is a byte sequence that are not legal in the encoding in use,
  then the parser <em class=rfc2119>MUST</em> raise an
  <a href="#xml-misc-error" id=xme-illegal-bytes><code>xml-misc-error</code></a>.
  <!--
     <q>It is a fatal error when an XML processor encounters an entity with an
     encoding that it is unable to process. It is a fatal error if an XML
     entity is determined (via default, encoding declaration, or higher-level
     protocol) to be in a certain encoding but contains byte sequences that are
     not legal in that encoding.</q>
  -->

  <dd>If it is the document entity or a general entity, then:
    <ul>
    <li>If the input byte sequence for the entity begins with the
    <abbr title="BYTE ORDER MARK" class=charname>BOM</abbr>, then the parser
    <em class=rfc2119>MUST</em> set the <span class=ed>BOM flag</span> of
    the node corresponding to the entity (the <code>Document</code> node
    for the document entity or an <code>Entity</code> node for a general
    entity) to <code>true</code>.
    <!--
      <q>Entities encoded in UTF-16 MUST and entities encoded in UTF-8 MAY
      begin with the Byte Order Mark</q>
    -->
    <span class=ed>@@ flag must be checked later</span>
    <!-- <?xml encoding=""?> must be reflected to xmlEncoding; this should be
    enforced by DOM Core spec. -->
    </ul>
  <dd>If it is a parameter entity or the external subset entity, then:
    <ul>
    <li>If the character encoding of the entity is <code>UTF-16</code> but
    the input byte stream for the entity does not begin with the
    <abbr title="BYTE ORDER MARK" class=charname>BOM</abbr>, then the parser
    <em class=rfc2119>MUST</em> raise an
    <a href="#xml-misc-error" id=xme-pe-bom><code>xml-misc-error</code></a>.
    <li class=ed>@@ encoding="" preferred name?
<!--
"In an encoding declaration, the values "UTF-8", "UTF-16", "ISO-10646-UCS-2", and "ISO-10646-UCS-4" SHOULD be used for the various encodings and transformations of Unicode / ISO/IEC 10646, the values "ISO-8859-1", "ISO-8859-2", ... "ISO-8859-n" (where n is the part number) SHOULD be used for the parts of ISO 8859, and the values "ISO-2022-JP", "Shift_JIS", and "EUC-JP" SHOULD be used for the various encoded forms of JIS X-0208-1997. It is RECOMMENDED that character encodings registered (as charsets) with the Internet Assigned Numbers Authority [IANA-CHARSETS], other than those just listed, be referred to using their registered names; other encodings SHOULD use names starting with an "x-" prefix."

In addition, this should be checked later for Document and Entity nodes.
-->
    </ul>

<dt>For the document
  <dd>If the <abbr>XML</abbr> document does not begin with an
  <abbr>XML</abbr> declaration, then the parser <em class=rfc2119>MUST</em>
  raise an
  <a href="#xml-misc-recommentation" id=xmr-xml-decl><code>xml-misc-recommendation</code></a>.
  <dd>If the document does not contain the document type declaration, or
  if it does but the document type definition does not contain entity 
  declaration for any of <code>amp</code>, <code>lt</code>, <code>gt</code>,
  <code>apos</code>, or <code>quot</code>, then the parser
  <em class=rfc2119>MUST</em> raise
  <a href="#xml-misc-recommentation" id=xmr-predefined-decl><code>xml-misc-recommendation</code></a>(s).
  <!--
    <q>For interoperability, valid documents SHOULD declare the entities
    amp, lt, gt, apos, quot, in the form specified in 4.6 Predefined
    Entities.</q>
  -->
<dt>For the document type declaration
  <dd class=ed>@@ read external entity
  <dd>The <code>entities</code> attribute of the <code>DocumentType</code>
  node <em class=rfc2119>MUST</em> contain a <code>NamedNodeMap</code> object
  whose first five items are as follows:
    <ol start=0>
    <li>An <code>Entity</code> node whose <code>nodeName</code> attribute
    is <code>amp</code>.  It contains a <code>Text</code> node whose
    <code>data</code> attribute is set to <code>&amp;</code>.
    <li>An <code>Entity</code> node whose <code>nodeName</code> attribute
    is <code>lt</code>.  It contains a <code>Text</code> node whose
    <code>data</code> attribute is set to <code>&lt;</code>.
    <li>An <code>Entity</code> node whose <code>nodeName</code> attribute
    is <code>gt</code>.  It contains a <code>Text</code> node whose
    <code>data</code> attribute is set to <code>></code>.
    <li>An <code>Entity</code> node whose <code>nodeName</code> attribute
    is <code>quot</code>.  It contains a <code>Text</code> node whose
    <code>data</code> attribute is set to <code>"</code>.
    <li>An <code>Entity</code> node whose <code>nodeName</code> attribute
    is <code>apos</code>.  It contains a <code>Text</code> node whose
    <code>data</code> attribute is set to <code>'</code>.
    </ol>
<dt>For each internal general entity declaration being processed by the parser
  <dd>If the 
  <a href="http://www.w3.org/TR/2006/REC-xml-20060816/#NT-EntityValue"><code>EntityValue</code></a>
  part of the general entity declaration contains a bare <code>U+003C</code>
  <code>LESS-THAN SIGN</code> (<code>&lt;</code>) character, then the parser
  <em class=rfc2119>MUST</em> raise an
  <a href="#xml-misc-warning" id=xmw-entity-value-lt><code>xml-misc-warning</code></a>.<!--
"strongly advised to avoid" in a Note in Section 2.3 of [XML], [XML11].
-->
<dt>For each element type declaration being processed by the parser
  <dd>If there is another processed element type declaration whose
  <code>Name</code> is equal to the <code>Name</code> of the element type
  declaration, then the parser <em class=rfc2119>MUST</em> raise an 
  <a href="#xml-validity-error" id=vc-edunique><code>xml-validity-error</code></a>.
<dt>For each attribute definition list declaration being processed by the
parser
  <dd>If there is another processed attribute defintion list declaration whose
  <code>Name</code> is equal to the <code>Name</code> of the attribute
  definition list declaration, then the parser <em class=rfc2119>MUST</em>
  raise an 
  <a href="#xml-misc-warning" id=xme-attlist-unique><code>xml-misc-warning</code></a>.
  <dd>For each attribute definition in the attribute definition list 
  declaration, if there is another processed attribute definition whose
  <code>Name</code> is equal to the <code>Name</code> of the attribute
  definition (whether or not in the same attribute definition list
  declaration), then the parser <em class=rfc2119>MUST</em> raise an
  <a href="#xml-misc-warning" id=xme-attrdef-unique><code>xml-misc-warning</code></a>.
  <!--
    <q>For interoperability, an XML processor <em class=rfc2119>MAY</em> at
    user option issue a warning when more than one attribute-list declaration
    is provided for a given element type, or more than one attribute definition
    is provided for a given attribute, but this is not an error.</q>
  -->
<!--
  NOTE: <!ATTLIST a xml:space (default) #IMPLIED xml:space CDATA #IMPLIED>
  will not be warned.
-->

<dt>For each entity declaration being processed by the parser
  <dd>Handle as follows:
    <ol>
    <li><p>If the entity declaration declares a general entity, the following
    is applied:
      <dl>
      <dt>If the <code>Name</code> is <code>lt</code> or <code>amp</code>
        <dd><p>If the entity declaration does not declare an internal entity,
        or if the replacement text of the entity is not the escaped form of
        <code>&lt;</code> (if <code>lt</code>) or <code>&amp;</code> (if
        <code>amp</code>), then the parser <em class=rfc2119>MUST</em> raise an
        <a href="#xml-misc-error" id=xme-double-escape><code>xml-misc-error</code></a>.

          <div class="note memo informative">
          <p>In other word, the character in the <code>EntityValue</code>
          has to be double-escaped.
          </div>
      <dt>If the <code>Name</code> is <code>gt</code>, <code>quot</code>, or
      <code>apos</code>
        <dd><p>If the entity declaration does not declare an internal entity,
        or if the replacement text of the entity is not equal to or not the
        escaped form of <code>></code> (if <code>gt</code>), <code>"</code> (if
        <code>quot</code>), or <code>'</code> (if <code>apos</code>), then the
        parser <em class=rfc2119>MUST</em> raise an
        <a href="#xml-misc-error" id=xme-single-escape><code>xml-misc-error</code></a>.

          <div class="note memo informative">
          <p>In other word, the character in the <code>EntityValue</code>
          has to be single- or double-escaped.
          </div>
      </dl>
      <!--
        <q>If the entities lt or amp are declared, they MUST be declared as internal entities whose replacement text is a character reference to the respective character (less-than sign or ampersand) being escaped; the double escaping is REQUIRED for these entities so that references to them produce a well-formed result. If the entities gt, apos, or quot are declared, they MUST be declared as internal entities whose replacement text is the single character being escaped (or a character reference to that character; the double escaping here is OPTIONAL but harmless).</q>
      -->

    <li><p>If the entity declaration has to be ignored since there has already
    been declared an entity with the same <code>Name</code> as the declaration,
    then the parser <em class=rfc2119>MUST</em> raise a
    <a href="#misc-info" id=mi-ent-unique><code>misc-info</code></a>
    and abort these steps.

    <div class="informative note memo">
    <p>Five predefined entities, i.e. <code>amp</code>, <code>lt</code>,
    <code>gt</code>, <code>quot</code>, and <code>apos</code>, are always
    declared implicitly and therefore any declaration for such an entity 
    always raises an
    <a href="#misc-info" id=mi-ent-unique><code>misc-info</code></a>.
    </div>  

    <li><p>If the entity declaration declares a parameter entity and the
    <code>Name</code> of the entity begins with the string <code>xml</code>
    (in any combination of upper- and lowercase letters), then the parser
    <em class=rfc2119>MUST</em> raise an
    <a href="#xml-misc-warning" id=xmw-reserved-pe-name><code>xml-misc-warning</code></a>.

    <li><p>If the entity declaration contains the <code>EntityValue</code>,
    then for each occurence of any references to unparsed entities in the
    <code>EntityValue</code>, the parser <em class=rfc2119>MUST</em> raise an
    <a href="#xml-misc-error" id=xme-unparsed-in-ev><code>xml-misc-error</code></a>.
    <!--
      <q>It is an error for a reference to an unparsed entity to appear in the
      EntityValue in an entity declaration.</q>
    -->
    <li><p>If the entity declaration declares a general entity, then an
    <code>Entity</code> node <em class=rfc2119>MUST</em> be created and
    appended to the <code>NamedNodeMap</code> object in the
    <code>entities</code> attribute of the <code>DocumentType</code> node.
    
    <p class=ed>Read the external entity

    <p>If the replacement text of the entity is read, then parse the 
    replacement text as if it were referenced from the content of an
    element (with no namespace bindings).  If no <span class=ed>@@ parse error</span>
    is raised by the parsing process, then the nodes generated by the
    parsing <em class=rfc2119>MUST</em> be appended to the <code>Entity</code>
    node.  The parse error <em class=rfc2119>MUST NOT</em> be propagated to
    the entire parsing process.  Other kinds of errors
    <em class=rfc2119>MUST</em> be propagated.  The first parse error
    <em class=rfc2119>MUST</em> abort the internal parsing process.
    <span class=ed>@@ better wording</span>

    <p class=ed>@@ prop
     
    <p>Then, the <code>Entity</code> node and its descendant 
    <em class=rfc2119>MUST</em> be marked as read-only.
  </ol>

<dt>For each notation declaration being processed by the parser
  <dd>If there is another processed notation declaration whose
  <code>Name</code> is equal to the <code>Name</code> of the notation
  declaration, then the parser <em class=rfc2119>MUST</em> raise an 
  <a href="#xml-validity-error" id=vc-uniquenotationname><code>xml-validity-error</code></a>.
  <!-- <a href="http://www.w3.org/TR/2006/REC-xml-20060816/#UniqueNotationName">Validity constraint: Unique Notation Name</a> -->

<dt>For each empty-element tag
  <dd>If the <code>Name</code> of the tag is not declared by a processed
  element type declaration as <code>EMPTY</code> content, then the parser
  <em class=rfc2119>MUST</em> raise an
  <a href="#xml-misc-recommentation" id=xmr-emptyelemtag-not-empty><code>xml-misc-recommendation</code></a>.
<dt>For each start-tag
  <dd>If the <code>Name</code> of the tag is declared by a processed element
  type declaration as <code>EMPTY</code> content, then the parser
  <em class=rfc2119>MUST</em> raise an
  <a href="#xml-misc-recommentation" id=xmr-empty-not-emptyelemtag><code>xml-misc-recommendation</code></a>.
<dt>For each attribute
  <dd><p>The parser <em class=rfc2119>MUST</em> set the normalized value of 
  the attribute to the <code>value</code> attribute of the <code>Attr</code>
  node created for the attribute.

    <div class="note memo informative">
    <p>That is, any entity reference has to be expanded.  Unexpanded entity
    references in attribute values are discarded.
    </div>
<dt>For each <code>xml:space</code> attribute
  <dd>The parser <em class=rfc2119>MUST</em> set the normalized value of
  the <code>xml:space</code> attribute to the <code>value</code> attribute
  of the <code>Attr</code> node created for the attribute even if the
  normalized value is different from <code>default</code> or
  <code>preserve</code>.
  <!-- In XML 1.0/1.1 specification, the attribute specification MAY be
  ignored. -->

<dt>For each parameter entity reference
  <dd><p>Process as follows:
    <ol>
    <li>If the declaration for the entity is <em>not</em> processed,
    then:
      <dl class=switch>
      <dt>If the document contains no external entity or if the document
      contains the <code>standalone</code> pseudo-attribute set to
      <code>yes</code><!-- or the document contains no DTD -->
        <dd>The parser <em class=rfc2119>MUST</em> raise an
        <a href="#xml-well-formedness-error" id=wf-entdeclared-pe><code>xml-well-formedness-error</code></a>.
      <dt>Otherwise
        <dd>The parser <em class=rfc2119>MUST</em> raise an
        <a href="#xml-validity-error" id=vc-entdeclared-pe><code>xml-validity-error</code></a>.
      </dl>
    <li>If the declaration for the entity <em>is</em> processed but the
    referenced entity cannot be retrieved, then the parser
    <em class=rfc2119>MUST</em> raise an
    <span class=ed>@@ ??-error</span>.
    </ol>

    <p>In any of two cases above, process as follows:
    <ul>
    <li>If the parameter entity reference is contained in a declaration, then
    the declaration <em class=rfc2119>MUST</em> be ignored <em>except</em> that
    any error before the parameter entity <em class=rfc2119>MUST</em> be
    raised as usual.
    <li>If the parameter entity reference is contained in the status portion of
    a conditional section, then the conditional section
    <em class=rfc2119>MUST</em> be processed as if it were an
    <code>IGNORE</code>d section.
    <li>The parser <em class=rfc2119>MUST NOT</em> process any entity or
    attribute-list declaration after the parameter entity reference in the DTD
    <em>except</em> when the <code>standalone</code> pseudo-attribute of the
    XML declaration (if any) is set to <code>yes</code>.
    <!-- This requirement is enforced for internal DTD subset case in
    XML 1.0/1.1 specification (section 5.1) but not for any other cases. -->
    <!-- According to this definition, element type declarations, notation
    declarations, and PIs ARE processed. -->
    <li>If the parameter entity reference is the first reference to an entity
    that is not read, then the parser <em class=rfc2119>MUST</em> raise an
    <a href="#entity-error" id=ee-unread-pe><code>entity-error</code></a>.
    <li>The <code>allDeclarationsProcessed</code> <span class=ed>@@ ref</span>
    attribute of the <code>Document</code> node <em class=rfc2119>MUST</em> be
    set to <code>false</code>.
    </ul>
<dt>For each general entity reference in an attribute value or in the content
of an element
  <dd><p>Process as follows:
    <ol>
    <li>If the <code>Name</code> of the entity reference is either
    <code>amp</code>, <code>lt</code>, <code>gt</code>, <code>quot</code>,
    or <code>apos</code>, then abort these steps.
    <li>If the declaration for the entity is <em>not</em> processed,
    then:
      <dl class=switch>
      <dt>If the document contains no external entity or if the document
      contains the <code>standalone</code> pseudo-attribute set to
      <code>yes</code><!-- or the document contains no DTD -->
        <dd>The parser <em class=rfc2119>MUST</em> raise an
        <a href="#xml-well-formedness-error" id=wf-entdeclared-ge><code>xml-well-formedness-error</code></a>.
      <dt>Otherwise
        <dd>The parser <em class=rfc2119>MUST</em> raise an
        <a href="#xml-validity-error" id=vc-entdeclared-ge><code>xml-validity-error</code></a>.
      </dl>
    <li>If the declaration for the entity <em>is</em> processed but the
    referenced entity cannot be retrieved, then the parser
    <em class=rfc2119>MUST</em> raise an
    <span class=ed>@@ ??-error</span>.
    </ol>

    <p>In any of two cases above, process as follows:
    <ul>
    <li>If the general entity reference is the first reference to an entity
    that is not read, then the parser <em class=rfc2119>MUST</em> raise an
    <a href="#entity-error" id=ee-unread-ge><code>entity-error</code></a>.
    <span class=ed>@@ entity declared WFC?</span>
    <li class=ed>An unexpended entity reference node <em class=rfc2119>MUST</em> be inserted to the current node.
    </ul>

<dt>For each comment <em>outside</em> of document type declaration
  <dd>A <code>Comment</code> node <em class=rfc2119>MUST</em> be created
  and inserted appropriately.
  <!-- In XML 1.0/1.1 spec, this is optional. -->
</dl>

<p>The parser <em class=rfc2119>MUST</em> try to read any entity
referenced by general or parameter entity references<!--,--> and the
external subset entity, if any<!--, and any general entity declared-->
in the document type definition.

<p><strong>Well-formedness constraints</strong>.  When the parser
detects a voilation to one of certain well-formedness constraints, it
<em class=rfc2119>MUST</em> raise an <a
href="#xml-well-formedness-error"><code>xml-well-formedness-error</code></a>.
The list of such well-formed constraints is as follows:

<ul>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#wfc-PEinInternalSubset">Well-formedness constraint: PEs in Internal Subset</a>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#GIMatch">Well-formedness constraint: Element Type Match</a>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#uniqattspec">Well-formedness constraint: Unique Att Spec</a>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#NoExternalRefs">Well-formedness constraint: No External Entity References</a>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#CleanAttrVals">Well-formedness constraint: No &lt; in Attribute Values</a>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#wf-Legalchar">Well-formedness constraint: Legal Character</a>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#textent">Well-formedness constraint: Parsed Entity</a>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#norecursion">Well-formedness constraint: No Recursion</a>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#indtd">Well-formedness constraint: In DTD</a>
</ul>

<p><strong>Validity constraints</strong>.  When the parser detects a
violation to one of certain validity contraints, it <em
class=rfc2119>MUST</em> raise an <a
href="#xml-validity-error"><code>xml-validity-error</code></a>.  The
list of such validity constraints is as follows:

<ul>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#vc-PEinMarkupDecl">Validity constraint: Proper Declaration/PE Nesting</a>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#vc-PEinGroup">Validity constraint: Proper Group/PE Nesting</a>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#condsec-nesting">Validity constraint: Proper Conditional Section/PE Nesting</a>
<li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#vc-check-rmd">Validity constraint: Standalone Document Declaration</a>
</ul>

<p><strong>Other creteria</strong>.  If the parser detects a violation
to one of certain additional constraints, it <em
class=rfc2119>MUST</em> raise an <a
href="#xml-misc-recommendation"><code>xml-misc-recommendation</code></a>.
The list of such constraints is as follows:

<ul>
<li><q>For interoperability, if a parameter-entity reference appears in a 
<code>choice</code>, <code>seq</code>, or <code>Mixed</code> construct, its 
replacement text <em class=rfc2119>SHOULD</em> contain at least one non-blank 
character, and neither the first nor last non-blank character of the 
replacement text <em class=rfc2119>SHOULD</em> be a connector (<code>|</code> 
or <code>,</code>).</q>
<li><q>External parsed entities <em class=rfc2119>SHOULD</em> each begin with a
text declaration.</q>
</ul>

<p>The parser <em class=rfc2119>MUST</em> act as if it is a <a
href="http://www.w3.org/TR/2006/REC-xml-20060816/#dt-validating">validating
XML processor</a> for the purpose of informing of white space
characters appearing in <a
href="http://www.w3.org/TR/2006/REC-xml-20060816/#dt-elemcontent">element
content</a> (See <a
href="http://www.w3.org/TR/2006/REC-xml-20060816/#sec-white-space">Section
2.10</a> of the XML specification).

  <div class="note memo informative">
  <p>In other word, the <code>isElementContentWhitespace</code> attribute
  of <code>Text</code> nodes has to be set appropriately.  Note that the
  value of the attribute will be set to <code>false</code> for any 
  <code>Text</code> node in the content of an element whose declaration
  is not processed.
  </div>

<p>The parser <em class=rfc2119>MUST</em> raise at least one <a
href="#xml-well-formedness-error"
id=wfe-syntax><code>xml-well-formedness-error</code></a> if the entity
it parses does not match to the appropriate production rule in the XML
specification.  As an exception to this requirement, it <em
class=rfc2119>MAY</em> choose not to raise such an error if the error
will be raised by the conformance checker when the conformance checker
<a href="#algorithm-to-check-a-node" title="check a node">checks</a>
the <code>Document</code> object produced by the parser.

<!--
  <li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#ExtSubset">Well-formedness constraint: External Subset</a>
  <li><a href="http://www.w3.org/TR/2006/REC-xml-20060816/#PE-between-Decls">Well-formedness constraint: PE Between Declarations</a>
-->

<!--
  Inpossible to test:
    "In the absence of external character encoding information (such as MIME
    headers), parsed entities which are stored in an encoding other than UTF-8
    or UTF-16 MUST begin with a text declaration"
-->
</div><!-- ed -->

</div><!-- section -->


<div class=section>
<h2>DOM Document Type Definitions</h2>

<p>This section defines various extensions to DOM to represent
definitions that can be contained in XML DTDs.  They are referred to
as <dfn id=term-dom-dtdef><abbr>DOM</abbr> Document Type
Definitions</dfn>, which is a set of <abbr>DOM</abbr> interfaces,
including both new interfaces and modifications to existing standard
<abbr>DOM</abbr> interfaces.

<p>The primary goal of those features is to make it possible to built
an XML DTD validator on the top of the extended DOM API.

<div class="note memo">

<p>Although these features are defined as extensions to the standard
DOM interfaces, they are not expected to be implemented by Web
browsers.

</div>

<div class="note memo">

<p>Interfaces defined in this section are partially modeled and
inspired by early Working Drafts of <cite><abbr>DOM</abbr> Level
1</cite> <cite class="bibref informative">[<a
href="#ref-DOM1WD">DOM1WD</a>]</cite>, <cite><abbr>DOM</abbr> Level 3
Abstract Schemas</cite> draft <cite class="bibref informative">[<a
href="#ref-DOM3AS">DOM3AS</a>]</cite>, and <cite><abbr>XML</abbr>
Schema <abbr>API</abbr></cite> specification <cite class="bibref
informative">[<a href="#ref-XSAPI">XSAPI</a>]</cite>, but they are not
compatible with any of them as a whole.</p>

</div>

<div class="note memo">

<p>Features in this section are applied to both <span title="XML
document">XML documents</span> and <span title="HTML document">HTML
documents</span>.

</div>

<div class=section id=section-node>
<h3 id=Node>Nodes</h3>

<p>This specification introduces two kinds of <span
class=concept-node>nodes</span>: <span
title=concept-element-type>element types</span> and <span
title=concept-attribute-definition>attribute definitions</span>.
Also, this specification reuses two kinds of nodes defined by DOM3
Core specification <cite class="bibref normative">[<a
href="#ref-DOM3CORE">DOM3CORE</a>]</cite> (but obsoleted by current
DOM Standard <cite class="bibref normative">[<a
href="#ref-DOM">DOM</a>]</cite>): <span
title=concept-entity>entities</span> and <span
title=concept-notation>notations</span>.  Requirements on <span
class=concept-node>nodes</span> are applied by the following rules:

<dl class=switch>

<dt>Node types introduced by this specification
(<code>ElementTypeDefinition</code> and
<code>AttributeDefinition</code>)

<dd>If this specification explicitly states requirements for them,
they have to be followed.  Otherwise, requirements mentioned in the
DOM Standard have to be followed.

<dt><code>DocumentType</code>

<dd>If this specification explicitly states requirements for it, they
have to be followed.  Otherwise, requirements mentioned in the DOM
Standard have to be followed.

<div class="note memo">

<p>This specification defines how nodes attached to the
<code>DocumentType</code> (e.g. <code>ElementTypeDefinition</code> and
<code>Entity</code>) affect to attributes and methods of the <span
title=concept-node>nodes</span>.  When the <code>DocumentType</code>
has no such attached node, they are expected to behave as specified by
the DOM Standard.

</div>

<dt>Node types defined in DOM3 Core specification but obsoleted by DOM
Standard (<code>Entity</code> and <code>Notation</code>)

<dd>If this specification explicitly states requirements for them,
they have to be followed.  Otherwise, requirements mentioned in the
DOM3 Core specification have to be followed.

<dt>Other node types

<dd>Requirements in the DOM Standard have to be followed.

</dl>

<p>Nodes of types <code>ElementTypeDefinition</code>,
<code>AttributeDefinition</code>, <code>Entity</code>, and
<code>Notation</code> cannot contain, or cannot be contained by, any
kind of node as <span title=concept-tree-child>child</span>.

<div class="note memo">

  <p>Historically, DOM3 Core specification and earlier versions of
  this specification have allowed <code>AttributeDefinition</code> and
  <code>Entity</code> nodes containing <span
  title=concept-tree-child>children</span>.

</div>

<hr>

<pre class=idl><code>partial interface <span>Node</span> {
  const unsigned short <span title=dom-Node-ELEMENT_TYPE_DEFINITION_NODE>ELEMENT_TYPE_DEFINITION_NODE</span> = 81001;
  const unsigned short <span title=dom-Node-ATTRIBUTE_DEFINITION_NODE>ATTRIBUTE_DEFINITION_NODE</span> = 81002;
};</code></pre>

<p>The <code title=dom-Node-nodeType>nodeType</code> attribute <em
class=rfc2119>MUST</em> return the following, depending on the
<span>context object</span>:

<dl class=switch>

<dt><code>ElementTypeDefinition</code>
<dd><dfn title=dom-Node-ELEMENT_TYPE_DEFINITION_NODE><code id=ELEMENT_TYPE_DEFINITION_NODE>ELEMENT_TYPE_DEFINITION_NODE</code></dfn>
(<code>81001</code>)

<dt><code>AttributeDefinition</code>
<dd><dfn title=dom-Node-ATTRIBUTE_DEFINITION_NODE><code id=ATTRIBUTE_DEFINITION_NODE>ATTRIBUTE_DEFINITION_NODE</code></dfn>
(<code>81002</code>)

<!-- For Entity and Notation, defined by DOM3CORE -->
</dl>

<p>The <code title=dom-Node-nodeName>nodeName</code> attribute <em
class=rfc2119>MUST</em> return the name (<span
title=concept-element-type-name>element type name</span> or <span
title=concept-attribute-definition-name>attribute definition
name</span>) of the node.

<p>If the <span title=concept-node>node</span> has attributes <code
title=dom-Node-attributes>attributes</code>, <code
title=dom-Node-localName>localName</code>, <code
title=dom-Node-namespaceURI>namespaceURI</code>, and <code
title=dom-Node-prefix>prefix</code>, they <em class=rfc2119>MUST</em>
return <code>null</code>.<!-- NodeExodus / AttrExodus -->

<p>The <code title=dom-Node-nodeValue>nodeValue</code> attribute and
the <code title=dom-Node-textContent>textContent</code> attribute <em
class=rfc2119>MUST</em> return the following, depending on the
<span>context object</span>:

<dl class=switch>

<!--
<dt><code>ElementTypeDefinition</code>
<dd><span>Null</span>.
-->

<dt><code>AttributeDefinition</code> <dd>The <span
title=concept-attribute-definition-default-value>default value</span>
of the <span>context object</span>.

<dt><code>Entity</code>
<dd>The <span title=concept-entity-replacement-text>replacement
text</span> of the <span>context object</span>.

<!-- For Notation, defined by DOM3CORE -->
</dl>

<p>Setting the <code title=dom-Node-nodeValue>nodeValue</code>
attribute or the <code title=dom-Node-textContent>textContent</code>
attribute <em class=rfc2119>MUST</em> do the following, depending on
the <span>context object</span>:

<dl class=switch>

<!--
<dt><code>ElementTypeDefinition</code>
<dd>Do nothing.
-->

<dt><code>AttributeDefinition</code> <dd>Set the <span
title=concept-attribute-definition-default-value>default value</span>
of the <span>context object</span> to the new value.

<dt><code>Entity</code>
<dd>Set the <span title=concept-entity-replacement-text>replacement
text</span> of the <span>context object</span> to the new value.

<!-- For Notation, defined by DOM3CORE -->
</dl>

<p>On setting, the <code title=dom-Node-textContent>textContent</code>
attribute <em class=rfc2119>MUST</em> act as if it was the empty
string instead if the new value is <span>null</span>.

<p>When a node is <span title=concept-node-clone>cloned</span>, the
following values <em class=rfc2119>MUST</em> be copied:

<!-- This list should be equal to isEqualNode's list -->
<dl class=switch>

<dt><code>DocumentType</code>
<!-- Modify DOM definition -->
<dd>Its <span title=concept-DocumentType-elementTypes>element
types</span>, <span title=concept-DocumentType-generalEntities>general
entities</span>, and <span
title=concept-DocumentType-notations>notations</span>.

  <div class="note memo">
  
  <p>The DOM Standard defines more values to copy.

  </div>

<dt><code>ElementTypeDefinition</code> <dd>Its <span
title=concept-element-type-name>name</span> and <span
title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</span>.<!-- XXX content model -->

<dt><code>AttributeDefinition</code> <dd>Its <span
title=concept-attribute-definition-name>name</span>, <span
title=concept-attribute-definition-declared-type>declared type</span>,
<span title=concept-attribute-definition-allowed-tokens>allowed
tokens</span>, <span
title=concept-attribute-definition-default-type>default type</span>,
and <span title=concept-attribute-definition-default-value>default
value</span>.

<dt><code>Entity</code>
<!-- Implementation dependent in DOM3CORE -->
<dd>Its <span title=concept-entity-name>name</span>, <span
title=concept-entity-publicid>public ID</span>, <span
title=concept-entity-systemid>system ID</span>, <span
title=concept-entity-notation-name>notation name</span>, and <span
title=concept-entity-replacement-text>replacement text</span>.

  <div class="note memo">

  <p>The <span title=concept-entity-encoding>encoding</span><!--
  [MANAKAI] --> is not copied.

  </div>

<dt><code>Notation</code>
<!-- Implementation dependent in DOM3CORE -->
<dd>Its <span title=concept-notation-name>name</span>, <span
title=concept-notation-publicid>public ID</span>, and <span
title=concept-notation-systemid>system ID</span>.

</dl>

<p>For the <span title=concept-node-equals>equality</span> of two
nodes, equality of the following values <em class=rfc2119>MUST</em>
also be taken into account:

<!-- This list should be equal to cloneNode's list -->
<dl class=switch>

<dt><code>DocumentType</code>
<!-- Modify DOM definition -->
<dd>Its <span title=concept-DocumentType-elementTypes>element
types</span>, <span title=concept-DocumentType-generalEntities>general
entities</span>, and <span
title=concept-DocumentType-notations>notations</span>.

<dt><code>ElementTypeDefinition</code>
<dd>Its <span title=concept-element-type-name>name</span> and <span
title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</span>.<!-- XXX and content model -->

<dt><code>AttributeDefinition</code> <dd>Its <span
title=concept-attribute-definition-name>name</span>, <span
title=concept-attribute-definition-declared-type>declared type</span>,
<span title=concept-attribute-definition-allowed-tokens>allowed
tokens</span>, <span
title=concept-attribute-definition-default-type>default type</span>,
and <span title=concept-attribute-definition-default-value>default
value</span>.

<dt><code>Entity</code>
<!-- Modify DOM3CORE definition -->
<dd>Its <span title=concept-entity-name>name</span>, <span
title=concept-entity-publicid>public ID</span>, <span
title=concept-entity-systemid>system ID</span>, <span
title=concept-entity-notation-name>notation name</span>, and <span
title=concept-entity-replacement-text>replacement text</span>.

<dt><code>Notation</code>
<!-- Modify DOM3CORE definition -->
<dd>Its <span title=concept-notation-name>name</span>, <span
title=concept-notation-publicid>public ID</span>, and <span
title=concept-notation-systemid>system ID</span>.

</dl>

<p>For the comparison of node sets, only the length and equality of
nodes with same <code title=dom-Node-nodeName>nodeName</code> in the
set are significant.  The order of the nodes are not ignored for the
purpose of the comparison.  For the comparison of <span
title=concept-attribute-definition-allowed-tokens>allowed
tokens</span>, the length of items and existence of the values in both
are taken into account.

<p>If at least one of two nodes compared by the <code
title=dom-Node-compareDocumentPosition>compareDocumentPosition</code>
method (i.e. <var title>reference</var> and <var title>other</var>)
are <code>ElementTypeDefinition</code>,
<code>AttributeDefinition</code>, <code>Entity</code>, or
<code>Notation</code> and they are different nodes, the following
rules are applied:

<ul>

<li>If both nodes are of these four node types and their <span
title=concept-owner>owners</span> are the same node,

  <ul>

  <li>If <var title>other</var>'s node type is less than <var
  title>reference</var>'s node type, the method <em
  class=rfc2119>MUST</em> return the result of adding <code
  title=dom-Node-DOCUMENT_POSITION_PRECEDING>DOCUMENT_POSITION_PRECEDING</code>
  to <code
  title=dom-Node-DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC>DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC</code>.

  <li>Otherwise, if <var title>other</var>'s node type is greater than
  <var title>reference</var>'s node type, the method <em
  class=rfc2119>MUST</em> return the result of adding <code
  title=dom-Node-DOCUMENT_POSITION_FOLLOWING>DOCUMENT_POSITION_FOLLOWING</code>
  to <code
  title=dom-Node-DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC>DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC</code>.

  <li>Otherwise, if <var title>other</var>'s <code
  title=dom-Node-nodeName>nodeName</code> is less than <var
  title>reference</var>'s <code
  title=dom-Node-nodeName>nodeName</code> in code point order, the
  method <em class=rfc2119>MUST</em> return the resulf of adding <code
  title=dom-Node-DOCUMENT_POSITION_PRECEDING>DOCUMENT_POSITION_PRECEDING</code>
  to <code
  title=dom-Node-DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC>DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC</code>.

  <li>Otherwise, the method <em class=rfc2119>MUST</em> return the
  result of adding <code
  title=dom-Node-DOCUMENT_POSITION_FOLLOWING>DOCUMENT_POSITION_FOLLOWING</code>
  to <code
  title=dom-Node-DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC>DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC</code>.

  </ul>

<li>Otherwise, the <span title=concept-owner>owner</span> <em
class=rfc2119>MUST</em> be considered as the <span
title=concept-tree-parent>parent</span> of the node for the purpose of
comparison.  The nodes of these four types <em class=rfc2119>MUST</em>
be considered as preceding any <span
title=concept-tree-child>child</span> node of the <span
title=concept-owner>owner</span>.

</ul>

<hr>

<p>A node of type <code>ElementTypeDefinition</code>,
<code>Entity</code>, or <code>Notation</code> has an associated <dfn
title=concept-owner-document-type-definition>owner document type
definition</dfn>.  The <code>AttributeDefinition</code> node has an
associated <dfn title=concept-owner-element-type-definition>owner
element type definition</dfn>.  Their values are <span>null</span>
unless otherwise specified.  When not ambiguous, they are simply
referred to as <dfn title=concept-owner>owner</dfn> of the node.

<p>The <dfn title=dom-ownerDocumentTypeDefinition><code
id=ownerDocumentTypeDefinition>ownerDocumentTypeDefinition</code></dfn>
attribute of the <code>ElementTypeDefinition</code>,
<code>Entity</code>, and <code>Notation</code> interfaces <em
class=rfc2119>MUST</em> return the <span
title=concept-owner-document-type-definition>owner document type
definition</span> of the <span>context object</span>.  The <dfn
title=dom-ownerElementTypeDefinition><code
id=ownerElementTypeDefinition>ownerElementTypeDefinition</code></dfn>
attribute of the <code>AttributeDefinition</code> interface <em
class=rfc2119>MUST</em> return the <span
title=concept-owner-element-type-definition>owner element type
definition</span> of the <span>context object</span>.

<p>The <dfn title=dom-publicId><code id=publicId>publicId</code></dfn>
attribute and the <dfn title=dom-systemId><code
id=systemId>systemId</code></dfn> attribute of the <code>Entity</code>
and <code>Notation</code> interfaces <em class=rfc2119>MUST</em>
return the <span title=concept-publicid>public ID</span> and <span
title=concept-systemid>system ID</span> of the <span>context
object</span>, respectively.<!-- For DocumentType, defined in DOM -->.

<p>On setting, the <code title=dom-publicId>publicId</code> attribute
and the <code title=dom-systemId>systemId</code> attribute of the
<code>DocumentType</code>, <code>Entity</code>, and
<code>Notation</code> interfaces <em class=rfc2119>MUST</em> set the
<span title=concept-publicid>public ID</span> and <span
title=concept-systemid>system ID</span> of the <span>context
object</span>, respectively, to the new value.

<div class="note memo">
<p>In DOM Standard and DOM3 Core specifications, these attributes are
read-only.
</div>

<div class="note memo">
<p>Setting an invalid identifier to these attribute might make the
node unserializable in the XML syntax.
</div>

<hr>

<p>When a <code>NamedNodeMap</code> <span
title=concept-collection>collection</span> represents <span
title=concept-DocumentType-elementTypes>element types</span>, <span
title=concept-DocumentType-generalEntities>general entities</span>,
<span title=concept-DocumentType-notations>notations</span>, or <span
title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</span>, methods <code
title=dom-NamedNodeMap-getNamedItemNS>getNamedItemNS</code>, <code
title=dom-NamedNodeMap-setNamedItemNS>setNamedItemNS</code>, and <code
title=dom-NamedNodeMap-removeNamedItemNS>removeNamedItemNS</code> of
the <code>NamedNodeMap</code> interface <cite class="bibref
normative">[<a href="#ref-DOM3CORE">DOM3CORE</a>]</cite> <em
class=rfc2119>MUST</em> <span>throw</span> a
"<code>NotSupportedError</code>" exception.

</div>

<div class=section id=section-document>
<h3 id=Document>Documents</h3>

<p>Several factory methods are added to the <code>Document</code>
interface.

<pre class=idl id=section-documentxdoctype><code>partial interface <span>Document</span> {
  <span>DocumentType</span> <span title=dom-Document-createDocumentTypeDefinition>createDocumentTypeDefinition</span>(<span>DOMString</span> name);
  <span>ElementTypeDefinition</span> <span title=dom-Document-createElementTypeDefinition>createElementTypeDefinition</span>(<span>DOMString</span> name);
  <span>AttributeDefinition</span> <span title=dom-Document-createAttributeDefinition>createAttributeDefinition</span>(<span>DOMString</span> name);
  <span>Entity</span> <span title=dom-Document-createGeneralEntity>createGeneralEntity</span>(<span>DOMString</span> name);
  <span>Notation</span> <span title=dom-Document-createNotation>createNotation</span>(<span>DOMString</span> name);
};</code></pre>

<div class="note memo">
  <p>Earlier versions of this specification called this WebIDL
  fragment as the <dfn
  id=DocumentXDoctype><code>DocumentXDoctype</code></dfn> interface.
</div>

<p>The <dfn title=dom-Document-createDocumentTypeDefinition><code
id=createDocumentTypeDefinition>createDocumentTypeDefinition(<var>name</var>)</code></dfn>
method <em class=rfc2119>MUST</em> run these steps:

<ol>

  <li>If <var title>name</var> does not match the <code>Name</code>
  production, <span>throw</span> an
  "<code>InvalidCharacterError</code>" exception and terminate these
  steps.

  <li>Return a new <span title=concept-doctype>doctype</span>, with
  <var title>name</var> as its <span
  title=concept-doctype-name>name</span> and with its <span
  title=concept-node-document>node document</span> set to the
  <span>context object</span>.

</ol>

<p>The <dfn title=dom-Document-createElementTypeDefinition><code
id=createDocumentTypeDefinition>createElementTypeDefinition(<var>name</var>)</code></dfn>
method <em class=rfc2119>MUST</em> run these steps:

<ol>

  <li>If <var title>name</var> does not match the <code>Name</code>
  production, <span>throw</span> an
  "<code>InvalidCharacterError</code>" exception and terminate these
  steps.

  <li>Return a new <span title=concept-element-type>element
  type</span>, with <var title>name</var> as its <span
  title=concept-element-type-name>name</span> and with its <span
  title=concept-node-document>node document</span> set to the
  <span>context object</span>.

</ol>

<p>The <dfn title=dom-Document-createAttributeDefinition><code
id=createDocumentTypeDefinition>createAttributeDefinition(<var>name</var>)</code></dfn>
method <em class=rfc2119>MUST</em> run these steps:

<ol>

  <li>If <var title>name</var> does not match the <code>Name</code>
  production, <span>throw</span> an
  "<code>InvalidCharacterError</code>" exception and terminate these
  steps.

  <li>Return a new <span title=concept-attribute-definition>attribute
  definition</span>, with <var title>name</var> as its <span
  title=concept-attribute-definition-name>name</span> and with its
  <span title=concept-node-document>node document</span> set to the
  <span>context object</span>.

</ol>

<p>The <dfn title=dom-Document-createGeneralEntity><code
id=createDocumentTypeDefinition>createGeneralEntity(<var>name</var>)</code></dfn>
method <em class=rfc2119>MUST</em> run these steps:

<ol>

  <li>If <var title>name</var> does not match the <code>Name</code>
  production, <span>throw</span> an
  "<code>InvalidCharacterError</code>" exception and terminate these
  steps.

  <li>Return a new <span title=concept-general-entity>general
  entity</span>, with <var title>name</var> as its <span
  title=concept-entity-name>name</span> and with its <span
  title=concept-node-document>node document</span> set to the
  <span>context object</span>.

</ol>

<p>The <dfn title=dom-Document-createNotation><code
id=createDocumentTypeDefinition>createNotation(<var>name</var>)</code></dfn>
method <em class=rfc2119>MUST</em> run these steps:

<ol>

  <li>If <var title>name</var> does not match the <code>Name</code>
  production, <span>throw</span> an
  "<code>InvalidCharacterError</code>" exception and terminate these
  steps.

  <li>Return a new <span title=concept-notation>notation</span>, with
  <var title>name</var> as its <span
  title=concept-notation-name>name</span> and with its <span
  title=concept-node-document>node document</span> set to the
  <span>context object</span>.

</ol>

<div class="note memo">
<p><var>name</var> does not have to be a namespace qualified name.</p>
</div>

</div>


<div class=section id=section-documenttype>
<h3>Document types</h3>

<p>Each <span title=concept-doctype>doctype</span> has associated
unordered sets of nodes <dfn
title=concept-DocumentType-elementTypes>element types</dfn>, <dfn
title=concept-DocumentType-generalEntities>general entities</dfn>, and
<dfn title=concept-DocumentType-notations>notations</dfn>.  Unless
otherwise specified, they <em class=rfc2119>MUST</em> be empty when
the <span title=concept-doctype>doctype</span> is created.

<p>The set <span title=concept-DocumentType-elementTypes>element
types</span> can only contains <span
title="concept-element-type">element types</span>.

<p>The <dfn title=dom-DocumentType-elementTypes><code
id=elementTypes>elementTypes</code></dfn> attribute of the
<code>DocumentType</code> interface <em class=rfc2119>MUST</em> return
an <code>NamedNodeMap</code> <span
title=concept-collection>collection</span> containing the nodes in the
<span title=concept-DocumentType-elementTypes>element types</span> set
of the <span>context object</span>, sorted by their <code
title=dom-Node-nodeName>nodeName</code>'s code point.

<p>The <span title=concept-DocumentType-generalEntities>general
entities</span> of the <span title=concept-doctype>doctype</span> is
exposed by the <code title=dom-DocumentType-entities>entities</code>
attribute of the <code>DocumentType</code> interface <cite
class="bibref normative">[<a
href="#ref-DOM3CORE">DOM3CORE</a>]</cite>.  The <dfn
title=dom-DocumentType-generalEntities><code
id=generalEntities>generalEntities</code></dfn> attribute of the
<code>DocumentType</code> interface <em class=rfc2119>MUST</em> return
the same object as the <code
title=dom-DocumentType-entities>entities</code> attribute.  The nodes
in the <code title=dom-DocumentType-entities>entities</code> <span
title=concept-collection>collection</span> <em class=rfc2119>MUST</em>
be sorted by their <code title=dom-Node-nodeName>nodeName</code>'s
code point.

<p>The <span title=concept-DocumentType-notations>notations</span> of
the <span title=concept-doctype>doctype</span> is exposed by the <code
title=dom-DocumentType-notations>notations</code> attribute of the
<code>DocumentType</code> interface <cite class="bibref normative">[<a
href="#ref-DOM3CORE">DOM3CORE</a>]</cite>.  The nodes in the <code
title=dom-DocumentType-notations>notations</code> <span
title=concept-collection>collection</span> <em class=rfc2119>MUST</em>
be sorted by their <code title=dom-Node-nodeName>nodeName</code>'s
code point.

<div class=ed>
<p>Need to merge with <code>manakai-allow-doctype-children</code>
configuration parameter spec...

<p>A <a href="#DocumentType"><code>DocumentType</code></a> interface 
<em class=rfc2119>MAY</em> contain zero or more
<code>ProcessingInstruction</code> nodes in the <code>NodeList</code> object 
contained in the <code>childNodes</code> attribute of the 
<a href="#DocumentType"><code>DocumentType</code></a> node.</p>

<p>If the <a href="#DocumentType"><code>DocumentType</code></a> node is created
during the process to create a <abbr>DOM</abbr> from an <abbr>XML</abbr>
document, the <code>NodeList</code> object in the <code>childNodes</code> 
object <em class=rfc2119>MUST</em> contains the 
<code>ProcessingInstruction</code> nodes representing the processing 
instructions in the document type definition of the document processed
<cite class="bibref normative">[<a href="#ref-XML">XML</a>,
<a href="#ref-XML11">XML11</a>]</cite> by the <abbr>XML</abbr> processor.

<p>If a <a href="#DocumentType"><code>DocumentType</code></a> node is created
from a
<a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#infoitem.doctype">document
type declaration information item</a>
<cite class="bibref normative">[<a href="#ref-INFOSET">INFOSET</a>]</cite>,
the <code>NodeList</code> object in the <code>childNodes</code> attribute
of the node <em class=rfc2119>MUST</em> contain the
<code>ProcessingInstruction</code> nodes created from any
<a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#infoitem.pi">processing
instruction information items</a> in the list in the [children] property of the
<a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#infoitem.doctype">document
type declaration item</a> in the same order.</p>

<p>If a <a href="#DocumentType"><code>DocumentType</code></a> node is mapped to
a document type declaration information item, the list in the [children] 
property <em class=rfc2119>MUST</em> contain the processng instruction
information items created from the <code>ProcessingInstruction</code> nodes
in the <code>NodeList</code> object in the <code>childNodes</code> attribute
of the <a href="#DocumentType"><code>DocumentType</code></a> node.</p>
</div>

<pre class=idl id=section-documenttypedefinition><code>partial interface <span>DocumentType</span> {
  [TreatNullAs=EmptyString] attribute <span>DOMString</span> <span title=dom-publicId>publicId</span>;
  [TreatNullAs=EmptyString] attribute <span>DOMString</span> <span title=dom-systemId>systemId</span>;
  attribute <span>DOMString</span>? <span title=dom-DocumentType-declarationBaseURI>declarationBaseURI</span>;
  attribute <span>DOMString</span>? <span title=dom-DocumentType-manakaiDeclarationBaseURI>manakaiDeclarationBaseURI</span>;

  readonly attribute <span>NamedNodeMap</span> <span title=dom-DocumentType-elementTypes>elementTypes</span>;
  readonly attribute <span>NamedNodeMap</span> <span title=dom-DocumentType-generalEntities>generalEntities</span>;

  <a href="#ElementTypeDefinition">ElementTypeDefinition</a> <a href="#getElementTypeDefinitionNode">getElementTypeDefinitionNode</a>
    (in DOMString <a href="#getElementTypeDefinitionNode-name"><var>name</var></a>);
  <a href="#Entity">Entity</a> <a href="#getGeneralEntityNode">getGeneralEntityNode</a>
    (in DOMString <a href="#getGeneralEntityNode-name"><var>name</var></a>);
  <a href="#Notation">Notation</a> <a href="#getNotationNode">getNotationNode</a>
    (in DOMString <a href="#getNotationNode-name"><var>name</var></a>);

  <span>ElementTypeDefinition</span>? <span title=dom-DocumentType-setElementTypeDefinitionNode>setElementTypeDefinitionNode</span>(<span>ElementTypeDefinition</span> node);
  <span>Entity</span>? <span title=dom-DocumentType-setGeneralEntityNode>setGeneralEntityNode</span>(<span>Entity</span> node);
  <span>Notation</span>? <span title=dom-DocumentType-setNotationNode>setNotationNode</span>(<span>Notation</span> node);
  <span>ElementTypeDefinition</span> <span title=dom-DocumentType-removeElementTypeDefinitionNode>removeElementTypeDefinitionNode</span>(<span>ElementTypeDefinition</span> node);
  <span>Entity</span> <span title=dom-DocumentType-removeGeneralEntityNode>removeGeneralEntityNode</span>(<span>Entity</span> node);
  <span>Notation</span> <span title=dom-DocumentType-removeNotationNode>removeNotationNode</span>(<span>Notation</span> node);
};</code></pre>

<div class="note memo">

  <p>Earlier versions of this specification named this WebIDL fragment
  as the <dfn
  id=DocumentTypeDefinition><code>DocumentTypeDefinition</code></dfn>
  interface.

</div>

<div class=ed>
  <p>If the <code>DocumentType</code> node is created during the process
  to create a <abbr>DOM</abbr> from an <abbr>XML</abbr> document, the following
  requirements are applied:  The <code>NamedNodeMap</code> object in the
  <a href="#elementTypes"><code>elementType</code></a> attribute 
  <em class=rfc2119>MUST</em> be so transformed that the object contains
  the <code>ElementTypeDefinition</code> nodes for the element types
  whose name is presented as the <code>Name</code> of the element type or
  attribute definition list declarations processed
  <cite class="bibref normative">[<a href="#ref-XML">XML</a>,
  <a href="#ref-XML11">XML11</a>]</cite> by the <abbr>XML</abbr>
  processor.  If there are more than one element type declarations for an
  element type, then the declarations other than the first one 
  <em class=rfc2119>MUST</em> be ignored for the purpose of constructing the
  <code>NamedNodeMap</code> object.</p>

<p>All entities declared in the document type definition
contained in or referenced from the document entity
might not be exposed through this collection, depending
on the information provided by the XML processor for
the DOM implementation.  In particular, it might not
contain any entity if entity references are expanded
at the parse time.  An implementation [['''MUST NOT''']]
expose an [CODE(DOMi)@en[[[Entity]]]] node whose [CODE(DOMa)@en[[[nodeName]]]]
is equal to the name of one of five predefined general entities in
XML through the collection as the result of parsing of an XML
document that has no error.  Duplicate entity declarations are also discarded.

<p>The attribute [['''MUST''']] return the [CODE(DOMi)@en[[[NamedNodeMap]]]]
object that contains all the [CODE(DOMi)@en[[[Entity]]]] nodes
representing general entities belong to the node.

<p>If the [CODE(DOMi)@en[[[DocumentTypeDefinition]]]] node is
created from an XML document, duplicate notation declarations, if any, in DTD 
[['''MUST NOT''']] result in a node in the [CODE(DOMi)@en[[[NamedNodeMap]]]]
object and only the first declaration [['''MUST''']] be
made available as a [CODE(DOMi)@en[[[Notation]]]] node.

<p>;; This definition is based on one for the 
[CODE(DOMa)@en[[[notations]]]] attribute of the
[CODE(DOMi)@en[[[DocumentType]]]] interface in DOM XML module.
Since duplication is violation to the Validity Constraint,
XML parsers might vary on how notations are notified to
the application.  In particular, [CODE(InfoProp)@en[[[notations]]]]
property of the document information item in XML Information Set
is so defined that in case ''any'' notation is declared for 
multiple times then the property has no value.

<p>The attribute [['''MUST''']] return the [CODE(DOMi)@en[[[NamedNodeMap]]]]
object that contains all the [CODE(DOMi)@en[[[Notation]]]] nodes
representing notations belong to the node.
</div>

<dl>
<dt><dfn id=getElementTypeDefinitionNode class=dom-method><code>getElementTypeDefinitionNode</code></dfn>,
method</dt>
  <dd><p>Returns the
  <a href="#ElementTypeDefinition"><code>ElementTypeDefinition</code></a> node
  with the specified name.</p>

  <p>The
  <dfn id=getElementTypeDefinitionNode-name class=dom-param><var>name</var></dfn>
  parameter is the name of the element type.</p>

  <p>When invoked, the method <em class=rfc2119>MUST</em> return the 
  <a href="#ElementTypeDefinition"><code>ElementTypeDefinition</code></a> node,
  whose <a href="#nodeName"><code>nodeName</code></a> is equal to
  <a href="#getElementTypeDefinitionNode-name"><var>name</var></a>, in the
  <code>NamedNodeMap</code> object in the
  <a href="#elementTypes"><code>elementTypes</code></a> attribute of the
  node.  If there is no such node, it <em class=rfc2119>MUST</em> return
  <code>null</code>.</p></dd>
<dt><dfn id=getGeneralEntityNode class=dom-method><code>getGeneralEntityNode</code></dfn>,
method</dt>
  <dd><p>Returns the <a href="#Entity"><code>Entity</code></a> node
  with the specified name.</p>

  <p>The
  <dfn id=getGeneralEntityNode-name class=dom-param><var>name</var></dfn>
  parameter is the name of the general entity.</p>

  <p>When invoked, the method <em class=rfc2119>MUST</em> return the 
  <a href="#Entity"><code>Entity</code></a> node,
  whose <a href="#nodeName"><code>nodeName</code></a> is equal to
  <a href="#getGeneralEntityNode-name"><var>name</var></a>, in the
  <code>NamedNodeMap</code> object in the
  <a href="#entities"><code>entities</code></a> attribute of the
  node.  If there is no such node, it <em class=rfc2119>MUST</em> return
  <code>null</code>.</p></dd>
<dt><dfn id=getNotationNode class=dom-method><code>getNotationNode</code></dfn>,
method</dt>
  <dd><p>Returns the <a href="#Notation"><code>Notation</code></a> node
  with the specified name.</p>

  <p>The
  <dfn id=getNotationNode-name class=dom-param><var>name</var></dfn>
  parameter is the name of the notation.</p>

  <p>When invoked, the method <em class=rfc2119>MUST</em> return the 
  <a href="#Notation"><code>Notation</code></a> node,
  whose <a href="#nodeName"><code>nodeName</code></a> is equal to
  <a href="#getNotationNode-name"><var>name</var></a>, in the
  <code>NamedNodeMap</code> object in the
  <a href="#notations"><code>notations</code></a> attribute of the
  node.  If there is no such node, it <em class=rfc2119>MUST</em> return
  <code>null</code>.</p></dd>

<dt><dfn title=dom-DocumentType-setElementTypeDefinitionNode
class=dom-method><code
id=setElementTypeDefinitionNode>setElementTypeDefinitionNode</code></dfn>,
method</dt>

<dd>The <code
title=dom-DocumentType-setElementTypeDefinitionNode>setElementTypeDefinitionNode(<var
title>node</var>)</code> method <em class=rfc2119>MUST</em> return the
result of <span title=concept-set-node>setting</span> <var
title>node</var> to the <span>context object</span>'s <span
title=concept-DocumentType-elementTypes>element types</span>.

<dt><dfn title=dom-DocumentType-setGeneralEntityNode
class=dom-method><code
id=setGeneralEntityNode>setGeneralEntityNode</code></dfn>, method</dt>

<dd>The <code
title=dom-DocumentType-setGeneralEntityNode>setGeneralEntityNode(<var
title>node</var>)</code> method <em class=rfc2119>MUST</em> return the
result of <span title=concept-set-node>setting</span> <var
title>node</var> to the <span>context object</span>'s <span
title=concept-DocumentType-generalEntities>general entities</span>.

<dt><dfn title=dom-DocumentType-setNotationNode class=dom-method><code
id=setNotationNode>setNotationNode</code></dfn>, method

<dd>The <code
title=dom-DocumentType-setNotationNode>setNotationNode(<var
title>node</var>)</code> method <em class=rfc2119>MUST</em> return the
result of <span title=concept-set-node>setting</span> <var
title>node</var> to the <span>context object</span>'s <span
title=concept-DocumentType-notations>notations</span>.

<dt><dfn class=dom-method title=dom-DocumentType-removeElementTypeDefinitionNode><code>removeElementTypeDefinitionNode</code></dfn>, method

<dd>The <code
title=dom-DocumentType-removeElementTypeDefinitionNode>removeElementTypeDefinitionNode(<var
title>node</var>)</code> method <em class=rfc2119>MUST</em> return the
result of <span title=concept-remove-node>removing</span> <var
title>node</var> from the <span>context object</span>'s <span
title=concept-DocumentType-elementTypes>element types</span>.

<dt><dfn class=dom-method title=dom-DocumentType-removeGeneralEntityNode><code>removeGeneralEntityNode</code></dfn>, method

<dd>The <code
title=dom-DocumentType-removeGeneralEntityNode>removeGeneralEntityNode(<var
title>node</var>)</code> method <em class=rfc2119>MUST</em> return the
result of <span title=concept-remove-node>removing</span> <var
title>node</var> from the <span>context object</span>'s <span
title=concept-DocumentType-generalEntities>general entities</span>.

<dt><dfn class=dom-method title=dom-DocumentType-removeNotationNode><code>removeNotationNode</code></dfn>, method

<dd>The <code
title=dom-DocumentType-removeNotationNode>removeNotationNode(<var
title>node</var>)</code> method <em class=rfc2119>MUST</em> return the
result of <span title=concept-remove-node>removing</span> <var
title>node</var> from the <span>context object</span>'s <span
title=concept-DocumentType-notations>notations</span>.

</dl>

<p>To <dfn title=concept-remove-node>remove</dfn> a node <var
title>node</var> from the set of nodes <var title>set</var><!--
associated to the node <var title>owner</var>-->, run these steps:

<ol>

  <li>If <var title>set</var> does not contain <var title>node</var>,
  <span>throw</span> an "<code>NotFoundError</code>" exception and
  abort these steps.

  <li>Remove <var title>node</var> from <var title>set</var>.

  <li>Set the <span title=concept-owner>owner</span> of
  <var title>node</var> to <span>null</span>.

  <li>Return <var title>node</var>.
</ol>

<p>To <dfn title=concept-set-node>set</dfn> a node <var
title>node</var> to the set of nodes <var title>set</var> associated
to the node <var title>owner</var>, run these steps:

<ol>

<li>If the <span title=concept-owner>owner</span> of <var
title>node</var> is not <span>null</span> and is not equal to <var
title>owner</var>, <span>throw</span> a
"<code>HierarchyRequestError</code>" and abort these steps.

<li><span title=concept-node-adopt>Adopt</span> <var title>node</var>
into the <span title=concept-node-document>node document</span> of
<var title>owner</var>.

<li>Let <var title>oldNode</var> be <span>null</span>.

<li>If there is a node whose <code
title=dom-Node-nodeName>nodeName</code> is equal to <var
title>node</var>'s <code title=dom-Node-nodeName>nodeName</code> in
<var title>set</var>, let <var title>oldNode</var> be the node and
<span title=concept-remove-node>remove</span> <var title>oldNode</var>
from <var title>set</var>.

<li>Add <var title>node</var> to <var title>set</var>.

<li>Set the <span title=concept-owner>owner</span> of <var
title>node</var> to <var title>owner</var>.

<li>Return <var title>oldNode</var>.

</ol>

</div><!-- section -->

<div class=section id=section-elementtypedefinition>
<h3>Element types</h3>

<p>The <code>ElementTypeDefinition</code> objects are simply known as
<dfn title=concept-element-type>element types</dfn>.  It represents
the definition of the element, identified by the <dfn
title=concept-element-type-name>name</span>.

<div class="note memo">
<p>Although the <span title=concept-element-type>element type</span>
is corresponding to the <code>ELEMENT</code> declaration in the XML
DTD, the <span title=concept-element-type>element type</span> does not
directly represent the <code>ELEMENT</code> declaration.
</div>

<pre class=idl><code>interface <dfn id=ElementTypeDefinition>ElementTypeDefinition</dfn> : <span>Node</span> {
  readonly attribute <span>DocumentType</span>? <span title=dom-ownerDocumentTypeDefinition>ownerDocumentTypeDefinition</span>;

  readonly attribute <span>NamedNodeMap</span> <span title=dom-ElementTypeDefinition-attributeDefinitions>attributeDefinitions</span>;
  <span>AttributeDefinition</span>? <span title=dom-ElementTypeDefinition-getAttributeDefinitionNode>getAttributeDefinitionNode</span>(<span>DOMString</span> name);
  <span>AttributeDefinition</span>? <span title=dom-ElementTypeDefinition-setAttributeDefinitionNode>setAttributeDefinitionNode</span>(<span>AttributeDefinition</span> node);
  <span>AttributeDefinition</span> <span title=dom-ElementTypeDefinition-removeAttributeDefinitionNode>removeAttributeDefinitionNode</span>(<span>AttributeDefinition</span> node);
};</code></pre>

<p>Each <span title=concept-element-type>element type</span> has an
associated unordered set of nodes <dfn
title=concept-elementTypeDefinition-attributeDefinitions>attribute
definitions</dfn>.  Unless otherwise specified, it <em
class=rfc2119>MUST</em> be empty when the <span
title=concept-element-type>element type</span> is created.  The set
<span
title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</span> can only contains <span
title="concept-attribute-definition">attribute definition</span>.

<p>The <dfn title=dom-ElementTypeDefinition-attributeDefinitions><code
id=attributeDefinitions>attributeDefinitions</code></dfn> attribute of
the <code>ElementTypeDefinition</code> interface <em
class=rfc2119>MUST</em> return an <code>NamedNodeMap</code> <span
title=concept-collection>collection</span> containing the nodes in the
<span
title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</span> set of the <span>context object</span>, sorted by
their <code title=dom-Node-nodeName>nodeName</code>'s code point.

<div class=ed>

<p>Even if there are more than one element type declarations for an
element type in <abbr>DTD</abbr>, the result <abbr>DOM</abbr> will
contain only an <a
href="#ElementTypeDefinition"><code>ElementTypeDefinition</code></a>
node for that element type.  In addition, if there are attribute
definition declarations for an element type, even when there is no
element type declaration for that element type, the <abbr>DOM</abbr>
will contain an <a
href="#ElementTypeDefinition"><code>ElementTypeDefinition</code></a>
node for that element type.</p>

  <p>If the
  <a href="#ElementTypeDefinition"><code>ElementTypeDefinition</code></a> node
  is created during the process to create a <abbr>DOM</abbr> from an
  <abbr>XML</abbr> document, the following requirements are applied:  The
  <code>NamedNodeMap</code> object in the 
  <a href="#attributeDefinitions"><code>attributeDefinitions</code></a>
  attribute <em class=rfc2119>MUST</em> be so transformed that the object
  contains the
  <a href="#AttributeDefinition"><code>AttributeDefinition</code></a> node
  corresponding to the attribute definitions in the attribute definition
  list declarations processed
  <cite class="bibref normative">[<a href="#ref-XML">XML</a>,
  <a href="#ref-XML11">XML11</a>]</cite> by the <abbr>XML</abbr> processor and
  associated to the element type represented by the node.  If there are more
  than one attribute definitions for an attribute, then the definitions other
  than the first one <em class=rfc2119>MUST</em> be ignored for the purpose
  of constructing the <code>NamedNodeMap</code> object.</p></dd>
</div>

<dl>
<dt><dfn id=getAttributeDefinitionNode class=dom-method><code>getAttributeDefinitionNode</code></dfn>,
method</dt>
  <dd><p>Return the
  <a href="#AttributeDefinition"><code>AttributeDefinition</code></a> node
  with the specified name.</p>

  <p>The
  <dfn id=getAttributeDefinitionNode-name class=dom-param><var>name</var></dfn>
  parameter is the name of the attribute.</p>

  <p>When invoked, the method <em class=rfc2119>MUST</em> return the
  <a href="#AttributeDefinition"><code>AttributeDefinition</code></a> node,
  whose <a href="#nodeName"><code>nodeName</code></a> attribute value is
  equal to <a href="#getAttributeDefinitionNode-name"><var>name</var></a>,
  in the <code>NamedNodeMap</code> in the 
  <a href="#attributeDefinitions"><code>attributeDefinitions</code></a>
  attribute of the node.  If there is no such node, it 
  <em class=rfc2119>MUST</em> return <code>null</code>.</p></dd>
</dl>

<p>The <dfn
title=dom-ElementTypeDefinition-setAttributeDefinitionNode><code
id=setAttributeDefinitionNode>setAttributeDefinitionNode(<var
title>node</var>)</code></dfn> method of the
<code>ElementTypeDefinition</code> object <em class=rfc2119>MUST</em>
return the result of <span title=concept-set-node>setting</span> <var
title>node</var> to the <span>context object</span>'s <span
title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</span>.

<p>The <dfn
title=dom-ElementTypeDefinition-removeAttributeDefinitionNode><code>removeAttributeDefinitionNode(<var
title>node</var>)</code></dfn> method of the
<code>ElementTypeDefinition</code> object <em class=rfc2119>MUST</em>
return the result of <span title=concept-remove-node>removing</span>
<var title>node</var> from the <span>context object</span>'s <span
title=concept-ElementTypeDefinition-attributeDefinitions>attribute
definitions</span>.

<div class=ed>
<p>A future version of the specification might define a set of attributes
and methods for representing and accessing to the content model of the 
element type.</p>

<pre class=idl><code>partial interface ElementTypeDefinition {
  attribute DOMString? contentModelText;
};</code></pre>
</div>

</div><!-- section -->

<div class=section id=section-attributedefinition>
<h3>Attribute definitions</h3>

<p>The nodes of type <a
href="#ATTRIBUTE_DEFINITION_NODE"><code>ATTRIBUTE_DEFINITION_NODE</code></a>
represents an <dfn title=concept-attribute-definition>attribute
definition</dfn>.  Such a node <em class=rfc2119>MUST</em> implement
the <a
href="#AttributeDefinition"><code>AttributeDefinition</code></a>
interface, which extends the <a href="#Node"><code>Node</code></a>
interface.</p>

<p>Each <span title=concept-attribute-definition>attribute
definition</span> has an associated <dfn
title=concept-attribute-definition-name>name</dfn>.

<p>Each <span title=concept-attribute-definition>attribute
definition</span> has associated <dfn
title=concept-attribute-definition-declared-type>declared type</dfn>,
<dfn title=concept-attribute-definition-allowed-tokens>allowed
tokens</dfn>, <dfn
title=concept-attribute-definition-default-type>default type</dfn>,
and <dfn title=concept-attribute-definition-default-value>default
value</dfn>.  Unless otherwise specified, they are initialized to
their default values when the <span
title=concept-attribute-definition>attribute definition</span> is
created.  Their default values are <code
title=dom-AttributeDefinition-NO_TYPE_ATTR>NO_TYPE_ATTR</code>, the
empty list, <code
title=dom-AttributeDefinition-UNKNOWN_DEFAULT>UNKNOWN_DEFAULT</code>,
and the empty string, respectively.

<p>An attribute definition represents a definition of the attribute 
associated to an element type.  It is corresponding to the attribute definition
in the attribute list declaration in <abbr>DTD</abbr>.  However, an
<a href="#AttributeDefinition"><code>AttributeDefinition</code></a> node does 
not represent the attribute definition in <abbr>DTD</abbr> itself.  Even if 
there are more than one attribute definitions for an attribute of an element 
type in <abbr>DTD</abbr>, the result <abbr>DOM</abbr> will contain only an
<a href="#AttributeDefinition"><code>AttributeDefinition</code></a> node for 
that attribute.</p>

<pre class=idl><code>interface <dfn id=AttributeDefinition>AttributeDefinition</dfn> : <a href="#Node">Node</a> {
  <span class=comment>// <dfn id=DefaultValueType>DefaultValueType</dfn>
  const unsigned short <a href="#UNKNOWN_DEFAULT">UNKNOWN_DEFAULT</a> = 0;
  const unsigned short <a href="#FIXED_DEFAULT">FIXED_DEFAULT</a> = 1;
  const unsigned short <a href="#REQUIRED_DEFAULT">REQUIRED_DEFAULT</a> = 2;
  const unsigned short <a href="#IMPLIED_DEFAULT">IMPLIED_DEFAULT</a> = 3;
  const unsigned short <a href="#EXPLICIT_DEFAULT">EXPLICIT_DEFAULT</a> = 4;

  readonly attribute <span>ElementTypeDefinition</span>? <span title=dom-ownerElementTypeDefinition>ownerElementTypeDefinition</span>;
  attribute unsigned short <a href="#declaredType">declaredType</a>;
  attribute <span>DOMString</span>[] <a href="#allowedTokens">allowedTokens</a>;
  attribute unsigned short <a href="#defaultType">defaultType</a>;
};

[NoInterfaceObject]
interface <dfn>AttrDeclaredValueType</dfn> {
  <span class=comment>// <dfn id=DeclaredValueType>DeclaredValueType</dfn>
  const unsigned short <a href="#NO_TYPE_ATTR">NO_TYPE_ATTR</a> = 0;
  const unsigned short <a href="#CDATA_ATTR">CDATA_ATTR</a> = 1;
  const unsigned short <a href="#ID_ATTR">ID_ATTR</a> = 2;
  const unsigned short <a href="#IDREF_ATTR">IDREF_ATTR</a> = 3;
  const unsigned short <a href="#IDREFS_ATTR">IDREFS_ATTR</a> = 4;
  const unsigned short <a href="#ENTITY_ATTR">ENTITY_ATTR</a> = 5;
  const unsigned short <a href="#ENTITIES_ATTR">ENTITIES_ATTR</a> = 6;
  const unsigned short <a href="#NMTOKEN_ATTR">NMTOKEN_ATTR</a> = 7;
  const unsigned short <a href="#NMTOKENS_ATTR">NMTOKENS_ATTR</a> = 8;
  const unsigned short <a href="#NOTATION_ATTR">NOTATION_ATTR</a> = 9;
  const unsigned short <a href="#ENUMERATION_ATTR">ENUMERATION_ATTR</a> = 10;
  const unsigned short <a href="#UNKNOWN_ATTR">UNKNOWN_ATTR</a> = 11;
};
<span>AttributeDefinition</span> implements <span>AttrDeclaredValueType</span>;
<span>Attr</span> implements <span>AttrDeclaredValueType</span>;
</code></pre>

<dl>
<dt><dfn id=declaredType class=dom-attr><code>declaredType</code></dfn> of type
<code>unsigned short</code></dt>
  <dd><p>The declared type
  <cite class="bibref normative">[<a href="#ref-XML">XML</a>,
  <a href="#ref-XML11">XML11</a>]</cite> of the attribute.  It is expected that
  this attribute contains a value from the definition group
  <a href="#DeclaredValueType"><code>DeclaredValueType</code></a>.</p>

  <p>On getting, the attribute <em class=rfc2119>MUST</em> return the
  value associated to this attribute.</p>

  <p>On setting, it <em class=rfc2119>MUST</em> set the specified
  value as the value associated to this attribute.</p>

  <p>If the <code>AttributeDefinition</code> node is created during the process
  to create a <abbr>DOM</abbr> from an <abbr>XML</abbr> document, an
  appropriate value from the
  <a href="#DeclaredValueType"><code>DeclaredValueType</code></a> constant
  group <em class=rfc2119>MUST</em> be set to the attribute.</p>

  <!-- DeclaredValueType -->
<p>The definition group 
<dfn id=DeclaredValueType><code>DeclaredValueType</code></dfn> contains
integers indicating the declared type of attributes.  The definition
group contains the following constants:</p>

<table>
<thead>
<tr><th scope=col>Name<th scope=col>Value<th scope=col>Description</tr>
</thead>
<tbody>
<tr>
<th scope=row><dfn id=NO_TYPE_ATTR class=dom-const><code>NO_TYPE_ATTR</code>
<td><code>0</code><td><a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#intro.null">No
value</a>
<cite class="bibref normative">[<a href="#ref-INFOSET">INFOSET</a>]</cite>.</tr>
<tr>
<th scope=row><dfn id=CDATA_ATTR class=dom-const><code>CDATA_ATTR</code>
<td><code>1</code><td><code>CDATA</code>
<cite class="bibref normative">[<a href="#ref-XML">XML</a>,
<a href="#ref-XML11">XML11</a>]</cite>.</tr>
<tr>
<th scope=row><dfn id=ID_ATTR class=dom-const><code>ID_ATTR</code>
<td><code>2</code><td><code>ID</code>
<cite class="bibref normative">[<a href="#ref-XML">XML</a>,
<a href="#ref-XML11">XML11</a>]</cite>.</tr>
<tr>
<th scope=row><dfn id=IDREF_ATTR class=dom-const><code>IDREF_ATTR</code>
<td><code>3</code><td><code>IDREF</code>
<cite class="bibref normative">[<a href="#ref-XML">XML</a>,
<a href="#ref-XML11">XML11</a>]</cite>.</tr>
<tr>
<th scope=row><dfn id=IDREFS_ATTR class=dom-const><code>IDREFS_ATTR</code>
<td><code>4</code><td><code>IDREFS</code>
<cite class="bibref normative">[<a href="#ref-XML">XML</a>,
<a href="#ref-XML11">XML11</a>]</cite>.</tr>
<tr>
<th scope=row><dfn id=ENTITY_ATTR class=dom-const><code>ENTITY_ATTR</code>
<td><code>5</code><td><code>ENTITY</code>
<cite class="bibref normative">[<a href="#ref-XML">XML</a>,
<a href="#ref-XML11">XML11</a>]</cite>.</tr>
<tr>
<th scope=row><dfn id=ENTITIES_ATTR class=dom-const><code>ENTITIES_ATTR</code>
<td><code>6</code><td><code>ENTITIES</code>
<cite class="bibref normative">[<a href="#ref-XML">XML</a>,
<a href="#ref-XML11">XML11</a>]</cite>.</tr>
<tr>
<th scope=row><dfn id=NMTOKEN_ATTR class=dom-const><code>NMTOKEN_ATTR</code>
<td><code>7</code><td><code>NMTOKEN</code>
<cite class="bibref normative">[<a href="#ref-XML">XML</a>,
<a href="#ref-XML11">XML11</a>]</cite>.</tr>
<tr>
<th scope=row><dfn id=NMTOKENS_ATTR class=dom-const><code>NMTOKENS_ATTR</code>
<td><code>8</code><td><code>NMTOKENS</code>
<cite class="bibref normative">[<a href="#ref-XML">XML</a>,
<a href="#ref-XML11">XML11</a>]</cite>.</tr>
<tr>
<th scope=row><dfn id=NOTATION_ATTR class=dom-const><code>NOTATION_ATTR</code>
<td><code>9</code><td><code>NOTATION</code>
<cite class="bibref normative">[<a href="#ref-XML">XML</a>,
<a href="#ref-XML11">XML11</a>]</cite>.</tr>
<tr>
<th scope=row><dfn id=ENUMERATION_ATTR class=dom-const><code>ENUMERATION_ATTR</code>
<td><code>10</code><td>Enumeration
<cite class="bibref normative">[<a href="#ref-XML">XML</a>,
<a href="#ref-XML11">XML11</a>]</cite>.</tr>
<tr>
<th scope=row><dfn id=UNKNOWN_ATTR class=dom-const><code>UNKNOWN_ATTR</code>
<td><code>11</code><td><a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#intro.null">Unknown</a>,
because no declaration for the attribute has been read but the 
<a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#infoitem.document">[all declarations processed]</a>
property
<cite class="bibref normative">[<a href="#ref-INFOSET">INFOSET</a>]</cite>
would be false.</tr>
</tbody>
</table>

<p>If no attribute type information is available, or if the source
of the information does not distinguish 
<a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#intro.null">no
value</a> and
<a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#intro.null">unknown</a>
<cite class="bibref normative">[<a href="#ref-INFOSET">INFOSET</a>]</cite>, 
then the value
<a href="#NO_TYPE_ATTR"><code>NO_TYPE_ATTR</code></a> 
<em class=rfc2119>MUST</em> be used.</p>

<div class="note memo">
<p>An <a href="#AttributeDefinition"><code>AttributeDefinition</code></a> node
created by the 
<a href="#createAttributeDefinition"><code>createAttributeDefinition</code></a>
method has its <a href="#declaredType"><code>declaredType</code></a> attribute
set to <a href="#NO_TYPE_ATTR"><code>NO_TYPE_ATTR</code></a>.</p>
</div>

<p>If the source of the information does not distinguish
<a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#intro.null">no
value</a> and/or
<a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/#intro.null">unknown</a>
<cite class="bibref normative">[<a href="#ref-INFOSET">INFOSET</a>]</cite> and
<code>CDATA</code>
<cite class="bibref normative">[<a href="#ref-XML">XML</a>,
<a href="#ref-XML11">XML11</a>]</cite>, then the value
<a href="#CDATA_ATTR"><code>CDATA_ATTR</code></a> <em class=rfc2119>MUST</em>
be used.</p>

<p>In Perl binding
<cite class="bibref normative">[<a href="#ref-DOMPERL">DOMPERL</a>]</cite>, the
<code>Attr</code> nodes <em class=rfc2119>MUST</em> implement the
<a href="#DeclaredValueType"><code>DeclaredValueType</code></a>
definition group.</p>

  </dd>
<dt><dfn id=allowedTokens class=dom-attr><code>allowedTokens</code></dfn> of
type <code>DOMString</code>[]</dt>
  <dd><p>The list of allowed attribute values.</p>

  <p>On getting, the attribute <em class=rfc2119>MUST</em> return the
  <code>DOMStringList</code> object associated to this attribute.  The object
  <em class=rfc2119>MAY</em> contain zero or more ordered strings, consist of
  zero or more characters respectively, possibly with duplications.

  <p>If the <a href="#AttributeDefinition"><code>AttributeDefinition</code></a>
  node is created during the process to create a <abbr>DOM</abbr> from an 
  <abbr>XML</abbr> document, the object <em class=rfc2119>MUST</em> contain
  the names or name tokens allowed for the attribute defined by the node.
  If the document is well-formed, the object will be empty unless 
  the <a href="#declaredType"><code>declaredType</code></a> is 
  <a href="#ENUMERATION_ATTR"><code>ENUMERATION_ATTR</code></a> or
  <a href="#NOTATION_ATTR"><code>NOTATION_ATTR</code></a>.</p>

  <p>If the <a href="#declaredType"><code>declaredType</code></a> is different
  from <a href="#ENUMERATION_ATTR"><code>ENUMERATION_ATTR</code></a> or
  <a href="#NOTATION_ATTR"><code>NOTATION_ATTR</code></a>, this attribute
  <em class=rfc2119>MUST</em> be ignored for the purpose of serializing
  into (part of) <abbr>XML</abbr> document.</p>

  <div class="note memo">
    <p>When serializing the node it should be noted that the object might
    be empty, might contain duplications, and might contain strings that are
    not names or name tokens.</p>
  </div></dd>
<dt><dfn id=defaultType class=dom-attr><code>defaultType</code></dfn> of
type <code>unsigned short</code></dt>
  <dd><p>The type of the default for the attribute.  It is expected that this 
  attribute contains a value from the definition group
  <a href="#DefaultValueType"><code>DefaultValueType</code></a>.</p>

  <p>On getting, the attribute <em class=rfc2119>MUST</em> return
  the value associated to this attribute.</p>

  <p>On setting, it <em class=rfc2119>MUST</em> set the specified
  value as the value associated to this attribute.</p>

  <p>If the 
  <a href="#AttributeDefinition"><code>AttributeDefinition</code></a> node is
  created during the process to create a <abbr>DOM</abbr> from an
  <abbr>XML</abbr> document, an appropriate value from the
  <a href="#DefaultValueType"><code>DefaultValueType</code></a> definition
  group <em class=rfc2119>MUST</em> be set to the attribute.</p>

  <!-- DefaultValueType -->
  <p>The definition group
  <dfn id=DefaultValueType><code>DefaultValueType</code></dfn>
  contains integers indicating the type of the default for the attribute.
  The definition group contains the following constants:</p>

  <table>
  <thead>
  <tr><th scope=col>Name<th scope=col>Value<th scope=col>Description</tr>
  </thead>
  <tbody>
  <tr>
  <th scope=row><dfn id=UNKNOWN_DEFAULT class=dom-const><code>UNKNOWN_DEFAULT</code></dfn>
  <td><code>0</code><td>Unknown.</tr>
  <tr>
  <th scope=row><dfn id=FIXED_DEFAULT class=dom-const><code>FIXED_DEFAULT</code></dfn>
  <td><code>1</code><td>Provided explicitly and only the value is allowed.
  <cite class="bibref normative">[<a href="#ref-XML">XML</a>,
  <a href="#ref-XML11">XML11</a>]</cite>.</tr>
  <tr>
  <th scope=row><dfn id=REQUIRED_DEFAULT class=dom-const><code>REQUIRED_DEFAULT</code></dfn>
  <td><code>2</code><td>No default value and the attribute have to be
  explicitly specified.</tr>
  <tr>
  <th scope=row><dfn id=IMPLIED_DEFAULT class=dom-const><code>IMPLIED_DEFAULT</code></dfn>
  <td><code>3</code><td>Implied
  <cite class="bibref normative">[<a href="#ref-XML">XML</a>,
  <a href="#ref-XML11">XML11</a>]</cite>.</tr>
  <tr>
  <th scope=row><dfn id=EXPLICIT_DEFAULT class=dom-const><code>EXPLICIT_DEFAULT</code></dfn>
  <td><code>4</code><td>Provided explicitly.</tr>
  </tbody>
  </table>

  <p>If the source of the default type does not distinguish
  implied and unknown default types, then the value
  <a href="#IMPLIED_DEFAULT"><code>IMPLIED_DEFAULT</code></a>
  <em class=rfc2119>MUST</em> be used.</p>

  <div class="note memo">
  <p>An <a href="#AttributeDefinition"><code>AttributeDefinition</code></a>
  node created by the
  <a href="#createAttributeDefinition"><code>createAttributeDefinition</code></a>
  method has its <a href="#defaultType"><code>defaultType</code></a>
  attribute set to
  <a href="#UNKNOWN_DEFAULT"><code>UNKNOWN_DEFAULT</code></a>.</p>
  </div></dd>
</dl>

</div>

<div class=section id=section-entity>
<h3>General entities</h3>

<p>The <code>Entity</code> node is known as <dfn
title=concept-general-entity>general entity</dfn>, or when not
ambiguous, simply <dfn title=concept-entity>entity</dfn>.

<p>Each <span title=concept-entity>entity</span> has an associated
<dfn title=concept-entity-publicid>public ID</dfn> and <dfn
title=concept-entity-systemid>system ID</dfn>.  Unless otherwise
specified, their values are the empty string when the <span
title=concept-entity>entity</span> is created.

<pre class=idl><code>partial interface <span>Entity</span> {
  readonly attribute <span>DocumentType</span>? <span title=dom-ownerDocumentTypeDefinition>ownerDocumentTypeDefinition</span>;

  [TreatNullAs=EmptyString] attribute DOMString <span title=dom-publicId>publicId</span>;
  [TreatNullAs=EmptyString] attribute DOMString <span title=dom-systemId>systemId</span>;
  attribute <span>DOMString</span>? <span title=dom-declarationBaseURI>declarationBaseURI</span>;
  attribute <span>DOMString</span>? <span title=dom-manakaiDeclarationBaseURI>manakaiDeclarationBaseURI</span>;
  attribute <span>DOMString</span>? <span title=dom-Entity-notationName>notationName</span>;
  readonly attribute <span>DOMString</span> <span title=dom-Entity-hasReplacementTree>hasReplacementTree</span>;
  attribute <span>DOMString</span>? <span title=dom-Entity-manakaiEntityURI>manakaiEntityURI</span>;
  attribute <span>DOMString</span>? <span title=dom-manakaiEntityBaseURI>manakaiEntityBaseURI</span>;
  attribute boolean <a href="#isExternallyDeclared">isExternallyDeclared</a>;
};</code></pre>

<p>Each <span title=concept-entity>entity</span> has an associated
<dfn title=concept-entity-notation-name>notation name</dfn>.  Unless
otherwise specified, it is <span>null</span> when the <span
title=concept-entity>entity</span> is created.

<p>The <code title=dom-Entity-notationName>notationName</code>
attribute returns the <span
title=concept-entity-notation-name>notation name</span> of the
<span>context object</span>.<!-- Normatively defined in DOM3CORE -->

<p>On setting, the <code
title=dom-Entity-notationName>notationName</code> attribute of the
<code>Entity</code> interface <em class=rfc2119>MUST</em> set the
<span title=concept-entity-notation-name>notation name</span> of the
<span>context object</span> to the new value.

<div class="note memo">
<p>In DOM3 Core specification, this attribute was read-only.
</div>

<div class="note memo">
<p>Setting an invalid name to this attribute would make the node
unserializable in the XML syntax.
</div>

<p>Each <span title=concept-entity>entity</span> has an associated
<dfn title=concept-entity-replacement-text>replacement text</dfn>.
Unless otherwise specified, the <span
title=concept-entity-replacement-text>replacement text</span> is the
empty string when an <span title=concept-entity>entity</span> is
created.

<dl>
<dt><dfn id=isExternallyDeclared class=dom-attr><code>isExternallyDeclared</code></dfn>
of type <code>boolean</code></dt>
  <dd><p>Whether the entity is declared by an external entity declaration or 
  not.  If the value is <code>true</code>, the entity is declared in an entity
  declaration in the external subset entity or in an external parameter entity.
  If the value is <code>false</code>, the entity is declared in an entity
  declaration in the internal subset, or the node is created in memory.</p>

  <p>On getting, the attribute <em class=rfc2119>MUST</em> return
  the value associated to this attribute.</p>

  <p>On setting, it <em class=rfc2119>MUST</em> set the specified
  value as the value associated to this attribute.</p>

  <p>If the <a href="#Entity"><code>Entity</code></a> node is created during
  the process to create a <abbr>DOM</abbr> from an <abbr>XML</abbr> document,
  the following requirements are applied:  If the entity is an unparsed
  entity, then the attribute <em class=rfc2119>MUST</em> be set to 
  <code>false</code>.  Otherwise, i.e. the entity is a parsed entity, then the
  attribute <em class=rfc2119>MUST</em> be set to the value of whether the
  entity is declared by an external markup declaration or not.</p></dd>
</dl>

<hr>

<p>A <span title=concept-entity>entity</span> has associated <dfn
title=concept-entity-url>entity URL</dfn> and <dfn
title=concept-entity-base-url>entity base URL</dfn>.  Unless otherwise
specified, their values are <span>null</span>.

<p>On getting, the <dfn
title=dom-Entity-manakaiEntityURI><code>manakaiEntityURI</code></dfn>
attribute of the <code>Entity</code> interface <em
class=rfc2119>MUST</em> run these steps:

<ol>

<li>If the <span title=concept-entity-url>entity URL</span> of the
<span>context object</span> is not <span>null</span>, return it and
abort these steps.

<li>Otherwise, if the <span title=concept-entity-systemid>system
ID</span> of the <span>context object</span> is not the empty string,
<span title="resolve a URL">resolve</span> it relative to the <span
title=concept-effective-declaration-base-url>effective declaration
base URL</span> of the <span>context object</span>.  If it succeeded,
return the result and abort these steps.

<li>Return <span>null</span>.

</ol>

<p>On setting, the attribute <em class=rfc2119>MUST</em> run these
steps:

<ol>

<li>If the new value is <span>null</span>, set the <span
title=concept-entity-url>entity URL</span> of the <span>context
object</span> to <span>null</span> and abort these steps.

<li><span title="resolve a URL">Resolve</span> the new value relative
to the <span title=concept-effective-declaration-base-url>effective
declaration base URL</span> of the <span>context object</span>.  Set
the <span title=concept-entity-url>entity URL</span> of the
<span>context object</span> to the result if succeeded, or
<span>null</span> otherwise.

</ol>

<div class="note memo">

<p>It is expected that an <span>XML Parser</span> supporting this
specification set the <span title=concept-entity-url>entity URL</span>
when an external entity is read.

</div>

</div><!-- section -->

<div class=section id=section-notation>
<h3>Notations</h3>

<p>The <code>Notation</code> node is simply known as <dfn
title=concept-notation>notation</span>.

<p>Each <span title=concept-notation>notation</span> has an associated
<dfn title=concept-notation-publicid>public ID</dfn> and <dfn
title=concept-notation-systemid>system ID</dfn>.  Unless otherwise
specified, their values are the empty string when the <span
title=concept-notation>notation</span> is created.

<pre class=idl><code>partial interface <span>Notation</span> {
  readonly attribute <span>DocumentType</span>? <span title=dom-ownerDocumentTypeDefinition>ownerDocumentTypeDefinition</span>;
  [TreatNullAs=EmptyString] attribute DOMString <span title=dom-publicId>publicId</span>;
  [TreatNullAs=EmptyString] attribute DOMString <span title=dom-systemId>systemId</span>;
  attribute <span>DOMString</span>? <span title=dom-declarationBaseURI>declarationBaseURI</span>;
  attribute <span>DOMString</span>? <span title=dom-manakaiDeclarationBaseURI>manakaiDeclarationBaseURI</span>;
};</code></pre>

</div><!-- section -->

</div><!-- section -->

<div class=section>
<h2>Base URLs</h2>

<p>To determine the <span title=concept-node-base-url>base URL</span>
of a <span title=concept-node>node</span> <var title>node</var>, these
steps <em class=rfc2119>MUST</em> be followed:

<ol>

<li>If <var title>node</var> is a <code>Document</code>, return
<span>document base URL</span> of <var title>node</var> and abort
these steps.

<li>If <var title>node</var> is the <code>base</code> attribute in the
<span>XML namespace</span>:

  <dl class=switch>

  <dt>If the <span title=concept-attribute-owner-element>owner
  element</span> of <var title>node</var> is <span>null</span> <dt>If
  the <span title=concept-tree-parent>parent</span> of the <span
  title=concept-attribute-owner-element>owner element</span> of <var
  title>node</var> is <span>null</span>

  <dd>Return the <span title=concept-node-base-url>base URL</span> of
  the <span title=concept-node-document>node document</span> of <var
  title>node</var> and abort these steps.

  <dt>Otherwise

  <dd>Return the <span title=concept-node-base-url>base URL</span> of
  the <span title=concept-tree-parent>parent</span> of the <span
  title=concept-attribute-owner-element>owner element</span> of <var
  title>node</var> and abort these steps.
  
  </dl>

<li>Otherwise, if <var title>node</var> is an <span
title=concept-attribute>attribute</span>:

  <dl class=switch>

  <dt>If the <span title=concept-attribute-owner-element>owner
  element</span> of <var title>node</var> is <span>null</span>

  <dd>Return the <span title=concept-node-base-url>base URL</span> of
  the <span title=concept-node-document>node document</span> of <var
  title>node</var> and abort these steps.

  <dt>Otherwise

  <dd>Return the <span title=concept-node-base-url>base URL</span> of
  the <span title=concept-attribute-owner-element>owner element</span>
  of <var title>node</var> and abort these steps.
  
  </dl>

<li>If <var title>node</var> is an <span
title=concept-element>element</span> and it has the <code>base</code>
attribute in the <span title>XML namespace</span>, <span
title="resolve a URL">resolve</span> the <span
title=concept-attribute-value>value</span> of the <span
title=concept-attribute>attribute</span> relative to the <span
title=concept-node-base-url>base URL</span> of the <span
title=concept-attribute>attribute</span>.  If it succeeded, return the
result and abort these steps.

<li>If the <span title=concept-tree-parent>parent</span> of <var
title>node</var> is not <span>null</span>, return the <span
title=concept-node-base-url>base URL</span> of the <span
title=concept-tree-parent>parent</span> and abort these steps.

<li><!-- If <var title>node</var> is not <span>in a document</span>,
r-->Return the <span title=concept-node-base-url>base URL</span> of
the <span title=concept-node-document>node document</span> of <var
title>node</var> and abort these steps.

</ol>

<div class="note memo">

<p>These steps ignore external entity boundary, which is a
<span>willful violation</span> to the <cite>XML Base</cite>
specification <cite class="bibref informative">[<a
href="#ref-XMLBASE">XMLBASE</a>]</cite>.

</div>

<hr>

<p>On getting, the <dfn
title=dom-DocumentType-declarationBaseURI><code>declarationBaseURI</code></dfn>
and <dfn
title=dom-DocumentType-manakaiDeclarationBaseURI><code>manakaiDeclarationBaseURI</code></dfn>
attributes of the <code>DocumentType</code> interface <em
class=rfc2119>MUST</em> return the <span
title=concept-node-base-url>base URL</span> of the <span>context
object</span>.  On setting, they <em class=rfc2119>MUST</em> do
nothing.

<p>Each <span title=concept-entity>entity</span> or <span
title=concept-notation>notation</span> has an associated <dfn
title=concept-declaration-base-url>declaration base URL</dfn>.  Its
default value is <span>null</span>.

<p>On getting, the <dfn
title=dom-declarationBaseURI><code>declarationBaseURI</code></dfn> and
<dfn
title=dom-manakaiDeclarationBaseURI><code>manakaiDeclarationBaseURI</code></dfn>
attributes of the <code>Entity</code> or <code>Notation</code>
interface <em class=rfc2119>MUST</em> return <dfn
title=concept-effective-declaration-base-url>effective declaration
base URL</dfn>, i.e. the <span
title=concept-declaration-base-url>declaration base URL</span> of the
<span>context object</span> if it is not <span>null</span>, or the
<span title=concept-node-base-url>base URL</span> of the <span>context
object</span> otherwise.

<p>On setting, they <em class=rfc2119>MUST</em> run these steps:

<ol>

<li>If the new value is <span>null</span>, set the <span
title=concept-declaration-base-url>declaration base URL</span> of the
<span>context object</span> to <span>null</span> and abort these
steps.

<li>Otherwise, <span title="resolve a URL">resolve</span> the new
value relative to the <span title=concept-node-base-url>base
URL</span> of the <span>context object</span>.  Set the <span
title=concept-declaration-base-url>declaration base URL</span> of the
<span>context object</span> to the result, if it succeeded, or
<span>null</span>, otherwise.

</ol>

<hr>

<pre class=idl><code>partial interface <span>Document</span> {
  attribute <span>DOMString</span>? <span title=dom-manakaiEntityBaseURI>manakaiEntityBaseURI</span>;
};</code></pre>

<p>The <span title=concept-document>document</span>, like <span
title=concept-entity>entities</span>, has the <span
title=concept-entity-base-url>entity base URL</span>, initially
<span>null</span>.

<p>On getting, the <dfn
title=dom-manakaiEntityBaseURI><code>manakaiEntityBaseURI</code></dfn>
attribute of the <code>Document</code> or <code>Entity</code>
interface <em class=rfc2119>MUST</em> run these steps:

<ol>

<li>If the <span title=concept-entity-base-url>entity base URL</span>
of the <span>context object</span> is not <span>null</span>, return it
and abort these steps.

<li>Otherwise, if the <span>context object</span> is
<code>Entity</code>, return the <code
title=dom-Entity-manakaiEntityURI>manakaiEntityURI</code> attribute
value of the <span>context object</span> if it is not
<span>null</span>.

<li>Otherwise, return the <span title=concept-node-base-url>base
URL</span> of the <span>context object</span>.

</ol>

<p>On setting, the attribute <em class=rfc2119>MUST</em> run these
steps:

<ol>

<li>If the new value is <span>null</span>, set the <span
title=concept-entity-base-url>entity base URL</span> of the
<span>context object</span> to <span>null</span> and abort these
steps.

<li><span title="resolve a URL">Resolve</span> the new value relative
to the <code title=dom-Entity-manakaiEntityURI>manakaiEntityURI</code>
attribute value, if the <span>context object</span> is an
<code>Entity</code> and it it not <span>null</span>, or the <span
title=concept-node-base-url>base URL</span> otherwise, of the
<span>context object</span>.  Set the <span
title=concept-entity-base-url>entity base URL</span> of the
<span>context object</span> to the result if succeeded, or
<span>null</span> otherwise.

</ol>

<div class="note memo">

<p>It is expected that an <span>XML Parser</span> supporting this
specification set the <span title=concept-entity-base-url>entity base
URL</span> when a document or external entity is read.  If the entity
is retrieved using HTTP, the <code>Content-Base:</code> and
<code>Content-Location:</code> header fields might affect the value.
Note also that they does not affect the value of the <span>document
base URL</span> of the <span title=concept-document>document</span>.

</div>


</div><!-- section -->


<div class=section>
<h2>XML namespaces</h2>

<p class=section-info>This section is <em>non-normative</em>.

<p>This section describes how to implement namespace fixup.</p>

<div class=section>
<h3>Namespace mappings</h3>

<p class=section-info>This section is <em>non-normative</em>.

<p>A <dfn title=concept-nsmap>namespace mapping</dfn> is a data
structure with the following fields:

<dl>

<dt><dfn title=concept-nsmap-default>Default namespace</dfn>

<dd>Either a namespace URL, <i>null</i>, or <i>missing</i>.  By
default, its value is <i>missing</i>.

<dt><dfn title=concept-nsmap-prefix-to-url>Prefix to URL</dfn>

<dd>An ordered list of key/value pairs, where keys are namespace
prefixes and values are namespace URLs or <i>none</i>.  By default,
the set contains two pairs: (<code>xml</code>, the <span>XML
namespace</span>) and (<code>xmlns</code>, the <span>XMLNS
namespace</span>).

</dl>

<div class="note memo">

<p>There will be at most one pair with same key in the <span
title=concept-nsmap-prefix-to-url>prefix to URL</span> list.  However,
there might be more than one pairs with same value in the list.

</div>

<p>A <dfn title=concept-default-namespace-declaration>default
namespace declaration</dfn> with namespace URL <var title>url</var> is
an <span title=concept-attribute>attribute</span> whose <span
title=concept-attribute-namespace>namespace</span> is the <span>XMLNS
namespace</span>, <span title=concept-attribute-local-name>local
name</span> is <code>xmlns</code>, and <span
title=concept-attribute-value>value</span> is <var title>url</var>.

<p>A <dfn title=concept-namespace-prefix-declaration>namespace prefix
declaration</dfn> with prefix <var title>prefix</var> and namespace
URL <var title>url</var> is an <span
title=concept-attribute>attribute</span> whose <span
title=concept-attribute-namespace>namespace</span> is the <span>XMLNS
namespace</span>, <span
title=concept-attribute-namespace-prefix>namespace prefix</span> is
<code>xmlns</code>, <span title=concept-attribute-local-name>local
name</span> is <var title>prefix</var>, and <span
title=concept-attribute-value>value</span> is <var title>url</var>.

</div>

<div class=section>
<h3>Namespace fixup of an XML element for serialization</h3>

<p class=section-info>This section is <em>non-normative</em>.

<p>The <dfn>steps for namespace fixup of an XML element for
serialization</dfn>, with an <span
title=concept-element>element</span> <var title>element</var> and
optional <span title=concept-nsmap>namespace mapping</span> <var
title>nsmap</var>, are as follows:

<ol>

<li>If <var title>nsmap</var> is not specified, let <var
title>nsmap</var> be a new <span title=concept-nsmap>namespace
mapping</span>.

<li>Otherwise, let <var title>nsmap</var> be a deep clone of <var
title>nsmap</var>.

<li>Let <var title>attributes</var> be the list containing the <span
title=concept-attribute>attributes</span> in the <span
title=concept-element-attribute>attribute list</span> of <var
title>element</var> in same order.

<li>For each <span title=concept-attribute>attribute</span> <var
title>attr</var> in <var title>attributes</var>, in order:

  <ol>

  <li>If the <span title=concept-attribute-namespace>namespace</span>
  of <var title>attr</var> is not the <span>XMLNS namespace</span>,
  skip the rest of these substeps and continue with any next <span
  title=concept-attribute>attribute</span>.

  <li>Let <var title>local name</var> be the <span
  title=concept-attribute-local-name>local name</span> of <var
  title>attr</var>.

  <li>Let <var title>value</var> be the <span
  title=concept-attribute-value>value</span> of <var title>attr</var>.

  <li>If <var title>local name</var> is <code>xml</code>, or if <var
  title>value</var> is the <span>XML namespace</span> or the
  <span>XMLNS namespace</span>, do nothing.

  <li>Otherwise, if <var title>local name</var> is <code>xmlns</code>:

    <ol>

    <li>If <var title>value</var> is the empty string, set the <span
    title=concept-nsmap-default>default namespace</span> of <var
    title>nsmap</var> to <i>null</i>.

    <li>Otherwise, set the <span title=concept-nsmap-default>default
    namespace</span> of <var title>nsmap</var> to <var
    title>value</var>.

    </ol>

  <li>Otherwise:

    <ol>

    <li>Delete the key/value pair whose key is equal to <var
    title>local name</var>, if any, from the <span
    title=concept-nsmap-prefix-to-url>prefix to URL</span> list of
    <var title>nsmap</var>.

    <li>If <var title>value</var> is the empty string, append
    key/value pair (<var title>local name</var>,
    <i>none</i>) to the <span title=concept-nsmap-prefix-to-url>prefix
    to URL</span> list of <var title>nsmap</var>.

    <li>Otherwise, append key/value pair (<var title>local name</var>,
    <var title>value</var>) to the <span
    title=concept-nsmap-prefix-to-url>prefix to URL</span> list of
    <var title>nsmap</var>.

    </ol>

  </ol>

<li>Let <var title>tag name</var> and <var title>new attr</var> be the
values returned by the <span>steps to obtain a QName</span> with the
<span title=concept-element-namespace>namespace</span>, <span
title=concept-element-namespace-prefix>namespace prefix</span>, and
<span title=concept-element-local-name>local name</span> of <var
title>element</var>, <var title>attributes</var>, and <var
title>nsmap</var> and with the <var title>is element</var> flag.

<li>If <var title>new attr</var> is not null, prepend it to <var
title>attributes</var>.

<li>Let <var title>attribute specifications</var> be the empty list.

<li>For each <span title=concept-attribute>attribute</span> <var
title>attr</var> in <var title>attributes</var>, in order:

  <ol>

  <li>Let <var title>attr name</var> and <var title>new attr</var> be
  the values returned by the <span>steps to obtain a QName</span> with
  the <span title=concept-attribute-namespace>namespace</span>, <span
  title=concept-attribute-namespace-prefix>namespace prefix</span>,
  and <span title=concept-attribute-local-name>local name</span> of
  <var title>attr</var>, <var title>attributes</var>, and <var
  title>nsmap</var> (without the <var title>is element</var> flag).

  <li>If <var title>new attr</var> is not null, insert it into <var
  title>attributes</var> just after <var title>attr</var>.

  <li>Append attribute name/value pair (<var title>attr name</var>,
  the <span title=concept-attribute-value>value</span> of <var
  title>attr</var>) to <var title>attribute specifications</var>.

  </ol>

  <li>Return <var title>tag name</var>, <var title>attribute
  specifications</var>, and <var title>nsmap</var>.

</ol>

<p>These steps return three values.  The first value, <var title>tag
name</var>, is used as the tag name in the start and end tag of the
serialization of <var title>element</var>.  The second value, <var
title>attribute specifications</var>, contains zero or more pairs of
attribute names and values, which are used in the start tag of the
serialization of <var title>element</var>.  The third value, <var
title>nsmap</var>, is used as the input to the steps for serialization
of the child elements of <var title>element</var>.

<p>The <dfn>steps to obtain a QName</dfn>, with parameters <var
title>namespace URL</var>, <var title>prefix</var>, <var title>local
name</var>, <var title>attributes</var>, and <var title>nsmap</var>,
where <var title>attributes</var> and <var title>nsmap</var> are
shared with the callee such that any modification to them is also
reflected to those variables in the steps which invoked these steps,
and the <var title>is element</var> flag, are as follows:

<ol>

<li>Let <var title>qname</var> be <var title>local name</var>.

<li>Let <var title>new attr</var> be null.

<li>If <var title>namespace URL</var> is null:

  <ol>

  <li>If the <var title>is element</var> flag is not set, do nothing.

  <li>Otherwise, if the <span title=concept-nsmap-default>default
  namespace</span> of <var title>nsmap</var> is not <i>null</i>:

    <ol>

    <li>Set the <span title=concept-nsmap-default>default
    namespace</span> of <var title>nsmap</var> to <i>null</i>.

    <li>If <var title>attributes</var> contains an <span
    title=concept-attribute>attribute</span> <var title>attr</var>
    whose <span title=concept-attribute-namespace>namespace</span> is
    the <span>XMLNS namespace</span> and <span
    title=concept-attribute-local-name>local name</span> is
    <code>xmlns</code>:

      <ol>

      <li>If the <span title=concept-attribute-value>value</span> of
      <var title>attr</var> is not the empty string, replace <var
      title>attr</var> in <var title>attributes</var> by a new <span
      title=concept-default-namespace-declaration>defualt namespace
      declaration</span> with namespace URL <i>the empty string</i>,
      preserving the order.

      </ol>

    <li>Otherwise, let <var title>new attr</var> be a new <span
    title=concept-default-namespace-declaration>defualt namespace
    declaration</span> with namespace URL <i>the empty string</i>.

    </ol>

  </ol>

<li>Otherwise, if <var title>namespace URL</var> is not null:

  <ol>

  <li>If <var title>namespace URL</var> is the <span>XML
  namespace</span>, let <var title>prefix</var> be <code>xml</code>.

  <li>Otherwise, if <var title>namespace URL</var> is the <span>XMLNS
  namespace</span>, let <var title>prefix</var> be <code>xmlns</code>.

  <li>If <var title>namespace URL</var> is the <span>XMLNS
  namespace</span> and <var title>qname</var> is <code>xmlns</code>,
  do nothing.

  <li>Otherwise, if the <var title>is element</var> flag is set, <var
  title>prefix</var> is null, and the <span
  title=concept-nsmap-default>default namespace</span> of <var
  title>nsmap</var> is <i>missing</i>:

    <ol>

    <li>Set the <span title=concept-nsmap-default>default
    namespace</span> of <var title>nsmap</var> to <var title>namespace
    URL</var>.

    <li>Let <var title>new attr</var> be a new <span
    title=concept-default-namespace-declaration>default namespace
    declaration</span> with namespace URL <var title>namespace
    URL</var>.

    </ol>

  <li>Otherwise, if the <var title>is element</var> flag is set, <var
  title>prefix</var> is null, and the <span
  title=concept-nsmap-default>default namespace</span> of <var
  title>nsmap</var> is equal to <var title>namespace URL</var>, do
  nothing.

  <li>Otherwise, if <var title>prefix</var> is not null and there is
  the key/value pair whose key is <var title>prefix</var> and value is
  <var title>namespace URL</var> in the <span
  title=concept-nsmap-prefix-to-url>prefix to URL</span> list of <var
  title>nsmap</var>, prepend <var title>prefix</var> followed by a
  <code>U+003A</code> <code class=charname>COLON</code> character
  (<code>:</code>) to <var title>qname</var>.

  <li>Otherwise, if <var title>prefix</var> is not null and there is
  no key/value pair whose key is <var title>prefix</var> in the <span
  title=concept-nsmap-prefix-to-url>prefix to URL</span> list of <var
  title>nsmap</var>:

    <ol>

    <li>Append key/value pair (<var title>prefix</var>, <var
    title>namespace URL</var>) to the <span
    title=concept-nsmap-prefix-to-url>prefix to URL</span> list of
    <var title>nsmap</var>.

    <li>Let <var title>new attr</var> be a new <span
    title=concept-namespace-prefix-declaration>namespace prefix
    declaration</span> with prefix <var title>prefix</var> and
    namespace URL <var title>namespace URL</var>.

    <li>Prepend <var title>prefix</var> followed by a
    <code>U+003A</code> <code class=charname>COLON</code> character
    (<code>:</code>) to <var title>qname</var>.

    </ol>

  <li>Otherwise, if there is the key/value pair whose value is equal
  to <var title>namespace URL</var> in the <span
  title=concept-nsmap-prefix-to-url>prefix to URL</span> list of <var
  title>nsmap</var>:

    <ol>

    <li>Let <var title>prefix</var> be the key of the last key/value
    pair whose value is equal to <var title>namespace URL</var> in the
    <span title=concept-nsmap-prefix-to-url>prefix to URL</span> list
    of <var title>nsmap</var>.

    <li>Prepend <var title>prefix</var> followed by a
    <code>U+003A</code> <code class=charname>COLON</code> character
    (<code>:</code>) to <var title>qname</var>.

    </ol>

  <li>Otherwise, if the <var title>is element</var> flag is set and
  the <span title=concept-nsmap-default>default namespace</span> of
  <var title>nsmap</var> is equal to <var title>namespace URL</var>,
  do nothing.

  <li>Otherwise, if the <var title>is element</var> flag is set, <var
  title>prefix</var> is null, and <var title>attribute</var> does not
  contain an <span title=concept-attribute>attribute</span> whose
  <span title=concept-attribute-namespace>namespace</span> is the
  <span>XMLNS namespace</span> and <span
  title=concept-attribute-local-name>local name</span> is
  <code>xmlns</code>:

    <ol>

    <li>Set the <span title=concept-nsmap-default>default
    namespace</span> of <var title>nsmap</var> to <var title>namespace
    URL</var>.

    <li>Let <var title>new attr</var> be a new <span
    title=concept-default-namespace-declaration>default namespace
    declaration</span> with namespace URL <var title>namespace
    URL</var>.

    </ol>

  <li>Otherwise:

    <ol>

    <li>Let <var title>prefix</var> be <code title>a<var
    title>n</var></code> where <var title>n</var> is chosen such that
    <var title>n</var> is the minimum non-negative integer <code
    title>a<var title>n</var></code> is not found as a key of the
    <span title=concept-nsmap-prefix-to-url>prefix to URL</span> list
    of <var title>nsmap</var>.

    <li>Append key/value pair (<var title>prefix</var>, <var
    title>namespace URL</var>) to the <span
    title=concept-nsmap-prefix-to-url>prefix to URL</span> list of
    <var title>nsmap</var>.

    <li>Let <var title>new attr</var> be a new <span
    title=concept-namespace-prefix-declaration>namespace prefix
    declaration</span> with prefix <var title>prefix</var> and
    namespace URL <var title>namespace URL</var>.

    <li>Prepend <var title>prefix</var> followed by a
    <code>U+003A</code> <code class=charname>COLON</code> character
    (<code>:</code>) to <var title>qname</var>.

    </ol>

  </ol>

  <li>Return <var title>qname</var> and <var title>new attr</var>.

</ol>

<div class="note memo">

<p>These steps are based on, but not equivalent to, <a
href="http://suika.fam.cx/~wakaba/wiki/sw/n/XML%E3%81%AE%E7%9B%B4%E5%88%97%E5%8C%96#anchor-8">Gecko's
implementation at the time of writing</a>.

</div>

<div class="note memo">

<p>These steps do not prevent an unserializable set of <var title>tag
name</var> and <var title>attributes</var> from being returned when,
for example, there is an <code>xmlns</code> <span
title=concept-attribute>attribute</span> in null namespace, there is
an <code>xml</code> <span title=concept-attribute>attribute</span> in
the <span>XMLNS namespace</span> whose <span
title=concept-attribute-value>value</span> is not equal to the
<span>XML namespace</span>, or the given <var title>nsmap</var>
contains a key which is not a valid XML <code>NCName</code>.

</div>

</div>

<div class=section>
<h3>Tests</h3>

<p class=section-info>This section is <em>non-normative</em>.

<p>There is no comprehensive test suite of namespace fixup at the time
of writing.

<p>There are some tests at: <code class=URI>&lt;<a
href="http://suika.suikawiki.org/~wakaba/test/web/dom/element/inner-html/">http://suika.suikawiki.org/~wakaba/test/web/dom/element/inner-html/</a>&gt;</code>
and <code class=URI>&lt;<a
href="https://github.com/manakai/perl-web-markup/blob/master/t/modules/Web-XML-Serializer.t">https://github.com/manakai/perl-web-markup/blob/master/t/modules/Web-XML-Serializer.t</a>></code>.

</div>

</div><!-- section -->


<div class=makesection>
<h2>Conformance checking of XML documents</h2>

<p>If there is a <span>parse error</span>, the document is not
well-formed.

<div class=ed>

<div class="issue ed">...

<p>Much of invalid (well-formed or not) XML document parsing and XML document
/ XML DOM conformance is left undefined so that this document provides a
guideline for conformance checkers.

</div>

<div class=section id=processing-model>
<h3>Processing Model</h3>

<p>Conceptually, validation of an XML document is split into two
stages for the purpose of this specification: the <dfn
id=xml-document-parsing>XML document parsing</dfn> stage and the <dfn
id=dom-xml-conformance-checking>DOM XML conformance checking</dfn>
stage.

<p>The input to the XML document parsing stage is a byte sequence
representing the parsed XML document (and any additional metadata),
and the output are a DOM tree representing the XML document and zero
or more <a href="#error">errors</a>.  The processor that implements
this stage is called <dfn id=parser>parser</dfn>.  Requirements for a
parser are defined in the section of <a href="#parsing-xml">Parsing an
XML Document</a>.

<p>The input to the DOM XML conformance chcking stage is a DOM tree,
and the output are zero or more <a href="#error">errors</a>.  The
processor that implements this stage is called <dfn
id=conformance-checker>conformance checker</dfn>.  Requirements for a
conformance checker are defined in the section of <a
href="#checking-dom">Checking an XML DOM Tree</a>.


<div class=section id=error-categories>
<h4>Error Classification</h4>

<p class=ed>An <dfn id=error>error</dfn> is ...

<p class=ed>If a <code>Document</code> node has no 
xml-well-formedness-error, entity-error, and unknown-error,
then it is well-formed.  If a well-formed <code>Document</code>
node has no xml-validity-error, it is valid.</p>

<div class="note memo">
<p>A wellformed <code>Document</code> can be safely serialized
into a wellformed XML document.  A valid <code>Document</code>
can be easily serialized into a valid XML document.</p>
</div>

<p class=ed>To be a conforming <a href="http://www.w3.org/TR/2006/REC-xml-20060816/#dt-validating">validating XML processor</a>,
...</p>

<p>Errors are classified into these 
<dfn id=error-category title="error category">error categories</dfn>:</p>

<dl id=errors>
<dt><dfn id=entity-error><code>entity-error</code></dfn></dt>
  <dd>
    <p class=ed>@@</p>
    <div class="note memo">
      <p>This <span class=ed>algorithm</span> does not support
      <abbr>DOM</abbr> tree with one or more <code>EntityReference</code>
      nodes.  It is expected that any entity references are expanded
      at the parse time and any unexpandable entity references
      make parse time errors raised so that never result in
      <abbr>DOM</abbr> tree with <code>EntityReference</code> nodes.</p>
    </div>
  </dd>
<dt><dfn id=round-trip-error><code>round-trip-error</code></dfn></dt>
  <dd class=ed>@@</dd>
<dt><dfn id=round-trip-warning><code>round-trip-warning</code></dfn></dt>
  <dd>
    <p>A <a href="#round-trip-warning"><code>round-trip-warning</code></a>
    will be raised when a construct, which might not be restored to the same
    construct when it is serialized and then re-parsed by a conforming
    processor, is encountered.</p>
    <div class="example memo">
      <p>For a <code>Comment</code> node a
      <a href="#round-trip-warning"><code>round-trip-warning</code></a> will
      be raised, since <abbr>XML</abbr> processors are not required to
      report texts of comments for applications.</p>
    </div>
  </dd>
<dt class=ed><dfn id=unknown-error><code>unknown-error</code></dfn>?</dt>
  <dd class=ed>@@</dd>
<dt><dfn id=xml-misc-error><code>xml-misc-error</code></dt>
  <dd>An <abbr>XML</abbr> <i>error</i> (<abbr>XML</abbr> 1.0
  <cite class="bibref normative">[<a href="#ref-XML">XML</a>]</cite> 
  <a href="http://www.w3.org/TR/2006/REC-xml-20060816/#dt-error">error</a> /
  <abbr>XML</abbr> 1.1
  <cite class="bibref normative">[<a href="#ref-XML11">XML11</a>]</cite>
  <a href="@@/#dt-error">error</a>)
  that is not classified to any other <a href="#error-category">error
  category</a>.</dd>
<dt><dfn id=xml-misc-fatal-error><code>xml-misc-fatal-error</code></dt>
  <dd>An <abbr>XML</abbr> <i>fatal error</i> (<abbr>XML</abbr> 1.0
  <cite class="bibref normative">[<a href="#ref-XML">XML</a>]</cite> 
  <a href="http://www.w3.org/TR/2006/REC-xml-20060816/#dt-fatal">fatal
  error</a> / <abbr>XML</abbr> 1.1
  <cite class="bibref normative">[<a href="#ref-XML11">XML11</a>]</cite>
  <a href="@@/#dt-fatal">fatal error</a>)
  that is not classified to any other <a href="#error-category">error
  category</a>. <span class=ed>@@ What errors fall into this category?</span></dd>
<dt><dfn id=xml-misc-recommendation><code>xml-misc-recommendation</code></dfn></dt>
  <dd>
    <p>An
    <a href="#xml-misc-recommendation"><code>xml-misc-recommendation</code></a>
    will be raised if a <em class=rfc2119>SHOULD</em>level requirement
    in <abbr>XML</abbr> specification is not met.</p>
  </dd>
<dt><dfn id=xml-validity-error><code>xml-validity-error</code></dfn></dt>
  <dd>A violation of validity constraint in XML document.</dd>
<dt><dfn id=xml-well-formedness-error><code>xml-well-formedness-error</code></dfn></dt>
  <dd><p>If an <code>xml-well-formedness-error</code> is raised,
  it would not be possible to generate an XML serialization that
  would match to the appropriate production rule and that would not 
  violate to any wellformedness constraint in XML
  specification <cite class="bibref normative">[<a href="#ref-XML">XML</a>,
  <a href="#ref-XML11">XML11</a>]</cite>.</p></dd>
<dt><dfn id=misc-info><code>misc-info</code></dfn>
  <dd><p>A <code>misc-info</code> is raised when some status information
  on parsing or checking process that are considered useful for debugging
  and so on is available.  It by no means implies the non-conformance of
  the document.
</dl>

<div class=ed><p>@@ TODO: #dt-atuseroption at user option
(MAY or MUST), #dt-compat for compatibility,
#dt-interop for interoperability</p>

<p>TODO: XML 1.1, XML Namespace 1.0/1.1, xml:base, xml:id

<p>TODO: XML "error"/"fatal error" is not always non-conforming (only
when MUST or SHOULD).
</div>

</div>

</div>

<div class="section" id=checking-dom>
<h3>Checking an <abbr>XML</abbr> <abbr>DOM</abbr> Tree</h3>

<p>The following algorithms and definitions are applied to
<abbr>XML</abbr> documents; especially, they are not applied
to <abbr>HTML</abbr> documents.<!-- TODO: ref to HTML5 --></p>

<div class=section id=definitions>
<h4>Definitions</h4>

<p>The <dfn id=xml-version><abbr>XML</abbr> version</dfn> of a node is 
the <abbr>XML</abbr> version of the document to which the node belongs.
For a <code>Documemt</code> node, the <abbr>XML</abbr> version
of the document is the value of the <code>xmlVersion</code>
attribute of the node.  For a <code>DocumentType</code> node whose 
<code>ownerDocument</code> attribute is set to <code>null</code>,
the <abbr>XML</abbr> version of the document is <code>1.0</code><!--
since createDocumentType [DOM3CORE] assumes XML 1.0 [XML10TE] -->.
For any other node, the <abbr>XML</abbr> version of the document
is that of the <code>Document</code> node contained in the
<code>ownerDocument</code> attribute of the node.</p>

</div>


<div class=section id=checking-components>
<h4>Conformance Checking Algorithms for Components</h4>

<p>To
<dfn id=algorithm-to-validate-an-xml-character-data title="validate an XML string">to
validate an <abbr>XML</abbr> string (<dfn id=var-s><var>s</var></dfn>)</dfn>,
the following algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
<li>If <var>s</var> contains a character that is <em>not</em> in
the character class <a href="#class-Char10"><code>Char10</code></a>, 
then raise an
<a href="#xml-well-formedness-error" id=wfe-illegal-char><code>xml-well-formedness-error</code></a>.</li>
<li>If <var>s</var> contains a character that is in the character
class <a href="#class-CompatChar10"><code>CompatChar10</code></a>,
then raise an
<a href="#xml-misc-warning" id=xmw-compat-char><code>xml-misc-warning</code></a>.</li>
<li>If <var>s</var> contains a character that is in the character
class <a href="#class-ControlChar10"><code>ControlChar10</code></a>,
then raise an
<a href="#xml-misc-warning" id=xmw-control-char><code>xml-misc-warning</code></a>.</li>
<li class=ed>@@ XML 1.1 support</li>
<li>If <var>s</var> contains a <code class=char>U+000D</code>
<code class=charname>CARRIAGE RETURN</code> character, then
raise a 
<a href="#round-trip-error" id=rte-cr><code>round-trip-error</code></a>.
<span class=ed>@@ We should not raise duplicate errors for U+000D
in attribute values.  In addition, we should support a mode where
U+000D will be serialized as &#x000D; (so that no round-trip-error
will be raised).</span></li>
</ol>

<p>To
<dfn id=algorithm-to-validate-a-name title="validate a Name">validate a
<code>Name</code> (<dfn id=var-name-s><var>s</var></dfn>)</dfn>, the following
algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
<li>If <var>s</var> is an empty string, then raise an
<a href="#xml-well-formedness-error" id=wfe-name-empty><code>xml-well-formedness-error</code></a>.
Abort these steps.</li>
<li><a href="#algorithm-to-validate-an-xml-character-data" title="validate an XML string">Validate
<var>s</var> as an <abbr>XML</abbr> string</a>.</li>
<li>If the first character in <var>s</var> is a character that is 
<em>not</em> in the character class 
<a href="#class-NameStartChar10"><code>NameStartChar10</code></a>, then raise
an
<a href="#xml-well-formedness-error" id=wfe-name-startchar><code>xml-well-formedness-error</code></a>.</li>
<li>If a character other than the first character in <var>s</var> is a 
character that is <em>not</em> in the character class 
<a href="#class-NameChar10"><code>NameChar10</code></a>, then raise an
<a href="#xml-well-formedness-error" id=wfe-name-char><code>xml-well-formedness-error</code></a>.</li>
<li>If <var>s</var> begins with the string <code>xml</code> (in any
case combination), then raise an
<a href="#xml-misc-warning" id=xmw-reserved-name><code>xml-misc-warning</code></a>.
<span class=ed>@@ except for attribute names <code>xml:lang</code>,
<code>xml:space</code><!--, <code>xml:base</code>, <code>xml:id</code>,
<code>xmlns</code>, <code>xmlns:<var>*</var></code>,
pi name <code>xml-stylesheet</code>-->.</span><!--
"names beginning with a match to (('X'|'x')('M'|'m')('L'|'l')) are reserved for standardization in this or future versions of this specification.":
xmlns, xml-stylesheet, xml:base and xml:id specifications violate to this sentense!
--></li>
<!-- COLON in Name is a lowercase "should not" in a Note of [XML],
[XML11]. -->
<li class=ed>@@ XML 1.1 support</li>
</ol>

<p>To
<dfn id=algorithm-to-validate-an-ncname title="validate an NCName">validate
an <code>NCName</code> (<dfn id=var-ncname-s><var>s</var></dfn>)</dfn>, the
following algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
<li><a href="#algorithm-to-validate-a-name" title="validate a Name">Validate
<var>s</var> as a <code>Name</code></a>.</li>
<li class=ed>@@</li>
</ol>

<p>To 
<dfn id=algorithm-to-validate-a-public-identifier title="validate a public identifier">validate
a public identifier (<dfn id=var-pid><var>pid</var></dfn>)</dfn>, the
following algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
<li>If <var>pid</var> is <code>null</code>, abort these steps.</li>
<li>If <var>pid</var> contains a character that is <em>not</em> in the
character class <a href="#class-PubidChar"><code>PubidChar</code></a>, then
raise an
<a href="#xml-well-formedness-error" id=wfe-pubid-char><code>xml-well-formedness-error</code></a>.</li>
  <li>If <var>pid</var> contains one of <code class=char>U+0009</code>
  <code class=charname>CHARACTER TABULATION</code>, 
  <code class=char>U+000A</code> <code class=charname>CARRIAGE RETURN</code>,
  and <code class=char>U+000D</code> <code class=charname>LINE FEED</code>
  characters, if the first character of <var>pid</var> is
  <code class=char>U+0020</code> <code class=charname>SPACE</code> character,
  if the last character of <var>pid</var> is <code class=char>U+0020</code>
  <code class=charname>SPACE</code> character, or if there is a
  <code class=char>U+0020</code> <code class=charname>SPACE</code> character
  immediately followed by another <code class=char>U+0020</code>
  <code class=charname>SPACE</code> character in <var>pid</var>, then it is a
  <a href="#round-trip-error" id=rte-pubid-space><code>round-trip-error</code></a>.
  <span class=ed>Is this really a roundtripness problem?  XML spec
  does only define the way to match public identifiers in fact, no
  canonical form.</span></li>
</ol>

<p>To 
<dfn id=algorithm-to-validate-a-system-identifier title="validate a system identifier">validate
a system identifier (<dfn id=var-sid><var>sid</var></dfn>)</dfn>, the
following algorithm <em class=rfc2119>MUST</em> be used:</p>
<ol>
  <li>If <var>sid</var> is <code>null</code>, abort these steps.</li>
<li><a href="#algorithm-to-validate-an-xml-character-data" title="validate an XML string">Validate
<var>sid</var> as an <abbr>XML</abbr> string</a>.</li>
  <li>If <var>sid</var> contains both <code class=char>U+0022</code>
  <code class=charname>QUOTATION MARK</code> (<code class=char>"</code>) and
  <code class=char>U+0027</code> <code class=charname>APOSTROPHE</code>
  (<code class=char>'</code>) characters, raise an
  <a href="#xml-well-formedness-error" id=wfe-sid-lit><code>xml-well-formedness-error</code></a>.</li>
  <li>If <var>sid</var> contains at least one <code class=char>U+0023</code>
  <code class=charname>NUMBER SIGN</code> (<code class=char>#</code>)
  character, then raise an
  <a href="#xml-misc-error" id=xme-sid-fragment><code>xml-misc-error</code></a>.</li>
  <li class=ed>@@ If <var>sid</var> cannot be converted to a URI
  reference, then raise a fact-level error (xml-misc-warning?).<!--
  XML 1.0 has no conformance language for system identifier being
  a URI reference. --></li>
</ol>

</div>

<div class=section id=checking-node>
<h4>Checking <code>Node</code></h4>

<p>The algorithm <dfn title="to check a node" id=algorithm-to-check-a-node>to 
check a node (<dfn id=var-n><var>n</var></dfn>)</dfn> is defined as 
following:</p>
<dl class=switch>
<dt>If <var>n</var> is an <code>Attr</code> node</dt>
  <dd>
    <ol>
    <li><a href="#algorithm-to-validate-an-ncname">Validate the
    <code>localName</code> attribute value as an <code>NCName</code></a>.</li>
    <li>If the <code>prefix</code> attribute value is different from
    <code>null</code>, then <a href="#algorithm-to-validate-an-ncname">validate
    the <code>prefix</code> attribute value as an <code>NCName</code></a>.</li>
    <li>For each node <dfn id=var-attr-nc><var>n<sub><var>c</var></sub></var></dfn> in the
    <code>childNodes</code> list of <var>n</var>,
      <ol>
      <li>If <var>n<sub><var>c</var></sub></var> is <em>not</em> a
      <code>Text</code> or <code>EntityReference</code> node, then it is an
      <a href="#xml-well-formedness-error" id=wfe-attr-child><code>xml-well-formedness-error</code></a>.</li>
      <li>Otherwise, if <var>n<sub><var>c</var></sub></var> is an
      <code>EntityReference</code> node, then it is an 
      <a href="#entity-error" id=ee-attr-er><code>entity-error</code></a>.</li>
      <li>Otherwise,
      <a href="#algorithm-to-check-a-node" title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recusrively.</li>
      </ol></li>
    <li>If <code>nodeName</code> attribute of <var>n</var> is
    <code>xml:space</code> <span class=ed>@@ or {xml namespace}:space ?</span>
    and <code>value</code> attribute of <var>n</var> is neither 
    <code>default</code> nor <code>preserve</code>, then it is an
    <a href="#xml-misc-error" id=xme-attr-xml-space><code>xml-misc-error</code></a>.<!--
    Note that <!ATTLIST e xml:space (default|preserve) "a">...
    <e xml:space="default"/> is conforming and valid. --></li>
    <li class=ed>@@ xml:lang value is not a language tag [RFC 3066 or its
    successor] or an empty string, then xml-misc-warning
    (a "fact"-level error; not an XML error).</li>
    <li class=ed>@@ <code>specified</code>,
    <code>manakaiAttributeType</code> (#ValueType Validity constraint: Attribute Value Type)</li>
    <!-- xml:space MUST be declared to be valid. -->
    <li>Let <dfn id=var-v><var>v</var></dfn> be the value of the
    attribute <code>value</code> of <var>n</var>.</li>
    <li>Validate the <var>n</var> against the <span class=ed>declared 
    type</span> as following:
      <dl class=switch>
      <dt class=ed><code>ID_ATTR</code></dt>
        <dd>
          <ol>
          <li><span class=ed>Validate <var>v</var> as an
          <code>Name</code>.</span>  If it fails, then raise an
          <a href="#xml-validity-error" id=vc-id-name><code>xml-validity-error</code></a>.</li>
          <li><span class=ed>If <code>ID</code> <var>v</var> is defined,</span>
          then raise an  
          <a href="#xml-validity-error" id=vc-id-duplication><code>xml-validity-error</code></a>.</li>
          </ol>
        </dd>
      <dt class=ed>IDREF_ATTR</dt>
        <dd>
          <ol>
          <li><span class=ed>Validate <var>v</var> as an
          <code>Name</code>.</span>  If it fails, then raise an
          <a href="#xml-validity-error" id=vc-idref-name><code>xml-validity-error</code></a>.</li>
          <li><span class=ed>If <code>ID</code> <var>v</var> is NOT
          defined,</span> then raise an  
          <a href="#xml-validity-error" id=vc-idref-match><code>xml-validity-error</code></a>.</li>
          </ol>
        </dd>
      <dt class=ed>IDREFS_ATTR</dt>
        <dd class=ed>@@</dd>
      <dt class=ed>ENTITY_ATTR</dt>
        <dd>
          <ol>
          <li><span class=ed>Validate <var>v</var> as an
          <code>Name</code>.</span>  If it fails, then raise an
          <a href="#xml-validity-error" id=vc-entname-name><code>xml-validity-error</code></a>.</li>
          <li><span class=ed>If <code>Entity</code> <var>v</var> is NOT
          defined,</span> then raise an  
          <a href="#xml-validity-error" id=vc-entname-match><code>xml-validity-error</code></a>.</li>
          </ol>
        </dd>
      <dt class=ed>ENTITIES_ATTR</dt>
        <dd class=ed>@@</dd>
      <dt class=ed>NMTOKEN_ATTR</dt>
        <dd>
          <ol>
          <li><span class=ed>Validate <var>v</var> as an
          <code>Nmtoken</code>.</span>  If it fails, then raise an
          <a href="#xml-validity-error" id=vc-nmtok-name><code>xml-validity-error</code></a>.</li>
          </ol>
        </dd>
      <dt class=ed>NMTOKENS_ATTR</dt>
        <dd class=ed>@@</dd>
      <dt class=ed>NOTATION_ATTR</dt>
        <dd class=ed><var>v</var> must be one of enumerated values.
        If not, then raise an
        <a href="#xml-validity-error" id=vc-notatn-match><code>xml-validity-error</code></a>.</dd>
      <dt class=ed>ENUMERATED_ATTR</dt>
        <dd class=ed><var>v</var> must be one of enumerated values.
        If not, then raise an
        <a href="#xml-validity-error" id=vc-enum><code>xml-validity-error</code></a>.</dd>
      <dt class=ed>@@</dt>
      </dl>
    </li>
    <li>If <span class=ed>type ID and default is NOT #IMPLIED or #REQUIRED</span>, then
    raise an
    <a href="#xml-validity-error" id=vc-id-default><code>xml-validity-error</code></a>.</li>
    <li class=ed>@@ #FixedAttr Validity constraint: Fixed Attribute Default</li>
    <li class=ed>@@ strict serialization error for U+000D, U+000A, and
    U+0009 characters, leading/trailing U+0020, and U+0020{2,} string?</li>
    </ol>
  </dd>
<dt>If <var>n</var> is an <code>AttributeDefinition</code> node</dt>
  <dd>
    <ol>
    <li class=ed></li>
    <li>If <code>nodeName</code> attribute of <var>n</var> is
    <code>xml:space</code> <span class=ed>@@ or {xml namespace}:space ?</span>
    and <span class=ed>its declared type is different from (default|preserve),
    (preserve|default), (default), or (preserve)</span>, then raise an
    <a href="#xml-misc-error" id=xme-at-xml-space><code>xml-misc-error</code></a>.</li>
    <li>For each node <dfn id=var-ad-nc><var>n<sub><var>c</var></sub></var></dfn> in the
    <code>childNodes</code> list of <var>n</var>,
      <ol>
      <li>If <var>n<sub><var>c</var></sub></var> is <em>not</em> a
      <code>Text</code> or <code>EntityReference</code> node, then it is an
      <a href="#xml-well-formedness-error" id=wfe-at-child><code>xml-well-formedness-error</code></a>.</li>
      <li>Otherwise, if <var>n<sub><var>c</var></sub></var> is an
      <code>EntityReference</code> node, then it is an 
      <a href="#entity-error" id=ee-at-er><code>entity-error</code></a>.</li>
      <li>Otherwise,
      <a href="#algorithm-to-check-a-node" title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recusrively.</li>
      </ol></li>
    <li class=ed>If <code>NOTATION_ATTR</code>, enumerated values MUST
    be declared.  If not, then raise an
    <a href="#xml-validity-error" id=vc-notatn-declared><code>xml-validity-error</code></a>.</li>
    <li class=ed>If <code>NOTATION_ATTR</code> or <code>ENUMERATED_ATTR</code>,
    values MUST all be distinct.  If not, then raise an
    <a href="#xml-validity-error" id=vc-no-duplicate-tokens><code>xml-validity-error</code></a>.</li>
    <li class=ed>If <code>NOTATION_ATTR</code> on an <code>EMPTY</code> 
    element, then raise an
    <a href="#xml-validity-error" id=vc-no-notation-empty><code>xml-validity-error</code></a>.</li>
    <li class=ed>@@ #defattrvalid Validity constraint: Attribute Default Value Syntactically Correct</li>
    </ol>
  </dd>
<dt>If <var>n</var> is a <code>CDATASection</code> node</dt>
  <dd>
    <ol>
    <li><a href="#algorithm-to-validate-an-xml-character-data" title="validate an XML string">Validate the 
    <code>data</code> attribute value as an <abbr>XML</abbr> character
    data</a>.</li>
    <li>If the <code>data</code> attribute value contains
    a string <code>]]></code>, then raise an
    <a href="#xml-well-formedness-error" id=wfe-cs-mse><code>xml-well-formedness-error</code></a>.<!-- "for compatibility" --></li>
    <li>If the <code>childNodes</code> list of <var>n</var> contains
    any nodes, they are in
    <a href="#xml-well-formedness-error" id=wfe-cs-child><code>xml-well-formedness-error</code></a>.</li>
    </ol>
  </dd>
<dt>If <var>n</var> is a <code>Comment</code> node</dt>
  <dd>
    <ol>
    <li>Raise an
    <a href="#round-trip-warning" id=rtw-comment><code>round-trip-warning</code></a>.</li>
    <li><a href="#algorithm-to-validate-an-xml-character-data" title="validate an XML string">Validate the 
    <code>data</code> attribute value as an <abbr>XML</abbr> character
    data</a>.</li>
    <li>If the <code>data</code> attribute value contains
    a string <code>--</code>, or if it ends with a character
    <code>-</code>, then raise an
    <a href="#xml-well-formedness-error" id=wfe-comment-com><code>xml-well-formedness-error</code></a>.<!--
    "for compatibility" --></li>
    <li>If the <code>childNodes</code> list of <var>n</var> contains
    any nodes, they are in
    <a href="#xml-well-formedness-error" id=wfe-comment-child><code>xml-well-formedness-error</code></a>.</li>
    </ol>
  </dd>
<dt>If <var>n</var> is a <code>Document</code> node</dt>
  <dd>
    <ol>
    <li>If <a href="#xml-version"><abbr>XML</abbr> version</a> of <var>n</var>
    is different from <code>1.0</code> or <code>1.1</code>,
    then it is an <code class=ed>unknown-error?</code>.</li>
    <li>If the <code>xmlEncoding</code> attribute value does <em>not</em>
    match to <code>[A-Za-z] ([A-Za-z0-9._] | '-')*</code>
    <span class=ed>@@ formal def</span>, then it is an
    <a href="#xml-well-formedness-error" id=wfe-encoding><code>xml-well-formedness-error</code></a>.</li>
    <li>The <code>childNodes</code> list of <var>n</var> have to
    consist of zero or more <code>Comment</code> and/or
    <code>ProcessingInstruction</code> nodes, followed by
    an optional <code>DocumentType</code> node, followed
    by zero or more <code>Comment</code> and/or
    <code>ProcessingInstruction</code> nodes, followed by
    an <code>Element</code> node, followed
    by zero or more <code>Comment</code> and/or
    <code>ProcessingInstruction</code> nodes.  Any violation to this is an
    <a href="#xml-well-formedness-error" id=wfe-document-child><code>xml-well-formedness-error</code></a>.</li>
    <li>For each node <dfn id=var-document-nc><var>n<sub><var>c</var></sub></var></dfn>
    in the <code>childNodes</code> list of <var>n</var>,
      <ol>
      <li>If <var>n<sub><var>c</var></sub></var> is <em>not</em> an
      <code>EntityReference</code> node, then
      <a href="#algorithm-to-check-a-node" title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recursively.</li>
      </ol></li>
    <li class=ed>@@ <code>allDeclarationsProcessed</code></li>
    </ol>
  </dd>
<dt>If <var>n</var> is a <code>DocumentFragment</code> node</dt>
  <dd>
    <ol>
    <li>For each node <dfn id=var-df-nc><var>n<sub><var>c</var></sub></var></dfn>
    in the <code>childNodes</code> list of <var>n</var>,
      <ol>
      <li>If <var>n<sub><var>c</var></sub></var> is <em>not</em> an
      <code>Element</code>, <code>Text</code>, <code>CDATASection</code>,
      <code>Comment</code>, <code>ProcessingInstruction</code>, or
      <code>EntityReference</code> node, then it is an
      <a href="#xml-well-formedness-error" id=wfe-df-child><code>xml-well-formedness-error</code></a>.</li>
      <li>Otherwise, if <var>n<sub><var>c</var></sub></var> is an
      <code>EntityReference</code> node, then it is an
      <a href="#entity-error" id=ee-df-er><code>entity-error</code></a>.</li>
      <li>Otherwise,
      <a href="#algorithm-to-check-a-node" title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recursively.</li>
      </ol></li>
    </ol>
  </dd>
<dt>If <var>n</var> is a <code>DocumentType</code> node</dt>
  <dd>
    <ol>
    <li><a href="#algorithm-to-validate-an-ncname">Validate the
    <code>nodeName</code> attribute value as an <code>NCName</code></a>.</li>
    <li>Follow the following substeps:
      <ol>
      <li>If <code>ownerDocument</code> attribute of <var>n</var> is
      <code>null</code>, then abort these substeps.</li>
      <li>If <code>documentElement</code> attribute of the node
      set to <code>ownerDocument</code> attribute of <var>n</var> is
      <code>null</code>, then abort these substeps.</li>
      <li>If <code>nodeName</code> attribute of the node set to
      <code>documentElement</code> attribute of the node set to
      <code>ownerDocument</code> attribute of <var>n</var> is
      different from <code>nodeName</code> of <var>n</var>,
      then raise an
      <a href="#xml-validity-error" id=vc-roottype><code>xml-validity-error</code></a>.</li></li>
      </ol>
    </li>
    <li><a href="#algorithm-to-validate-a-public-identifier" title="validate a public identifier">Validate
    the <code>publicId</code> attribute value as a public identifier</a>.</li>
    <li><a href="#algorithm-to-validate-a-system-identifier" title="validate a system identifier">Validate
    the <code>systemId</code> attribute value as a system identifier</a>.</li>
    <li>If the <code>publicId</code> attribute value of <var>n</var> is
    <em>not</em> <code>null</code> and the <code>systemId</code> attribute
    value of <var>n</var> is <code>null</code>, then raise an
    <a href="#xml-well-formedness-error" id=wfe-dt-sid><code>xml-well-formedness-error</code></a>.
    <span class=ed>@@ publicId == null?  Or, publicId == ""</span></li>
    <li>For each node <dfn id=var-dt-nc><var>n<sub><var>c</var></sub></var></dfn>
    in the <code>childNodes</code> list of <var>n</var>,
      <ol>
      <li>If <var>n<sub><var>c</var></sub></var> is <em>not</em> a
      <code>ProcessingInstruction</code> node, then it is an
      <a href="#xml-well-formedness-error" id=wfe-dt-child><code>xml-well-formedness-error</code></a>.
      <span class=ed>@@ ref to manakai's extensions</span></li>
      <li>Otherwise, <!-- if n_c is not an EntityReference node, -->
      <a href="#algorithm-to-check-a-node" title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recusrively.</li>
      </ol></li>
    <li>For each node in the <code>entities</code>, <code>notations</code>,
    and <code>elementTypes</code> lists of <var>n</var>,
    <a href="#algorithm-to-check-a-node" title="check a node">check the
    node</a> recursively.</li>
    <li class=ed>@@ externally declared?</li>
    <li>If the <code>NamedNodeMap</code> object in the <code>entities</code>
    attribute of <var>n</var> does not contain <code>Entity</code> nodes
    whose <code>nodeName</code> attribute are <code>amp</code>,
    <code>lt</code>, <code>gt</code>, <code>apos</code>, and <code>quot</code>
    then raise
    <a href="#xml-misc-recommentation" id=xmr-predefined><code>xml-misc-recommendation</code></a>(s).
    </ol>
  </dd>
<dt>If <var>n</var> is an <code>Element</code> node</dt>
  <dd>
    <ol>
    <li><a href="#algorithm-to-validate-an-ncname">Validate the
    <code>localName</code> attribute value as an <code>NCName</code></a>.</li>
    <li>If the <code>prefix</code> attribute value is different from
    <code>null</code>, then <a href="#algorithm-to-validate-an-ncname">validate
    the <code>prefix</code> attribute value as an <code>NCName</code></a>.</li>
    <li>For each node <dfn id=var-element-nc><var>n<sub><var>c</var></sub></var></dfn>
    in the <code>childNodes</code> list of <var>n</var>,
      <ol>
      <li>If <var>n<sub><var>c</var></sub></var> is <em>not</em> an 
      <code>Element</code>,
      <code>Text</code>, <code>CDATASection</code>, <code>Comment</code>,
      <code>ProcessingInstruction</code>, or
      <code>EntityReference</code> node, then it is an
      <a href="#xml-well-formedness-error" id=wfe-element-child><code>xml-well-formedness-error</code></a>.</li>
      <li>Otherwise, if <var>n<sub><var>c</var></sub></var> is an
      <code>EntityReference</code> node, then it is an
      <a href="#entity-error" id=ee-element-er><code>entity-error</code></a>.</li>
      <li>Otherwise,
      <a href="#algorithm-to-check-a-node" title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recursively.</li>
      </ol></li>
    <li class=ed>@@ #elementvalid Validity constraint: Element Valid</li>
    <li>Let <var>attrs</var> be the value of the <code>attribute</code>
    attribute of <var>n</var>.  Check conformance of <var>attrs</var>
    as following:
      <ol>
      <li>If <var>attrs</var> contains an <code>Attr</code> node whose
      <code>nodeName</code> attribute value is equal to that of another
      <code>Attr</code> node in <var>attrs</var>, then raise an
      <a href="#xml-well-formedness-error" id=wfe-uniqattspec><code>xml-well-formedness-error</code></a>.<!--
      #uniqattspec Well-formedness constraint: Unique Att Spec --></li>
      <li class=ed>@@ #RequiredAttr Validity constraint: Required Attribute</li>
      </ol>
    </li>
    </ol>
  </dd>
<dt>If <var>n</var> is an <code>ElementTypeDefinition</code> node</dt>
  <dd>
    <ol>
    <li class=ed></li>
    <li>If the <code>childNodes</code> list of <var>n</var> contains
    any nodes, they are in
    <a href="#xml-well-formedness-error" id=wfe-et-child><code>xml-well-formedness-error</code></a>.</li>
    <li class=ed>@@ <q cite="http://www.w3.org/TR/2006/REC-xml-20060816/#elemdecls">At user option, an XML processor MAY issue a warning when a declaration mentions an element type for which no declaration is provided, but this is not an error.</q></li>
    <li class=ed>@@ <q cite="http://www.w3.org/TR/2006/REC-xml-20060816/#sec-element-content">For compatibility, it is an error if the content model allows an element to match more than one occurrence of an element type in the content model. </q></li>
    <li class=ed>@@ #vc-MixedChildrenUnique
    Validity constraint: No Duplicate Types</li>
    <li class=ed>@@ <q cite="http://www.w3.org/TR/2006/REC-xml-20060816/#attdecls">At user option, an XML processor MAY issue a warning if attributes are declared for an element type not itself declared, but this is not an error.</q></li>
    <li>If there is more than one <code>AttributeDefinition</code> node
    with <span class=ed>attribute type <code>ID</code></span> in the 
    <code>NamedNodeMap</code> list contained in the 
    <code>attributeDefinitions</code> attribute of <var>n</var>, then raise an
    <a href="#xml-validity-error" id=vc-one-id-per-el><code>xml-validity-error</code></a>.</li>
    <li>If there is more than one <code>AttributeDefinition</code> node
    with <span class=ed>attribute type <code>NOTATION</code></span> in the 
    <code>NamedNodeMap</code> list contained in the 
    <code>attributeDefinitions</code> attribute of <var>n</var>, then raise an
    <a href="#xml-validity-error" id=vc-one-notation-per><code>xml-validity-error</code></a>.</li>
    <li class=ed>"For interoperability, the same Nmtoken  SHOULD NOT occur more than once in the enumerated attribute types of a single element type."</li>
    </ol>
  </dd>
<dt>If <var>n</var> is an <code>Entity</code> node whose
<code>notationName</code> attribute value is <code>null</code> (i.e. a
parsed entity)</dt>
  <dd>
    <ol>
    <li>Raise an
    <a href="#entity-error" id=ee-entity-node><code>entity-error</code></a>.</li>
    <li><a href="#algorithm-to-validate-an-ncname">Validate the
    <code>nodeName</code> attribute value as an <code>NCName</code></a>.</li>
    <li><a href="#algorithm-to-validate-a-public-identifier" title="validate a public identifier">Validate
    the <code>publicId</code> attribute value as a public identifier</a>.</li>
    <li><a href="#algorithm-to-validate-a-system-identifier" title="validate a system identifier">Validate
    the <code>systemId</code> attribute value as a system identifier</a>.</li>
    <li>If the <code>publicId</code> attribute value of <var>n</var> is
    <em>not</em> <code>null</code> and the <code>systemId</code> attribute
    value of <var>n</var> is <code>null</code>, then raise an
    <a href="#xml-well-formedness-error" id=wfe-entity-sid><code>xml-well-formedness-error</code></a>.</li>
    <li>For each node <dfn id=var-entity-nc><var>n<sub><var>c</var></sub></var></dfn>
    in the <code>childNodes</code> list of <var>n</var>,
      <ol>
      <li>If <var>n<sub><var>c</var></sub></var> is <em>not</em> an
      <code>Element</code>,
      <code>Text</code>, <code>CDATASection</code>, <code>Comment</code>,
      <code>ProcessingInstruction</code>, or <code>EntityReference</code>
      node, then it is an
      <a href="#xml-well-formedness-error" id=wfe-entity-child><code>xml-well-formedness-error</code></a>.</li>
      <li>Otherwise, if <var>n<sub><var>c</var></sub></var> is an
      <code>EntityReference</code> node, then it is an
      <a href="#entity-error" id=ee-er-er><code>entity-error</code></a>.</li>
      <li>Otherwise,
      <a href="#algorithm-to-check-a-node" title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recursively.</li>
      </ol></li>
    </ol>
  </dd>
<dt>If <var>n</var> is an <code>Entity</code> node whose
<code>notationName</code> attribute value is <em>not</em> <code>null</code>
(i.e. an unparsed entity)</dt>
  <dd>
    <ol>
    <li><a href="#algorithm-to-validate-an-ncname">Validate the
    <code>nodeName</code> attribute value as an <code>NCName</code></a>.</li>
    <li><a href="#algorithm-to-validate-a-public-identifier" title="validate a public identifier">Validate
    the <code>publicId</code> attribute value as a public identifier</a>.</li>
    <li><a href="#algorithm-to-validate-a-system-identifier" title="validate a system identifier">Validate
    the <code>systemId</code> attribute value as a system identifier</a>.</li>
    <li>If the <code>systemId</code> attribute value of <var>n</var> is
    <code>null</code>, then raise an
    <a href="#xml-well-formedness-error" id=wfe-uentity-sid><code>xml-well-formedness-error</code></a>.</li>
    <li><a href="#algorithm-to-validate-an-ncname">Validate the
    <code>notationName</code> attribute value of <var>n</var> as an
    <code>NCName</code></a>.</li>
    <li class=ed>@@ #not-declared Validity constraint: Notation Declared</li>
    <li>If the <code>childNodes</code> list of <var>n</var> contains
    any nodes, they are in
    <a href="#xml-well-formedness-error" id=wfe-uentity-child><code>xml-well-formedness-error</code></a>.</li>
    </ol>
  </dd>
<dt>If <var>n</var> is an <code>EntityReference</code> node</dt>
  <dd>
    <ol>
    <li>An <a href="#entity-error" id=ee-er-node><code>entity-error</code></a>.</li>
    <li><a href="#algorithm-to-validate-an-ncname">Validate the
    <code>nodeName</code> attribute value as an <code>NCName</code></a>.</li>
    <li>For each node <dfn id=var-er-nc><var>n<sub><var>c</var></sub></var></dfn>
    in the <code>childNodes</code> list of <var>n</var>,
      <ol>
      <li>If <var>n<sub><var>c</var></sub></var> is <em>not</em> an
      <code>Element</code>,
      <code>Text</code>, <code>CDATASection</code>, <code>Comment</code>,
      <code>ProcessingInstruction</code>, or <code>EntityReference</code>
      node, then it is an
      <a href="#xml-well-formedness-error" id=wfe-er-child><code>xml-well-formedness-error</code></a>.</li>
      <li>Otherwise, if <var>n<sub><var>c</var></sub></var> is <em>not</em> an
      <code>EntityReference</code> node, then it is an 
      <a href="#entity-error" id=ee-entity-er><code>entity-error</code></a>.</li>
      <li>Otherwise,
      <a href="#algorithm-to-check-a-node" title="check a node">check
      <var>n<sub><var>c</var></sub></var></a> recursively.</li>
      </ol></li>
    </ol>
  </dd>
<dt>If <var>n</var> is a <code>Notation</code> node</dt>
  <dd>
    <ol>
    <li><a href="#algorithm-to-validate-an-ncname">Validate the
    <code>nodeName</code> attribute value as an <code>NCName</code></a>.</li>
    <li><a href="#algorithm-to-validate-a-public-identifier" title="validate a public identifier">Validate
    the <code>publicId</code> attribute value as a public identifier</a>.</li>
    <li><a href="#algorithm-to-validate-a-system-identifier" title="validate a system identifier">Validate
    the <code>systemId</code> attribute value as a system identifier</a>.</li>
    <li>If the <code>childNodes</code> list of <var>n</var> contains
    any nodes, they are in
    <a href="#xml-well-formedness-error" id=wfe-notation-child><code>xml-well-formedness-error</code></a>.</li>
    </ol>
  </dd>
<dt>If <var>n</var> is a <code>ProcessingInstruction</code> node</dt>
  <dd>
    <ol>
    <li>If the <code>target</code> attribute value matches to the string
    <code>xml</code> in any case combination, then raise a 
    <a href="#xml-well-formedness-error" id=wfe-pi-xml><code>xml-well-formedness-error</code></a>.</li>
    <li>Otherwise, <a href="#algorithm-to-validate-an-ncname">validate the
    <code>target</code> attribute value as an <code>NCName</code></a>.</li>
    <li>Then,
    <a href="#algorithm-to-validate-an-xml-character-data" title="validate an XML string">validate
    the <code>data</code> attribute value as an <abbr>XML</abbr> character
    data</a>.</li>
    <li>If the <code>data</code> attribute value contains a string
    <code>?></code>, then raise a 
    <a href="#xml-well-formedness-error" id=wfe-pi-pic><code>xml-well-formedness-error</code></a>.</li>
    <li>If the <code>data</code> attribute value starts with either
    <code class=char>U+0009</code> <code class=charname>CHARACTER
    TABULATION</code>, <code class=char>U+000A</code> <code class=charname>LINE
    FEED</code>, <code class=char>U+000D</code> <code class=charname>CARRIAGE
    RETURN</code>, or <code class=char>U+0020</code>
    <code class=charname>SPACE</code> character, then raise a
    <a href="#round-trip-error" id=rte-pi-s><code>round-trip-error</code></a>.</li>
    <li>If the <code>childNodes</code> list of <var>n</var> contains
    any nodes, then raise an
    <a href="#xml-well-formedness-error" id=wfe-pi-child><code>xml-well-formedness-error</code></a>.</li>
    <li class=ed>@@ Warn if not declared
    </ol>
  </dd>
<dt>If <var>n</var> is a <code>Text</code> node</dt>
  <dd>
    <ol>
    <li><a href="#algorithm-to-validate-an-xml-character-data" title="validate an XML string">Validate the 
    <code>data</code> attribute value as an <abbr>XML</abbr> character
    data</a>.</li>
    <li>If the <code>childNodes</code> list of <var>n</var> contains
    any nodes, they are in
    <a href="#xml-well-formedness-error" id=wfe-text-child><code>xml-well-formedness-error</code></a>.</li>
    </ol>
  </dd>
<dt>Otherwise</dt>
  <dd><span class=ed>xml-well-formedness-error?  unknown-error?</span></dd>
</dl>

</div>

</div>

<div id=classes class=section>
<h3>Character Classes</h3>

<p>This section defines a couple of character classes.
These classes are referred to by algorithms specified above.</p>

<p>Character class <dfn id=class-Char10><code>Char10</code></dfn> 
contains the following characters:</p>
<ul>
<li><code class=char>U+0009</code> <code class=charname>CHARACTER
TABULATION</code></li>
<li><code class=char>U+000A</code> <code class=charname>LINE FEED</code></li>
<li><code class=char>U+000D</code> <code class=charname>CARRIAGE
RETURN</code></li>
<li><code class=char>U+0020</code> <code class=charname>SPACE</code>
.. <code class=char>U+D7FF</code></li>
<li><code class=char>U+E000</code> .. <code class=char>U+FFFD</code>
<code class=charname>REPLACEMENT CHARACTER</code></li>
<li><code class=char>U+10000</code> .. <code class=char>U+10FFFF</code></li>
</ul>
<div class="note memo">
<p>This character class contains all characters allowed in the production rule
<a href="http://www.w3.org/TR/2006/REC-xml-20060816/#NT-Char"><code>Char</code></a>
of <abbr>XML</abbr> 1.0
<cite class="bibref normative">[<a href="#ref-XML">XML</a>]</cite>.</p>
</div>

<p>Character class <dfn id=class-CompatChar10><code>CompatChar10</code></dfn> 
contains the following characters:</p>
<ul>
<li class=ed>@@ <q>Document authors are encouraged to avoid "compatibility characters", as defined in section 6.8 of [Unicode @@ Unicode 2.0 @@] (see also D21 in section 3.6 of [Unicode3]).</q></li>
</ul>

<p>Character class <dfn id=class-ControlChar10><code>ControlChar10</code></dfn> 
contains the following characters:</p>
<ul>
<li><code class=char>U+007F</code> <code class=charname>DELETE</code> ..
<code class=char>U+0084</code> <code class=charname>INDEX</code></li>
<li><code class=char>U+0086</code> <code class=charname>START OF SELECTED
AREA</code> .. <code class=char>U+009F</code> <code class=charname>APPLICATION
PROGRAM COMMAND</code></li>
<li><code class=char>U+FDD0</code> .. <code class=char>U+FDEF</code></li>
<li><code class=char>U+1FFFE</code> .. <code class=char>U+1FFFF</code></li>
<li><code class=char>U+2FFFE</code> .. <code class=char>U+2FFFF</code></li>
<li><code class=char>U+3FFFE</code> .. <code class=char>U+3FFFF</code></li>
<li><code class=char>U+4FFFE</code> .. <code class=char>U+4FFFF</code></li>
<li><code class=char>U+5FFFE</code> .. <code class=char>U+5FFFF</code></li>
<li><code class=char>U+6FFFE</code> .. <code class=char>U+6FFFF</code></li>
<li><code class=char>U+7FFFE</code> .. <code class=char>U+7FFFF</code></li>
<li><code class=char>U+8FFFE</code> .. <code class=char>U+8FFFF</code></li>
<li><code class=char>U+9FFFE</code> .. <code class=char>U+9FFFF</code></li>
<li><code class=char>U+AFFFE</code> .. <code class=char>U+AFFFF</code></li>
<li><code class=char>U+BFFFE</code> .. <code class=char>U+BFFFF</code></li>
<li><code class=char>U+CFFFE</code> .. <code class=char>U+CFFFF</code></li>
<li><code class=char>U+DFFFE</code> .. <code class=char>U+DFFFF</code></li>
<li><code class=char>U+EFFFE</code> .. <code class=char>U+EFFFF</code></li>
<li><code class=char>U+FFFFE</code> .. <code class=char>U+FFFFF</code></li>
<li><code class=char>U+10FFFE</code> .. <code class=char>U+10FFFF</code></li>
</ul>
<div class="note memo">
<p>This character class contains the characters listed in the Note in
<a href="http://www.w3.org/TR/2006/REC-xml-20060816/#charsets">Section 2.2</a>
of <abbr>XML</abbr> 1.0
<cite class="bibref normative">[<a href="#ref-XML">XML</a>]</cite>,
as amended by
<a href="http://www.w3.org/XML/xml-V10-4e-errata#E02">errata</a>.</p>
</div>

<p>The character class <dfn id=class-NameStartChar10><code>NameStartChar10</code></dfn> 
contains the following characters:</p>
<ul class=ed>
</ul>
<div class="note memo">
<p>This character class contains all characters allowed as the first character
of a string matching to the production rule
<a href="http://www.w3.org/TR/2006/REC-xml-20060816/#NT-Name"><code>Name</code></a>
of <abbr>XML</abbr> 1.0
<cite class="bibref normative">[<a href="#ref-XML">XML</a>]</cite>.</p>
</div>

<p>The character class <dfn id=class-NameChar10><code>NameChar10</code></dfn> 
contains the following characters:</p>
<ul>
<li>The characters in the character class
<a href="#class-NameStartChar10">NameStartChar10</a>.</li>
<li class=ed></li>
</ul>
<div class="note memo">
<p>This character class contains all characters allowed as the second
character of a string matching to the production rule
<a href="http://www.w3.org/TR/2006/REC-xml-20060816/#NT-Name"><code>Name</code></a>
of <abbr>XML</abbr> 1.0
<cite class="bibref normative">[<a href="#ref-XML">XML</a>]</cite>.</p>
</div>

<p>The character class <dfn id=class-PubidChar><code>PubidChar</code></dfn>
contains the following characters:</p>
<ul>
<li><code class=char>U+0009</code> <code class=charname>CHARACTER 
TABULATION</code></li>
<li><code class=char>U+000A</code> <code class=charname>LINE FEED</code></li>
<li><code class=char>U+000D</code> <code class=charname>CARRIAGE
RETURN</code></li>
<li><code class=char>U+0020</code> <code class=charname>SPACE</code></li>
<li><code class=char>U+0021</code> <code class=charname>EXCLAMATION MARK</code>
(<code class=char>!</code>)</li>
<li><code class=char>U+0023</code> <code class=charname>DOLLAR SIGN</code>
(<code class=char>$</code>)</li>
<li><code class=char>U+0024</code> <code class=charname>NUMBER SIGN</code>
(<code class=char>#</code>)</li>
<li><code class=char>U+0025</code> <code class=charname>PERCENT SIGN</code>
(<code class=char>%</code>)</li>
<li><code class=char>U+0027</code> <code class=charname>APOSTROPHE</code>
(<code class=char>'</code>)</li>
<li><code class=char>U+0028</code> <code class=charname>LEFT PARENTHESIS</code>
(<code class=char>(</code>)</li>
<li><code class=char>U+0029</code> <code class=charname>RIGHT
PARENTHESIS</code> (<code class=char>)</code>)</li>
<li><code class=char>U+002A</code> <code class=charname>ASTERISK</code>
(<code class=char>*</code>)</li>
<li><code class=char>U+002B</code> <code class=charname>PLUS SIGN</code>
(<code class=char>+</code>)</li>
<li><code class=char>U+002C</code> <code class=charname>COMMA</code>
(<code class=char>,</code>)</li>
<li><code class=char>U+002D</code> <code class=charname>HYPHEN-MINUS</code>
(<code class=char>-</code>)</li>
<li><code class=char>U+002E</code> <code class=charname>FULL STOP</code>
(<code class=char>.</code>)</li>
<li><code class=char>U+002F</code> <code class=charname>SOLIDUS</code>
(<code class=char>/</code>)</li>
<li><code class=char>U+0030</code> <code class=charname>DIGIT ZERO</code>
(<code class=char>0</code>) .. <code class=char>U+0039</code>
<code class=charname>DIGIT NINE</code> (<code class=char>9</code>)</li>
<li><code class=char>U+003A</code> <code class=charname>COLON</code>
(<code class=char>:</code>)</li>
<li><code class=char>U+003B</code> <code class=charname>SEMICOLON</code>
(<code class=char>;</code>)</li>
<li><code class=char>U+003D</code> <code class=charname>EQUAL SIGN</code>
(<code class=char>=</code>)</li>
<li><code class=char>U+003F</code> <code class=charname>QUESTION MARK</code>
(<code class=char>?</code>)</li>
<li><code class=char>U+0040</code> <code class=charname>COMMERCIAL AT</code>
(<code class=char>@</code>)</li>
<li><code class=char>U+0041</code> <code class=charname>LATIN CAPITAL LETTER
A</code> (<code class=char>A</code>) .. <code class=char>U+005A</code>
<code class=charname>LATIN CAPITAL LETTER Z</code> 
(<code class=char>Z</code>)</li>
<li><code class=char>U+005F</code> <code class=charname>LOW LINE</code>
(<code class=char>_</code>)</li>
<li><code class=char>U+0061</code> <code class=charname>LATIN CAPITAL LETTER
A</code> (<code class=char>A</code>) .. <code class=char>U+007A</code>
<code class=charname>LATIN CAPITAL LETTER Z</code> 
(<code class=char>Z</code>)</li>
</ul>
<div class="note memo">
<p>This character class contains all characters allowed in the production rule
<a href="http://www.w3.org/TR/2006/REC-xml-20060816/#NT-PubidChar"><code>PubidChar</code></a>
of <abbr>XML</abbr> 1.0
<cite class="bibref normative">[<a href="#ref-XML">XML</a>]</cite>.</p>
</div>

</div>

</div><!-- ed -->

</div><!-- section -->


<div class=section>
<h2>Obsolete features</h2>

<div class=section id=features>
<h3>The DOM feature string for the DOM Document Type Definitions</h3>

<p>Ealier versions of this specification defined the DOM feature <cite
class="bibref normative">[<a href="#ref-DOM3CORE">DOM3CORE</a>]</cite>
<dfn
id=feature-XDoctype><code>http://suika.suikawiki.org/www/2006/feature/XDoctype</code></dfn>
version <dfn id=feature-XDoctype-3.0><code>3.0</code></dfn>.
</div><!-- section -->

<div class=section>
<h3>Obsolete attribute</h3>

<p>The <code id=internalSubset>internalSubset</code> attribute of the
<a
href="#DocumentTypeDefinition"><code>DocumentTypeDefinition</code></a>
interface has been removed.

<p>The <dfn title=dom-Entity-hasReplacementTree><code
id=hasReplacementTree>hasReplacementTree</code></dfn> attribute of the
<code>Entity</code> interface <em class=rfc2119>MUST</em> return
<span>false</span>.

<div class="note memo">

<p>The attribute was used to get or set whether the <span
title=concept-entity>entity</span> has the replacement subtree (as its
<code title=dom-Node-childNodes>childNodes</code>) or not.

</div>

<pre class=idl><code>partial interface <span>Element</span> {
  readonly attribute DOMString? <span title=dom-manakaiBaseURI>manakaiBaseURI</span>;
};

partial interface <span>ProcessingInstruction</span> {
  readonly attribute DOMString? <span title=dom-manakaiBaseURI>manakaiBaseURI</span>;
};</code></pre>

<p>The <dfn title=dom-manakaiBaseURI><code>manakaiBaseURI</code></dfn>
attribute of the <code>Element</code> and
<code>ProcessingInstruction</code> interfaces <em
class=rfc2119>MUST</em> return <span>null</span>.

</div><!-- section -->

</div><!-- section -->

<div id="references" class="section reference">
<h2 class=no-num>References</h2>

<div class=ed>
<p>Need to update references
</div>

<div id="normative-references" class="section normative reference">
<h3 class=no-num>Normative References</h3>

<dl>

<dt id=ref-DOM>DOM
<dd><cite><a href="http://dom.spec.whatwg.org/">DOM
Standard</a></cite>, WHATWG.

<dt id=ref-DOM3CORE>DOM3CORE</dt>
  <dd><cite><a href="http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407">Document
  Object Model (<abbr>DOM</abbr>) Level 3 Core Specification, Version 
  1.0</a></cite>, <abbr>W3C</abbr> Recommendation, <time datetime=2004-04-07>7
  April 2004</time>.  <em>This</em> version of the specification is referenced.
  The latest version of the specification is available at
  <code class=uri>&lt;<a href="http://www.w3.org/TR/DOM-Level-3-Core">http://www.w3.org/TR/DOM-Level-3-Core</a>></code>.</dd>
<dt id=ref-DOMBIND>DOMBIND</dt>
  <dd><cite><a href="http://www.w3.org/TR/2007/WD-DOM-Bindings-20071017/">Language
  Bindings for <abbr>DOM</abbr> Specifications</a></cite>, <abbr>W3C</abbr>
  Working Draft, <time datetime=2007-10-17>17 October 2007</time>.  
  <em>This</em> version of the specification is referenced.  The latest version
  of the specification is available at
  <code class=uri>&lt;<a href="http://www.w3.org/TR/DOM-Bindings/">http://www.w3.org/TR/DOM-Bindings/</a>></code>.</dd>
<dt id=ref-DOMPERL>DOMPERL</dt>
  <dd><cite><a href="http://suika.suikawiki.org/gate/2005/sw/manakai/DOM%20Perl%20Binding">manakai's
  <abbr>DOM</abbr> Perl Binding</a></cite>, editor's draft.  Work in 
  progress.</dd>

<dt id=ref-FETCH>FETCH <dd><cite><a
href="http://fetch.spec.whatwg.org/">Fetch Standard</a></cite>,
WHATWG.

<dt id=ref-HTML>HTML

<dd><a
href="http://www.whatwg.org/specs/web-apps/current-work/"><cite>HTML</cite></a>,
<abbr title="Web Hypertext Application Technology Working
Group">WHATWG</abbr>.

<dt id=ref-INFOSET>INFOSET</dt>
  <dd><cite><a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204"><abbr>XML</abbr>
  Information Set (Second Edition)</a></cite>, <abbr>W3C</abbr> Recommendation,
  <time datetime=2004-02-04>4 February 2004</time>.  <em>This</em> version of
  the specification is referenced.  The latest version of the specification is
  available at
  <code class=uri>&lt;<a href="http://www.w3.org/TR/xml-infoset">http://www.w3.org/TR/xml-infoset</a>></code>.</dd>
<dt id="ref-KEYWORDS">KEYWORDS</dt>
  <dd><cite><a href="urn:ietf:rfc:2119">Key words for use in 
  <abbr>RFCs</abbr> to Indicate Requirement Levels</a></cite>,
  <abbr title="Internet Engineering Task Force">IETF</abbr> 
  <a href="urn:ietf:bcp:14"><abbr title="Best Current Practice">BCP</abbr> 
  14</a>, <abbr title="Request for Comments">RFC</abbr> 2119, 
  <time datetime=1997-03>March 1997</time>.
  <em>This</em> version of the specification is referenced.</dd>
<dt id=ref-MANAKAI>MANAKAI</dt>
  <dd><cite><a href="http://suika.suikawiki.org/gate/2005/sw/manakai/DOM%20Extensions">
  manakai's <abbr>DOM</abbr> Extensions</a></cite>, editor's draft.  Work in 
  progress.</dd>

<dt id=ref-XML>XML

<dd><a href="http://www.w3.org/TR/xml/"><cite>Extensible Markup
Language (<abbr>XML</abbr>) 1.0</cite></a>, W3C.

<dt id=ref-XML11>XML11

<dd><a href="http://www.w3.org/TR/xml11/"><cite>Extensible Markup
Language (<abbr>XML</abbr>) 1.1</cite></a>, W3C.

<dt id=ref-XMLNS>XMLNS

<dd><a href="http://www.w3.org/TR/xml-names/"><cite>Namespaces in XML
1.0</cite></a>, W3C.

<dt id=ref-XMLNS11>XMLNS11

<dd><a href="http://www.w3.org/TR/xml-names11/"><cite>Namespaces in
XML 1.1</cite></a>, W3C.

<dt id=ref-XML5>XML5

<dd><a
href="https://dvcs.w3.org/hg/xml-er/raw-file/tip/Overview.html"><cite>XML-ER</cite></a>,
Anne van Kesteren.

</dl>
</div>

<div id="informative-references" class="section informative reference">
<h3 class=no-num>Non-normative References</h3>

<dl>
<dt id=ref-DOM1WD>DOM1WD</dt>
  <dd><cite><a href="http://www.w3.org/TR/WD-DOM-971209/">Document Object
  Model Specification</a></cite>, <abbr>W3C</abbr> Working Draft,
  <time datetime=1997-12-09>9 December 1997</time>.</dd>
  <dd><cite><a href="http://www.w3.org/TR/WD-DOM-19980318/">Document Object
  Model Specification</a></cite>, <abbr>W3C</abbr> Working Draft,
  <time datetime=1998-03-18>18 March 1998</time>.</dd>
  <dd><cite><a href="http://www.w3.org/TR/1998/WD-DOM-19980416/">Document 
  Object Model Specification, Version 1.0</a></cite>, <abbr>W3C</abbr> Working
  Draft, <time datetime=1998-04-16>16 April 1998</time>.</dd>
<dt id=ref-DOM3AS>DOM3AS</dt>
  <dd><cite><a href="http://www.w3.org/TR/2002/NOTE-DOM-Level-3-AS-20020725/">Document
  Object Model (<abbr>DOM</abbr>) Level 3 Abstract Schemas Specification,
  Version 1.0</a></cite>, <abbr>W3C</abbr> Note, <time datetime=2002-07-25>25
  July 2002</time>.  The latest version of the specification is available at
  <code class=uri>&lt;<a href="http://www.w3.org/TR/DOM-Level-3-AS">http://www.w3.org/TR/DOM-Level-3-AS</a>></code>.</dd>

<dt id=ref-XMLBASE>XMLBASE

<dd><cite><a href="http://www.w3.org/TR/xmlbase/">XML Base</a></cite>,
W3C.

<dt id=ref-XSAPI>XSAPI</dt>
  <dd><cite><a href="http://www.w3.org/Submission/2004/SUBM-xmlschema-api-20040309/"><abbr>XML</abbr>
  Schema <abbr>API</abbr></a></cite>, <abbr>W3C</abbr> Member Submission,
  <time datetime=2004-03-09>9 March 2004</time>.  The latest version of the
  specification is available at
  <code class=uri>&lt;<a href="http://www.w3.org/Submission/xmlschema-api/">http://www.w3.org/Submission/xmlschema-api/</a>></code>.</dd>
</dl>
</div>

</div>

</body>
</html>
